using System;
using System.Collections;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Web;
using System.Web.SessionState;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Web.UI.HtmlControls;
using System.Web.Security;
using System.Data.SqlClient;
using System.IO;
using System.Xml;
using System.Xml.Xsl;
using System.Xml.XPath;
using System.Text;
using System.Text.RegularExpressions;
using System.Configuration;
using System.Collections.Specialized;

using iTextSharp.text;
using iTextSharp.text.pdf;
using iTextSharp.text.html;

using UrlQuery;

namespace daikon
{
	/// <summary>
	/// Summary description for daikon.
	/// </summary>
	/// 

	public partial class daikon_page : System.Web.UI.Page
	{
		protected UrlQuery.UrlQuery thisPageURL;
		//        protected UrlQuery.UrlQuery prevPageURL;
		protected string prevPageURL;
		protected DaikonUser currUser;
		protected string xslTemplate;
		protected string outputMessage1;
		protected string outputMessage2;
		protected string sareNamespace = "";
		protected string projectNum = "";
       
		protected StringWriter writerString;
		protected XmlTextWriter xmlWriter;
		protected XsltArgumentList xsltArgs;

		XmlDocument changeDoc;
		XPathNavigator changeNav;

		DaikonGrantFieldValues staticVals;

		protected void Page_PreInit(object sender, System.EventArgs e)
		{
			thisPageURL = new UrlQuery.UrlQuery();
			//            prevPageURL = (UrlQuery.UrlQuery)(Session["prevPageURL"]);
			prevPageURL = (string)Session["prevPageURL"];
			//            Session["prevPageURL"] = (UrlQuery.UrlQuery)Session["thisPageURL"];
			if (Request.Form["btnCancel"] != null)
				Response.Redirect(prevPageURL, true);

			staticVals = new DaikonGrantFieldValues();
			
			staticVals.DaikonGrantFieldValues(ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
		}

        protected void Page_Error(object sender, System.EventArgs e)
        {
            Exception ex = Server.GetLastError();
            ErrorMessage.LastException = ex;
            Response.Redirect("ErrorReport.aspx"); 
        }

		protected void Page_Load(object sender, System.EventArgs e)
		{
			/*
						thisPageURL = new UrlQuery.UrlQuery();
			//            prevPageURL = (UrlQuery.UrlQuery)(Session["prevPageURL"]);
						prevPageURL = (string)Session["prevPageURL"];
			//            Session["prevPageURL"] = (UrlQuery.UrlQuery)Session["thisPageURL"];
						if (Request.Form["btnCancel"] != null)
							Response.Redirect(prevPageURL, true);
			*/
			//            prevPageURL = (UrlQuery.UrlQuery)(Session["thisPageURL"]);
			if ((Request.Params["do"] == "logout") || (Session.IsNewSession) || (Session["curruser"] == null) || (Session["sessionkey"] == null))
			{
				try
				{
					sareChangeMailer();
				}
				catch (SystemException ex)
				{
					Response.Write("Unable to send confirmation email" + ex.Message);
				}
				logOut();
				//Response.Redirect("login.aspx", true);
			}
			else
			{
				currUser = (DaikonUser)(Session["currUser"]);
				writerString = new StringWriter();
				xmlWriter = new XmlTextWriter(writerString);
				xsltArgs = new XsltArgumentList();

				if (Session["changedoc"] != null)
				{
					changeDoc = (XmlDocument)(Session["changedoc"]);
					changeNav = changeDoc.CreateNavigator();
					//                changeNav.MoveToRoot();
					//                changeDoc.Save(Server.MapPath("~/logs/") + currUser.Username + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.xml");
				}
				else
				{
					changeDoc = new XmlDocument();
					//                changeDoc.BaseURI = "http://www.sare.org/";

					changeNav = changeDoc.CreateNavigator();
					//                changeNav.MoveToRoot();

					changeNav.AppendChildElement("", "SAREroot", "", "");
					changeNav.MoveToChild("SAREroot", "");
					/*
									changeNav.AppendChildElement("", "users", "", "");
									changeNav.AppendChildElement("", "projects", "", "");
									changeNav.AppendChildElement("", "events", "", "");
									changeNav.AppendChildElement("", "profiles", "", "");
									changeNav.AppendChildElement("", "resources", "", "");
					*/
					Session["changedoc"] = changeDoc;
				}

				//            if (changeNav.IsEmptyElement())


                if ((Session.IsNewSession) || (Session["curruser"] == null) || (Session["sessionkey"] == null))
                {
                    Response.Redirect("login.aspx", true);
                }
                else if (Request.Form["btnCancel"] != null)
                    Response.Redirect(prevPageURL, true);
                else if (Request.Form["cmdCancel"] != null)
                {
                    if (Request.Params["profileID"] != null)
                        CancelProfile(Convert.ToInt32(Request.Params["profileID"]));
                    Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                }
                else if (Request.Form["searchCancel"] != null)
                {
                    Response.Redirect("sare_main.aspx");
                }
                else if (Request.Params["massmail"] != null)
                    MassClaimMailer(sender, e);
                else if (Request.Form["formID"] == "editreport")
                    reportSubmissionHandler(sender, e);
                else if (Request.Form["cmdChangeUserDetails"] == "Change Details")
                    UserEditFormHandler(sender, e);
                else if (Request.Form["cmdCreateProj"] == "Create Project" || Request.Form["btnAdminCreateProjConfirm"] == "Create and Edit")
                    createProjectFormHandler(sender, e);
                else if (Request.Form["cmdCreatePDP"] == "Create State Report" || Request.Form["btnAdminCreatePDPConfirm"] == "Create and Edit")
                    createPDPFormHandler(sender, e);
                else if (Request.Form["cmdCancelChangeUserDetails"] == "Cancel Changes")
                {
                    Session.Remove("statusMessage1");
                    //Session.Remove("editingUser");
                    //Response.Redirect("sare_main.aspx");
                    string strRedirect;
                    if (Session["currUser"] == Session["editingUser"])
                    {
                        writerString = new StringWriter();
                        xmlWriter = new XmlTextWriter(writerString);
                        DaikonUser editingUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
                        Session["editingUser"] = editingUser;
                        editingUser.toXML(xmlWriter, "editing");
                        xsltArgs.AddParam("loggedinUser", "", currUser.Username);
                        xsltArgs.AddParam("editingUser", "", editingUser.Username);
                        xmlWriter.WriteElementString("lastname", editingUser.LastName);
                        strRedirect = "sare_main.aspx";
                    }
                    else
                        strRedirect = "sare_main.aspx?do=userlist";
                    Session.Remove("editingUser");
                    Response.Redirect(strRedirect);
                }
                else if (Request.Form["cmdDeleteUser"] == "Delete User")
                {
                    if (Request.Form["ConfirmDelete"] != null)
                    {
                        string deletedUsername = ((DaikonUser)(Session["editingUser"])).Username;
                        DaikonUser editedUser = new DaikonUser(deletedUsername); //(DaikonUser)Session["editingUser"];
                        editedUser.deleteUserFromDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], editedUser.Username);
                        DeleteMailer(currUser.Email, editedUser.Email, "User", editedUser.Username, editedUser.Region);
                        Session["confirmthis"] = writerString.ToString();
                        Session["statusMessage2"] = "User " + editedUser.Username + " is Deleted.";
                        Session.Remove("editingUser");
                        Response.Redirect("sare_main.aspx?do=confirm&confirmType=deleteuser");
                        //Response.Redirect("sare_main.aspx");
                    }
                }
                else if (Request.Form["cmdChangeParticipantDetails"] == "Save Participant" ||
                         Request.Form["cmdChangeParticipantDetails"] == "Update Participant")
                {
                    if (Request.Params["do"] == "addparticipant")
                    {
                        AddParticipantFormHandler(sender, e);
                    }
                    else if (Request.Params["do"] == "editparticipant")
                    {
                        UpdateParticipantFormHandler(sender, e);
                    }
                    //projectDetialsUpdateHandler(sender, e);
                    //				Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                }
                else if (Request.Form["cmdAddNextParticipant"] == "Save and Add Next Participant")
                {
                    if (Request.Params["do"] == "addparticipant")
                    {
                        AddParticipantFormHandler(sender, e);
                    }
                    else if (Request.Params["do"] == "editparticipant")
                    {
                        UpdateParticipantFormHandler(sender, e);
                    }
                    //projectDetialsUpdateHandler(sender, e);
                    //				Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                }
                else if (Request.Form["cmdDeleteParticipantDetails"] == "Delete Participant")
                {
                    if (Request.Form["ConfirmDelete"] != null)
                    {

                        DaikonParticipant deleteParticipant = new DaikonParticipant();

                        deleteParticipant.deleteParticipantFromDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Int32.Parse(Request.Params["user"]));

                        Session.Remove("editparticipant");
                        Session.Remove("statusMessage1");
                        //projectDetialsUpdateHandler(sender, e);
                        Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                    }
                    else
                        Session["statusMessage1"] = "The participant failed to delete.  To delete a participant, check the Confirm Delete box, then click Delete Participant.";
                }
                else if (Request.Form["cmdBackToOverview"] != null)
                {
                    string thisGrant = (string)(Session["currGrant"]);
                    int projType = currUser.Grants[thisGrant].Type;
                    if (projType == 10)
                        Response.Redirect("sare_main.aspx?do=editPDP&pn=" + Session["currGrant"]);
                    else
                        Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                }
                else if (Request.Form["cmdChangeCoordinatorDetails"] == "Save Coordinator" ||
                    Request.Form["cmdChangeCoordinatorDetails"] == "Update Coordinator")
                {
                    if (Request.Params["do"] == "addcoordinator")
                    {
                        AddCoordinatorFormHandler(sender, e);
                    }
                    else if (Request.Params["do"] == "editcoordinator")
                    {
                        UpdateCoordinatorFormHandler(sender, e);
                    }
                }
                else if (Request.Form["cmdAddNextCoordinator"] == "Save and Add Next Coordinator")
                {
                    if (Request.Params["do"] == "addcoordinator")
                    {
                        AddCoordinatorFormHandler(sender, e);
                    }
                    else if (Request.Params["do"] == "editcoordinator")
                    {
                        UpdateCoordinatorFormHandler(sender, e);
                    }
                }
                else if (Request.Form["cmdDeleteCoordinatorDetails"] == "Delete Coordinator")
                {
                    if (Request.Form["ConfirmDelete"] != null)
                    {

                        DaikonParticipant deleteParticipant = new DaikonParticipant();

                        deleteParticipant.deleteParticipantFromDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Int32.Parse(Request.Params["user"]));

                        Session.Remove("editcoordinator");
                        Session.Remove("statusMessage1");
                        Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                    }
                }
                else if (Request.Form["cmdDeleteCoordinatorDetails"] == "Remove Coordinator")
                {
                    if (Request.Form["ConfirmDelete"] != null)
                    {
                        string thisGrant = (string)(Session["currGrant"]);
                        int projType = currUser.Grants[thisGrant].Type;
                        if (Request.Params.Get("pn") != null)
                            thisGrant = Request.Params.Get("pn");

                        DaikonParticipant deleteParticipant = new DaikonParticipant();
                        if (thisGrant == "")
                            deleteParticipant.deleteParticipantFromDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Int32.Parse(Request.Params["user"]));
                        else
                            deleteParticipant.deleteCoordinatorFromDB(Request.Params["user"], currUser.Grants[thisGrant].CoreID);

                        Session.Remove("editcoordinator");
                        Session.Remove("statusMessage1");
                        RemoveCoordinatorMailer(currUser.Email, currUser.Username, currUser.Grants[thisGrant].projNum, currUser.Grants[thisGrant].projTitle);
                        if (projType == 10)
                            Response.Redirect("sare_main.aspx?do=editPdp&pn=" + Session["currGrant"]);
                        else
                            Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                    }
                }
                else if (Request.Form["cmdSubmit"] == "Save and Continue To Page 2")
                {
                    int profileID = AddProfile1(sender, e);
                    if (profileID > 0)
                        Response.Redirect("sare_main.aspx?do=addProfile2&profileID=" + profileID.ToString() + "&type=" + Request.Params["type"]);
                    else if (profileID == 0)
                        Session["statusMessage1"] = "Systems and Commodities Category are required fields.";
                    else
                        Session["statusMessage1"] = "Other(s) text required.";
                }
                else if (Request.Form["cmdSubmit"] == "Save and Back To My Project")
                {
                    AddProfile2(sender, e);
                    //projectDetialsUpdateHandler(sender, e);
                    Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                }
                else if (Request.Form["cmdSubmit"] == "Save and Return to Page 1")
                {
                    AddProfile2(sender, e);
                    Response.Redirect("sare_main.aspx?do=addProfile&type=" + Request.Params["type"] + "&pn=" + Session["currGrant"]);
                }               
                else if (Request.Form["btnCreateFinalReport"] == "Create New")
                {
                    Response.Redirect("sare_main.aspx?do=editRept&pn=" + Session["currGrant"] + "&y=" + Request.Form["addFinalReportYear"] + "&t=1");
                }
                else if (Request.Form["btnCreateAnnualReport"] == "Create New")
                {
                    Response.Redirect("sare_main.aspx?do=editRept&pn=" + Session["currGrant"] + "&y=" + Request.Form["addAnnualReportYear"] + "&t=0");
                }
				if (Request.Form["profileSearch"] != null)
				{
					ProfileSearchHandler(sender, e);
				}
				if (Request.Form["picall"] != null)
				{
					PICallHandler(sender, e);
				}
				if (Request.Form["confirmmessage"] != null)
				{
					SendMessageHandler(sender, e);
				}
				if (Request.Form["sendmail"] != null)
				{
					if (Session["queuedmessage"] != null)
					{
						sareMassMailer((PackagedUserMessage)Session["queuedmessage"]);
						Session.Remove("queuedmessage");
                        Session["statusMessage2"] = "Message has been sent.";
                        Response.Redirect("sare_main.aspx?do=confirm&confirmType=update");
					}
					else
					{
						Session["statusMessage1"] = "Unable to load sent message.";
					}
					Response.Redirect("sare_main.aspx");
				}
				if (Request.Form["savepicall"] != null)
				{
					SavePICallHandler(sender, e);
				}
				if (Request.Form["btnSaveBasics"] != null)
				{
					projectSubmissionHandler(sender, e);
				}
                if (Request.Form["btnProjectDetailsSubmit"] != null || Request.Form["btnProjectDetailsApprove"] != null ||
                    Request.Form["btnProjectDetailsNotApprove"] != null)
                {
                    /*
                    if (Request.Params["t"] == null)
                    {
                        if (Session["currReport"] == null)
                        {
                            DaikonGrant projectDetails = currUser.Grants[(string)(Session["currGrant"])];
                            int count = projectDetails.Reports.Count;
                            int type = 0;
                            int rept_year = 0;

                            for (int cnt = 0; cnt < count; cnt++)
                            {
                                if (projectDetails.Reports.Values[cnt].Type == 2)
                                {
                                    rept_year = projectDetails.Reports.Values[cnt].Year;
                                    type = 2;
                                    Session["currReport"] = projectDetails.Reports[rept_year.ToString() + type.ToString()];
                                }
                            }
                        }                       
                    }
                    */
                    
                    if (Request.Params["t"] != null && Request.Params["t"] != "2")
                        reportSubmissionHandler(sender, e);
                    else
                    {
                        //projectOverviewSubmissionApproveHandler(sender, e);
                        projectDetialsSubmissionHandler(sender, e);
                    }
                }
                if (Request.Form["btnPDPDetailsSubmit"] != null || Request.Form["btnPDPDetailsApprove"] != null ||
                    Request.Form["btnPDPDetailsNotApprove"] != null)
                {
                    PDPSubmissionHandler(sender, e);
                }
                if (Request.Form["btnSubmit"] != null)
                {
                    reportSubmissionHandler(sender, e);
                }
				if (Request.Form["btnAssignClaimCode"] != null)
				{
					AssignClaimSubmissionHandler(sender, e);
				}
				if (Request.Form["Claim"] != null)
				{
					ClaimProjectFormHandler(sender, e);
				}
                if (Request.Form["ClaimPDP"] != null)
                {
                    ClaimPdpFormHandler(sender, e);
                }
                if (Request.Form["PreviewDelete"] == "Preview Delete")
                {
                    string projectNum = Request.Form["projNum"];

                    if (projectNum.Length == 0)
                        Session["statusMessage1"] = "Please Enter Project Number";
                    else
                    {
                        string userSQL;
                        string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();

                        SqlConnection userConnection;
                        SqlCommand userCommand;
                        SqlDataReader userDataReader;

                        userConnection = new SqlConnection(userConnString);
                        userSQL = "ProjectOverview"; // "Select top 1 * from shared_basics where proj_num='" + projectNum + "'";
                        userCommand = new SqlCommand(userSQL, userConnection);
                        userCommand.CommandType = CommandType.StoredProcedure;
                        userCommand.Parameters.Add("@proj_num", SqlDbType.VarChar, 50).Value = projectNum;
                        userConnection.Open();
                        userDataReader = userCommand.ExecuteReader();

                        if (userDataReader.HasRows == true)
                        {
                            while (userDataReader.Read())
                            {
                                if (userDataReader["proj_type_text"].ToString() == "State Reports")
                                    Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projectNum + "&deleteProj=true");
                                else
                                    Response.Redirect("sare_main.aspx?do=editProj&pn=" + projectNum + "&deleteProj=true");
                            }
                        }
                        else
                        {
                            Session["statusMessage1"] = "Project number does not exist.";
                        }


                    }
                }
				if (Request.Form["cmdDeleteProj"] == "Delete Project")
				{
					if (Request.Form["confDel"] != null)
						DeleteProjectFormHandler(sender, e);
					else
						Response.Redirect("sare_main.aspx?do=editProj&pn=" + (string)(Session["currGrant"]) + "&deleteProj=true");
				}
				if (Request.Form["btnCancelDelete"] == "Cancel Delete")
				{
					Session.Remove("statusMessage1");
					Session.Remove("deleteProj");
					Response.Redirect("sare_main.aspx");
				}
                if (Request.Form["saveprodinfo"] == "Save" || Request.Form["savesubmitprodinfo"] == "Save and Submit")
                {
                    AddProductInfoFormHandler(sender, e);
                }
                if (Request.Form["updprodinfo"] == "Save" || Request.Form["submitprodinfo"] == "Submit for Approval" || Request.Form["approveprodinfo"] == "Approve" || Request.Form["notapproveprodinfo"] == "Not Approve")
                {
                    UpdateProductInfoFormHandler(sender, e);
                }
                if (Request.Form["deleteprodinfo"] != null)
                {
                    DeleteProductInfoFormHandler(sender, e);
                }
                if (Request.Form["btnPDF"] != null)
                {
                    string projectNum = "";
                    int reportType = 0;
                    int reportYear = 2010;
                    string path = Server.MapPath("~/assocfiles/pdf/");
                    string fileName = "pdfDocument" + DateTime.Now.Ticks + ".pdf";
                    
                    if (Request.Params.Get("pn") != null && Request.Params.Get("pn") != "")
                        projectNum = Request.Params.Get("pn");

			        if (Request.Params.Get("y") != null && Request.Params.Get("y") != "")
                        reportYear = int.Parse(Request.Params.Get("y"));			        

			        if (Request.Params.Get("t") != null && Request.Params.Get("t") != "")
                        reportType = int.Parse(Request.Params.Get("t"));

                    GeneratePDF(path, fileName, true, projectNum, Request.Form["oHidden"], reportType, reportYear);

                    
                }
                if (Request.Form["btnStateReportPDF"] != null)
                {
                    string projectNum = "";
                    string path = Server.MapPath("~/assocfiles/pdf/");
                    string fileName = "pdfDocument" + DateTime.Now.Ticks + ".pdf";

                    if (Request.Params.Get("pn") != null && Request.Params.Get("pn") != "")
                        projectNum = Request.Params.Get("pn");

                    GenerateStateReportPDF1(path, fileName, true, projectNum);
                    //GenerateSimplifiedStateReportPDF(path, fileName, true, projectNum);

                }
                if (Request.Form["btnSavePDPBasics"] != null)
                {

                    projectSubmissionHandler(sender, e);

                    string projNum = Request.Params.Get("pn");
                    string piFName = "";//Request.Form["coordFirst"];
                    string piLName = "";//Request.Form["coordLast"];
                    string piEthinicity = Request.Form["ethinicity"];
                    string piInstName = Request.Form["instituteName"];
                    string piEthinicity2 = Request.Form["ethinicity2"];
                    string piInstName2 = Request.Form["instituteName2"];
                    string piEthinicity3 = Request.Form["ethinicity3"];
                    string piInstName3 = Request.Form["instituteName3"];
                    string piAdd = "";//Request.Form["strAddress"];
                    string piCity = "";//Request.Form["strCity"];
                    string piState = "";//Request.Form["addrState"];
                    string piZip = "";//Request.Form["strZip"];
                    string piPhone = "";//Request.Form["strPhone"];
                    string piFax = "";//Request.Form["strFax"];
                    string piEmail = "";//Request.Form["strEmail"];
                    string piStatePro = Request.Form["strStatePro"];
                    string advName = Request.Form["AdvName"];
                    string advLName = Request.Form["AdvLName"];
                    string advType = Request.Form["AdvType"];
                    string advLocationState = Request.Form["AdvLocationState"];
                    string advLocationZip = Request.Form["AdvLocationZip"];
                    string advAff = Request.Form["AdvAff"];
                    string advDate = Request.Form["AdvDate"];
                    string advLoc = Request.Form["AdvLocation"];
                    string advName1 = Request.Form["AdvName1"];
                    string advLName1 = Request.Form["AdvLName1"];
                    string advType1 = Request.Form["AdvType1"];
                    string advLocationState1 = Request.Form["AdvLocationState1"];
                    string advLocationZip1 = Request.Form["AdvLocationZip1"];
                    string advAff1 = Request.Form["AdvAff1"];
                    string advDate1 = Request.Form["AdvDate1"];
                    string advLoc1 = Request.Form["AdvLocation1"];
                    string advName2 = Request.Form["AdvName2"];
                    string advLName2 = Request.Form["AdvLName2"];
                    string advType2 = Request.Form["AdvType2"];
                    string advLocationState2 = Request.Form["AdvLocationState2"];
                    string advLocationZip2 = Request.Form["AdvLocationZip2"];
                    string advAff2 = Request.Form["AdvAff2"];
                    string advDate2 = Request.Form["AdvDate2"];
                    string advLoc2 = Request.Form["AdvLocation2"];
                    string advName3 = Request.Form["AdvName3"];
                    string advLName3 = Request.Form["AdvLName3"];
                    string advType3 = Request.Form["AdvType3"];
                    string advLocationState3 = Request.Form["AdvLocationState3"];
                    string advLocationZip3 = Request.Form["AdvLocationZip3"];
                    string advAff3 = Request.Form["AdvAff3"];
                    string advDate3 = Request.Form["AdvDate3"];
                    string advLoc3 = Request.Form["AdvLocation3"];
                    string advName4 = Request.Form["AdvName4"];
                    string advLName4 = Request.Form["AdvLName4"];
                    string advType4 = Request.Form["AdvType4"];
                    string advLocationState4 = Request.Form["AdvLocationState4"];
                    string advLocationZip4 = Request.Form["AdvLocationZip4"];
                    string advAff4 = Request.Form["AdvAff4"];
                    string advDate4 = Request.Form["AdvDate4"];
                    string advLoc4 = Request.Form["AdvLocation4"];
                    string advName5 = Request.Form["AdvName5"];
                    string advLName5 = Request.Form["AdvLName5"];
                    string advType5 = Request.Form["AdvType5"];
                    string advLocationState5 = Request.Form["AdvLocationState5"];
                    string advLocationZip5 = Request.Form["AdvLocationZip5"];
                    string advAff5 = Request.Form["AdvAff5"];
                    string advDate5 = Request.Form["AdvDate5"];
                    string advLoc5 = Request.Form["AdvLocation5"];
                    string advName6 = Request.Form["AdvName6"];
                    string advLName6 = Request.Form["AdvLName6"];
                    string advType6 = Request.Form["AdvType6"];
                    string advLocationState6 = Request.Form["AdvLocationState6"];
                    string advLocationZip6 = Request.Form["AdvLocationZip6"];
                    string advAff6 = Request.Form["AdvAff6"];
                    string advDate6 = Request.Form["AdvDate6"];
                    string advLoc6 = Request.Form["AdvLocation6"];
                    string advName7 = Request.Form["AdvName7"];
                    string advLName7 = Request.Form["AdvLName7"];
                    string advAff7 = Request.Form["AdvAff7"];
                    string advName8 = Request.Form["AdvName8"];
                    string advLName8 = Request.Form["AdvLName8"];
                    string advAff8 = Request.Form["AdvAff8"];
                    string advName9 = Request.Form["AdvName9"];
                    string advLName9 = Request.Form["AdvLName9"];
                    string advAff9 = Request.Form["AdvAff9"];
                    string advName10 = Request.Form["AdvName10"];
                    string advLName10 = Request.Form["AdvLName10"];
                    string advAff10 = Request.Form["AdvAff10"];
                    string advName11 = Request.Form["AdvName11"];
                    string advLName11 = Request.Form["AdvLName11"];
                    string advAff11 = Request.Form["AdvAff11"];
                    string advName12 = Request.Form["AdvName12"];
                    string advLName12 = Request.Form["AdvLName12"];
                    string advAff12 = Request.Form["AdvAff12"];
                    string advName13 = Request.Form["AdvName13"];
                    string advLName13 = Request.Form["AdvLName13"];
                    string advAff13 = Request.Form["AdvAff13"];
                    string advName14 = Request.Form["AdvName14"];
                    string advLName14 = Request.Form["AdvLName14"];
                    string advAff14 = Request.Form["AdvAff14"];
                    string advName15 = Request.Form["AdvName15"];
                    string advLName15 = Request.Form["AdvLName15"];
                    string advAff15 = Request.Form["AdvAff15"]; 
                    string sareOutreach = Request.Form["initOut"]; 
                    int piInstType = 0;
                    int piRace = 0;
                    int piInstType2 = 0;
                    int piRace2 = 0;
                    int piInstType3 = 0;
                    int piRace3 = 0;

                    /*
                    bool american = (bool)(Request.Form["american"] == "on");
                    bool asian = (bool)(Request.Form["asian"] == "on");
                    bool black = (bool)(Request.Form["black"] == "on");
                    bool hawaiian = (bool)(Request.Form["hawaiian"] == "on");
                    bool hispanic = (bool)(Request.Form["hispanic"] == "on");
                    bool nothispanic = (bool)(Request.Form["nothispanic"] == "on");
                    bool white = (bool)(Request.Form["white"] == "on");
                    */


                    bool grant1862 = (bool)(Request.Form["Grant1862"] == "on");
                    bool grant1890 = (bool)(Request.Form["Grant1890"] == "on");

                    bool grant1862_2 = (bool)(Request.Form["Grant1862_2"] == "on");
                    bool grant1890_2 = (bool)(Request.Form["Grant1890_2"] == "on");

                    bool grant1862_3 = (bool)(Request.Form["Grant1862_3"] == "on");
                    bool grant1890_3 = (bool)(Request.Form["Grant1890_3"] == "on");

                    if (Request.Form["race"] == "american")
                        piRace = 1;
                    if (Request.Form["race"] == "asian")
                        piRace = 2;
                    if (Request.Form["race"] == "black")
                        piRace = 3;
                    if (Request.Form["race"] == "hawaiian")
                        piRace = 4;
                    if (Request.Form["race"] == "hispanic")
                        piRace = 5;
                    if (Request.Form["race"] == "nothispanic")
                        piRace = 6;
                    if (Request.Form["race"] == "white")
                        piRace = 7;
                    if (Request.Form["race"] == null)
                        piRace = 0;

                    if (grant1862 == true)
                        piInstType = 1862;
                    if (grant1890 == true)
                        piInstType = 1890;

                    if (Request.Form["race2"] == "american")
                        piRace2 = 1;
                    if (Request.Form["race2"] == "asian")
                        piRace2 = 2;
                    if (Request.Form["race2"] == "black")
                        piRace2 = 3;
                    if (Request.Form["race2"] == "hawaiian")
                        piRace2 = 4;
                    if (Request.Form["race2"] == "hispanic")
                        piRace2 = 5;
                    if (Request.Form["race2"] == "nothispanic")
                        piRace2 = 6;
                    if (Request.Form["race2"] == "white")
                        piRace2 = 7;
                    if (Request.Form["race2"] == null)
                        piRace2 = 0;

                    if (grant1862_2 == true)
                        piInstType2 = 1862;
                    if (grant1890_2 == true)
                        piInstType2 = 1890;

                    if (Request.Form["race3"] == "american")
                        piRace3 = 1;
                    if (Request.Form["race3"] == "asian")
                        piRace3 = 2;
                    if (Request.Form["race3"] == "black")
                        piRace3 = 3;
                    if (Request.Form["race3"] == "hawaiian")
                        piRace3 = 4;
                    if (Request.Form["race3"] == "hispanic")
                        piRace3 = 5;
                    if (Request.Form["race3"] == "nothispanic")
                        piRace3 = 6;
                    if (Request.Form["race3"] == "white")
                        piRace3 = 7;
                    if (Request.Form["race3"] == null)
                        piRace3 = 0;

                    if (grant1862_3 == true)
                        piInstType3 = 1862;
                    if (grant1890_3 == true)
                        piInstType3 = 1890;

                    if (piStatePro == null)
                        piStatePro = "";

                    daikonPDP.PDPContents pdpInfoToSave;
                    pdpInfoToSave = new daikonPDP.PDPContents();

                    pdpInfoToSave.ProjectNum = projNum;
                    pdpInfoToSave.PiFirstName = piFName;
                    pdpInfoToSave.PiLasttName = piLName;
                    if (piEthinicity == null)
                        pdpInfoToSave.PiEthinicity = "";
                    else
                        pdpInfoToSave.PiEthinicity = piEthinicity;
                    pdpInfoToSave.PiRace = piRace;
                    pdpInfoToSave.PiInstituteName = piInstName;
                    pdpInfoToSave.PiInstituteType = piInstType;
                    if (piEthinicity2 == null)
                        pdpInfoToSave.PiEthinicity2 = "";
                    else
                        pdpInfoToSave.PiEthinicity2 = piEthinicity2;
                    pdpInfoToSave.PiRace2 = piRace2;
                    if (piInstName2 == null)
                        pdpInfoToSave.PiInstituteName2 = "";
                    else
                        pdpInfoToSave.PiInstituteName2 = piInstName2;
                    pdpInfoToSave.PiInstituteType2 = piInstType2;
                    if (piEthinicity3 == null)
                        pdpInfoToSave.PiEthinicity3 = "";
                    else
                        pdpInfoToSave.PiEthinicity3 = piEthinicity3;
                    pdpInfoToSave.PiRace3 = piRace3;
                    if (piInstName3 == null)
                        pdpInfoToSave.PiInstituteName3 = "";
                    else
                        pdpInfoToSave.PiInstituteName3 = piInstName3;
                    pdpInfoToSave.PiInstituteType3 = piInstType3;
                    pdpInfoToSave.PiAddress = piAdd;
                    pdpInfoToSave.PiCity = piCity;
                    pdpInfoToSave.PiState = piState;
                    pdpInfoToSave.PiZip = piZip;
                    pdpInfoToSave.PiPhone = piPhone;
                    pdpInfoToSave.PiFax = piFax;
                    pdpInfoToSave.PiEmail = piEmail;                    
                    pdpInfoToSave.PiStatePro = piStatePro;
                    pdpInfoToSave.AdvisoryName = advName;
                    pdpInfoToSave.AdvisoryLName = advLName;
                    pdpInfoToSave.AdvisoryType = advType;
                    pdpInfoToSave.AdvisoryState = advLocationState;
                    pdpInfoToSave.AdvisoryZip = advLocationZip;
                    pdpInfoToSave.AdvisoryAff = advAff;
                    pdpInfoToSave.AdvisoryDate = advDate.Trim();
                    pdpInfoToSave.AdvisoryLocation = advLoc;
                    pdpInfoToSave.AdvisoryName1 = advName1;
                    pdpInfoToSave.AdvisoryLName1 = advLName1;
                    pdpInfoToSave.AdvisoryType1 = advType1;
                    pdpInfoToSave.AdvisoryState1 = advLocationState1;
                    pdpInfoToSave.AdvisoryZip1 = advLocationZip1;
                    pdpInfoToSave.AdvisoryAff1 = advAff1;
                    if (advDate1 == null)
                        pdpInfoToSave.AdvisoryDate1 = "";
                    else
                        pdpInfoToSave.AdvisoryDate1 = advDate1.Trim();
                    pdpInfoToSave.AdvisoryLocation1 = advLoc1;
                    pdpInfoToSave.AdvisoryName2 = advName2;
                    pdpInfoToSave.AdvisoryLName2 = advLName2;
                    pdpInfoToSave.AdvisoryType2 = advType2;
                    pdpInfoToSave.AdvisoryState2 = advLocationState2;
                    pdpInfoToSave.AdvisoryZip2 = advLocationZip2;
                    pdpInfoToSave.AdvisoryAff2 = advAff2;
                    if (advDate2 == null)
                        pdpInfoToSave.AdvisoryDate2 = "";
                    else
                        pdpInfoToSave.AdvisoryDate2 = advDate2.Trim();
                    pdpInfoToSave.AdvisoryLocation2 = advLoc2;
                    pdpInfoToSave.AdvisoryName3 = advName3;
                    pdpInfoToSave.AdvisoryLName3 = advLName3;
                    pdpInfoToSave.AdvisoryType3 = advType3;
                    pdpInfoToSave.AdvisoryState3 = advLocationState3;
                    pdpInfoToSave.AdvisoryZip3 = advLocationZip3;
                    pdpInfoToSave.AdvisoryAff3 = advAff3;
                    if (advDate3 == null)
                        pdpInfoToSave.AdvisoryDate3 = "";
                    else
                        pdpInfoToSave.AdvisoryDate3 = advDate3.Trim();
                    pdpInfoToSave.AdvisoryLocation3 = advLoc3;
                    pdpInfoToSave.AdvisoryName4 = advName4;
                    pdpInfoToSave.AdvisoryLName4 = advLName4;
                    pdpInfoToSave.AdvisoryType4 = advType4;
                    pdpInfoToSave.AdvisoryState4 = advLocationState4;
                    pdpInfoToSave.AdvisoryZip4 = advLocationZip4;
                    pdpInfoToSave.AdvisoryAff4 = advAff4;
                    if (advDate4 == null)
                        pdpInfoToSave.AdvisoryDate4 = "";
                    else
                        pdpInfoToSave.AdvisoryDate4 = advDate4.Trim();
                    pdpInfoToSave.AdvisoryLocation4 = advLoc4;
                    pdpInfoToSave.AdvisoryName5 = advName5;
                    pdpInfoToSave.AdvisoryLName5 = advLName5;
                    pdpInfoToSave.AdvisoryType5 = advType5;
                    pdpInfoToSave.AdvisoryState5 = advLocationState5;
                    pdpInfoToSave.AdvisoryZip5 = advLocationZip5;
                    pdpInfoToSave.AdvisoryAff5 = advAff5;
                    if (advDate5 == null)
                        pdpInfoToSave.AdvisoryDate5 = "";
                    else
                        pdpInfoToSave.AdvisoryDate5 = advDate5.Trim();
                    pdpInfoToSave.AdvisoryLocation5 = advLoc5;
                    pdpInfoToSave.AdvisoryName6 = advName6;
                    pdpInfoToSave.AdvisoryLName6 = advLName6;
                    pdpInfoToSave.AdvisoryType6 = advType6;
                    pdpInfoToSave.AdvisoryState6 = advLocationState6;
                    pdpInfoToSave.AdvisoryZip6 = advLocationZip6;
                    pdpInfoToSave.AdvisoryAff6 = advAff6;
                    if (advDate6 == null)
                        pdpInfoToSave.AdvisoryDate6 = "";
                    else
                        pdpInfoToSave.AdvisoryDate6 = advDate6.Trim();
                    pdpInfoToSave.AdvisoryLocation6 = advLoc6;
                    pdpInfoToSave.AdvisoryName7 = advName7;
                    pdpInfoToSave.AdvisoryLName7 = advLName7;
                    pdpInfoToSave.AdvisoryAff7 = advAff7;
                    pdpInfoToSave.AdvisoryName8 = advName8;
                    pdpInfoToSave.AdvisoryLName8 = advLName8;
                    pdpInfoToSave.AdvisoryAff8 = advAff8;
                    pdpInfoToSave.AdvisoryName9 = advName9;
                    pdpInfoToSave.AdvisoryLName9 = advLName9;
                    pdpInfoToSave.AdvisoryAff9 = advAff9;
                    pdpInfoToSave.AdvisoryName10 = advName10;
                    pdpInfoToSave.AdvisoryLName10 = advLName10;
                    pdpInfoToSave.AdvisoryAff10 = advAff10;
                    pdpInfoToSave.AdvisoryName11 = advName11;
                    pdpInfoToSave.AdvisoryLName11 = advLName11;
                    pdpInfoToSave.AdvisoryAff11 = advAff11;
                    pdpInfoToSave.AdvisoryName12 = advName12;
                    pdpInfoToSave.AdvisoryLName12 = advLName12;
                    pdpInfoToSave.AdvisoryAff12 = advAff12;
                    pdpInfoToSave.AdvisoryName13 = advName13;
                    pdpInfoToSave.AdvisoryLName13 = advLName13;
                    pdpInfoToSave.AdvisoryAff13 = advAff13;
                    pdpInfoToSave.AdvisoryName14 = advName14;
                    pdpInfoToSave.AdvisoryLName14 = advLName14;
                    pdpInfoToSave.AdvisoryAff14 = advAff14;
                    pdpInfoToSave.AdvisoryName15 = advName15;
                    pdpInfoToSave.AdvisoryLName15 = advLName15;
                    pdpInfoToSave.AdvisoryAff15 = advAff15;
                    pdpInfoToSave.SareOutreach = sareOutreach;

                                     
                    if (piStatePro == "")
                    {
                        Session["statusMessage1"] = "Project State is required.";
                    }
                    /*
                    else if (piStatePro != "" && piInstType == 0)
                    {
                        Session["statusMessage1"] = "Institution Type is required.";
                    }
                    else if ((piStatePro == "" ) && piInstType == 0)
			        {
                       Session["statusMessage1"] = "Project State and Institution Type are required.";
			        } 
                    */
                    else
                    {
                        int pdpid = pdpInfoToSave.saveNewPDPInfoToDB();

                        if (pdpid > 0)
                        {
                            Session["statusMessage2"] = "PDP General Information has been saved successfully.";
                            Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projNum);
                        }

                    }
                                        
                }

                if (Request.Form["cmdPdpInitSave"] != null)
                {
                    string projNum = Request.Params.Get("pn");

                    int initNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    string sareOutreach = Request.Form["initOut"]; 
                    string initTopic = Request.Form["initDesc"];
                    string trainingObj = Request.Form["initObj"];
                    /*
                    string partExt = Request.Form["partExt"].ToString();
                    string partNrcs = Request.Form["partNRCS"];
                    string partNgo = Request.Form["partNGO"];
                    string partState = Request.Form["partState"];
                    string partFarmer = Request.Form["partFarmer"];
                    string partOther = Request.Form["partOther"];
                    string trainExt = Request.Form["trainExt"];
                    string trainNrcs = Request.Form["trainNRCS"];
                    string trainNgo = Request.Form["trainNGO"];
                    string trainState = Request.Form["trainState"];
                    string trainFarmer = Request.Form["trainFarmer"];
                    string trainOther = Request.Form["trainOther"];
                    string devExt = Request.Form["devExt"];
                    string devNrcs = Request.Form["devNRCS"];
                    string devNgo = Request.Form["devNGO"];
                    string devState = Request.Form["devState"];
                    string devFarmer = Request.Form["devFarmer"];
                    string devOther = Request.Form["devOther"];
                    string invExt = Request.Form["invExt"];
                    string invNrcs = Request.Form["invNRCS"];
                    string invNgo = Request.Form["invNGO"];
                    string invState = Request.Form["invState"];
                    string invFarmer = Request.Form["invFarmer"];
                    string invOther = Request.Form["invOther"];
                    */
                    daikonPDP.PDPContents pdpInitPartnersToSave;
                    pdpInitPartnersToSave = new daikonPDP.PDPContents();

                    pdpInitPartnersToSave.ProjectNum = projNum;
                    pdpInitPartnersToSave.InitiativeCount = initNum;
                    pdpInitPartnersToSave.InitTopic = initTopic;
                    pdpInitPartnersToSave.TrainingObj = trainingObj;
                    
                    if ((bool)(Request.Form["partExtCBox"] == "on"))
                        pdpInitPartnersToSave.PartExt = 1;
                    else
                        pdpInitPartnersToSave.PartExt = 0;
                    if ((bool)(Request.Form["partNrcsCBox"] == "on"))
                        pdpInitPartnersToSave.PartNRCS = 1;
                    else
                        pdpInitPartnersToSave.PartNRCS = 0;
                    if ((bool)(Request.Form["partNGOCBox"] == "on"))
                        pdpInitPartnersToSave.PartNGO = 1;
                    else
                        pdpInitPartnersToSave.PartNGO = 0;
                    if ((bool)(Request.Form["partStateCBox"] == "on"))
                        pdpInitPartnersToSave.PartState = 1;
                    else
                        pdpInitPartnersToSave.PartState = 0;
                    if ((bool)(Request.Form["partFarmerCBox"] == "on"))
                        pdpInitPartnersToSave.PartFarmer = 1;
                    else
                        pdpInitPartnersToSave.PartFarmer = 0;
                    if ((bool)(Request.Form["partOtherCBox"] == "on"))
                        pdpInitPartnersToSave.PartOther = 1;
                    else
                        pdpInitPartnersToSave.PartOther = 0;

                    if ((bool)(Request.Form["trainExtCBox"] == "on"))
                        pdpInitPartnersToSave.TrainExt = 1;
                    else
                        pdpInitPartnersToSave.TrainExt = 0;
                    if ((bool)(Request.Form["trainNrcsCBox"] == "on"))
                        pdpInitPartnersToSave.TrainNRCS = 1;
                    else
                        pdpInitPartnersToSave.TrainNRCS = 0;
                    if ((bool)(Request.Form["trainNGOCBox"] == "on"))
                        pdpInitPartnersToSave.TrainNGO = 1;
                    else
                        pdpInitPartnersToSave.TrainNGO = 0;
                    if ((bool)(Request.Form["trainStateCBox"] == "on"))
                        pdpInitPartnersToSave.TrainState = 1;
                    else
                        pdpInitPartnersToSave.TrainState = 0;
                    if ((bool)(Request.Form["trainFarmerCBox"] == "on"))
                        pdpInitPartnersToSave.TrainFarmer = 1;
                    else
                        pdpInitPartnersToSave.TrainFarmer = 0;
                    if ((bool)(Request.Form["trainOtherCBox"] == "on"))
                        pdpInitPartnersToSave.TrainOther = 1;
                    else
                        pdpInitPartnersToSave.TrainOther = 0;
                    /*
                    if (partExt != null && partExt.Length > 0)
                        pdpInitPartnersToSave.PartExt = Int32.Parse(partExt);
                    if (partNrcs != null && partNrcs.Length > 0)
                        pdpInitPartnersToSave.PartNRCS = Int32.Parse(partNrcs);
                    if (partNgo != null && partNgo.Length > 0)
                        pdpInitPartnersToSave.PartNGO = Int32.Parse(partNgo);
                    if (partFarmer != null && partFarmer.Length > 0)
                        pdpInitPartnersToSave.PartFarmer = Int32.Parse(partFarmer);
                    if (partState != null && partState.Length > 0)
                        pdpInitPartnersToSave.PartState = Int32.Parse(partState);
                    if (partOther != null && partOther.Length > 0)
                        pdpInitPartnersToSave.PartOther = Int32.Parse(partOther);
                    if (trainExt != null && trainExt.Length > 0)
                        pdpInitPartnersToSave.TrainExt = Int32.Parse(trainExt);
                    if (trainNrcs != null && trainNrcs.Length > 0)
                        pdpInitPartnersToSave.TrainNRCS = Int32.Parse(trainNrcs);
                    if (trainNgo != null && trainNgo.Length > 0)
                        pdpInitPartnersToSave.TrainNGO = Int32.Parse(trainNgo);
                    if (trainFarmer != null && trainFarmer.Length > 0)
                        pdpInitPartnersToSave.TrainFarmer = Int32.Parse(trainFarmer);
                    if (trainState != null && trainState.Length > 0)
                        pdpInitPartnersToSave.TrainState = Int32.Parse(trainState);
                    if (trainOther != null && trainOther.Length > 0)
                        pdpInitPartnersToSave.TrainOther = Int32.Parse(trainOther);
                    if (devExt != null && devExt.Length > 0)
                        pdpInitPartnersToSave.DevExt = Int32.Parse(devExt);
                    if (devNrcs != null && devNrcs.Length > 0)
                        pdpInitPartnersToSave.DevNRCS = Int32.Parse(devNrcs);
                    if (devNgo != null && devNgo.Length > 0)
                        pdpInitPartnersToSave.DevNGO = Int32.Parse(devNgo);
                    if (devFarmer != null && devFarmer.Length > 0)
                        pdpInitPartnersToSave.DevFarmer = Int32.Parse(devFarmer);
                    if (devState != null && devState.Length > 0)
                        pdpInitPartnersToSave.DevState = Int32.Parse(devState);
                    if (devOther != null && devOther.Length > 0)
                        pdpInitPartnersToSave.DevOther = Int32.Parse(devOther);
                    if (invExt != null && invExt.Length > 0)
                        pdpInitPartnersToSave.InvExt = Int32.Parse(invExt);
                    if (invNrcs != null && invNrcs.Length > 0)
                        pdpInitPartnersToSave.InvNRCS = Int32.Parse(invNrcs);
                    if (invNgo != null && invNgo.Length > 0)
                        pdpInitPartnersToSave.InvNGO = Int32.Parse(invNgo);
                    if (invFarmer != null && invFarmer.Length > 0)
                        pdpInitPartnersToSave.InvFarmer = Int32.Parse(invFarmer);
                    if (invState != null && invState.Length > 0)
                        pdpInitPartnersToSave.InvState = Int32.Parse(invState);
                    if (invOther != null && invOther.Length > 0)
                        pdpInitPartnersToSave.InvOther = Int32.Parse(invOther);
                    */

                    if (initTopic == null || initTopic.Length == 0)
                    {
                        Session["statusMessage1"] = "Training Initiative Title is required.";
                    }
                    else
                    {
                        int pdpInitID = pdpInitPartnersToSave.saveNewPDPInitPartnersToDB();

                        if (pdpInitID > 0)
                        {
                            Session["statusMessage2"] = "PDP Initiative/Topic and Partners data has been saved successfully.";
                            if (initNum == 0)
                                Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                            else
                                Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                        }
                    }
                }

                if (Request.Form["cmdPdpOurNarrSave"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    string outputSummary = Request.Form["outNarrSum"]; ;
                    string outputDesc = Request.Form["outNarrOutcomes"];
                    string outputOther = Request.Form["ourNarrOther"];

                    daikonPDP.PDPContents pdpOutNarrToSave;
                    pdpOutNarrToSave = new daikonPDP.PDPContents();

                    pdpOutNarrToSave.ProjectNum = projNum;
                    pdpOutNarrToSave.OutSummary = outputSummary;
                    pdpOutNarrToSave.OutDesc = outputDesc;
                    pdpOutNarrToSave.OutOther = outputOther;

                    int pdpOutNarrID = pdpOutNarrToSave.saveNewPDPOutNarrToDB();

                    if (pdpOutNarrID > 0)
                    {
                        Session["statusMessage2"] = "PDP Output Narrative data has been saved successfully.";
                        Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projNum);
                    }


                }

                if (Request.Form["cmdPdpKeyOutStudySave"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    //string studySess = Request.Form["studySession"];
                    string studyTitle = Request.Form["studyTitle"];
                    string studySDate = Request.Form["StudySDate"];
                    string studyEDate = Request.Form["StudyEDate"];
                    string studyExt = Request.Form["studyExt"];
                    string studyNRCS = Request.Form["studyNRCS"];
                    string studyNGO = Request.Form["studyNGO"];
                    string studyST = Request.Form["studyST"];
                    string studyProfit = Request.Form["studyPro"];
                    string studyFarm =Request.Form["studyFarm"];
                    string studyAttOther = Request.Form["studyAttOther"];
                    string studyAttDesc = Request.Form["studyAttDesc"];
                    string studyLocation = Request.Form["studyLoc"];
                    string studyState = Request.Form["studyState"];
                    string studyZip = Request.Form["studyZip"];
                    string studyMedia = Request.Form["studyMedia"];
                    string studyClient = Request.Form["studyClient"];
                    string studyDevel = Request.Form["studyDevel"];
                    string studyIncorp = Request.Form["studyIncorp"];
                    string studyProgram = Request.Form["studyProg"];
                    string studyConsult = Request.Form["studyConsult"];
                    string studyFarmers = Request.Form["studyFarmers"];
                    string studyOutOther = Request.Form["studyOutOther"];
                    string studyOutDesc = Request.Form["studyOutDesc"];
                    string studyDescription = Request.Form["studyDescription"];
                    
                    daikonPDP.PDPKeyOut pdpKeyOutStudyToSave;
                    pdpKeyOutStudyToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutStudyToSave.ProjectNum = projNum;
                    pdpKeyOutStudyToSave.InitiativeNum = initNum;

                    //if (studySess != null && studySess.Length > 0)
                    pdpKeyOutStudyToSave.StudySess = sessNum;
                    pdpKeyOutStudyToSave.InitiativeNum = initNum;
                    pdpKeyOutStudyToSave.StudyTitle = studyTitle;
                    if (studySDate == null)
                        pdpKeyOutStudyToSave.StudyStartDate = "";
                    else
                        pdpKeyOutStudyToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutStudyToSave.StudyEndDate = "";
                    else
                        pdpKeyOutStudyToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutStudyToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutStudyToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutStudyToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutStudyToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutStudyToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutStudyToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutStudyToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutStudyToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutStudyToSave.StudyLocation = studyLocation;
                    pdpKeyOutStudyToSave.StudyState = studyState;
                    pdpKeyOutStudyToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutStudyToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutStudyToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutStudyToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutStudyToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutStudyToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutStudyToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutStudyToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutStudyToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutStudyToSave.StudyOutDesc = studyOutDesc;
                    pdpKeyOutStudyToSave.StudyDescription = studyDescription;

                    int pdp_key_study_id = pdpKeyOutStudyToSave.SaveNewPDPKeyOutStudyToDB();

                    if (pdp_key_study_id > 0)
                    {
                        Session["statusMessage2"] = "PDP Key Outcome & Activities Study data has been saved successfully.";
                        if (initNum == 0)
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                        else
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    }
                }

                if (Request.Form["cmdPdpKeyOutStudyUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    //string studySess = Request.Form["studySession"];
                    string studyTitle = Request.Form["studyTitle"];
                    string studySDate = Request.Form["StudySDate"];
                    string studyEDate = Request.Form["StudyEDate"];
                    string studyExt = Request.Form["studyExt"];
                    string studyNRCS = Request.Form["studyNRCS"];
                    string studyNGO = Request.Form["studyNGO"];
                    string studyST = Request.Form["studyST"];
                    string studyProfit = Request.Form["studyPro"];
                    string studyFarm = Request.Form["studyFarm"];
                    string studyAttOther = Request.Form["studyAttOther"];
                    string studyAttDesc = Request.Form["studyAttDesc"];
                    string studyLocation = Request.Form["studyLoc"];
                    string studyState = Request.Form["studyState"];
                    string studyZip = Request.Form["studyZip"];
                    string studyMedia = Request.Form["studyMedia"];
                    string studyClient = Request.Form["studyClient"];
                    string studyDevel = Request.Form["studyDevel"];
                    string studyIncorp = Request.Form["studyIncorp"];
                    string studyProgram = Request.Form["studyProg"];
                    string studyConsult = Request.Form["studyConsult"];
                    string studyFarmers = Request.Form["studyFarmers"];
                    string studyOutOther = Request.Form["studyOutOther"];
                    string studyOutDesc = Request.Form["studyOutDesc"];
                    string studyDescription = Request.Form["studyDescription"];

                    daikonPDP.PDPKeyOut pdpKeyOutStudyToSave;
                    pdpKeyOutStudyToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutStudyToSave.ProjectNum = projNum;
                    pdpKeyOutStudyToSave.InitiativeNum = initNum;
                    pdpKeyOutStudyToSave.StudyTitle = studyTitle;
                    //if (studySess != null && studySess.Length > 0)
                    pdpKeyOutStudyToSave.StudySess = sessNum;
                    pdpKeyOutStudyToSave.InitiativeNum = initNum;
                    if (studySDate == null)
                        pdpKeyOutStudyToSave.StudyStartDate = "";
                    else
                        pdpKeyOutStudyToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutStudyToSave.StudyEndDate = "";
                    else
                        pdpKeyOutStudyToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutStudyToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutStudyToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutStudyToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutStudyToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutStudyToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutStudyToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutStudyToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutStudyToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutStudyToSave.StudyLocation = studyLocation;
                    pdpKeyOutStudyToSave.StudyState = studyState;
                    pdpKeyOutStudyToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutStudyToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutStudyToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutStudyToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutStudyToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutStudyToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutStudyToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutStudyToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutStudyToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutStudyToSave.StudyOutDesc = studyOutDesc;
                    pdpKeyOutStudyToSave.StudyDescription = studyDescription;

                    pdpKeyOutStudyToSave.UpdatePDPKeyOutStudyToDB();

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Study data has been updated successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    
                }

                if (Request.Form["cmdPdpKeyOutTravelSave"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    string studyTitle = Request.Form["TravelTitle"];
                    string travelDescrip = Request.Form["TravelDescription"];
                    //string studySess = Request.Form["TravelScholar"];
                    string travelIndi1 = Request.Form["TravelIndividual1"];
                    string travelIndi2 = Request.Form["TravelIndividual2"];
                    string travelIndi3 = Request.Form["TravelIndividual3"];
                    string travelIndi4 = Request.Form["TravelIndividual4"];
                    string travelIndi5 = Request.Form["TravelIndividual5"];
                    string travelIndi6 = Request.Form["TravelIndividual6"];
                    string travelIndi7 = Request.Form["TravelIndividual7"];
                    string travelIndi8 = Request.Form["TravelIndividual8"];
                    string travelIndi9 = Request.Form["TravelIndividual9"];
                    string travelIndi10 = Request.Form["TravelIndividual10"];
                    string travelIndi11 = Request.Form["TravelIndividual11"];
                    string travelIndi12 = Request.Form["TravelIndividual12"];
                    string travelIndiOther = Request.Form["TravelIndividualOther"];
                    string studySDate = Request.Form["StudySDate"];
                    string studyEDate = Request.Form["StudyEDate"];
                    string studyExt = Request.Form["TravelExt"];
                    string studyNRCS = Request.Form["TravelNRCS"];
                    string studyNGO = Request.Form["TravelNGO"];
                    string studyST = Request.Form["TravelST"];
                    string studyProfit = Request.Form["TravelPro"];
                    string studyFarm = Request.Form["TravelFarm"];
                    string studyAttOther = Request.Form["TravelOther"];
                    string studyAttDesc = Request.Form["TravelReciDesc"];
                    string studyLocation = Request.Form["TravelLoc"];
                    string studyState = Request.Form["TravelState"];
                    string studyZip = Request.Form["TravelZip"];
                    string studyMedia = Request.Form["TravelMedia"];
                    string studyClient = Request.Form["TravelClient"];
                    string studyDevel = Request.Form["TravelDevel"];
                    string studyIncorp = Request.Form["TravelIncorp"];
                    string studyProgram = Request.Form["TravelProg"];
                    string studyConsult = Request.Form["TravelConsult"];
                    string studyFarmers = Request.Form["TravelFarmers"];
                    string studyOutOther = Request.Form["TravelOutOther"];
                    string studyOutDesc = Request.Form["TravelOutDesc"];


                    daikonPDP.PDPKeyOut pdpKeyOutTravelToSave;
                    pdpKeyOutTravelToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutTravelToSave.ProjectNum = projNum;
                    pdpKeyOutTravelToSave.InitiativeNum = initNum;

                    pdpKeyOutTravelToSave.StudyTitle = studyTitle;
                    pdpKeyOutTravelToSave.TravelDescription = travelDescrip;
                    pdpKeyOutTravelToSave.TravelIndividual1 = travelIndi1;
                    pdpKeyOutTravelToSave.TravelIndividual2 = travelIndi2;
                    pdpKeyOutTravelToSave.TravelIndividual3 = travelIndi3;
                    pdpKeyOutTravelToSave.TravelIndividual4 = travelIndi4;
                    pdpKeyOutTravelToSave.TravelIndividual5 = travelIndi5;
                    pdpKeyOutTravelToSave.TravelIndividual6 = travelIndi6;
                    pdpKeyOutTravelToSave.TravelIndividual7 = travelIndi7;
                    pdpKeyOutTravelToSave.TravelIndividual8 = travelIndi8;
                    pdpKeyOutTravelToSave.TravelIndividual9 = travelIndi9;
                    pdpKeyOutTravelToSave.TravelIndividual10 = travelIndi10;
                    pdpKeyOutTravelToSave.TravelIndividual11 = travelIndi11;
                    pdpKeyOutTravelToSave.TravelIndividual12 = travelIndi12;
                    pdpKeyOutTravelToSave.TravelIndividualOther = travelIndiOther;
                    //if (studySess != null && studySess.Length > 0)
                    pdpKeyOutTravelToSave.StudySess = sessNum;
                    if (studySDate == null)
                        pdpKeyOutTravelToSave.StudyStartDate = "";
                    else
                        pdpKeyOutTravelToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutTravelToSave.StudyEndDate = "";
                    else
                        pdpKeyOutTravelToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutTravelToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutTravelToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutTravelToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutTravelToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutTravelToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutTravelToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutTravelToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutTravelToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutTravelToSave.StudyLocation = studyLocation;
                    pdpKeyOutTravelToSave.StudyState = studyState;
                    pdpKeyOutTravelToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutTravelToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutTravelToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutTravelToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutTravelToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutTravelToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutTravelToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutTravelToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutTravelToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutTravelToSave.StudyOutDesc = studyOutDesc;

                    int pdp_key_study_id = pdpKeyOutTravelToSave.SaveNewPDPKeyOutTravelToDB();

                    if (pdp_key_study_id > 0)
                    {
                        Session["statusMessage2"] = "PDP Key Outcome & Activities Travel data has been saved successfully.";
                        if (initNum == 0)
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                        else
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    }
                }

                if (Request.Form["cmdPdpKeyOutTravelUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    string studyTitle = Request.Form["TravelTitle"];
                    string travelDescrip = Request.Form["TravelDescription"];
                    //string studySess = Request.Form["TravelScholar"];
                    string travelIndi1 = Request.Form["TravelIndividual1"];
                    string travelIndi2 = Request.Form["TravelIndividual2"];
                    string travelIndi3 = Request.Form["TravelIndividual3"];
                    string travelIndi4 = Request.Form["TravelIndividual4"];
                    string travelIndi5 = Request.Form["TravelIndividual5"];
                    string travelIndi6 = Request.Form["TravelIndividual6"];
                    string travelIndi7 = Request.Form["TravelIndividual7"];
                    string travelIndi8 = Request.Form["TravelIndividual8"];
                    string travelIndi9 = Request.Form["TravelIndividual9"];
                    string travelIndi10 = Request.Form["TravelIndividual10"];
                    string travelIndi11 = Request.Form["TravelIndividual11"];
                    string travelIndi12 = Request.Form["TravelIndividual12"];
                    string travelIndiOther = Request.Form["TravelIndividualOther"];
                    string studySDate = Request.Form["StudySDate"];
                    string studyEDate = Request.Form["StudyEDate"];
                    string studyExt = Request.Form["TravelExt"];
                    string studyNRCS = Request.Form["TravelNRCS"];
                    string studyNGO = Request.Form["TravelNGO"];
                    string studyST = Request.Form["TravelST"];
                    string studyProfit = Request.Form["TravelPro"];
                    string studyFarm = Request.Form["TravelFarm"];
                    string studyAttOther = Request.Form["TravelOther"];
                    string studyAttDesc = Request.Form["TravelReciDesc"];
                    string studyLocation = Request.Form["TravelLoc"];
                    string studyState = Request.Form["TravelState"];
                    string studyZip = Request.Form["TravelZip"];
                    string studyMedia = Request.Form["TravelMedia"];
                    string studyClient = Request.Form["TravelClient"];
                    string studyDevel = Request.Form["TravelDevel"];
                    string studyIncorp = Request.Form["TravelIncorp"];
                    string studyProgram = Request.Form["TravelProg"];
                    string studyConsult = Request.Form["TravelConsult"];
                    string studyFarmers = Request.Form["TravelFarmers"];
                    string studyOutOther = Request.Form["TravelOutOther"];
                    string studyOutDesc = Request.Form["TravelOutDesc"];


                    daikonPDP.PDPKeyOut pdpKeyOutTravelToSave;
                    pdpKeyOutTravelToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutTravelToSave.ProjectNum = projNum;
                    pdpKeyOutTravelToSave.InitiativeNum = initNum;

                    pdpKeyOutTravelToSave.StudyTitle = studyTitle;
                    pdpKeyOutTravelToSave.TravelDescription = travelDescrip;
                    pdpKeyOutTravelToSave.TravelIndividual1 = travelIndi1;
                    pdpKeyOutTravelToSave.TravelIndividual2 = travelIndi2;
                    pdpKeyOutTravelToSave.TravelIndividual3 = travelIndi3;
                    pdpKeyOutTravelToSave.TravelIndividual4 = travelIndi4;
                    pdpKeyOutTravelToSave.TravelIndividual5 = travelIndi5;
                    pdpKeyOutTravelToSave.TravelIndividual6 = travelIndi6;
                    pdpKeyOutTravelToSave.TravelIndividual7 = travelIndi7;
                    pdpKeyOutTravelToSave.TravelIndividual8 = travelIndi8;
                    pdpKeyOutTravelToSave.TravelIndividual9 = travelIndi9;
                    pdpKeyOutTravelToSave.TravelIndividual10 = travelIndi10;
                    pdpKeyOutTravelToSave.TravelIndividual11 = travelIndi11;
                    pdpKeyOutTravelToSave.TravelIndividual12 = travelIndi12;
                    pdpKeyOutTravelToSave.TravelIndividualOther = travelIndiOther;
                    //if (studySess != null && studySess.Length > 0)
                    pdpKeyOutTravelToSave.StudySess = sessNum;
                    if (studySDate == null)
                        pdpKeyOutTravelToSave.StudyStartDate = "";
                    else
                        pdpKeyOutTravelToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutTravelToSave.StudyEndDate = "";
                    else
                        pdpKeyOutTravelToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutTravelToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutTravelToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutTravelToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutTravelToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutTravelToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutTravelToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutTravelToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutTravelToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutTravelToSave.StudyLocation = studyLocation;
                    pdpKeyOutTravelToSave.StudyState = studyState;
                    pdpKeyOutTravelToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutTravelToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutTravelToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutTravelToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutTravelToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutTravelToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutTravelToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutTravelToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutTravelToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutTravelToSave.StudyOutDesc = studyOutDesc;

                    pdpKeyOutTravelToSave.UpdatePDPKeyOutTravelToDB();

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Travel data has been updated successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    
                }

                if (Request.Form["cmdPdpKeyOutTravelDelete"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    daikonPDP.PDPKeyOut pdpKeyOutTravelToDelete;
                    pdpKeyOutTravelToDelete = new daikonPDP.PDPKeyOut();

                    pdpKeyOutTravelToDelete.DeletePDPKeyOutTravelFromDB(Convert.ToInt32(Request.Form["DeleteID"]));

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Travel data has been deleted successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    

                }

                if (Request.Form["cmdPdpKeyOutFieldDelete"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    daikonPDP.PDPKeyOut pdpKeyOutFieldToDelete;
                    pdpKeyOutFieldToDelete = new daikonPDP.PDPKeyOut();

                    pdpKeyOutFieldToDelete.DeletePDPKeyOutFieldFromDB(Convert.ToInt32(Request.Form["DeleteID"]));

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Field Days/Tour data has been deleted successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());


                }

                if (Request.Form["cmdPdpKeyOutWorkshopsDelete"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    daikonPDP.PDPKeyOut pdpKeyOutWorkshopsToDelete;
                    pdpKeyOutWorkshopsToDelete = new daikonPDP.PDPKeyOut();

                    pdpKeyOutWorkshopsToDelete.DeletePDPKeyOutWorkshopsFromDB(Convert.ToInt32(Request.Form["DeleteID"]));

                    Session["statusMessage2"] = "PDP Key Outcome & Activities  Workshop data has been deleted successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());


                }

                if (Request.Form["cmdPdpKeyOutStudyDelete"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    daikonPDP.PDPKeyOut pdpKeyOutStudyToDelete;
                    pdpKeyOutStudyToDelete = new daikonPDP.PDPKeyOut();

                    pdpKeyOutStudyToDelete.DeletePDPKeyOutStudyFromDB(Convert.ToInt32(Request.Form["DeleteID"]));

                    Session["statusMessage2"] = "PDP Key Outcome & Activities  Study Circle/Focus Group data has been deleted successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());


                }

                if (Request.Form["cmdPdpKeyOutGrantsDelete"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    daikonPDP.PDPKeyOut pdpKeyOutGrantsToDelete;
                    pdpKeyOutGrantsToDelete = new daikonPDP.PDPKeyOut();

                    pdpKeyOutGrantsToDelete.DeletePDPKeyOutGrantsFromDB(Convert.ToInt32(Request.Form["DeleteID"]));

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Curricula data has been deleted successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());


                }

                if (Request.Form["cmdPdpKeyOutWebDelete"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    daikonPDP.PDPKeyOut pdpKeyOutWebToDelete;
                    pdpKeyOutWebToDelete = new daikonPDP.PDPKeyOut();

                    pdpKeyOutWebToDelete.DeletePDPKeyOutWebFromDB(Convert.ToInt32(Request.Form["DeleteID"]));

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Webinars data has been deleted successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());


                }

                if (Request.Form["cmdPdpKeyOutOtherDelete"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    daikonPDP.PDPKeyOut pdpKeyOutOtherToDelete;
                    pdpKeyOutOtherToDelete = new daikonPDP.PDPKeyOut();

                    pdpKeyOutOtherToDelete.DeletePDPKeyOutOtherFromDB(Convert.ToInt32(Request.Form["DeleteID"]));

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Others data has been deleted successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());


                }

                if (Request.Form["cmdPDPInitDelete"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;

                    daikonPDP.PDPContents pdpInitPartnersToDelete;
                    pdpInitPartnersToDelete = new daikonPDP.PDPContents();

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Form["confDel"] != null)
                    {
                        if (pdpInitPartnersToDelete.DeletePDPInitiative(projNum, initNum) == true)
                            //Session["statusMessage2"] = "PDP Initiative and Key Outcome & Activities Others deleted successfully.";
                            Session["statusMessage2"] = "Initiative has been deleted successfully.";
                        else
                            Session["statusMessage1"] = "PDP Initiative and Key Outcome & Activities Others were not deleted.";
                        Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projNum);

                    }
                    else
                    {
                        //Response.Redirect("sare_main.aspx?do=editProj&pn=" + (string)(Session["currGrant"]) + "&deleteProj=true");
                        Session["statusMessage1"] = "Initiative NOT DELETED! To delete this Initiative and its Key Activities and Outcomes, check the 'Confirm Delete' box at the bottom of this page and click the Delete PDP Initiative button.";
                        if (initNum == 0)
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                        else
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    }
                }
                
                if (Request.Form["cmdPdpKeyOutOtherSave"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    string otherDescrip = Request.Form["OtherDescription"];
                    //string studySess = Request.Form["OtherNum"];
                    string studyTitle = Request.Form["otherTitle"];
                    string studySDate = Request.Form["OtherSDate"];
                    string studyEDate = Request.Form["OtherEDate"];
                    string studyExt = Request.Form["OtherExt"];
                    string studyNRCS = Request.Form["OtherNRCS"];
                    string studyNGO = Request.Form["OtherNGO"];
                    string studyST = Request.Form["OtherST"];
                    string studyProfit = Request.Form["OtherPro"];
                    string studyFarm = Request.Form["OtherFarm"];
                    string studyAttOther = Request.Form["OtherOther"];
                    string studyAttDesc = Request.Form["OtherReciDesc"];
                    string studyLocation = Request.Form["OtherLoc"];
                    string studyState = Request.Form["OtherState"];
                    string studyZip = Request.Form["OtherZip"];
                    string studyMedia = Request.Form["OtherMedia"];
                    string studyClient = Request.Form["OtherClient"];
                    string studyDevel = Request.Form["OtherDevel"];
                    string studyIncorp = Request.Form["OtherIncorp"];
                    string studyProgram = Request.Form["OtherProg"];
                    string studyConsult = Request.Form["OtherConsult"];
                    string studyFarmers = Request.Form["OtherFarmers"];
                    string studyOutOther = Request.Form["OtherOutOther"];
                    string studyOutDesc = Request.Form["OtherOutDesc"];


                    daikonPDP.PDPKeyOut pdpKeyOutOtherToSave;
                    pdpKeyOutOtherToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutOtherToSave.ProjectNum = projNum;
                    pdpKeyOutOtherToSave.InitiativeNum = initNum;

                    pdpKeyOutOtherToSave.OtherDescription = otherDescrip;
                    //if (studySess != null && studySess.Length > 0)
                    pdpKeyOutOtherToSave.StudySess = sessNum;
                    pdpKeyOutOtherToSave.StudyTitle = studyTitle;
                    if (studySDate == null)
                        pdpKeyOutOtherToSave.StudyStartDate = "";
                    else
                        pdpKeyOutOtherToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutOtherToSave.StudyEndDate = "";
                    else
                        pdpKeyOutOtherToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutOtherToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutOtherToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutOtherToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutOtherToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutOtherToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutOtherToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutOtherToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutOtherToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutOtherToSave.StudyLocation = studyLocation;
                    pdpKeyOutOtherToSave.StudyState = studyState;
                    pdpKeyOutOtherToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutOtherToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutOtherToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutOtherToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutOtherToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutOtherToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutOtherToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutOtherToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutOtherToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutOtherToSave.StudyOutDesc = studyOutDesc;

                    int pdp_key_study_id = pdpKeyOutOtherToSave.SaveNewPDPKeyOutOtherToDB();

                    if (pdp_key_study_id > 0)
                    {
                        Session["statusMessage2"] = "PDP Key Outcome & Activities Other data has been saved successfully.";
                        if (initNum == 0)
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                        else
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    }
                }

                if (Request.Form["cmdPdpKeyOutOtherUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    string otherDescrip = Request.Form["OtherDescription"];
                    //string studySess = Request.Form["OtherNum"];
                    string studyTitle = Request.Form["otherTitle"];
                    string studySDate = Request.Form["OtherSDate"];
                    string studyEDate = Request.Form["OtherEDate"];
                    string studyExt = Request.Form["OtherExt"];
                    string studyNRCS = Request.Form["OtherNRCS"];
                    string studyNGO = Request.Form["OtherNGO"];
                    string studyST = Request.Form["OtherST"];
                    string studyProfit = Request.Form["OtherPro"];
                    string studyFarm = Request.Form["OtherFarm"];
                    string studyAttOther = Request.Form["OtherOther"];
                    string studyAttDesc = Request.Form["OtherReciDesc"];
                    string studyLocation = Request.Form["OtherLoc"];
                    string studyState = Request.Form["OtherState"];
                    string studyZip = Request.Form["OtherZip"];
                    string studyMedia = Request.Form["OtherMedia"];
                    string studyClient = Request.Form["OtherClient"];
                    string studyDevel = Request.Form["OtherDevel"];
                    string studyIncorp = Request.Form["OtherIncorp"];
                    string studyProgram = Request.Form["OtherProg"];
                    string studyConsult = Request.Form["OtherConsult"];
                    string studyFarmers = Request.Form["OtherFarmers"];
                    string studyOutOther = Request.Form["OtherOutOther"];
                    string studyOutDesc = Request.Form["OtherOutDesc"];


                    daikonPDP.PDPKeyOut pdpKeyOutOtherToSave;
                    pdpKeyOutOtherToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutOtherToSave.ProjectNum = projNum;
                    pdpKeyOutOtherToSave.InitiativeNum = initNum;
                    pdpKeyOutOtherToSave.OtherDescription = otherDescrip;
                    //if (studySess != null && studySess.Length > 0)
                    pdpKeyOutOtherToSave.StudySess = sessNum;
                    pdpKeyOutOtherToSave.StudyTitle = studyTitle;
                    if (studySDate == null)
                        pdpKeyOutOtherToSave.StudyStartDate = "";
                    else
                        pdpKeyOutOtherToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutOtherToSave.StudyEndDate = "";
                    else
                        pdpKeyOutOtherToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutOtherToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutOtherToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutOtherToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutOtherToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutOtherToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutOtherToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutOtherToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutOtherToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutOtherToSave.StudyLocation = studyLocation;
                    pdpKeyOutOtherToSave.StudyState = studyState;
                    pdpKeyOutOtherToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutOtherToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutOtherToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutOtherToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutOtherToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutOtherToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutOtherToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutOtherToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutOtherToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutOtherToSave.StudyOutDesc = studyOutDesc;

                    pdpKeyOutOtherToSave.UpdatePDPKeyOutOtherToDB();

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Other data has been saved successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    
                }

                if (Request.Form["cmdPdpKeyOutWebSave"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    //string studySess = Request.Form["WebCurricula"];
                    string studyTitle = Request.Form["WebTitle"];
                    string studySDate = Request.Form["StudySDate"];
                    string studyEDate = Request.Form["StudyEDate"];
                    string studyExt = Request.Form["WebExt"];
                    string studyNRCS = Request.Form["WebNRCS"];
                    string studyNGO = Request.Form["WebNGO"];
                    string studyST = Request.Form["WebST"];
                    string studyProfit = Request.Form["WebPro"];
                    string studyFarm = Request.Form["WebFarm"];
                    string studyAttOther = Request.Form["WebAttOther"];
                    string studyAttDesc = Request.Form["WebAttDesc"];
                    string studyMedia = Request.Form["WebMedia"];
                    string studyClient = Request.Form["WebClient"];
                    string studyDevel = Request.Form["WebDevel"];
                    string studyIncorp = Request.Form["WebIncorp"];
                    string studyProgram = Request.Form["WebProg"];
                    string studyConsult = Request.Form["WebConsult"];
                    string studyFarmers = Request.Form["WebFarmers"];
                    string studyOutOther = Request.Form["WebOutOther"];
                    string studyOutDesc = Request.Form["WebOutDesc"];
                    string studyDescription = Request.Form["WebDescription"];

                    string shortTitle = Request.Form["WebSeriesTitle"];
                    string shortSDate = Request.Form["shortSDate"];
                    string shortEDate = Request.Form["shortEDate"];
                    string shortExt = Request.Form["WebSeriesExt"];
                    string shortNRCS = Request.Form["WebSeriesNRCS"];
                    string shortNGO = Request.Form["WebSeriesNGO"];
                    string shortST = Request.Form["WebSeriesST"];
                    string shortProfit = Request.Form["WebSeriesPro"];
                    string shortFarm = Request.Form["WebSeriesFarm"];
                    string shortAttOther = Request.Form["WebSeriesAttOther"];
                    string shortAttDesc = Request.Form["WebSeriesAttDesc"];
                    string shortMedia = Request.Form["WebSeriesMedia"];
                    string shortClient = Request.Form["WebSeriesClient"];
                    string shortDevel = Request.Form["WebSeriesDevel"];
                    string shortIncorp = Request.Form["WebSeriesIncorp"];
                    string shortProgram = Request.Form["WebSeriesProg"];
                    string shortConsult = Request.Form["WebSeriesConsult"];
                    string shortFarmers = Request.Form["WebSeriesFarmers"];
                    string shortOutOther = Request.Form["WebSeriesOutOther"];
                    string shortOutDesc = Request.Form["WebSeriesOutDesc"];
                    string shortDescription = Request.Form["WebSeriesDescription"];

                    string interTitle = Request.Form["WebCurTitle"];
                    string interSDate = Request.Form["interSDate"];
                    string interEDate = Request.Form["interEDate"];
                    string interExt = Request.Form["WebCurExt"];
                    string interNRCS = Request.Form["WebCurNRCS"];
                    string interNGO = Request.Form["WebCurNGO"];
                    string interST = Request.Form["WebCurST"];
                    string interProfit = Request.Form["WebCurPro"];
                    string interFarm = Request.Form["WebCurFarm"];
                    string interAttOther = Request.Form["WebCurAttOther"];
                    string interAttDesc = Request.Form["WebCurAttDesc"];
                    string interMedia = Request.Form["WebCurMedia"];
                    string interClient = Request.Form["WebCurClient"];
                    string interDevel = Request.Form["WebCurDevel"];
                    string interIncorp = Request.Form["WebCurIncorp"];
                    string interProgram = Request.Form["WebCurProg"];
                    string interConsult = Request.Form["WebCurConsult"];
                    string interFarmers = Request.Form["WebCurFarmers"];
                    string interOutOther = Request.Form["WebCurOutOther"];
                    string interOutDesc = Request.Form["WebCurOutDesc"];
                    string interDescription = Request.Form["WebCurDescription"];

                    daikonPDP.PDPKeyOut pdpKeyOutWebToSave;
                    pdpKeyOutWebToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutWebToSave.ProjectNum = projNum;
                    pdpKeyOutWebToSave.InitiativeNum = initNum;

                    //if (studySess != null && studySess.Length > 0)
                    pdpKeyOutWebToSave.StudySess = sessNum;
                    pdpKeyOutWebToSave.StudyTitle = studyTitle;
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutWebToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studySDate == null)
                        pdpKeyOutWebToSave.StudyStartDate = "";
                    else
                        pdpKeyOutWebToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutWebToSave.StudyEndDate = "";
                    else
                        pdpKeyOutWebToSave.StudyEndDate = studyEDate.Trim();
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutWebToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutWebToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutWebToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutWebToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutWebToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutWebToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutWebToSave.StudyAttDesc = studyAttDesc;
                   
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutWebToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutWebToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutWebToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutWebToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutWebToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutWebToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutWebToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutWebToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutWebToSave.StudyOutDesc = studyOutDesc;
                    pdpKeyOutWebToSave.StudyDescription = studyDescription;

                    pdpKeyOutWebToSave.ShortTitle = shortTitle;
                    if (shortExt != null && shortExt.Length > 0)
                        pdpKeyOutWebToSave.ShortExt = Convert.ToInt32(shortExt);
                    if (shortSDate == null)
                        pdpKeyOutWebToSave.ShortStartDate = "";
                    else
                        pdpKeyOutWebToSave.ShortStartDate = shortSDate.Trim();
                    if (shortEDate == null)
                        pdpKeyOutWebToSave.ShortEndDate = "";
                    else
                        pdpKeyOutWebToSave.ShortEndDate = shortEDate.Trim();
                    if (shortNRCS != null && shortNRCS.Length > 0)
                        pdpKeyOutWebToSave.ShortNRCS = Convert.ToInt32((shortNRCS));
                    if (shortNGO != null && shortNGO.Length > 0)
                        pdpKeyOutWebToSave.ShortNGO = Convert.ToInt32(shortNGO);
                    if (shortST != null && shortST.Length > 0)
                        pdpKeyOutWebToSave.ShortST = Convert.ToInt32(shortST);
                    if (shortProfit != null && shortProfit.Length > 0)
                        pdpKeyOutWebToSave.ShortProfit = Convert.ToInt32(shortProfit);
                    if (shortFarm != null && shortFarm.Length > 0)
                        pdpKeyOutWebToSave.ShortFarm = Convert.ToInt32(shortFarm);
                    pdpKeyOutWebToSave.ShortAttOther = shortAttOther;
                    pdpKeyOutWebToSave.ShortAttDesc = shortAttDesc;

                    if (shortMedia != null && shortMedia.Length > 0)
                        pdpKeyOutWebToSave.ShortMedia = Convert.ToInt32(shortMedia);
                    if (shortClient != null && shortClient.Length > 0)
                        pdpKeyOutWebToSave.ShortClient = Convert.ToInt32(shortClient);
                    if (shortDevel != null && shortDevel.Length > 0)
                        pdpKeyOutWebToSave.ShortDevel = Convert.ToInt32(shortDevel);
                    if (shortIncorp != null && shortIncorp.Length > 0)
                        pdpKeyOutWebToSave.ShortIncorp = Convert.ToInt32(shortIncorp);
                    if (shortProgram != null && shortProgram.Length > 0)
                        pdpKeyOutWebToSave.ShortProgram = Convert.ToInt32(shortProgram);
                    if (shortConsult != null && shortConsult.Length > 0)
                        pdpKeyOutWebToSave.ShortConsult = Convert.ToInt32(shortConsult);
                    if (shortFarmers != null && shortFarmers.Length > 0)
                        pdpKeyOutWebToSave.ShortFarmers = Convert.ToInt32(shortFarmers);
                    pdpKeyOutWebToSave.ShortOutOther = shortOutOther;
                    pdpKeyOutWebToSave.ShortOutDesc = shortOutDesc;
                    pdpKeyOutWebToSave.ShortDescription = shortDescription;

                    pdpKeyOutWebToSave.InterTitle = interTitle;
                    if (interExt != null && interExt.Length > 0)
                        pdpKeyOutWebToSave.InterExt = Convert.ToInt32(interExt);
                    if (interSDate == null)
                        pdpKeyOutWebToSave.InterStartDate = "";
                    else
                        pdpKeyOutWebToSave.InterStartDate = interSDate.Trim();
                    if (interEDate == null)
                        pdpKeyOutWebToSave.InterEndDate = "";
                    else
                        pdpKeyOutWebToSave.InterEndDate = interEDate.Trim();
                    if (interNRCS != null && interNRCS.Length > 0)
                        pdpKeyOutWebToSave.InterNRCS = Convert.ToInt32((interNRCS));
                    if (interNGO != null && interNGO.Length > 0)
                        pdpKeyOutWebToSave.InterNGO = Convert.ToInt32(interNGO);
                    if (interST != null && interST.Length > 0)
                        pdpKeyOutWebToSave.InterST = Convert.ToInt32(interST);
                    if (interProfit != null && interProfit.Length > 0)
                        pdpKeyOutWebToSave.InterProfit = Convert.ToInt32(interProfit);
                    if (interFarm != null && interFarm.Length > 0)
                        pdpKeyOutWebToSave.InterFarm = Convert.ToInt32(interFarm);
                    pdpKeyOutWebToSave.InterAttOther = interAttOther;
                    pdpKeyOutWebToSave.InterAttDesc = interAttDesc;

                    if (interMedia != null && interMedia.Length > 0)
                        pdpKeyOutWebToSave.InterMedia = Convert.ToInt32(interMedia);
                    if (interClient != null && interClient.Length > 0)
                        pdpKeyOutWebToSave.InterClient = Convert.ToInt32(interClient);
                    if (interDevel != null && interDevel.Length > 0)
                        pdpKeyOutWebToSave.InterDevel = Convert.ToInt32(interDevel);
                    if (interIncorp != null && interIncorp.Length > 0)
                        pdpKeyOutWebToSave.InterIncorp = Convert.ToInt32(interIncorp);
                    if (interProgram != null && interProgram.Length > 0)
                        pdpKeyOutWebToSave.InterProgram = Convert.ToInt32(interProgram);
                    if (interConsult != null && interConsult.Length > 0)
                        pdpKeyOutWebToSave.InterConsult = Convert.ToInt32(interConsult);
                    if (interFarmers != null && interFarmers.Length > 0)
                        pdpKeyOutWebToSave.InterFarmers = Convert.ToInt32(interFarmers);
                    pdpKeyOutWebToSave.InterOutOther = interOutOther;
                    pdpKeyOutWebToSave.InterOutDesc = interOutDesc;
                    pdpKeyOutWebToSave.InterDescription = interDescription;

                    int pdp_key_web_id = pdpKeyOutWebToSave.SaveNewPDPKeyOutWebToDB();

                    if (pdp_key_web_id > 0)
                    {
                        Session["statusMessage2"] = "PDP Key Outcome & Activities Web data has been saved successfully.";
                        if (initNum == 0)
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                        else
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    }
                }

                if (Request.Form["cmdPdpKeyOutWebUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    //string studySess = Request.Form["WebCurricula"];
                    string studyTitle = Request.Form["WebTitle"];
                    string studySDate = Request.Form["StudySDate"];
                    string studyEDate = Request.Form["StudyEDate"];
                    string studyExt = Request.Form["WebExt"];
                    string studyNRCS = Request.Form["WebNRCS"];
                    string studyNGO = Request.Form["WebNGO"];
                    string studyST = Request.Form["WebST"];
                    string studyProfit = Request.Form["WebPro"];
                    string studyFarm = Request.Form["WebFarm"];
                    string studyAttOther = Request.Form["WebAttOther"];
                    string studyAttDesc = Request.Form["WebAttDesc"];
                    string studyMedia = Request.Form["WebMedia"];
                    string studyClient = Request.Form["WebClient"];
                    string studyDevel = Request.Form["WebDevel"];
                    string studyIncorp = Request.Form["WebIncorp"];
                    string studyProgram = Request.Form["WebProg"];
                    string studyConsult = Request.Form["WebConsult"];
                    string studyFarmers = Request.Form["WebFarmers"];
                    string studyOutOther = Request.Form["WebOutOther"];
                    string studyOutDesc = Request.Form["WebOutDesc"];
                    string studyDescription = Request.Form["WebDescription"];

                    string shortTitle = Request.Form["WebSeriesTitle"];
                    string shortSDate = Request.Form["shortSDate"];
                    string shortEDate = Request.Form["shortEDate"];
                    string shortExt = Request.Form["WebSeriesExt"];
                    string shortNRCS = Request.Form["WebSeriesNRCS"];
                    string shortNGO = Request.Form["WebSeriesNGO"];
                    string shortST = Request.Form["WebSeriesST"];
                    string shortProfit = Request.Form["WebSeriesPro"];
                    string shortFarm = Request.Form["WebSeriesFarm"];
                    string shortAttOther = Request.Form["WebSeriesAttOther"];
                    string shortAttDesc = Request.Form["WebSeriesAttDesc"];
                    string shortMedia = Request.Form["WebSeriesMedia"];
                    string shortClient = Request.Form["WebSeriesClient"];
                    string shortDevel = Request.Form["WebSeriesDevel"];
                    string shortIncorp = Request.Form["WebSeriesIncorp"];
                    string shortProgram = Request.Form["WebSeriesProg"];
                    string shortConsult = Request.Form["WebSeriesConsult"];
                    string shortFarmers = Request.Form["WebSeriesFarmers"];
                    string shortOutOther = Request.Form["WebSeriesOutOther"];
                    string shortOutDesc = Request.Form["WebSeriesOutDesc"];
                    string shortDescription = Request.Form["WebSeriesDescription"];

                    string interTitle = Request.Form["WebCurTitle"];
                    string interSDate = Request.Form["interSDate"];
                    string interEDate = Request.Form["interEDate"];
                    string interExt = Request.Form["WebCurExt"];
                    string interNRCS = Request.Form["WebCurNRCS"];
                    string interNGO = Request.Form["WebCurNGO"];
                    string interST = Request.Form["WebCurST"];
                    string interProfit = Request.Form["WebCurPro"];
                    string interFarm = Request.Form["WebCurFarm"];
                    string interAttOther = Request.Form["WebCurAttOther"];
                    string interAttDesc = Request.Form["WebCurAttDesc"];
                    string interMedia = Request.Form["WebCurMedia"];
                    string interClient = Request.Form["WebCurClient"];
                    string interDevel = Request.Form["WebCurDevel"];
                    string interIncorp = Request.Form["WebCurIncorp"];
                    string interProgram = Request.Form["WebCurProg"];
                    string interConsult = Request.Form["WebCurConsult"];
                    string interFarmers = Request.Form["WebCurFarmers"];
                    string interOutOther = Request.Form["WebCurOutOther"];
                    string interOutDesc = Request.Form["WebCurOutDesc"];
                    string interDescription = Request.Form["WebCurDescription"];


                    daikonPDP.PDPKeyOut pdpKeyOutWebToSave;
                    pdpKeyOutWebToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutWebToSave.ProjectNum = projNum;
                    pdpKeyOutWebToSave.InitiativeNum = initNum;

                    //if (studySess != null && studySess.Length > 0)
                    pdpKeyOutWebToSave.StudySess = sessNum;
                    pdpKeyOutWebToSave.StudyTitle = studyTitle;
                    if (studySDate == null)
                        pdpKeyOutWebToSave.StudyStartDate = "";
                    else
                        pdpKeyOutWebToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutWebToSave.StudyEndDate = "";
                    else
                        pdpKeyOutWebToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutWebToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutWebToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutWebToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutWebToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutWebToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutWebToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutWebToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutWebToSave.StudyAttDesc = studyAttDesc;

                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutWebToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutWebToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutWebToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutWebToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutWebToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutWebToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutWebToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutWebToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutWebToSave.StudyOutDesc = studyOutDesc;
                    pdpKeyOutWebToSave.StudyDescription = studyDescription;

                    pdpKeyOutWebToSave.ShortTitle = shortTitle;
                    if (shortExt != null && shortExt.Length > 0)
                        pdpKeyOutWebToSave.ShortExt = Convert.ToInt32(shortExt);
                    if (shortSDate == null)
                        pdpKeyOutWebToSave.ShortStartDate = "";
                    else
                        pdpKeyOutWebToSave.ShortStartDate = shortSDate.Trim();
                    if (shortEDate == null)
                        pdpKeyOutWebToSave.ShortEndDate = "";
                    else
                        pdpKeyOutWebToSave.ShortEndDate = shortEDate.Trim();
                    if (shortNRCS != null && shortNRCS.Length > 0)
                        pdpKeyOutWebToSave.ShortNRCS = Convert.ToInt32((shortNRCS));
                    if (shortNGO != null && shortNGO.Length > 0)
                        pdpKeyOutWebToSave.ShortNGO = Convert.ToInt32(shortNGO);
                    if (shortST != null && shortST.Length > 0)
                        pdpKeyOutWebToSave.ShortST = Convert.ToInt32(shortST);
                    if (shortProfit != null && shortProfit.Length > 0)
                        pdpKeyOutWebToSave.ShortProfit = Convert.ToInt32(shortProfit);
                    if (shortFarm != null && shortFarm.Length > 0)
                        pdpKeyOutWebToSave.ShortFarm = Convert.ToInt32(shortFarm);
                    pdpKeyOutWebToSave.ShortAttOther = shortAttOther;
                    pdpKeyOutWebToSave.ShortAttDesc = shortAttDesc;

                    if (shortMedia != null && shortMedia.Length > 0)
                        pdpKeyOutWebToSave.ShortMedia = Convert.ToInt32(shortMedia);
                    if (shortClient != null && shortClient.Length > 0)
                        pdpKeyOutWebToSave.ShortClient = Convert.ToInt32(shortClient);
                    if (shortDevel != null && shortDevel.Length > 0)
                        pdpKeyOutWebToSave.ShortDevel = Convert.ToInt32(shortDevel);
                    if (shortIncorp != null && shortIncorp.Length > 0)
                        pdpKeyOutWebToSave.ShortIncorp = Convert.ToInt32(shortIncorp);
                    if (shortProgram != null && shortProgram.Length > 0)
                        pdpKeyOutWebToSave.ShortProgram = Convert.ToInt32(shortProgram);
                    if (shortConsult != null && shortConsult.Length > 0)
                        pdpKeyOutWebToSave.ShortConsult = Convert.ToInt32(shortConsult);
                    if (shortFarmers != null && shortFarmers.Length > 0)
                        pdpKeyOutWebToSave.ShortFarmers = Convert.ToInt32(shortFarmers);
                    pdpKeyOutWebToSave.ShortOutOther = shortOutOther;
                    pdpKeyOutWebToSave.ShortOutDesc = shortOutDesc;
                    pdpKeyOutWebToSave.ShortDescription = shortDescription;

                    pdpKeyOutWebToSave.InterTitle = interTitle;
                    if (interExt != null && interExt.Length > 0)
                        pdpKeyOutWebToSave.InterExt = Convert.ToInt32(interExt);
                    if (interSDate == null)
                        pdpKeyOutWebToSave.InterStartDate = "";
                    else
                        pdpKeyOutWebToSave.InterStartDate = interSDate.Trim();
                    if (interEDate == null)
                        pdpKeyOutWebToSave.InterEndDate = "";
                    else
                        pdpKeyOutWebToSave.InterEndDate = interEDate.Trim();
                    if (interNRCS != null && interNRCS.Length > 0)
                        pdpKeyOutWebToSave.InterNRCS = Convert.ToInt32((interNRCS));
                    if (interNGO != null && interNGO.Length > 0)
                        pdpKeyOutWebToSave.InterNGO = Convert.ToInt32(interNGO);
                    if (interST != null && interST.Length > 0)
                        pdpKeyOutWebToSave.InterST = Convert.ToInt32(interST);
                    if (interProfit != null && interProfit.Length > 0)
                        pdpKeyOutWebToSave.InterProfit = Convert.ToInt32(interProfit);
                    if (interFarm != null && interFarm.Length > 0)
                        pdpKeyOutWebToSave.InterFarm = Convert.ToInt32(interFarm);
                    pdpKeyOutWebToSave.InterAttOther = interAttOther;
                    pdpKeyOutWebToSave.InterAttDesc = interAttDesc;

                    if (interMedia != null && interMedia.Length > 0)
                        pdpKeyOutWebToSave.InterMedia = Convert.ToInt32(interMedia);
                    if (interClient != null && interClient.Length > 0)
                        pdpKeyOutWebToSave.InterClient = Convert.ToInt32(interClient);
                    if (interDevel != null && interDevel.Length > 0)
                        pdpKeyOutWebToSave.InterDevel = Convert.ToInt32(interDevel);
                    if (interIncorp != null && interIncorp.Length > 0)
                        pdpKeyOutWebToSave.InterIncorp = Convert.ToInt32(interIncorp);
                    if (interProgram != null && interProgram.Length > 0)
                        pdpKeyOutWebToSave.InterProgram = Convert.ToInt32(interProgram);
                    if (interConsult != null && interConsult.Length > 0)
                        pdpKeyOutWebToSave.InterConsult = Convert.ToInt32(interConsult);
                    if (interFarmers != null && interFarmers.Length > 0)
                        pdpKeyOutWebToSave.InterFarmers = Convert.ToInt32(interFarmers);
                    pdpKeyOutWebToSave.InterOutOther = interOutOther;
                    pdpKeyOutWebToSave.InterOutDesc = interOutDesc;
                    pdpKeyOutWebToSave.InterDescription = interDescription;

                    pdpKeyOutWebToSave.UpdatePDPKeyOutWebToDB();

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Web data has been updated successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    
                }


                if (Request.Form["cmdPdpKeyOutWorkshopsSave"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    //string shortSess = Request.Form["shortSession"];
                    string shortSDate = Request.Form["ShortSDate"];
                    string shortEDate = Request.Form["ShortEDate"];
                    string shortExt = Request.Form["shortExt"];
                    string shortNRCS = Request.Form["shortNRCS"];
                    string shortNGO = Request.Form["shortNGO"];
                    string shortST = Request.Form["shortST"];
                    string shortProfit = Request.Form["shortPro"];
                    string shortFarm = Request.Form["shortFarm"];
                    string shortAttOther = Request.Form["shortAttOther"];
                    string shortAttDesc = Request.Form["shortAttDesc"];
                    string shortLocation = Request.Form["shortLoc"];
                    string shortState = Request.Form["shortState"];
                    string shortZip = Request.Form["shortZip"];
                    string shortMedia = Request.Form["shortMedia"];
                    string shortClient = Request.Form["shortClient"];
                    string shortDevel = Request.Form["shortDevel"];
                    string shortIncorp = Request.Form["shortIncorp"];
                    string shortProgram = Request.Form["shortProg"];
                    string shortConsult = Request.Form["shortConsult"];
                    string shortFarmers = Request.Form["shortFarmers"];
                    string shortOutOther = Request.Form["shortOutOther"];
                    string shortOutDesc = Request.Form["shortOutDesc"];
                    string shortTitle = Request.Form["shortTitle"];
                    string shortDescription = Request.Form["shortDescription"];

                    string interSess = Request.Form["interSession"];
                    string interSDate = Request.Form["InterSDate"];
                    string interEDate = Request.Form["InterSDate"];
                    string interExt = Request.Form["interExt"];
                    string interNRCS = Request.Form["interNRCS"];
                    string interNGO = Request.Form["interNGO"];
                    string interST = Request.Form["interST"];
                    string interProfit = Request.Form["interPro"];
                    string interFarm = Request.Form["interFarm"];
                    string interAttOther = Request.Form["interAttOther"];
                    string interAttDesc = Request.Form["interAttDesc"];
                    string interLocation = Request.Form["interLoc"];
                    string interState = Request.Form["interState"];
                    string interZip = Request.Form["interZip"];
                    string interMedia = Request.Form["interMedia"];
                    string interClient = Request.Form["interClient"];
                    string interDevel = Request.Form["interDevel"];
                    string interIncorp = Request.Form["interIncorp"];
                    string interProgram = Request.Form["interProg"];
                    string interConsult = Request.Form["interConsult"];
                    string interFarmers = Request.Form["interFarmers"];
                    string interOutOther = Request.Form["interOutOther"];
                    string interOutDesc = Request.Form["interOutDesc"];
                    string interTitle = Request.Form["interTitle"];
                    string interDescription = Request.Form["interDescription"];

                    string multiSess = Request.Form["multiSession"];
                    string multiSDate = Request.Form["MultiSDate"];
                    string multiEDate = Request.Form["MultiEDate"];
                    string multiExt = Request.Form["multiExt"];
                    string multiNRCS = Request.Form["multiNRCS"];
                    string multiNGO = Request.Form["multiNGO"];
                    string multiST = Request.Form["multiST"];
                    string multiProfit = Request.Form["multiPro"];
                    string multiFarm = Request.Form["multiFarm"];
                    string multiAttOther = Request.Form["multiAttOther"];
                    string multiAttDesc = Request.Form["multiAttDesc"];
                    string multiLocation = Request.Form["multiLoc"];
                    string multiState = Request.Form["multiState"];
                    string multiZip = Request.Form["multiZip"];
                    string multiMedia = Request.Form["multiMedia"];
                    string multiClient = Request.Form["multiClient"];
                    string multiDevel = Request.Form["multiDevel"];
                    string multiIncorp = Request.Form["multiIncorp"];
                    string multiProgram = Request.Form["multiProg"];
                    string multiConsult = Request.Form["multiConsult"];
                    string multiFarmers = Request.Form["multiFarmers"];
                    string multiOutOther = Request.Form["multiOutOther"];
                    string multiOutDesc = Request.Form["multiOutDesc"];
                    string multiTitle = Request.Form["multiTitle"];
                    string multiDescription = Request.Form["multiDescription"];

                    string studySess = Request.Form["extendSession"];
                    string studySDate = Request.Form["ExtendSDate"];
                    string studyEDate = Request.Form["ExtendEDate"];
                    string studyExt = Request.Form["extendExt"];
                    string studyNRCS = Request.Form["extendNRCS"];
                    string studyNGO = Request.Form["extendNGO"];
                    string studyST = Request.Form["extendST"];
                    string studyProfit = Request.Form["extendPro"];
                    string studyFarm = Request.Form["extendFarm"];
                    string studyAttOther = Request.Form["extendAttOther"];
                    string studyAttDesc = Request.Form["extendAttDesc"];
                    string studyLocation = Request.Form["extendLoc"];
                    string studyState = Request.Form["extendState"];
                    string studyZip = Request.Form["extendZip"];
                    string studyMedia = Request.Form["extendMedia"];
                    string studyClient = Request.Form["extendClient"];
                    string studyDevel = Request.Form["extendDevel"];
                    string studyIncorp = Request.Form["extendIncorp"];
                    string studyProgram = Request.Form["extendProg"];
                    string studyConsult = Request.Form["extendConsult"];
                    string studyFarmers = Request.Form["extendFarmers"];
                    string studyOutOther = Request.Form["extendOutOther"];
                    string studyOutDesc = Request.Form["extendOutDesc"];
                    string studyTitle = Request.Form["extendTitle"];
                    string studyDescription = Request.Form["extendDescription"];

                    daikonPDP.PDPKeyOut pdpKeyOutWorkshopsToSave;
                    pdpKeyOutWorkshopsToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutWorkshopsToSave.ProjectNum = projNum;
                    pdpKeyOutWorkshopsToSave.InitiativeNum = initNum;

                    //if (shortSess != null && shortSess.Length > 0)
                    pdpKeyOutWorkshopsToSave.ShortSess = sessNum;
                    if (shortSDate == null)
                        pdpKeyOutWorkshopsToSave.ShortStartDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.ShortStartDate = shortSDate.Trim();
                    if (shortEDate == null)
                        pdpKeyOutWorkshopsToSave.ShortEndDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.ShortEndDate = shortEDate.Trim();
                    if (shortExt != null && shortExt.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortExt = Convert.ToInt32(shortExt);
                    if (shortNRCS != null && shortNRCS.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortNRCS = Convert.ToInt32((shortNRCS));
                    if (shortNGO != null && shortNGO.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortNGO = Convert.ToInt32(shortNGO);
                    if (shortST != null && shortST.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortST = Convert.ToInt32(shortST);
                    if (shortProfit != null && shortProfit.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortProfit = Convert.ToInt32(shortProfit);
                    if (shortFarm != null && shortFarm.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortFarm = Convert.ToInt32(shortFarm);
                    pdpKeyOutWorkshopsToSave.ShortAttOther = shortAttOther;
                    pdpKeyOutWorkshopsToSave.ShortAttDesc = shortAttDesc;
                    pdpKeyOutWorkshopsToSave.ShortLocation = shortLocation;
                    pdpKeyOutWorkshopsToSave.ShortState = shortState;
                    pdpKeyOutWorkshopsToSave.ShortZip = shortZip;
                    if (shortMedia != null && shortMedia.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortMedia = Convert.ToInt32(shortMedia);
                    if (shortClient != null && shortClient.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortClient = Convert.ToInt32(shortClient);
                    if (shortDevel != null && shortDevel.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortDevel = Convert.ToInt32(shortDevel);
                    if (shortIncorp != null && shortIncorp.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortIncorp = Convert.ToInt32(shortIncorp);
                    if (shortProgram != null && shortProgram.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortProgram = Convert.ToInt32(shortProgram);
                    if (shortConsult != null && shortConsult.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortConsult = Convert.ToInt32(shortConsult);
                    if (shortFarmers != null && shortFarmers.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortFarmers = Convert.ToInt32(shortFarmers);
                    pdpKeyOutWorkshopsToSave.ShortOutOther = shortOutOther;
                    pdpKeyOutWorkshopsToSave.ShortOutDesc = shortOutDesc;
                    pdpKeyOutWorkshopsToSave.ShortTitle = shortTitle;
                    pdpKeyOutWorkshopsToSave.ShortDescription = shortDescription;

                    if (interSess != null && interSess.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterSess = Convert.ToInt32(interSess);
                    if (interSDate == null)
                        pdpKeyOutWorkshopsToSave.InterStartDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.InterStartDate = interSDate.Trim();
                    if (interEDate == null)
                        pdpKeyOutWorkshopsToSave.InterEndDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.InterEndDate = interEDate.Trim();
                    if (interExt != null && interExt.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterExt = Convert.ToInt32(interExt);
                    if (interNRCS != null && interNRCS.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterNRCS = Convert.ToInt32((interNRCS));
                    if (interNGO != null && interNGO.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterNGO = Convert.ToInt32(interNGO);
                    if (interST != null && interST.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterST = Convert.ToInt32(interST);
                    if (interProfit != null && interProfit.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterProfit = Convert.ToInt32(interProfit);
                    if (interFarm != null && interFarm.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterFarm = Convert.ToInt32(interFarm);
                    pdpKeyOutWorkshopsToSave.InterAttOther = interAttOther;
                    pdpKeyOutWorkshopsToSave.InterAttDesc = interAttDesc;
                    pdpKeyOutWorkshopsToSave.InterLocation = interLocation;
                    pdpKeyOutWorkshopsToSave.InterState = interState;
                    pdpKeyOutWorkshopsToSave.InterZip = interZip;
                    if (interMedia != null && interMedia.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterMedia = Convert.ToInt32(interMedia);
                    if (interClient != null && interClient.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterClient = Convert.ToInt32(interClient);
                    if (interDevel != null && interDevel.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterDevel = Convert.ToInt32(interDevel);
                    if (interIncorp != null && interIncorp.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterIncorp = Convert.ToInt32(interIncorp);
                    if (interProgram != null && interProgram.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterProgram = Convert.ToInt32(interProgram);
                    if (interConsult != null && interConsult.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterConsult = Convert.ToInt32(interConsult);
                    if (interFarmers != null && interFarmers.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterFarmers = Convert.ToInt32(interFarmers);
                    pdpKeyOutWorkshopsToSave.InterOutOther = interOutOther;
                    pdpKeyOutWorkshopsToSave.InterOutDesc = interOutDesc;
                    pdpKeyOutWorkshopsToSave.InterTitle = interTitle;
                    pdpKeyOutWorkshopsToSave.InterDescription = interDescription;

                    if (multiSess != null && multiSess.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiSess = Convert.ToInt32(multiSess);
                    if (multiSDate == null)
                        pdpKeyOutWorkshopsToSave.MultiStartDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.MultiStartDate = multiSDate.Trim();
                    if (multiEDate == null)
                        pdpKeyOutWorkshopsToSave.MultiEndDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.MultiEndDate = multiEDate.Trim();
                    if (multiExt != null && multiExt.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiExt = Convert.ToInt32(multiExt);
                    if (multiNRCS != null && multiNRCS.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiNRCS = Convert.ToInt32((multiNRCS));
                    if (multiNGO != null && multiNGO.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiNGO = Convert.ToInt32(multiNGO);
                    if (multiST != null && multiST.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiST = Convert.ToInt32(multiST);
                    if (multiProfit != null && multiProfit.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiProfit = Convert.ToInt32(multiProfit);
                    if (multiFarm != null && multiFarm.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiFarm = Convert.ToInt32(multiFarm);
                    pdpKeyOutWorkshopsToSave.MultiAttOther = multiAttOther;
                    pdpKeyOutWorkshopsToSave.MultiAttDesc = multiAttDesc;
                    pdpKeyOutWorkshopsToSave.MultiLocation = multiLocation;
                    pdpKeyOutWorkshopsToSave.MultiState = multiState;
                    pdpKeyOutWorkshopsToSave.MultiZip = multiZip;
                    if (multiMedia != null && multiMedia.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiMedia = Convert.ToInt32(multiMedia);
                    if (multiClient != null && multiClient.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiClient = Convert.ToInt32(multiClient);
                    if (multiDevel != null && multiDevel.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiDevel = Convert.ToInt32(multiDevel);
                    if (multiIncorp != null && multiIncorp.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiIncorp = Convert.ToInt32(multiIncorp);
                    if (multiProgram != null && multiProgram.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiProgram = Convert.ToInt32(multiProgram);
                    if (multiConsult != null && multiConsult.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiConsult = Convert.ToInt32(multiConsult);
                    if (multiFarmers != null && multiFarmers.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiFarmers = Convert.ToInt32(multiFarmers);
                    pdpKeyOutWorkshopsToSave.MultiOutOther = multiOutOther;
                    pdpKeyOutWorkshopsToSave.MultiOutDesc = multiOutDesc;
                    pdpKeyOutWorkshopsToSave.MultiTitle = multiTitle;
                    pdpKeyOutWorkshopsToSave.MultiDescription = multiDescription;

                    if (studySess != null && studySess.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudySess = Convert.ToInt32(studySess);
                    if (studySDate == null)
                        pdpKeyOutWorkshopsToSave.StudyStartDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutWorkshopsToSave.StudyEndDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutWorkshopsToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutWorkshopsToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutWorkshopsToSave.StudyLocation = studyLocation;
                    pdpKeyOutWorkshopsToSave.StudyState = studyState;
                    pdpKeyOutWorkshopsToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutWorkshopsToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutWorkshopsToSave.StudyOutDesc = studyOutDesc;
                    pdpKeyOutWorkshopsToSave.StudyTitle = studyTitle;
                    pdpKeyOutWorkshopsToSave.StudyDescription = studyDescription;

                    int pdp_key_work_id = pdpKeyOutWorkshopsToSave.SaveNewPDPKeyOutWorkshopsToDB();

                    if (pdp_key_work_id > 0)
                    {
                        Session["statusMessage2"] = "PDP Key Outcome & Activities Workshops data has been saved successfully.";
                        if (initNum == 0)
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                        else
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    }
                }

                if (Request.Form["cmdPdpKeyOutWorkshopsUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    //string shortSess = Request.Form["shortSession"];
                    string shortSDate = Request.Form["ShortSDate"];
                    string shortEDate = Request.Form["ShortEDate"];
                    string shortExt = Request.Form["shortExt"];
                    string shortNRCS = Request.Form["shortNRCS"];
                    string shortNGO = Request.Form["shortNGO"];
                    string shortST = Request.Form["shortST"];
                    string shortProfit = Request.Form["shortPro"];
                    string shortFarm = Request.Form["shortFarm"];
                    string shortAttOther = Request.Form["shortAttOther"];
                    string shortAttDesc = Request.Form["shortAttDesc"];
                    string shortLocation = Request.Form["shortLoc"];
                    string shortState = Request.Form["shortState"];
                    string shortZip = Request.Form["shortZip"];
                    string shortMedia = Request.Form["shortMedia"];
                    string shortClient = Request.Form["shortClient"];
                    string shortDevel = Request.Form["shortDevel"];
                    string shortIncorp = Request.Form["shortIncorp"];
                    string shortProgram = Request.Form["shortProg"];
                    string shortConsult = Request.Form["shortConsult"];
                    string shortFarmers = Request.Form["shortFarmers"];
                    string shortOutOther = Request.Form["shortOutOther"];
                    string shortOutDesc = Request.Form["shortOutDesc"];
                    string shortTitle = Request.Form["shortTitle"];
                    string shortDescription = Request.Form["shortDescription"];

                    string interSess = Request.Form["interSession"];
                    string interSDate = Request.Form["InterSDate"];
                    string interEDate = Request.Form["InterEDate"];
                    string interExt = Request.Form["interExt"];
                    string interNRCS = Request.Form["interNRCS"];
                    string interNGO = Request.Form["interNGO"];
                    string interST = Request.Form["interST"];
                    string interProfit = Request.Form["interPro"];
                    string interFarm = Request.Form["interFarm"];
                    string interAttOther = Request.Form["interAttOther"];
                    string interAttDesc = Request.Form["interAttDesc"];
                    string interLocation = Request.Form["interLoc"];
                    string interState = Request.Form["interState"];
                    string interZip = Request.Form["interZip"];
                    string interMedia = Request.Form["interMedia"];
                    string interClient = Request.Form["interClient"];
                    string interDevel = Request.Form["interDevel"];
                    string interIncorp = Request.Form["interIncorp"];
                    string interProgram = Request.Form["interProg"];
                    string interConsult = Request.Form["interConsult"];
                    string interFarmers = Request.Form["interFarmers"];
                    string interOutOther = Request.Form["interOutOther"];
                    string interOutDesc = Request.Form["interOutDesc"];
                    string interTitle = Request.Form["interTitle"];
                    string interDescription = Request.Form["interDescription"];

                    string multiSess = Request.Form["multiSession"];
                    string multiSDate = Request.Form["MultiSDate"];
                    string multiEDate = Request.Form["MultiEDate"];
                    string multiExt = Request.Form["multiExt"];
                    string multiNRCS = Request.Form["multiNRCS"];
                    string multiNGO = Request.Form["multiNGO"];
                    string multiST = Request.Form["multiST"];
                    string multiProfit = Request.Form["multiPro"];
                    string multiFarm = Request.Form["multiFarm"];
                    string multiAttOther = Request.Form["multiAttOther"];
                    string multiAttDesc = Request.Form["multiAttDesc"];
                    string multiLocation = Request.Form["multiLoc"];
                    string multiState = Request.Form["multiState"];
                    string multiZip = Request.Form["multiZip"];
                    string multiMedia = Request.Form["multiMedia"];
                    string multiClient = Request.Form["multiClient"];
                    string multiDevel = Request.Form["multiDevel"];
                    string multiIncorp = Request.Form["multiIncorp"];
                    string multiProgram = Request.Form["multiProg"];
                    string multiConsult = Request.Form["multiConsult"];
                    string multiFarmers = Request.Form["multiFarmers"];
                    string multiOutOther = Request.Form["multiOutOther"];
                    string multiOutDesc = Request.Form["multiOutDesc"];
                    string multiTitle = Request.Form["multiTitle"];
                    string multiDescription = Request.Form["multiDescription"];

                    string studySess = Request.Form["extendSession"];
                    string studySDate = Request.Form["ExtendSDate"];
                    string studyEDate = Request.Form["ExtendEDate"];
                    string studyExt = Request.Form["extendExt"];
                    string studyNRCS = Request.Form["extendNRCS"];
                    string studyNGO = Request.Form["extendNGO"];
                    string studyST = Request.Form["extendST"];
                    string studyProfit = Request.Form["extendPro"];
                    string studyFarm = Request.Form["extendFarm"];
                    string studyAttOther = Request.Form["extendAttOther"];
                    string studyAttDesc = Request.Form["extendAttDesc"];
                    string studyLocation = Request.Form["extendLoc"];
                    string studyState = Request.Form["extendState"];
                    string studyZip = Request.Form["extendZip"];
                    string studyMedia = Request.Form["extendMedia"];
                    string studyClient = Request.Form["extendClient"];
                    string studyDevel = Request.Form["extendDevel"];
                    string studyIncorp = Request.Form["extendIncorp"];
                    string studyProgram = Request.Form["extendProg"];
                    string studyConsult = Request.Form["extendConsult"];
                    string studyFarmers = Request.Form["extendFarmers"];
                    string studyOutOther = Request.Form["extendOutOther"];
                    string studyOutDesc = Request.Form["extendOutDesc"];
                    string studyTitle = Request.Form["extendTitle"];
                    string studyDescription = Request.Form["extendDescription"];

                    daikonPDP.PDPKeyOut pdpKeyOutWorkshopsToSave;
                    pdpKeyOutWorkshopsToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutWorkshopsToSave.ProjectNum = projNum;
                    pdpKeyOutWorkshopsToSave.InitiativeNum = initNum;

                    //if (shortSess != null && shortSess.Length > 0)
                    pdpKeyOutWorkshopsToSave.ShortSess = sessNum;
                    if (shortSDate == null)
                        pdpKeyOutWorkshopsToSave.ShortStartDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.ShortStartDate = shortSDate.Trim();
                    if (shortEDate == null)
                        pdpKeyOutWorkshopsToSave.ShortEndDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.ShortEndDate = shortEDate.Trim();
                    if (shortExt != null && shortExt.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortExt = Convert.ToInt32(shortExt);
                    if (shortNRCS != null && shortNRCS.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortNRCS = Convert.ToInt32((shortNRCS));
                    if (shortNGO != null && shortNGO.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortNGO = Convert.ToInt32(shortNGO);
                    if (shortST != null && shortST.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortST = Convert.ToInt32(shortST);
                    if (shortProfit != null && shortProfit.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortProfit = Convert.ToInt32(shortProfit);
                    if (shortFarm != null && shortFarm.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortFarm = Convert.ToInt32(shortFarm);
                    pdpKeyOutWorkshopsToSave.ShortAttOther = shortAttOther;
                    pdpKeyOutWorkshopsToSave.ShortAttDesc = shortAttDesc;
                    pdpKeyOutWorkshopsToSave.ShortLocation = shortLocation;
                    pdpKeyOutWorkshopsToSave.ShortState = shortState;
                    pdpKeyOutWorkshopsToSave.ShortZip = shortZip;
                    if (shortMedia != null && shortMedia.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortMedia = Convert.ToInt32(shortMedia);
                    if (shortClient != null && shortClient.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortClient = Convert.ToInt32(shortClient);
                    if (shortDevel != null && shortDevel.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortDevel = Convert.ToInt32(shortDevel);
                    if (shortIncorp != null && shortIncorp.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortIncorp = Convert.ToInt32(shortIncorp);
                    if (shortProgram != null && shortProgram.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortProgram = Convert.ToInt32(shortProgram);
                    if (shortConsult != null && shortConsult.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortConsult = Convert.ToInt32(shortConsult);
                    if (shortFarmers != null && shortFarmers.Length > 0)
                        pdpKeyOutWorkshopsToSave.ShortFarmers = Convert.ToInt32(shortFarmers);
                    pdpKeyOutWorkshopsToSave.ShortOutOther = shortOutOther;
                    pdpKeyOutWorkshopsToSave.ShortOutDesc = shortOutDesc;
                    pdpKeyOutWorkshopsToSave.ShortTitle = shortTitle;
                    pdpKeyOutWorkshopsToSave.ShortDescription = shortDescription;

                    if (interSess != null && interSess.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterSess = Convert.ToInt32(interSess);
                    if (interSDate == null)
                        pdpKeyOutWorkshopsToSave.InterStartDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.InterStartDate = interSDate.Trim();
                    if (interEDate == null)
                        pdpKeyOutWorkshopsToSave.InterEndDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.InterEndDate = interEDate.Trim();
                    if (interExt != null && interExt.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterExt = Convert.ToInt32(interExt);
                    if (interNRCS != null && interNRCS.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterNRCS = Convert.ToInt32((interNRCS));
                    if (interNGO != null && interNGO.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterNGO = Convert.ToInt32(interNGO);
                    if (interST != null && interST.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterST = Convert.ToInt32(interST);
                    if (interProfit != null && interProfit.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterProfit = Convert.ToInt32(interProfit);
                    if (interFarm != null && interFarm.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterFarm = Convert.ToInt32(interFarm);
                    pdpKeyOutWorkshopsToSave.InterAttOther = interAttOther;
                    pdpKeyOutWorkshopsToSave.InterAttDesc = interAttDesc;
                    pdpKeyOutWorkshopsToSave.InterLocation = interLocation;
                    pdpKeyOutWorkshopsToSave.InterState = interState;
                    pdpKeyOutWorkshopsToSave.InterZip = interZip;
                    if (interMedia != null && interMedia.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterMedia = Convert.ToInt32(interMedia);
                    if (interClient != null && interClient.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterClient = Convert.ToInt32(interClient);
                    if (interDevel != null && interDevel.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterDevel = Convert.ToInt32(interDevel);
                    if (interIncorp != null && interIncorp.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterIncorp = Convert.ToInt32(interIncorp);
                    if (interProgram != null && interProgram.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterProgram = Convert.ToInt32(interProgram);
                    if (interConsult != null && interConsult.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterConsult = Convert.ToInt32(interConsult);
                    if (interFarmers != null && interFarmers.Length > 0)
                        pdpKeyOutWorkshopsToSave.InterFarmers = Convert.ToInt32(interFarmers);
                    pdpKeyOutWorkshopsToSave.InterOutOther = interOutOther;
                    pdpKeyOutWorkshopsToSave.InterOutDesc = interOutDesc;
                    pdpKeyOutWorkshopsToSave.InterTitle = interTitle;
                    pdpKeyOutWorkshopsToSave.InterDescription = interDescription;

                    if (multiSess != null && multiSess.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiSess = Convert.ToInt32(multiSess);
                    if (multiSDate == null)
                        pdpKeyOutWorkshopsToSave.MultiStartDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.MultiStartDate = multiSDate.Trim();
                    if (multiEDate == null)
                        pdpKeyOutWorkshopsToSave.MultiEndDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.MultiEndDate = multiEDate.Trim();
                    if (multiExt != null && multiExt.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiExt = Convert.ToInt32(multiExt);
                    if (multiNRCS != null && multiNRCS.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiNRCS = Convert.ToInt32((multiNRCS));
                    if (multiNGO != null && multiNGO.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiNGO = Convert.ToInt32(multiNGO);
                    if (multiST != null && multiST.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiST = Convert.ToInt32(multiST);
                    if (multiProfit != null && multiProfit.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiProfit = Convert.ToInt32(multiProfit);
                    if (multiFarm != null && multiFarm.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiFarm = Convert.ToInt32(multiFarm);
                    pdpKeyOutWorkshopsToSave.MultiAttOther = multiAttOther;
                    pdpKeyOutWorkshopsToSave.MultiAttDesc = multiAttDesc;
                    pdpKeyOutWorkshopsToSave.MultiLocation = multiLocation;
                    pdpKeyOutWorkshopsToSave.MultiState = multiState;
                    pdpKeyOutWorkshopsToSave.MultiZip = multiZip;
                    if (multiMedia != null && multiMedia.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiMedia = Convert.ToInt32(multiMedia);
                    if (multiClient != null && multiClient.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiClient = Convert.ToInt32(multiClient);
                    if (multiDevel != null && multiDevel.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiDevel = Convert.ToInt32(multiDevel);
                    if (multiIncorp != null && multiIncorp.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiIncorp = Convert.ToInt32(multiIncorp);
                    if (multiProgram != null && multiProgram.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiProgram = Convert.ToInt32(multiProgram);
                    if (multiConsult != null && multiConsult.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiConsult = Convert.ToInt32(multiConsult);
                    if (multiFarmers != null && multiFarmers.Length > 0)
                        pdpKeyOutWorkshopsToSave.MultiFarmers = Convert.ToInt32(multiFarmers);
                    pdpKeyOutWorkshopsToSave.MultiOutOther = multiOutOther;
                    pdpKeyOutWorkshopsToSave.MultiOutDesc = multiOutDesc;
                    pdpKeyOutWorkshopsToSave.MultiTitle = multiTitle;
                    pdpKeyOutWorkshopsToSave.MultiDescription = multiDescription;

                    if (studySess != null && studySess.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudySess = Convert.ToInt32(studySess);
                    if (studySDate == null)
                        pdpKeyOutWorkshopsToSave.StudyStartDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutWorkshopsToSave.StudyEndDate = "";
                    else
                        pdpKeyOutWorkshopsToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutWorkshopsToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutWorkshopsToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutWorkshopsToSave.StudyLocation = studyLocation;
                    pdpKeyOutWorkshopsToSave.StudyState = studyState;
                    pdpKeyOutWorkshopsToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutWorkshopsToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutWorkshopsToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutWorkshopsToSave.StudyOutDesc = studyOutDesc;
                    pdpKeyOutWorkshopsToSave.StudyTitle = studyTitle;
                    pdpKeyOutWorkshopsToSave.StudyDescription = studyDescription;

                    pdpKeyOutWorkshopsToSave.UpdatePDPKeyOutWorkshopsToDB();
                    
                    Session["statusMessage2"] = "PDP Key Outcome & Activities Workshops data has been updated successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    
                }

                if (Request.Form["cmdPdpKeyOutFieldSave"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    string initiativeNum = "0";
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initiativeNum = Request.Params.Get("initNum");

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    string interTitle = Request.Form["interTitle"];
                    string interSDate = Request.Form["InterSDate"];
                    string interEDate = Request.Form["InterEDate"];
                    string interExt = Request.Form["interExt"];
                    string interNRCS = Request.Form["interNRCS"];
                    string interNGO = Request.Form["interNGO"];
                    string interST = Request.Form["interST"];
                    string interProfit = Request.Form["interPro"];
                    string interFarm = Request.Form["interFarm"];
                    string interAttOther = Request.Form["interAttOther"];
                    string interAttDesc = Request.Form["interAttDesc"];
                    string interLocation = Request.Form["interLoc"];
                    string interState = Request.Form["interState"];
                    string interZip = Request.Form["interZip"];
                    string interMedia = Request.Form["interMedia"];
                    string interClient = Request.Form["interClient"];
                    string interDevel = Request.Form["interDevel"];
                    string interIncorp = Request.Form["interIncorp"];
                    string interProgram = Request.Form["interProg"];
                    string interConsult = Request.Form["interConsult"];
                    string interFarmers = Request.Form["interFarmers"];
                    string interOutOther = Request.Form["interOutOther"];
                    string interOutDesc = Request.Form["interOutDesc"];
                    string interDescription = Request.Form["interDescription"];

                    //string multiSess = Request.Form["multiSession"];
                    string multiTitle = Request.Form["multiTitle"];
                    string multiSDate = Request.Form["MultiSDate"];
                    string multiEDate = Request.Form["MultiEDate"];
                    string multiExt = Request.Form["multiExt"];
                    string multiNRCS = Request.Form["multiNRCS"];
                    string multiNGO = Request.Form["multiNGO"];
                    string multiST = Request.Form["multiST"];
                    string multiProfit = Request.Form["multiPro"];
                    string multiFarm = Request.Form["multiFarm"];
                    string multiAttOther = Request.Form["multiAttOther"];
                    string multiAttDesc = Request.Form["multiAttDesc"];
                    string multiLocation = Request.Form["multiLoc"];
                    string multiState = Request.Form["multiState"];
                    string multiZip = Request.Form["multiZip"];
                    string multiMedia = Request.Form["multiMedia"];
                    string multiClient = Request.Form["multiClient"];
                    string multiDevel = Request.Form["multiDevel"];
                    string multiIncorp = Request.Form["multiIncorp"];
                    string multiProgram = Request.Form["multiProg"];
                    string multiConsult = Request.Form["multiConsult"];
                    string multiFarmers = Request.Form["multiFarmers"];
                    string multiOutOther = Request.Form["multiOutOther"];
                    string multiOutDesc = Request.Form["multiOutDesc"];
                    string multiDescription = Request.Form["multiDescription"];

                    string studySess = Request.Form["extendSession"];
                    string studyTitle = Request.Form["extendTitle"];
                    string studySDate = Request.Form["ExtendSDate"];
                    string studyEDate = Request.Form["ExtendEDate"];
                    string studyExt = Request.Form["extendExt"];
                    string studyNRCS = Request.Form["extendNRCS"];
                    string studyNGO = Request.Form["extendNGO"];
                    string studyST = Request.Form["extendST"];
                    string studyProfit = Request.Form["extendPro"];
                    string studyFarm = Request.Form["extendFarm"];
                    string studyAttOther = Request.Form["extendAttOther"];
                    string studyAttDesc = Request.Form["extendAttDesc"];
                    string studyLocation = Request.Form["extendLoc"];
                    string studyState = Request.Form["extendState"];
                    string studyZip = Request.Form["extendZip"];
                    string studyMedia = Request.Form["extendMedia"];
                    string studyClient = Request.Form["extendClient"];
                    string studyDevel = Request.Form["extendDevel"];
                    string studyIncorp = Request.Form["extendIncorp"];
                    string studyProgram = Request.Form["extendProg"];
                    string studyConsult = Request.Form["extendConsult"];
                    string studyFarmers = Request.Form["extendFarmers"];
                    string studyOutOther = Request.Form["extendOutOther"];
                    string studyOutDesc = Request.Form["extendOutDesc"];
                    string studyDescription = Request.Form["extendDescription"];

                    daikonPDP.PDPKeyOut pdpKeyOutFieldToSave;
                    pdpKeyOutFieldToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutFieldToSave.ProjectNum = projNum;
                    pdpKeyOutFieldToSave.InitiativeNum = int.Parse(initiativeNum);

                    pdpKeyOutFieldToSave.InterTitle = interTitle;
                    if (interSDate == null)
                        pdpKeyOutFieldToSave.InterStartDate = "";
                    else
                        pdpKeyOutFieldToSave.InterStartDate = interSDate.Trim();
                    if (interEDate == null)
                        pdpKeyOutFieldToSave.InterEndDate = "";
                    else
                        pdpKeyOutFieldToSave.InterEndDate = interEDate.Trim();
                    if (interExt != null && interExt.Length > 0)
                        pdpKeyOutFieldToSave.InterExt = Convert.ToInt32(interExt);
                    if (interNRCS != null && interNRCS.Length > 0)
                        pdpKeyOutFieldToSave.InterNRCS = Convert.ToInt32((interNRCS));
                    if (interNGO != null && interNGO.Length > 0)
                        pdpKeyOutFieldToSave.InterNGO = Convert.ToInt32(interNGO);
                    if (interST != null && interST.Length > 0)
                        pdpKeyOutFieldToSave.InterST = Convert.ToInt32(interST);
                    if (interProfit != null && interProfit.Length > 0)
                        pdpKeyOutFieldToSave.InterProfit = Convert.ToInt32(interProfit);
                    if (interFarm != null && interFarm.Length > 0)
                        pdpKeyOutFieldToSave.InterFarm = Convert.ToInt32(interFarm);
                    pdpKeyOutFieldToSave.InterAttOther = interAttOther;
                    pdpKeyOutFieldToSave.InterAttDesc = interAttDesc;
                    pdpKeyOutFieldToSave.InterLocation = interLocation;
                    pdpKeyOutFieldToSave.InterState = interState;
                    pdpKeyOutFieldToSave.InterZip = interZip;
                    if (interMedia != null && interMedia.Length > 0)
                        pdpKeyOutFieldToSave.InterMedia = Convert.ToInt32(interMedia);
                    if (interClient != null && interClient.Length > 0)
                        pdpKeyOutFieldToSave.InterClient = Convert.ToInt32(interClient);
                    if (interDevel != null && interDevel.Length > 0)
                        pdpKeyOutFieldToSave.InterDevel = Convert.ToInt32(interDevel);
                    if (interIncorp != null && interIncorp.Length > 0)
                        pdpKeyOutFieldToSave.InterIncorp = Convert.ToInt32(interIncorp);
                    if (interProgram != null && interProgram.Length > 0)
                        pdpKeyOutFieldToSave.InterProgram = Convert.ToInt32(interProgram);
                    if (interConsult != null && interConsult.Length > 0)
                        pdpKeyOutFieldToSave.InterConsult = Convert.ToInt32(interConsult);
                    if (interFarmers != null && interFarmers.Length > 0)
                        pdpKeyOutFieldToSave.InterFarmers = Convert.ToInt32(interFarmers);
                    pdpKeyOutFieldToSave.InterOutOther = interOutOther;
                    pdpKeyOutFieldToSave.InterOutDesc = interOutDesc;
                    pdpKeyOutFieldToSave.InterDescription = interDescription;

                    //if (multiSess != null && multiSess.Length > 0)
                    pdpKeyOutFieldToSave.MultiSess = sessNum;
                    pdpKeyOutFieldToSave.MultiTitle = multiTitle;
                    if (multiSDate == null)
                        pdpKeyOutFieldToSave.MultiStartDate = "";
                    else
                        pdpKeyOutFieldToSave.MultiStartDate = multiSDate.Trim();
                    if (multiEDate == null)
                        pdpKeyOutFieldToSave.MultiEndDate = "";
                    else
                        pdpKeyOutFieldToSave.MultiEndDate = multiEDate.Trim();
                    if (multiExt != null && multiExt.Length > 0)
                        pdpKeyOutFieldToSave.MultiExt = Convert.ToInt32(multiExt);
                    if (multiNRCS != null && multiNRCS.Length > 0)
                        pdpKeyOutFieldToSave.MultiNRCS = Convert.ToInt32((multiNRCS));
                    if (multiNGO != null && multiNGO.Length > 0)
                        pdpKeyOutFieldToSave.MultiNGO = Convert.ToInt32(multiNGO);
                    if (multiST != null && multiST.Length > 0)
                        pdpKeyOutFieldToSave.MultiST = Convert.ToInt32(multiST);
                    if (multiProfit != null && multiProfit.Length > 0)
                        pdpKeyOutFieldToSave.MultiProfit = Convert.ToInt32(multiProfit);
                    if (multiFarm != null && multiFarm.Length > 0)
                        pdpKeyOutFieldToSave.MultiFarm = Convert.ToInt32(multiFarm);
                    pdpKeyOutFieldToSave.MultiAttOther = multiAttOther;
                    pdpKeyOutFieldToSave.MultiAttDesc = multiAttDesc;
                    pdpKeyOutFieldToSave.MultiLocation = multiLocation;
                    pdpKeyOutFieldToSave.MultiState = multiState;
                    pdpKeyOutFieldToSave.MultiZip = multiZip;
                    if (multiMedia != null && multiMedia.Length > 0)
                        pdpKeyOutFieldToSave.MultiMedia = Convert.ToInt32(multiMedia);
                    if (multiClient != null && multiClient.Length > 0)
                        pdpKeyOutFieldToSave.MultiClient = Convert.ToInt32(multiClient);
                    if (multiDevel != null && multiDevel.Length > 0)
                        pdpKeyOutFieldToSave.MultiDevel = Convert.ToInt32(multiDevel);
                    if (multiIncorp != null && multiIncorp.Length > 0)
                        pdpKeyOutFieldToSave.MultiIncorp = Convert.ToInt32(multiIncorp);
                    if (multiProgram != null && multiProgram.Length > 0)
                        pdpKeyOutFieldToSave.MultiProgram = Convert.ToInt32(multiProgram);
                    if (multiConsult != null && multiConsult.Length > 0)
                        pdpKeyOutFieldToSave.MultiConsult = Convert.ToInt32(multiConsult);
                    if (multiFarmers != null && multiFarmers.Length > 0)
                        pdpKeyOutFieldToSave.MultiFarmers = Convert.ToInt32(multiFarmers);
                    pdpKeyOutFieldToSave.MultiOutOther = multiOutOther;
                    pdpKeyOutFieldToSave.MultiOutDesc = multiOutDesc;
                    pdpKeyOutFieldToSave.MultiDescription = multiDescription;

                    pdpKeyOutFieldToSave.StudyTitle = studyTitle;
                    if (studySess != null && studySess.Length > 0)
                        pdpKeyOutFieldToSave.StudySess = Convert.ToInt32(studySess);
                    if (studySDate == null)
                        pdpKeyOutFieldToSave.StudyStartDate = "";
                    else
                        pdpKeyOutFieldToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutFieldToSave.StudyEndDate = "";
                    else
                        pdpKeyOutFieldToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutFieldToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutFieldToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutFieldToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutFieldToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutFieldToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutFieldToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutFieldToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutFieldToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutFieldToSave.StudyLocation = studyLocation;
                    pdpKeyOutFieldToSave.StudyState = studyState;
                    pdpKeyOutFieldToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutFieldToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutFieldToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutFieldToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutFieldToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutFieldToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutFieldToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutFieldToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutFieldToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutFieldToSave.StudyOutDesc = studyOutDesc;
                    pdpKeyOutFieldToSave.StudyDescription = studyDescription;

                    int pdp_key_field_id = pdpKeyOutFieldToSave.SaveNewPDPKeyOutFieldToDB();

                    if (pdp_key_field_id > 0)
                    {
                        Session["statusMessage2"] = "PDP Key Outcome & Activities Field data has been saved successfully.";
                        if (pdpKeyOutFieldToSave.InitiativeNum == 0)
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                        else
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + pdpKeyOutFieldToSave.InitiativeNum);
                    }
                }

                if (Request.Form["cmdPdpKeyOutFieldUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    string initiativeNum = "0";
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initiativeNum = Request.Params.Get("initNum");

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    string interTitle = Request.Form["interTitle"];
                    string interSDate = Request.Form["InterSDate"];
                    string interEDate = Request.Form["InterEDate"];
                    string interExt = Request.Form["interExt"];
                    string interNRCS = Request.Form["interNRCS"];
                    string interNGO = Request.Form["interNGO"];
                    string interST = Request.Form["interST"];
                    string interProfit = Request.Form["interPro"];
                    string interFarm = Request.Form["interFarm"];
                    string interAttOther = Request.Form["interAttOther"];
                    string interAttDesc = Request.Form["interAttDesc"];
                    string interLocation = Request.Form["interLoc"];
                    string interState = Request.Form["interState"];
                    string interZip = Request.Form["interZip"];
                    string interMedia = Request.Form["interMedia"];
                    string interClient = Request.Form["interClient"];
                    string interDevel = Request.Form["interDevel"];
                    string interIncorp = Request.Form["interIncorp"];
                    string interProgram = Request.Form["interProg"];
                    string interConsult = Request.Form["interConsult"];
                    string interFarmers = Request.Form["interFarmers"];
                    string interOutOther = Request.Form["interOutOther"];
                    string interOutDesc = Request.Form["interOutDesc"];
                    string interDescription = Request.Form["interDescription"];

                    //string multiSess = Request.Form["multiSession"];
                    string multiTitle = Request.Form["multiTitle"];
                    string multiSDate = Request.Form["MultiSDate"];
                    string multiEDate = Request.Form["MultiEDate"];
                    string multiExt = Request.Form["multiExt"];
                    string multiNRCS = Request.Form["multiNRCS"];
                    string multiNGO = Request.Form["multiNGO"];
                    string multiST = Request.Form["multiST"];
                    string multiProfit = Request.Form["multiPro"];
                    string multiFarm = Request.Form["multiFarm"];
                    string multiAttOther = Request.Form["multiAttOther"];
                    string multiAttDesc = Request.Form["multiAttDesc"];
                    string multiLocation = Request.Form["multiLoc"];
                    string multiState = Request.Form["multiState"];
                    string multiZip = Request.Form["multiZip"];
                    string multiMedia = Request.Form["multiMedia"];
                    string multiClient = Request.Form["multiClient"];
                    string multiDevel = Request.Form["multiDevel"];
                    string multiIncorp = Request.Form["multiIncorp"];
                    string multiProgram = Request.Form["multiProg"];
                    string multiConsult = Request.Form["multiConsult"];
                    string multiFarmers = Request.Form["multiFarmers"];
                    string multiOutOther = Request.Form["multiOutOther"];
                    string multiOutDesc = Request.Form["multiOutDesc"];
                    string multiDescription = Request.Form["multiDescription"];

                    string studySess = Request.Form["extendSession"];
                    string studyTitle = Request.Form["extendTitle"];
                    string studySDate = Request.Form["ExtendSDate"];
                    string studyEDate = Request.Form["ExtendEDate"];
                    string studyExt = Request.Form["extendExt"];
                    string studyNRCS = Request.Form["extendNRCS"];
                    string studyNGO = Request.Form["extendNGO"];
                    string studyST = Request.Form["extendST"];
                    string studyProfit = Request.Form["extendPro"];
                    string studyFarm = Request.Form["extendFarm"];
                    string studyAttOther = Request.Form["extendAttOther"];
                    string studyAttDesc = Request.Form["extendAttDesc"];
                    string studyLocation = Request.Form["extendLoc"];
                    string studyState = Request.Form["extendState"];
                    string studyZip = Request.Form["extendZip"];
                    string studyMedia = Request.Form["extendMedia"];
                    string studyClient = Request.Form["extendClient"];
                    string studyDevel = Request.Form["extendDevel"];
                    string studyIncorp = Request.Form["extendIncorp"];
                    string studyProgram = Request.Form["extendProg"];
                    string studyConsult = Request.Form["extendConsult"];
                    string studyFarmers = Request.Form["extendFarmers"];
                    string studyOutOther = Request.Form["extendOutOther"];
                    string studyOutDesc = Request.Form["extendOutDesc"];
                    string studyDescription = Request.Form["extendDescription"];

                    daikonPDP.PDPKeyOut pdpKeyOutFieldToSave;
                    pdpKeyOutFieldToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutFieldToSave.ProjectNum = projNum;
                    pdpKeyOutFieldToSave.InitiativeNum = int.Parse(initiativeNum);

                    pdpKeyOutFieldToSave.InterTitle = interTitle;
                    if (interSDate == null)
                        pdpKeyOutFieldToSave.InterStartDate = "";
                    else
                        pdpKeyOutFieldToSave.InterStartDate = interSDate.Trim();
                    if (interEDate == null)
                        pdpKeyOutFieldToSave.InterEndDate = "";
                    else
                        pdpKeyOutFieldToSave.InterEndDate = interEDate.Trim();
                    if (interExt != null && interExt.Length > 0)
                        pdpKeyOutFieldToSave.InterExt = Convert.ToInt32(interExt);
                    if (interNRCS != null && interNRCS.Length > 0)
                        pdpKeyOutFieldToSave.InterNRCS = Convert.ToInt32((interNRCS));
                    if (interNGO != null && interNGO.Length > 0)
                        pdpKeyOutFieldToSave.InterNGO = Convert.ToInt32(interNGO);
                    if (interST != null && interST.Length > 0)
                        pdpKeyOutFieldToSave.InterST = Convert.ToInt32(interST);
                    if (interProfit != null && interProfit.Length > 0)
                        pdpKeyOutFieldToSave.InterProfit = Convert.ToInt32(interProfit);
                    if (interFarm != null && interFarm.Length > 0)
                        pdpKeyOutFieldToSave.InterFarm = Convert.ToInt32(interFarm);
                    pdpKeyOutFieldToSave.InterAttOther = interAttOther;
                    pdpKeyOutFieldToSave.InterAttDesc = interAttDesc;
                    pdpKeyOutFieldToSave.InterLocation = interLocation;
                    pdpKeyOutFieldToSave.InterState = interState;
                    pdpKeyOutFieldToSave.InterZip = interZip;
                    if (interMedia != null && interMedia.Length > 0)
                        pdpKeyOutFieldToSave.InterMedia = Convert.ToInt32(interMedia);
                    if (interClient != null && interClient.Length > 0)
                        pdpKeyOutFieldToSave.InterClient = Convert.ToInt32(interClient);
                    if (interDevel != null && interDevel.Length > 0)
                        pdpKeyOutFieldToSave.InterDevel = Convert.ToInt32(interDevel);
                    if (interIncorp != null && interIncorp.Length > 0)
                        pdpKeyOutFieldToSave.InterIncorp = Convert.ToInt32(interIncorp);
                    if (interProgram != null && interProgram.Length > 0)
                        pdpKeyOutFieldToSave.InterProgram = Convert.ToInt32(interProgram);
                    if (interConsult != null && interConsult.Length > 0)
                        pdpKeyOutFieldToSave.InterConsult = Convert.ToInt32(interConsult);
                    if (interFarmers != null && interFarmers.Length > 0)
                        pdpKeyOutFieldToSave.InterFarmers = Convert.ToInt32(interFarmers);
                    pdpKeyOutFieldToSave.InterOutOther = interOutOther;
                    pdpKeyOutFieldToSave.InterOutDesc = interOutDesc;
                    pdpKeyOutFieldToSave.InterDescription = interDescription;

                    //if (multiSess != null && multiSess.Length > 0)
                    pdpKeyOutFieldToSave.MultiSess = sessNum;
                    pdpKeyOutFieldToSave.MultiTitle = multiTitle;
                    if (multiSDate == null)
                        pdpKeyOutFieldToSave.MultiStartDate = "";
                    else
                        pdpKeyOutFieldToSave.MultiStartDate = multiSDate.Trim();
                    if (multiEDate == null)
                        pdpKeyOutFieldToSave.MultiEndDate = "";
                    else
                        pdpKeyOutFieldToSave.MultiEndDate = multiEDate.Trim();
                    if (multiExt != null && multiExt.Length > 0)
                        pdpKeyOutFieldToSave.MultiExt = Convert.ToInt32(multiExt);
                    if (multiNRCS != null && multiNRCS.Length > 0)
                        pdpKeyOutFieldToSave.MultiNRCS = Convert.ToInt32((multiNRCS));
                    if (multiNGO != null && multiNGO.Length > 0)
                        pdpKeyOutFieldToSave.MultiNGO = Convert.ToInt32(multiNGO);
                    if (multiST != null && multiST.Length > 0)
                        pdpKeyOutFieldToSave.MultiST = Convert.ToInt32(multiST);
                    if (multiProfit != null && multiProfit.Length > 0)
                        pdpKeyOutFieldToSave.MultiProfit = Convert.ToInt32(multiProfit);
                    if (multiFarm != null && multiFarm.Length > 0)
                        pdpKeyOutFieldToSave.MultiFarm = Convert.ToInt32(multiFarm);
                    pdpKeyOutFieldToSave.MultiAttOther = multiAttOther;
                    pdpKeyOutFieldToSave.MultiAttDesc = multiAttDesc;
                    pdpKeyOutFieldToSave.MultiLocation = multiLocation;
                    pdpKeyOutFieldToSave.MultiState = multiState;
                    pdpKeyOutFieldToSave.MultiZip = multiZip;
                    if (multiMedia != null && multiMedia.Length > 0)
                        pdpKeyOutFieldToSave.MultiMedia = Convert.ToInt32(multiMedia);
                    if (multiClient != null && multiClient.Length > 0)
                        pdpKeyOutFieldToSave.MultiClient = Convert.ToInt32(multiClient);
                    if (multiDevel != null && multiDevel.Length > 0)
                        pdpKeyOutFieldToSave.MultiDevel = Convert.ToInt32(multiDevel);
                    if (multiIncorp != null && multiIncorp.Length > 0)
                        pdpKeyOutFieldToSave.MultiIncorp = Convert.ToInt32(multiIncorp);
                    if (multiProgram != null && multiProgram.Length > 0)
                        pdpKeyOutFieldToSave.MultiProgram = Convert.ToInt32(multiProgram);
                    if (multiConsult != null && multiConsult.Length > 0)
                        pdpKeyOutFieldToSave.MultiConsult = Convert.ToInt32(multiConsult);
                    if (multiFarmers != null && multiFarmers.Length > 0)
                        pdpKeyOutFieldToSave.MultiFarmers = Convert.ToInt32(multiFarmers);
                    pdpKeyOutFieldToSave.MultiOutOther = multiOutOther;
                    pdpKeyOutFieldToSave.MultiOutDesc = multiOutDesc;
                    pdpKeyOutFieldToSave.MultiDescription = multiDescription;

                    pdpKeyOutFieldToSave.StudyTitle = studyTitle;
                    if (studySess != null && studySess.Length > 0)
                        pdpKeyOutFieldToSave.StudySess = Convert.ToInt32(studySess);
                    if (studySDate == null)
                        pdpKeyOutFieldToSave.StudyStartDate = "";
                    else
                        pdpKeyOutFieldToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutFieldToSave.StudyEndDate = "";
                    else
                        pdpKeyOutFieldToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutFieldToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutFieldToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutFieldToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutFieldToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutFieldToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutFieldToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutFieldToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutFieldToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutFieldToSave.StudyLocation = studyLocation;
                    pdpKeyOutFieldToSave.StudyState = studyState;
                    pdpKeyOutFieldToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutFieldToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutFieldToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutFieldToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutFieldToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutFieldToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutFieldToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutFieldToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutFieldToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutFieldToSave.StudyOutDesc = studyOutDesc;
                    pdpKeyOutFieldToSave.StudyDescription = studyDescription;

                    pdpKeyOutFieldToSave.UpdatePDPKeyOutFieldToDB();

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Field data has been updated successfully.";
                    if (pdpKeyOutFieldToSave.InitiativeNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + pdpKeyOutFieldToSave.InitiativeNum);
                   
                    
                }

                if (Request.Form["cmdPdpKeyOutGrantsSave"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    //string shortSess = Request.Form["demoSession"];
                    string shortSDate = Request.Form["DemoSDate"];
                    string shortEDate = Request.Form["DemoEDate"];
                    string shortExt = Request.Form["demoExt"];
                    string shortNRCS = Request.Form["demoNRCS"];
                    string shortNGO = Request.Form["demoNGO"];
                    string shortST = Request.Form["demoST"];
                    string shortProfit = Request.Form["demoPro"];
                    string shortFarm = Request.Form["demoFarm"];
                    string shortAttOther = Request.Form["demoAttOther"];
                    string shortAttDesc = Request.Form["demoAttDesc"];
                    //string shortLocation = Request.Form["demoLoc"];
                    //string shortState = Request.Form["demoState"];
                    //string shortZip = Request.Form["demoZip"];
                    string shortMedia = Request.Form["demoMedia"];
                    string shortClient = Request.Form["demoClient"];
                    string shortDevel = Request.Form["demoDevel"];
                    string shortIncorp = Request.Form["demoIncorp"];
                    string shortProgram = Request.Form["demoProg"];
                    string shortConsult = Request.Form["demoConsult"];
                    string shortFarmers = Request.Form["demoFarmers"];
                    string shortOutOther = Request.Form["demoOutOther"];
                    string shortOutDesc = Request.Form["demoOutDesc"];

                    string interSess = Request.Form["workSession"];
                    string interSDate = Request.Form["WorkSDate"];
                    string interEDate = Request.Form["WorkEDate"];
                    string interExt = Request.Form["workExt"];
                    string interNRCS = Request.Form["workNRCS"];
                    string interNGO = Request.Form["workNGO"];
                    string interST = Request.Form["workST"];
                    string interProfit = Request.Form["workPro"];
                    string interFarm = Request.Form["workFarm"];
                    string interAttOther = Request.Form["workAttOther"];
                    string interAttDesc = Request.Form["workAttDesc"];
                    //string interLocation = Request.Form["workLoc"];
                    //string interState = Request.Form["workState"];
                    //string interZip = Request.Form["workZip"];
                    string interMedia = Request.Form["workMedia"];
                    string interClient = Request.Form["workClient"];
                    string interDevel = Request.Form["workDevel"];
                    string interIncorp = Request.Form["workIncorp"];
                    string interProgram = Request.Form["workProg"];
                    string interConsult = Request.Form["workConsult"];
                    string interFarmers = Request.Form["workFarmers"];
                    string interOutOther = Request.Form["workOutOther"];
                    string interOutDesc = Request.Form["workOutDesc"];
                    /*
                    string multiSess = Request.Form["tourSession"];
                    string multiSDate = Request.Form["TourSDate"];
                    string multiEDate = Request.Form["TourEDate"];
                    string multiExt = Request.Form["tourExt"];
                    string multiNRCS = Request.Form["tourNRCS"];
                    string multiNGO = Request.Form["tourNGO"];
                    string multiST = Request.Form["tourST"];
                    string multiProfit = Request.Form["tourPro"];
                    string multiFarm = Request.Form["tourFarm"];
                    string multiAttOther = Request.Form["tourAttOther"];
                    string multiAttDesc = Request.Form["tourAttDesc"];
                    string multiLocation = Request.Form["tourLoc"];
                    string multiState = Request.Form["tourState"];
                    string multiZip = Request.Form["tourZip"];
                    string multiMedia = Request.Form["tourMedia"];
                    string multiClient = Request.Form["tourClient"];
                    string multiDevel = Request.Form["tourDevel"];
                    string multiIncorp = Request.Form["tourIncorp"];
                    string multiProgram = Request.Form["tourProg"];
                    string multiConsult = Request.Form["tourConsult"];
                    string multiFarmers = Request.Form["tourFarmers"];
                    string multiOutOther = Request.Form["tourOutOther"];
                    string multiOutDesc = Request.Form["tourOutDesc"];


                    string studySess = Request.Form["curSession"];
                    string studySDate = Request.Form["CurSDate"];
                    string studyEDate = Request.Form["CurEDate"];
                    string studyExt = Request.Form["curExt"];
                    string studyNRCS = Request.Form["curNRCS"];
                    string studyNGO = Request.Form["curNGO"];
                    string studyST = Request.Form["curST"];
                    string studyProfit = Request.Form["curPro"];
                    string studyFarm = Request.Form["curFarm"];
                    string studyAttOther = Request.Form["curAttOther"];
                    string studyAttDesc = Request.Form["curAttDesc"];
                    string studyLocation = Request.Form["curLoc"];
                    string studyState = Request.Form["curState"];
                    string studyZip = Request.Form["curZip"];
                    string studyMedia = Request.Form["curMedia"];
                    string studyClient = Request.Form["curClient"];
                    string studyDevel = Request.Form["curDevel"];
                    string studyIncorp = Request.Form["curIncorp"];
                    string studyProgram = Request.Form["curProg"];
                    string studyConsult = Request.Form["curConsult"];
                    string studyFarmers = Request.Form["curFarmers"];
                    string studyOutOther = Request.Form["curOutOther"];
                    string studyOutDesc = Request.Form["curOutDesc"];
                    */
                    string shortTitle = Request.Form["demoTitle"];
                    string shortDescription = Request.Form["demoDescription"];
                    string interTitle = Request.Form["workTitle"];
                    string interDescription = Request.Form["workDescription"];
                    //string multiTitle = Request.Form["tourTitle"];
                    //string multiDescription = Request.Form["tourDescription"];
                    //string studyTitle = Request.Form["curTitle"];
                    //string studyDescription = Request.Form["curDescription"];

                    daikonPDP.PDPKeyOut pdpKeyOutGrantsToSave;
                    pdpKeyOutGrantsToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutGrantsToSave.ProjectNum = projNum;
                    pdpKeyOutGrantsToSave.InitiativeNum = initNum;

                    //if (shortSess != null && shortSess.Length > 0)
                    pdpKeyOutGrantsToSave.ShortTitle = shortTitle;
                    pdpKeyOutGrantsToSave.ShortDescription = shortDescription;
                    pdpKeyOutGrantsToSave.ShortSess = sessNum;
                    if (shortSDate == null)
                        pdpKeyOutGrantsToSave.ShortStartDate = "";
                    else
                        pdpKeyOutGrantsToSave.ShortStartDate = shortSDate.Trim();
                    if (shortEDate == null)
                        pdpKeyOutGrantsToSave.ShortEndDate = "";
                    else
                        pdpKeyOutGrantsToSave.ShortEndDate = shortEDate.Trim();
                    if (shortExt != null && shortExt.Length > 0)
                        pdpKeyOutGrantsToSave.ShortExt = Convert.ToInt32(shortExt);
                    if (shortNRCS != null && shortNRCS.Length > 0)
                        pdpKeyOutGrantsToSave.ShortNRCS = Convert.ToInt32((shortNRCS));
                    if (shortNGO != null && shortNGO.Length > 0)
                        pdpKeyOutGrantsToSave.ShortNGO = Convert.ToInt32(shortNGO);
                    if (shortST != null && shortST.Length > 0)
                        pdpKeyOutGrantsToSave.ShortST = Convert.ToInt32(shortST);
                    if (shortProfit != null && shortProfit.Length > 0)
                        pdpKeyOutGrantsToSave.ShortProfit = Convert.ToInt32(shortProfit);
                    if (shortFarm != null && shortFarm.Length > 0)
                        pdpKeyOutGrantsToSave.ShortFarm = Convert.ToInt32(shortFarm);
                    pdpKeyOutGrantsToSave.ShortAttOther = shortAttOther;
                    pdpKeyOutGrantsToSave.ShortAttDesc = shortAttDesc;
                    //pdpKeyOutGrantsToSave.ShortLocation = shortLocation;
                    //pdpKeyOutGrantsToSave.ShortState = shortState;
                    //pdpKeyOutGrantsToSave.ShortZip = shortZip;
                    if (shortMedia != null && shortMedia.Length > 0)
                        pdpKeyOutGrantsToSave.ShortMedia = Convert.ToInt32(shortMedia);
                    if (shortClient != null && shortClient.Length > 0)
                        pdpKeyOutGrantsToSave.ShortClient = Convert.ToInt32(shortClient);
                    if (shortDevel != null && shortDevel.Length > 0)
                        pdpKeyOutGrantsToSave.ShortDevel = Convert.ToInt32(shortDevel);
                    if (shortIncorp != null && shortIncorp.Length > 0)
                        pdpKeyOutGrantsToSave.ShortIncorp = Convert.ToInt32(shortIncorp);
                    if (shortProgram != null && shortProgram.Length > 0)
                        pdpKeyOutGrantsToSave.ShortProgram = Convert.ToInt32(shortProgram);
                    if (shortConsult != null && shortConsult.Length > 0)
                        pdpKeyOutGrantsToSave.ShortConsult = Convert.ToInt32(shortConsult);
                    if (shortFarmers != null && shortFarmers.Length > 0)
                        pdpKeyOutGrantsToSave.ShortFarmers = Convert.ToInt32(shortFarmers);
                    pdpKeyOutGrantsToSave.ShortOutOther = shortOutOther;
                    pdpKeyOutGrantsToSave.ShortOutDesc = shortOutDesc;

                    pdpKeyOutGrantsToSave.InterTitle = interTitle;
                    pdpKeyOutGrantsToSave.InterDescription = interDescription;
                    if (interSess != null && interSess.Length > 0)
                        pdpKeyOutGrantsToSave.InterSess = Convert.ToInt32(interSess);
                    if (interSDate == null)
                        pdpKeyOutGrantsToSave.InterStartDate = "";
                    else
                        pdpKeyOutGrantsToSave.InterStartDate = interSDate.Trim();
                    if (interEDate == null)
                        pdpKeyOutGrantsToSave.InterEndDate = "";
                    else
                        pdpKeyOutGrantsToSave.InterEndDate = interEDate.Trim();
                    if (interExt != null && interExt.Length > 0)
                        pdpKeyOutGrantsToSave.InterExt = Convert.ToInt32(interExt);
                    if (interNRCS != null && interNRCS.Length > 0)
                        pdpKeyOutGrantsToSave.InterNRCS = Convert.ToInt32((interNRCS));
                    if (interNGO != null && interNGO.Length > 0)
                        pdpKeyOutGrantsToSave.InterNGO = Convert.ToInt32(interNGO);
                    if (interST != null && interST.Length > 0)
                        pdpKeyOutGrantsToSave.InterST = Convert.ToInt32(interST);
                    if (interProfit != null && interProfit.Length > 0)
                        pdpKeyOutGrantsToSave.InterProfit = Convert.ToInt32(interProfit);
                    if (interFarm != null && interFarm.Length > 0)
                        pdpKeyOutGrantsToSave.InterFarm = Convert.ToInt32(interFarm);
                    pdpKeyOutGrantsToSave.InterAttOther = interAttOther;
                    pdpKeyOutGrantsToSave.InterAttDesc = interAttDesc;
                    //pdpKeyOutGrantsToSave.InterLocation = interLocation;
                    //pdpKeyOutGrantsToSave.InterState = interState;
                    //pdpKeyOutGrantsToSave.InterZip = interZip;
                    if (interMedia != null && interMedia.Length > 0)
                        pdpKeyOutGrantsToSave.InterMedia = Convert.ToInt32(interMedia);
                    if (interClient != null && interClient.Length > 0)
                        pdpKeyOutGrantsToSave.InterClient = Convert.ToInt32(interClient);
                    if (interDevel != null && interDevel.Length > 0)
                        pdpKeyOutGrantsToSave.InterDevel = Convert.ToInt32(interDevel);
                    if (interIncorp != null && interIncorp.Length > 0)
                        pdpKeyOutGrantsToSave.InterIncorp = Convert.ToInt32(interIncorp);
                    if (interProgram != null && interProgram.Length > 0)
                        pdpKeyOutGrantsToSave.InterProgram = Convert.ToInt32(interProgram);
                    if (interConsult != null && interConsult.Length > 0)
                        pdpKeyOutGrantsToSave.InterConsult = Convert.ToInt32(interConsult);
                    if (interFarmers != null && interFarmers.Length > 0)
                        pdpKeyOutGrantsToSave.InterFarmers = Convert.ToInt32(interFarmers);
                    pdpKeyOutGrantsToSave.InterOutOther = interOutOther;
                    pdpKeyOutGrantsToSave.InterOutDesc = interOutDesc;
                    /*
                    if (multiSess != null && multiSess.Length > 0)
                        pdpKeyOutGrantsToSave.MultiSess = Convert.ToInt32(multiSess);
                    if (multiSDate == null)
                        pdpKeyOutGrantsToSave.MultiStartDate = "";
                    else
                        pdpKeyOutGrantsToSave.MultiStartDate = multiSDate.Trim();
                    if (multiEDate == null)
                        pdpKeyOutGrantsToSave.MultiEndDate = "";
                    else
                        pdpKeyOutGrantsToSave.MultiEndDate = multiEDate.Trim();
                    if (multiExt != null && multiExt.Length > 0)
                        pdpKeyOutGrantsToSave.MultiExt = Convert.ToInt32(multiExt);
                    if (multiNRCS != null && multiNRCS.Length > 0)
                        pdpKeyOutGrantsToSave.MultiNRCS = Convert.ToInt32((multiNRCS));
                    if (multiNGO != null && multiNGO.Length > 0)
                        pdpKeyOutGrantsToSave.MultiNGO = Convert.ToInt32(multiNGO);
                    if (multiST != null && multiST.Length > 0)
                        pdpKeyOutGrantsToSave.MultiST = Convert.ToInt32(multiST);
                    if (multiProfit != null && multiProfit.Length > 0)
                        pdpKeyOutGrantsToSave.MultiProfit = Convert.ToInt32(multiProfit);
                    if (multiFarm != null && multiFarm.Length > 0)
                        pdpKeyOutGrantsToSave.MultiFarm = Convert.ToInt32(multiFarm);
                    pdpKeyOutGrantsToSave.MultiAttOther = multiAttOther;
                    pdpKeyOutGrantsToSave.MultiAttDesc = multiAttDesc;
                    pdpKeyOutGrantsToSave.MultiLocation = multiLocation;
                    pdpKeyOutGrantsToSave.MultiState = multiState;
                    pdpKeyOutGrantsToSave.MultiZip = multiZip;
                    if (multiMedia != null && multiMedia.Length > 0)
                        pdpKeyOutGrantsToSave.MultiMedia = Convert.ToInt32(multiMedia);
                    if (multiClient != null && multiClient.Length > 0)
                        pdpKeyOutGrantsToSave.MultiClient = Convert.ToInt32(multiClient);
                    if (multiDevel != null && multiDevel.Length > 0)
                        pdpKeyOutGrantsToSave.MultiDevel = Convert.ToInt32(multiDevel);
                    if (multiIncorp != null && multiIncorp.Length > 0)
                        pdpKeyOutGrantsToSave.MultiIncorp = Convert.ToInt32(multiIncorp);
                    if (multiProgram != null && multiProgram.Length > 0)
                        pdpKeyOutGrantsToSave.MultiProgram = Convert.ToInt32(multiProgram);
                    if (multiConsult != null && multiConsult.Length > 0)
                        pdpKeyOutGrantsToSave.MultiConsult = Convert.ToInt32(multiConsult);
                    if (multiFarmers != null && multiFarmers.Length > 0)
                        pdpKeyOutGrantsToSave.MultiFarmers = Convert.ToInt32(multiFarmers);
                    pdpKeyOutGrantsToSave.MultiOutOther = multiOutOther;
                    pdpKeyOutGrantsToSave.MultiOutDesc = multiOutDesc;

                    if (studySess != null && studySess.Length > 0)
                        pdpKeyOutGrantsToSave.StudySess = Convert.ToInt32(studySess);
                    if (studySDate == null)
                        pdpKeyOutGrantsToSave.StudyStartDate = "";
                    else
                        pdpKeyOutGrantsToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutGrantsToSave.StudyEndDate = "";
                    else
                        pdpKeyOutGrantsToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutGrantsToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutGrantsToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutGrantsToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutGrantsToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutGrantsToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutGrantsToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutGrantsToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutGrantsToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutGrantsToSave.StudyLocation = studyLocation;
                    pdpKeyOutGrantsToSave.StudyState = studyState;
                    pdpKeyOutGrantsToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutGrantsToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutGrantsToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutGrantsToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutGrantsToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutGrantsToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutGrantsToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutGrantsToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutGrantsToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutGrantsToSave.StudyOutDesc = studyOutDesc;

                    pdpKeyOutGrantsToSave.ShortTitle = shortTitle;
                    pdpKeyOutGrantsToSave.ShortDescription = shortDescription;
                    pdpKeyOutGrantsToSave.InterTitle = interTitle;
                    pdpKeyOutGrantsToSave.InterDescription = interDescription;
                    pdpKeyOutGrantsToSave.MultiTitle = multiTitle;
                    pdpKeyOutGrantsToSave.MultiDescription = multiDescription;
                    pdpKeyOutGrantsToSave.StudyTitle = studyTitle;
                    pdpKeyOutGrantsToSave.StudyDescription = studyDescription;
                    */
                    int pdp_key_grant_id = pdpKeyOutGrantsToSave.SaveNewPDPKeyOutGrantsToDB();

                    if (pdp_key_grant_id > 0)
                    {
                        Session["statusMessage2"] = "PDP Key Outcome & Activities Curricula data has been saved successfully.";
                        if (initNum == 0)
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                        else
                            Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    }
                }

                if (Request.Form["cmdPdpKeyOutGrantsUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    int initNum = 0;
                    int sessNum = 0;

                    if (Request.Params.Get("initNum") != null)
                        initNum = int.Parse(Request.Params.Get("initNum"));

                    if (Request.Params.Get("sessNum") != null)
                        sessNum = int.Parse(Request.Params.Get("sessNum"));

                    //string shortSess = Request.Form["demoSession"];
                    string shortTitle = Request.Form["demoTitle"];
                    string shortDescription = Request.Form["demoDescription"];
                    string shortSDate = Request.Form["DemoSDate"];
                    string shortEDate = Request.Form["DemoEDate"];
                    string shortExt = Request.Form["demoExt"];
                    string shortNRCS = Request.Form["demoNRCS"];
                    string shortNGO = Request.Form["demoNGO"];
                    string shortST = Request.Form["demoST"];
                    string shortProfit = Request.Form["demoPro"];
                    string shortFarm = Request.Form["demoFarm"];
                    string shortAttOther = Request.Form["demoAttOther"];
                    string shortAttDesc = Request.Form["demoAttDesc"];
                    //string shortLocation = Request.Form["demoLoc"];
                    //string shortState = Request.Form["demoState"];
                    //string shortZip = Request.Form["demoZip"];
                    string shortMedia = Request.Form["demoMedia"];
                    string shortClient = Request.Form["demoClient"];
                    string shortDevel = Request.Form["demoDevel"];
                    string shortIncorp = Request.Form["demoIncorp"];
                    string shortProgram = Request.Form["demoProg"];
                    string shortConsult = Request.Form["demoConsult"];
                    string shortFarmers = Request.Form["demoFarmers"];
                    string shortOutOther = Request.Form["demoOutOther"];
                    string shortOutDesc = Request.Form["demoOutDesc"];

                    string interSess = Request.Form["workSession"];
                    string interDescription = Request.Form["workDescription"];
                    string interTitle = Request.Form["workTitle"];
                    string interSDate = Request.Form["WorkSDate"];
                    string interEDate = Request.Form["WorkEDate"];
                    string interExt = Request.Form["workExt"];
                    string interNRCS = Request.Form["workNRCS"];
                    string interNGO = Request.Form["workNGO"];
                    string interST = Request.Form["workST"];
                    string interProfit = Request.Form["workPro"];
                    string interFarm = Request.Form["workFarm"];
                    string interAttOther = Request.Form["workAttOther"];
                    string interAttDesc = Request.Form["workAttDesc"];
                    //string interLocation = Request.Form["workLoc"];
                    //string interState = Request.Form["workState"];
                    //string interZip = Request.Form["workZip"];
                    string interMedia = Request.Form["workMedia"];
                    string interClient = Request.Form["workClient"];
                    string interDevel = Request.Form["workDevel"];
                    string interIncorp = Request.Form["workIncorp"];
                    string interProgram = Request.Form["workProg"];
                    string interConsult = Request.Form["workConsult"];
                    string interFarmers = Request.Form["workFarmers"];
                    string interOutOther = Request.Form["workOutOther"];
                    string interOutDesc = Request.Form["workOutDesc"];
                    /*
                    string multiSess = Request.Form["tourSession"];
                    string multiSDate = Request.Form["TourSDate"];
                    string multiEDate = Request.Form["TourEDate"];
                    string multiExt = Request.Form["tourExt"];
                    string multiNRCS = Request.Form["tourNRCS"];
                    string multiNGO = Request.Form["tourNGO"];
                    string multiST = Request.Form["tourST"];
                    string multiProfit = Request.Form["tourPro"];
                    string multiFarm = Request.Form["tourFarm"];
                    string multiAttOther = Request.Form["tourAttOther"];
                    string multiAttDesc = Request.Form["tourAttDesc"];
                    string multiLocation = Request.Form["tourLoc"];
                    string multiState = Request.Form["tourState"];
                    string multiZip = Request.Form["tourZip"];
                    string multiMedia = Request.Form["tourMedia"];
                    string multiClient = Request.Form["tourClient"];
                    string multiDevel = Request.Form["tourDevel"];
                    string multiIncorp = Request.Form["tourIncorp"];
                    string multiProgram = Request.Form["tourProg"];
                    string multiConsult = Request.Form["tourConsult"];
                    string multiFarmers = Request.Form["tourFarmers"];
                    string multiOutOther = Request.Form["tourOutOther"];
                    string multiOutDesc = Request.Form["tourOutDesc"];


                    string studySess = Request.Form["curSession"];
                    string studySDate = Request.Form["CurSDate"];
                    string studyEDate = Request.Form["CurEDate"];
                    string studyExt = Request.Form["curExt"];
                    string studyNRCS = Request.Form["curNRCS"];
                    string studyNGO = Request.Form["curNGO"];
                    string studyST = Request.Form["curST"];
                    string studyProfit = Request.Form["curPro"];
                    string studyFarm = Request.Form["curFarm"];
                    string studyAttOther = Request.Form["curAttOther"];
                    string studyAttDesc = Request.Form["curAttDesc"];
                    string studyLocation = Request.Form["curLoc"];
                    string studyState = Request.Form["curState"];
                    string studyZip = Request.Form["curZip"];
                    string studyMedia = Request.Form["curMedia"];
                    string studyClient = Request.Form["curClient"];
                    string studyDevel = Request.Form["curDevel"];
                    string studyIncorp = Request.Form["curIncorp"];
                    string studyProgram = Request.Form["curProg"];
                    string studyConsult = Request.Form["curConsult"];
                    string studyFarmers = Request.Form["curFarmers"];
                    string studyOutOther = Request.Form["curOutOther"];
                    string studyOutDesc = Request.Form["curOutDesc"];

                    string shortTitle = Request.Form["demoTitle"];
                    string shortDescription = Request.Form["demoDescription"];
                    string interTitle = Request.Form["workTitle"];
                    string interDescription = Request.Form["workDescription"];
                    string multiTitle = Request.Form["tourTitle"];
                    string multiDescription = Request.Form["tourDescription"];
                    string studyTitle = Request.Form["curTitle"];
                    string studyDescription = Request.Form["curDescription"];
                    */
                    daikonPDP.PDPKeyOut pdpKeyOutGrantsToSave;
                    pdpKeyOutGrantsToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutGrantsToSave.ProjectNum = projNum;
                    pdpKeyOutGrantsToSave.InitiativeNum = initNum;

                    //if (shortSess != null && shortSess.Length > 0)
                    pdpKeyOutGrantsToSave.ShortSess = sessNum;
                    pdpKeyOutGrantsToSave.ShortTitle = shortTitle;
                    pdpKeyOutGrantsToSave.ShortDescription = shortDescription;
                    if (shortSDate == null)
                        pdpKeyOutGrantsToSave.ShortStartDate = "";
                    else
                        pdpKeyOutGrantsToSave.ShortStartDate = shortSDate.Trim();
                    if (shortEDate == null)
                        pdpKeyOutGrantsToSave.ShortEndDate = "";
                    else
                        pdpKeyOutGrantsToSave.ShortEndDate = shortEDate.Trim();
                    if (shortExt != null && shortExt.Length > 0)
                        pdpKeyOutGrantsToSave.ShortExt = Convert.ToInt32(shortExt);
                    if (shortNRCS != null && shortNRCS.Length > 0)
                        pdpKeyOutGrantsToSave.ShortNRCS = Convert.ToInt32((shortNRCS));
                    if (shortNGO != null && shortNGO.Length > 0)
                        pdpKeyOutGrantsToSave.ShortNGO = Convert.ToInt32(shortNGO);
                    if (shortST != null && shortST.Length > 0)
                        pdpKeyOutGrantsToSave.ShortST = Convert.ToInt32(shortST);
                    if (shortProfit != null && shortProfit.Length > 0)
                        pdpKeyOutGrantsToSave.ShortProfit = Convert.ToInt32(shortProfit);
                    if (shortFarm != null && shortFarm.Length > 0)
                        pdpKeyOutGrantsToSave.ShortFarm = Convert.ToInt32(shortFarm);
                    pdpKeyOutGrantsToSave.ShortAttOther = shortAttOther;
                    pdpKeyOutGrantsToSave.ShortAttDesc = shortAttDesc;
                    //pdpKeyOutGrantsToSave.ShortLocation = shortLocation;
                    //pdpKeyOutGrantsToSave.ShortState = shortState;
                    //pdpKeyOutGrantsToSave.ShortZip = shortZip;
                    if (shortMedia != null && shortMedia.Length > 0)
                        pdpKeyOutGrantsToSave.ShortMedia = Convert.ToInt32(shortMedia);
                    if (shortClient != null && shortClient.Length > 0)
                        pdpKeyOutGrantsToSave.ShortClient = Convert.ToInt32(shortClient);
                    if (shortDevel != null && shortDevel.Length > 0)
                        pdpKeyOutGrantsToSave.ShortDevel = Convert.ToInt32(shortDevel);
                    if (shortIncorp != null && shortIncorp.Length > 0)
                        pdpKeyOutGrantsToSave.ShortIncorp = Convert.ToInt32(shortIncorp);
                    if (shortProgram != null && shortProgram.Length > 0)
                        pdpKeyOutGrantsToSave.ShortProgram = Convert.ToInt32(shortProgram);
                    if (shortConsult != null && shortConsult.Length > 0)
                        pdpKeyOutGrantsToSave.ShortConsult = Convert.ToInt32(shortConsult);
                    if (shortFarmers != null && shortFarmers.Length > 0)
                        pdpKeyOutGrantsToSave.ShortFarmers = Convert.ToInt32(shortFarmers);
                    pdpKeyOutGrantsToSave.ShortOutOther = shortOutOther;
                    pdpKeyOutGrantsToSave.ShortOutDesc = shortOutDesc;

                    pdpKeyOutGrantsToSave.InterTitle = interTitle;
                    pdpKeyOutGrantsToSave.InterDescription = interDescription;
                    if (interSess != null && interSess.Length > 0)
                        pdpKeyOutGrantsToSave.InterSess = Convert.ToInt32(interSess);
                    if (interSDate == null)
                        pdpKeyOutGrantsToSave.InterStartDate = "";
                    else
                        pdpKeyOutGrantsToSave.InterStartDate = interSDate.Trim();
                    if (interEDate == null)
                        pdpKeyOutGrantsToSave.InterEndDate = "";
                    else
                        pdpKeyOutGrantsToSave.InterEndDate = interEDate.Trim();
                    if (interExt != null && interExt.Length > 0)
                        pdpKeyOutGrantsToSave.InterExt = Convert.ToInt32(interExt);
                    if (interNRCS != null && interNRCS.Length > 0)
                        pdpKeyOutGrantsToSave.InterNRCS = Convert.ToInt32((interNRCS));
                    if (interNGO != null && interNGO.Length > 0)
                        pdpKeyOutGrantsToSave.InterNGO = Convert.ToInt32(interNGO);
                    if (interST != null && interST.Length > 0)
                        pdpKeyOutGrantsToSave.InterST = Convert.ToInt32(interST);
                    if (interProfit != null && interProfit.Length > 0)
                        pdpKeyOutGrantsToSave.InterProfit = Convert.ToInt32(interProfit);
                    if (interFarm != null && interFarm.Length > 0)
                        pdpKeyOutGrantsToSave.InterFarm = Convert.ToInt32(interFarm);
                    pdpKeyOutGrantsToSave.InterAttOther = interAttOther;
                    pdpKeyOutGrantsToSave.InterAttDesc = interAttDesc;
                    //pdpKeyOutGrantsToSave.InterLocation = interLocation;
                    //pdpKeyOutGrantsToSave.InterState = interState;
                    //pdpKeyOutGrantsToSave.InterZip = interZip;
                    if (interMedia != null && interMedia.Length > 0)
                        pdpKeyOutGrantsToSave.InterMedia = Convert.ToInt32(interMedia);
                    if (interClient != null && interClient.Length > 0)
                        pdpKeyOutGrantsToSave.InterClient = Convert.ToInt32(interClient);
                    if (interDevel != null && interDevel.Length > 0)
                        pdpKeyOutGrantsToSave.InterDevel = Convert.ToInt32(interDevel);
                    if (interIncorp != null && interIncorp.Length > 0)
                        pdpKeyOutGrantsToSave.InterIncorp = Convert.ToInt32(interIncorp);
                    if (interProgram != null && interProgram.Length > 0)
                        pdpKeyOutGrantsToSave.InterProgram = Convert.ToInt32(interProgram);
                    if (interConsult != null && interConsult.Length > 0)
                        pdpKeyOutGrantsToSave.InterConsult = Convert.ToInt32(interConsult);
                    if (interFarmers != null && interFarmers.Length > 0)
                        pdpKeyOutGrantsToSave.InterFarmers = Convert.ToInt32(interFarmers);
                    pdpKeyOutGrantsToSave.InterOutOther = interOutOther;
                    pdpKeyOutGrantsToSave.InterOutDesc = interOutDesc;
                    
                    /*
                    if (multiSess != null && multiSess.Length > 0)
                        pdpKeyOutGrantsToSave.MultiSess = Convert.ToInt32(multiSess);
                    if (multiSDate == null)
                        pdpKeyOutGrantsToSave.MultiStartDate = "";
                    else
                        pdpKeyOutGrantsToSave.MultiStartDate = multiSDate.Trim();
                    if (multiEDate == null)
                        pdpKeyOutGrantsToSave.MultiEndDate = "";
                    else
                        pdpKeyOutGrantsToSave.MultiEndDate = multiEDate.Trim();
                    if (multiExt != null && multiExt.Length > 0)
                        pdpKeyOutGrantsToSave.MultiExt = Convert.ToInt32(multiExt);
                    if (multiNRCS != null && multiNRCS.Length > 0)
                        pdpKeyOutGrantsToSave.MultiNRCS = Convert.ToInt32((multiNRCS));
                    if (multiNGO != null && multiNGO.Length > 0)
                        pdpKeyOutGrantsToSave.MultiNGO = Convert.ToInt32(multiNGO);
                    if (multiST != null && multiST.Length > 0)
                        pdpKeyOutGrantsToSave.MultiST = Convert.ToInt32(multiST);
                    if (multiProfit != null && multiProfit.Length > 0)
                        pdpKeyOutGrantsToSave.MultiProfit = Convert.ToInt32(multiProfit);
                    if (multiFarm != null && multiFarm.Length > 0)
                        pdpKeyOutGrantsToSave.MultiFarm = Convert.ToInt32(multiFarm);
                    pdpKeyOutGrantsToSave.MultiAttOther = multiAttOther;
                    pdpKeyOutGrantsToSave.MultiAttDesc = multiAttDesc;
                    pdpKeyOutGrantsToSave.MultiLocation = multiLocation;
                    pdpKeyOutGrantsToSave.MultiState = multiState;
                    pdpKeyOutGrantsToSave.MultiZip = multiZip;
                    if (multiMedia != null && multiMedia.Length > 0)
                        pdpKeyOutGrantsToSave.MultiMedia = Convert.ToInt32(multiMedia);
                    if (multiClient != null && multiClient.Length > 0)
                        pdpKeyOutGrantsToSave.MultiClient = Convert.ToInt32(multiClient);
                    if (multiDevel != null && multiDevel.Length > 0)
                        pdpKeyOutGrantsToSave.MultiDevel = Convert.ToInt32(multiDevel);
                    if (multiIncorp != null && multiIncorp.Length > 0)
                        pdpKeyOutGrantsToSave.MultiIncorp = Convert.ToInt32(multiIncorp);
                    if (multiProgram != null && multiProgram.Length > 0)
                        pdpKeyOutGrantsToSave.MultiProgram = Convert.ToInt32(multiProgram);
                    if (multiConsult != null && multiConsult.Length > 0)
                        pdpKeyOutGrantsToSave.MultiConsult = Convert.ToInt32(multiConsult);
                    if (multiFarmers != null && multiFarmers.Length > 0)
                        pdpKeyOutGrantsToSave.MultiFarmers = Convert.ToInt32(multiFarmers);
                    pdpKeyOutGrantsToSave.MultiOutOther = multiOutOther;
                    pdpKeyOutGrantsToSave.MultiOutDesc = multiOutDesc;

                    if (studySess != null && studySess.Length > 0)
                        pdpKeyOutGrantsToSave.StudySess = Convert.ToInt32(studySess);
                    if (studySDate == null)
                        pdpKeyOutGrantsToSave.StudyStartDate = "";
                    else
                        pdpKeyOutGrantsToSave.StudyStartDate = studySDate.Trim();
                    if (studyEDate == null)
                        pdpKeyOutGrantsToSave.StudyEndDate = "";
                    else
                        pdpKeyOutGrantsToSave.StudyEndDate = studyEDate.Trim();
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutGrantsToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutGrantsToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutGrantsToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutGrantsToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutGrantsToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutGrantsToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutGrantsToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutGrantsToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutGrantsToSave.StudyLocation = studyLocation;
                    pdpKeyOutGrantsToSave.StudyState = studyState;
                    pdpKeyOutGrantsToSave.StudyZip = studyZip;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutGrantsToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutGrantsToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutGrantsToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutGrantsToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutGrantsToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutGrantsToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutGrantsToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutGrantsToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutGrantsToSave.StudyOutDesc = studyOutDesc;

                    pdpKeyOutGrantsToSave.ShortTitle = shortTitle;
                    pdpKeyOutGrantsToSave.ShortDescription = shortDescription;
                    pdpKeyOutGrantsToSave.InterTitle = interTitle;
                    pdpKeyOutGrantsToSave.InterDescription = interDescription;
                    pdpKeyOutGrantsToSave.MultiTitle = multiTitle;
                    pdpKeyOutGrantsToSave.MultiDescription = multiDescription;
                    pdpKeyOutGrantsToSave.StudyTitle = studyTitle;
                    pdpKeyOutGrantsToSave.StudyDescription = studyDescription; 
                    */
                    pdpKeyOutGrantsToSave.UpdatePDPKeyOutGrantsToDB();

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Curricula data has been updated successfully.";
                    if (initNum == 0)
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum + "&initNum=" + initNum.ToString());
                    
                    
                }

                if (Request.Form["btnUpdatePDPBasics"] != null)
                {
                     projectSubmissionHandler(sender, e);

                    string projNum = Request.Params.Get("pn");
                    string piFName = "";//Request.Form["coordFirst"];
                    string piLName = "";//Request.Form["coordLast"];
                    string piEthinicity = Request.Form["ethinicity"];
                    string piInstName = Request.Form["instituteName"];
                    string piEthinicity2 = Request.Form["ethinicity2"];
                    string piInstName2 = Request.Form["instituteName2"];
                    string piEthinicity3 = Request.Form["ethinicity3"];
                    string piInstName3 = Request.Form["instituteName3"];
                    string piAdd = "";//Request.Form["strAddress"];
                    string piCity = "";//Request.Form["strCity"];
                    string piState = "";//Request.Form["addrState"];
                    string piZip = "";//Request.Form["strZip"];
                    string piPhone = "";//Request.Form["strPhone"];
                    string piFax = "";//Request.Form["strFax"];
                    string piEmail = "";//Request.Form["strEmail"];
                    string piStatePro = Request.Form["strStatePro"];
                    string advName = Request.Form["AdvName"];
                    string advLName = Request.Form["AdvLName"];
                    string advType = Request.Form["AdvType"];
                    string advLocationState = Request.Form["AdvLocationState"];
                    string advLocationZip = Request.Form["AdvLocationZip"];
                    string advAff = Request.Form["AdvAff"];
                    string advDate = Request.Form["AdvDate"];
                    string advLoc = Request.Form["AdvLocation"];
                    string advName1 = Request.Form["AdvName1"];
                    string advLName1 = Request.Form["AdvLName1"];
                    string advType1 = Request.Form["AdvType1"];
                    string advLocationState1 = Request.Form["AdvLocationState1"];
                    string advLocationZip1 = Request.Form["AdvLocationZip1"];
                    string advAff1 = Request.Form["AdvAff1"];
                    string advDate1 = Request.Form["AdvDate1"];
                    string advLoc1 = Request.Form["AdvLocation1"];
                    string advName2 = Request.Form["AdvName2"];
                    string advLName2 = Request.Form["AdvLName2"];
                    string advType2 = Request.Form["AdvType2"];
                    string advLocationState2 = Request.Form["AdvLocationState2"];
                    string advLocationZip2 = Request.Form["AdvLocationZip2"];
                    string advAff2 = Request.Form["AdvAff2"];
                    string advDate2 = Request.Form["AdvDate2"];
                    string advLoc2 = Request.Form["AdvLocation2"];
                    string advName3 = Request.Form["AdvName3"];
                    string advLName3 = Request.Form["AdvLName3"];
                    string advType3 = Request.Form["AdvType3"];
                    string advLocationState3 = Request.Form["AdvLocationState3"];
                    string advLocationZip3 = Request.Form["AdvLocationZip3"];
                    string advAff3 = Request.Form["AdvAff3"];
                    string advDate3 = Request.Form["AdvDate3"];
                    string advLoc3 = Request.Form["AdvLocation3"];
                    string advName4 = Request.Form["AdvName4"];
                    string advLName4 = Request.Form["AdvLName4"];
                    string advType4 = Request.Form["AdvType4"];
                    string advLocationState4 = Request.Form["AdvLocationState4"];
                    string advLocationZip4 = Request.Form["AdvLocationZip4"];
                    string advAff4 = Request.Form["AdvAff4"];
                    string advDate4 = Request.Form["AdvDate4"];
                    string advLoc4 = Request.Form["AdvLocation4"];
                    string advName5 = Request.Form["AdvName5"];
                    string advLName5 = Request.Form["AdvLName5"];
                    string advType5 = Request.Form["AdvType5"];
                    string advLocationState5 = Request.Form["AdvLocationState5"];
                    string advLocationZip5 = Request.Form["AdvLocationZip5"];
                    string advAff5 = Request.Form["AdvAff5"];
                    string advDate5 = Request.Form["AdvDate5"];
                    string advLoc5 = Request.Form["AdvLocation5"];
                    string advName6 = Request.Form["AdvName6"];
                    string advLName6 = Request.Form["AdvLName6"];
                    string advType6 = Request.Form["AdvType6"];
                    string advLocationState6 = Request.Form["AdvLocationState6"];
                    string advLocationZip6 = Request.Form["AdvLocationZip6"];
                    string advAff6 = Request.Form["AdvAff6"];
                    string advDate6 = Request.Form["AdvDate6"];
                    string advLoc6 = Request.Form["AdvLocation6"];
                    string advName7 = Request.Form["AdvName7"];
                    string advLName7 = Request.Form["AdvLName7"];
                    string advAff7 = Request.Form["AdvAff7"];
                    string advName8 = Request.Form["AdvName8"];
                    string advLName8 = Request.Form["AdvLName8"];
                    string advAff8 = Request.Form["AdvAff8"];
                    string advName9 = Request.Form["AdvName9"];
                    string advLName9 = Request.Form["AdvLName9"];
                    string advAff9 = Request.Form["AdvAff9"];
                    string advName10 = Request.Form["AdvName10"];
                    string advLName10 = Request.Form["AdvLName10"];
                    string advAff10 = Request.Form["AdvAff10"];
                    string advName11 = Request.Form["AdvName11"];
                    string advLName11 = Request.Form["AdvLName11"];
                    string advAff11 = Request.Form["AdvAff11"];
                    string advName12 = Request.Form["AdvName12"];
                    string advLName12 = Request.Form["AdvLName12"];
                    string advAff12 = Request.Form["AdvAff12"];
                    string advName13 = Request.Form["AdvName13"];
                    string advLName13 = Request.Form["AdvLName13"];
                    string advAff13 = Request.Form["AdvAff13"];
                    string advName14 = Request.Form["AdvName14"];
                    string advLName14 = Request.Form["AdvLName14"];
                    string advAff14 = Request.Form["AdvAff14"];
                    string advName15 = Request.Form["AdvName15"];
                    string advLName15 = Request.Form["AdvLName15"];
                    string advAff15 = Request.Form["AdvAff15"]; 
                    string sareOutreach = Request.Form["initOut"]; 
                    int piInstType = 0;
                    int piRace = 0;
                    int piInstType2 = 0;
                    int piRace2 = 0;
                    int piInstType3 = 0;
                    int piRace3 = 0;

                    /*
                    bool american = (bool)(Request.Form["american"] == "on");
                    bool asian = (bool)(Request.Form["asian"] == "on");
                    bool black = (bool)(Request.Form["black"] == "on");
                    bool hawaiian = (bool)(Request.Form["hawaiian"] == "on");
                    bool hispanic = (bool)(Request.Form["hispanic"] == "on");
                    bool nothispanic = (bool)(Request.Form["nothispanic"] == "on");
                    bool white = (bool)(Request.Form["white"] == "on");
                    */

                    bool grant1862 = (bool)(Request.Form["Grant1862"] == "on");
                    bool grant1890 = (bool)(Request.Form["Grant1890"] == "on");

                    bool grant1862_2 = (bool)(Request.Form["Grant1862_2"] == "on");
                    bool grant1890_2 = (bool)(Request.Form["Grant1890_2"] == "on");

                    bool grant1862_3 = (bool)(Request.Form["Grant1862_3"] == "on");
                    bool grant1890_3 = (bool)(Request.Form["Grant1890_3"] == "on");

                    if (Request.Form["race"] == "american")
                        piRace = 1;
                    if (Request.Form["race"] == "asian")
                        piRace = 2;
                    if (Request.Form["race"] == "black")
                        piRace = 3;
                    if (Request.Form["race"] == "hawaiian")
                        piRace = 4;
                    if (Request.Form["race"] == "hispanic")
                        piRace = 5;
                    if (Request.Form["race"] == "nothispanic")
                        piRace = 6;
                    if (Request.Form["race"] == "white")
                        piRace = 7;

                    if (grant1862 == true)
                        piInstType = 1862;
                    if (grant1890 == true)
                        piInstType = 1890;

                    if (Request.Form["race2"] == "american")
                        piRace2 = 1;
                    if (Request.Form["race2"] == "asian")
                        piRace2 = 2;
                    if (Request.Form["race2"] == "black")
                        piRace2 = 3;
                    if (Request.Form["race2"] == "hawaiian")
                        piRace2 = 4;
                    if (Request.Form["race2"] == "hispanic")
                        piRace2 = 5;
                    if (Request.Form["race2"] == "nothispanic")
                        piRace2 = 6;
                    if (Request.Form["race2"] == "white")
                        piRace2 = 7;

                    if (grant1862_2 == true)
                        piInstType2 = 1862;
                    if (grant1890_2 == true)
                        piInstType2 = 1890;

                    if (Request.Form["race3"] == "american")
                        piRace3 = 1;
                    if (Request.Form["race3"] == "asian")
                        piRace3 = 2;
                    if (Request.Form["race3"] == "black")
                        piRace3 = 3;
                    if (Request.Form["race3"] == "hawaiian")
                        piRace3 = 4;
                    if (Request.Form["race3"] == "hispanic")
                        piRace3 = 5;
                    if (Request.Form["race3"] == "nothispanic")
                        piRace3 = 6;
                    if (Request.Form["race3"] == "white")
                        piRace3 = 7;

                    if (grant1862_3 == true)
                        piInstType3 = 1862;
                    if (grant1890_3 == true)
                        piInstType3 = 1890;
                   

                    daikonPDP.PDPContents pdpInfoToSave;
                    pdpInfoToSave = new daikonPDP.PDPContents();

                    pdpInfoToSave.ProjectNum = projNum;
                    pdpInfoToSave.PiFirstName = piFName;
                    pdpInfoToSave.PiLasttName = piLName;
                    if (piEthinicity == null)
                        pdpInfoToSave.PiEthinicity = "";
                    else
                        pdpInfoToSave.PiEthinicity = piEthinicity;
                    pdpInfoToSave.PiRace = piRace;
                    if (piInstName == null)
                        pdpInfoToSave.PiInstituteName = "";
                    else
                        pdpInfoToSave.PiInstituteName = piInstName;
                    pdpInfoToSave.PiInstituteType = piInstType;
                    if (piEthinicity2 == null)
                        pdpInfoToSave.PiEthinicity2 = "";
                    else
                        pdpInfoToSave.PiEthinicity2 = piEthinicity2;
                    pdpInfoToSave.PiRace2 = piRace2;
                    if (piInstName2 == null)
                        pdpInfoToSave.PiInstituteName2 = "";
                    else
                        pdpInfoToSave.PiInstituteName2 = piInstName2;
                    pdpInfoToSave.PiInstituteType2 = piInstType2;
                    if (piEthinicity3 == null)
                        pdpInfoToSave.PiEthinicity3 = "";
                    else
                        pdpInfoToSave.PiEthinicity3 = piEthinicity3;
                    pdpInfoToSave.PiRace3 = piRace3;
                    if (piInstName3 == null)
                        pdpInfoToSave.PiInstituteName3 = "";
                    else
                        pdpInfoToSave.PiInstituteName3 = piInstName3;
                    pdpInfoToSave.PiInstituteType3 = piInstType3;
                    pdpInfoToSave.PiAddress = piAdd;
                    pdpInfoToSave.PiCity = piCity;
                    pdpInfoToSave.PiState = piState;
                    pdpInfoToSave.PiZip = piZip;
                    pdpInfoToSave.PiPhone = piPhone;
                    pdpInfoToSave.PiFax = piFax;
                    pdpInfoToSave.PiEmail = piEmail;
                    pdpInfoToSave.PiStatePro = piStatePro;
                    pdpInfoToSave.AdvisoryName = advName;
                    pdpInfoToSave.AdvisoryLName = advLName;
                    pdpInfoToSave.AdvisoryType = advType;
                    pdpInfoToSave.AdvisoryState = advLocationState;
                    pdpInfoToSave.AdvisoryZip = advLocationZip;
                    pdpInfoToSave.AdvisoryAff = advAff;
                    pdpInfoToSave.AdvisoryDate = advDate.Trim();
                    pdpInfoToSave.AdvisoryLocation = advLoc;
                    pdpInfoToSave.AdvisoryName1 = advName1;
                    pdpInfoToSave.AdvisoryLName1 = advLName1;
                    pdpInfoToSave.AdvisoryType1 = advType1;
                    pdpInfoToSave.AdvisoryState1 = advLocationState1;
                    pdpInfoToSave.AdvisoryZip1 = advLocationZip1;
                    pdpInfoToSave.AdvisoryAff1 = advAff1;
                    if (advDate1 == null)
                        pdpInfoToSave.AdvisoryDate1 = "";
                    else
                        pdpInfoToSave.AdvisoryDate1 = advDate1.Trim();
                    pdpInfoToSave.AdvisoryLocation1 = advLoc1;
                    pdpInfoToSave.AdvisoryName2 = advName2;
                    pdpInfoToSave.AdvisoryLName2 = advLName2;
                    pdpInfoToSave.AdvisoryType2 = advType2;
                    pdpInfoToSave.AdvisoryState2 = advLocationState2;
                    pdpInfoToSave.AdvisoryZip2 = advLocationZip2;
                    pdpInfoToSave.AdvisoryAff2 = advAff2;
                    if (advDate2 == null)
                        pdpInfoToSave.AdvisoryDate2 = "";
                    else
                        pdpInfoToSave.AdvisoryDate2 = advDate2.Trim();
                    pdpInfoToSave.AdvisoryLocation2 = advLoc2;
                    pdpInfoToSave.AdvisoryName3 = advName3;
                    pdpInfoToSave.AdvisoryLName3 = advLName3;
                    pdpInfoToSave.AdvisoryType3 = advType3;
                    pdpInfoToSave.AdvisoryState3 = advLocationState3;
                    pdpInfoToSave.AdvisoryZip3 = advLocationZip3;
                    pdpInfoToSave.AdvisoryAff3 = advAff3;
                    if (advDate3 == null)
                        pdpInfoToSave.AdvisoryDate3 = "";
                    else
                        pdpInfoToSave.AdvisoryDate3 = advDate3.Trim();
                    pdpInfoToSave.AdvisoryLocation3 = advLoc3;
                    pdpInfoToSave.AdvisoryName4 = advName4;
                    pdpInfoToSave.AdvisoryLName4 = advLName4;
                    pdpInfoToSave.AdvisoryType4 = advType4;
                    pdpInfoToSave.AdvisoryState4 = advLocationState4;
                    pdpInfoToSave.AdvisoryZip4 = advLocationZip4;
                    pdpInfoToSave.AdvisoryAff4 = advAff4;
                    if (advDate4 == null)
                        pdpInfoToSave.AdvisoryDate4 = "";
                    else
                     pdpInfoToSave.AdvisoryDate4 = advDate4.Trim();
                    pdpInfoToSave.AdvisoryLocation4 = advLoc4;
                    pdpInfoToSave.AdvisoryName5 = advName5;
                    pdpInfoToSave.AdvisoryLName5 = advLName5;
                    pdpInfoToSave.AdvisoryType5 = advType5;
                    pdpInfoToSave.AdvisoryState5 = advLocationState5;
                    pdpInfoToSave.AdvisoryZip5 = advLocationZip5;
                    pdpInfoToSave.AdvisoryAff5 = advAff5;
                    if (advDate5 == null)
                        pdpInfoToSave.AdvisoryDate5 = "";
                    else
                        pdpInfoToSave.AdvisoryDate5 = advDate5.Trim();
                    pdpInfoToSave.AdvisoryLocation5 = advLoc5;
                    pdpInfoToSave.AdvisoryName6 = advName6;
                    pdpInfoToSave.AdvisoryLName6 = advLName6;
                    pdpInfoToSave.AdvisoryType6 = advType6;
                    pdpInfoToSave.AdvisoryState6 = advLocationState6;
                    pdpInfoToSave.AdvisoryZip6 = advLocationZip6;
                    pdpInfoToSave.AdvisoryAff6 = advAff6;
                    if (advDate6 == null)
                        pdpInfoToSave.AdvisoryDate6 = "";
                    else
                     pdpInfoToSave.AdvisoryDate6 = advDate6.Trim();
                    pdpInfoToSave.AdvisoryLocation6 = advLoc6;
                    pdpInfoToSave.AdvisoryName7 = advName7;
                    pdpInfoToSave.AdvisoryLName7 = advLName7;
                    pdpInfoToSave.AdvisoryAff7 = advAff7;
                    pdpInfoToSave.AdvisoryName8 = advName8;
                    pdpInfoToSave.AdvisoryLName8 = advLName8;
                    pdpInfoToSave.AdvisoryAff8 = advAff8;
                    pdpInfoToSave.AdvisoryName9 = advName9;
                    pdpInfoToSave.AdvisoryLName9 = advLName9;
                    pdpInfoToSave.AdvisoryAff9 = advAff9;
                    pdpInfoToSave.AdvisoryName10 = advName10;
                    pdpInfoToSave.AdvisoryLName10 = advLName10;
                    pdpInfoToSave.AdvisoryAff10 = advAff10;
                    pdpInfoToSave.AdvisoryName11 = advName11;
                    pdpInfoToSave.AdvisoryLName11 = advLName11;
                    pdpInfoToSave.AdvisoryAff11 = advAff11;
                    pdpInfoToSave.AdvisoryName12 = advName12;
                    pdpInfoToSave.AdvisoryLName12 = advLName12;
                    pdpInfoToSave.AdvisoryAff12 = advAff12;
                    pdpInfoToSave.AdvisoryName13 = advName13;
                    pdpInfoToSave.AdvisoryLName13 = advLName13;
                    pdpInfoToSave.AdvisoryAff13 = advAff13;
                    pdpInfoToSave.AdvisoryName14 = advName14;
                    pdpInfoToSave.AdvisoryLName14 = advLName14;
                    pdpInfoToSave.AdvisoryAff14 = advAff14;
                    pdpInfoToSave.AdvisoryName15 = advName15;
                    pdpInfoToSave.AdvisoryLName15 = advLName15;
                    pdpInfoToSave.AdvisoryAff15 = advAff15;
                    pdpInfoToSave.SareOutreach = sareOutreach;

                    pdpInfoToSave.UpdatePDPInfoToDB();

                    Session["statusMessage2"] = "PDP General Information has been updated successfully.";
                    Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projNum);
                    
                }

                if (Request.Form["cmdAddNewInitiative"] != null)
                {

                    string projNum = Request.Params.Get("pn");
                    string piFName = "";//Request.Form["coordFirst"];
                    string piLName = "";//Request.Form["coordLast"];
                    string piEthinicity = Request.Form["ethinicity"];
                    string piInstName = Request.Form["instituteName"];
                    string piAdd = "";//Request.Form["strAddress"];
                    string piCity = "";//Request.Form["strCity"];
                    string piState = "";//Request.Form["addrState"];
                    string piZip = "";//Request.Form["strZip"];
                    string piPhone = "";//Request.Form["strPhone"];
                    string piFax = "";//Request.Form["strFax"];
                    string piEmail = "";//Request.Form["strEmail"];
                    string piStatePro = Request.Form["strStatePro"];
                    string advName = Request.Form["AdvName"];
                    string advAff = Request.Form["AdvAff"];
                    string advDate = Request.Form["AdvDate"];
                    string advLoc = Request.Form["AdvLocation"];
                    string advName1 = Request.Form["AdvName1"];
                    string advAff1 = Request.Form["AdvAff1"];
                    string advDate1 = Request.Form["AdvDate1"];
                    string advLoc1 = Request.Form["AdvLocation1"];
                    string advName2 = Request.Form["AdvName2"];
                    string advAff2 = Request.Form["AdvAff2"];
                    string advDate2 = Request.Form["AdvDate2"];
                    string advLoc2 = Request.Form["AdvLocation2"];
                    string advName3 = Request.Form["AdvName3"];
                    string advAff3 = Request.Form["AdvAff3"];
                    string advDate3 = Request.Form["AdvDate3"];
                    string advLoc3 = Request.Form["AdvLocation3"];
                    string advName4 = Request.Form["AdvName4"];
                    string advAff4 = Request.Form["AdvAff4"];
                    string advDate4 = Request.Form["AdvDate4"];
                    string advLoc4 = Request.Form["AdvLocation4"];
                    string advName5 = Request.Form["AdvName5"];
                    string advAff5 = Request.Form["AdvAff5"];
                    string advDate5 = Request.Form["AdvDate5"];
                    string advLoc5 = Request.Form["AdvLocation5"];
                    string advName6 = Request.Form["AdvName6"];
                    string advAff6 = Request.Form["AdvAff6"];
                    string advDate6 = Request.Form["AdvDate6"];
                    string advLoc6 = Request.Form["AdvLocation6"];
                    string advName7 = Request.Form["AdvName7"];
                    string advLName7 = Request.Form["AdvLName7"];
                    string advAff7 = Request.Form["AdvAff7"];
                    string advName8 = Request.Form["AdvName8"];
                    string advLName8 = Request.Form["AdvLName8"];
                    string advAff8 = Request.Form["AdvAff8"];
                    string advName9 = Request.Form["AdvName9"];
                    string advLName9 = Request.Form["AdvLName9"];
                    string advAff9 = Request.Form["AdvAff9"];
                    string advName10 = Request.Form["AdvName10"];
                    string advLName10 = Request.Form["AdvLName10"];
                    string advAff10 = Request.Form["AdvAff10"];
                    string advName11 = Request.Form["AdvName11"];
                    string advLName11 = Request.Form["AdvLName11"];
                    string advAff11 = Request.Form["AdvAff11"];
                    string advName12 = Request.Form["AdvName12"];
                    string advLName12 = Request.Form["AdvLName12"];
                    string advAff12 = Request.Form["AdvAff12"];
                    string advName13 = Request.Form["AdvName13"];
                    string advLName13 = Request.Form["AdvLName13"];
                    string advAff13 = Request.Form["AdvAff13"];
                    string advName14 = Request.Form["AdvName14"];
                    string advLName14 = Request.Form["AdvLName14"];
                    string advAff14 = Request.Form["AdvAff14"];
                    string advName15 = Request.Form["AdvName15"];
                    string advLName15 = Request.Form["AdvLName15"];
                    string advAff15 = Request.Form["AdvAff15"]; 
                    string sareOutreach = Request.Form["initOut"];
                    //string initCount = Request.Form["InitiativeCount"];

                    int piInstType = 0;
                    int piRace = 0;

                    int initiative_count = 0;

                    if (Request.Params.Get("initNum") != null)
                        initiative_count = int.Parse(Request.Params.Get("initNum"));
                    if (Request.Form["cmdAddNewInitiative"] == "Add Initiative 1")
                        initiative_count = 1;
                    if (Request.Form["cmdAddNewInitiative"] == "Add Initiative 2")
                        initiative_count = 2;
                    if (Request.Form["cmdAddNewInitiative"] == "Add Initiative 3")
                        initiative_count = 3;
                    if (Request.Form["cmdAddNewInitiative"] == "Add Initiative 4")
                        initiative_count = 4;
                    if (Request.Form["cmdAddNewInitiative"] == "Add Initiative 5")
                        initiative_count = 5;
                    if (Request.Form["cmdAddNewInitiative"] == "Add Initiative 6")
                        initiative_count = 6;



                    bool grant1862 = (bool)(Request.Form["Grant1862"] == "on");
                    bool grant1890 = (bool)(Request.Form["Grant1890"] == "on");

                    if (Request.Form["race"] == "american")
                        piRace = 1;
                    if (Request.Form["race"] == "asian")
                        piRace = 2;
                    if (Request.Form["race"] == "black")
                        piRace = 3;
                    if (Request.Form["race"] == "hawaiian")
                        piRace = 4;
                    if (Request.Form["race"] == "hispanic")
                        piRace = 5;
                    if (Request.Form["race"] == "nothispanic")
                        piRace = 6;
                    if (Request.Form["race"] == "white")
                        piRace = 7;

                    if (grant1862 == true)
                        piInstType = 1862;
                    if (grant1890 == true)
                        piInstType = 1890;

                    daikonPDP.PDPContents pdpInfoToSave;
                    pdpInfoToSave = new daikonPDP.PDPContents();

                    pdpInfoToSave.ProjectNum = projNum;
                    pdpInfoToSave.PiFirstName = piFName;
                    pdpInfoToSave.PiLasttName = piLName;
                    pdpInfoToSave.PiEthinicity = piEthinicity;
                    pdpInfoToSave.PiRace = piRace;
                    pdpInfoToSave.PiInstituteName = piInstName;
                    pdpInfoToSave.PiInstituteType = piInstType;
                    pdpInfoToSave.PiAddress = piAdd;
                    pdpInfoToSave.PiCity = piCity;
                    pdpInfoToSave.PiState = piState;
                    pdpInfoToSave.PiZip = piZip;
                    pdpInfoToSave.PiPhone = piPhone;
                    pdpInfoToSave.PiFax = piFax;
                    pdpInfoToSave.PiEmail = piEmail;
                    pdpInfoToSave.PiStatePro = piStatePro;
                    pdpInfoToSave.AdvisoryName = advName;
                    pdpInfoToSave.AdvisoryAff = advAff;
                    pdpInfoToSave.AdvisoryDate = advDate.Trim();
                    pdpInfoToSave.AdvisoryLocation = advLoc;
                    pdpInfoToSave.AdvisoryName1 = advName1;
                    pdpInfoToSave.AdvisoryAff1 = advAff1;
                    pdpInfoToSave.AdvisoryDate1 = advDate1.Trim();
                    pdpInfoToSave.AdvisoryLocation1 = advLoc1;
                    pdpInfoToSave.AdvisoryName2 = advName2;
                    pdpInfoToSave.AdvisoryAff2 = advAff2;
                    pdpInfoToSave.AdvisoryDate2 = advDate2.Trim();
                    pdpInfoToSave.AdvisoryLocation2 = advLoc2;
                    pdpInfoToSave.AdvisoryName3 = advName3;
                    pdpInfoToSave.AdvisoryAff3 = advAff3;
                    pdpInfoToSave.AdvisoryDate3 = advDate3.Trim();
                    pdpInfoToSave.AdvisoryLocation3 = advLoc3;
                    pdpInfoToSave.AdvisoryName4 = advName4;
                    pdpInfoToSave.AdvisoryAff4 = advAff4;
                    pdpInfoToSave.AdvisoryDate4 = advDate4.Trim();
                    pdpInfoToSave.AdvisoryLocation4 = advLoc4;
                    pdpInfoToSave.AdvisoryName5 = advName5;
                    pdpInfoToSave.AdvisoryAff5 = advAff5;
                    pdpInfoToSave.AdvisoryDate5 = advDate5.Trim();
                    pdpInfoToSave.AdvisoryLocation5 = advLoc5;
                    pdpInfoToSave.AdvisoryName6 = advName6;
                    pdpInfoToSave.AdvisoryAff6 = advAff6;
                    pdpInfoToSave.AdvisoryDate6 = advDate6.Trim();
                    pdpInfoToSave.AdvisoryLocation6 = advLoc6;
                    pdpInfoToSave.AdvisoryName8 = advName8;
                    pdpInfoToSave.AdvisoryLName8 = advLName8;
                    pdpInfoToSave.AdvisoryAff8 = advAff8;
                    pdpInfoToSave.AdvisoryName9 = advName9;
                    pdpInfoToSave.AdvisoryLName9 = advLName9;
                    pdpInfoToSave.AdvisoryAff9 = advAff9;
                    pdpInfoToSave.AdvisoryName10 = advName10;
                    pdpInfoToSave.AdvisoryLName10 = advLName10;
                    pdpInfoToSave.AdvisoryAff10 = advAff10;
                    pdpInfoToSave.AdvisoryName11 = advName11;
                    pdpInfoToSave.AdvisoryLName11 = advLName11;
                    pdpInfoToSave.AdvisoryAff11 = advAff11;
                    pdpInfoToSave.AdvisoryName12 = advName12;
                    pdpInfoToSave.AdvisoryLName12 = advLName12;
                    pdpInfoToSave.AdvisoryAff12 = advAff12;
                    pdpInfoToSave.AdvisoryName13 = advName13;
                    pdpInfoToSave.AdvisoryLName13 = advLName13;
                    pdpInfoToSave.AdvisoryAff13 = advAff13;
                    pdpInfoToSave.AdvisoryName14 = advName14;
                    pdpInfoToSave.AdvisoryLName14 = advLName14;
                    pdpInfoToSave.AdvisoryAff14 = advAff14;
                    pdpInfoToSave.AdvisoryName15 = advName15;
                    pdpInfoToSave.AdvisoryLName15 = advLName15;
                    pdpInfoToSave.AdvisoryAff15 = advAff15;
                    pdpInfoToSave.SareOutreach = sareOutreach;
                    pdpInfoToSave.InitiativeCount = initiative_count;

                    pdpInfoToSave.UpdatePDPInfoToDB();

                    Response.Redirect("sare_main.aspx?do=pdpinit&initNum=" + initiative_count.ToString() + "&pn=" + projNum);
                }

                if (Request.Form["cmdPdpInitUpate"] != null)
                {

                    string projNum = Request.Params.Get("pn");
                    string initTopic = Request.Form["initDesc"];
                    string trainingObj = Request.Form["initObj"];
                    /*
                    string partExt = Request.Form["partExt"].ToString();
                    string partNrcs = Request.Form["partNRCS"];
                    string partNgo = Request.Form["partNGO"];
                    string partState = Request.Form["partState"];
                    string partFarmer = Request.Form["partFarmer"];
                    string partOther = Request.Form["partOther"];
                    string trainExt = Request.Form["trainExt"];
                    string trainNrcs = Request.Form["trainNRCS"];
                    string trainNgo = Request.Form["trainNGO"];
                    string trainState = Request.Form["trainState"];
                    string trainFarmer = Request.Form["trainFarmer"];
                    string trainOther = Request.Form["trainOther"];
                    string devExt = Request.Form["devExt"];
                    string devNrcs = Request.Form["devNRCS"];
                    string devNgo = Request.Form["devNGO"];
                    string devState = Request.Form["devState"];
                    string devFarmer = Request.Form["devFarmer"];
                    string devOther = Request.Form["devOther"];
                    string invExt = Request.Form["invExt"];
                    string invNrcs = Request.Form["invNRCS"];
                    string invNgo = Request.Form["invNGO"];
                    string invState = Request.Form["invState"];
                    string invFarmer = Request.Form["invFarmer"];
                    string invOther = Request.Form["invOther"];
                    */
                    string intNum = Request.Params.Get("initNum");

                    daikonPDP.PDPContents pdpInitPartnersToSave;
                    pdpInitPartnersToSave = new daikonPDP.PDPContents();

                    pdpInitPartnersToSave.ProjectNum = projNum;
                    pdpInitPartnersToSave.InitTopic = initTopic;
                    pdpInitPartnersToSave.TrainingObj = trainingObj;

                    if ((bool)(Request.Form["partExtCBox"] == "on"))
                        pdpInitPartnersToSave.PartExt = 1;
                    else
                        pdpInitPartnersToSave.PartExt = 0;
                    if ((bool)(Request.Form["partNrcsCBox"] == "on"))
                        pdpInitPartnersToSave.PartNRCS = 1;
                    else
                        pdpInitPartnersToSave.PartNRCS = 0;
                    if ((bool)(Request.Form["partNGOCBox"] == "on"))
                        pdpInitPartnersToSave.PartNGO = 1;
                    else
                        pdpInitPartnersToSave.PartNGO = 0;
                    if ((bool)(Request.Form["partStateCBox"] == "on"))
                        pdpInitPartnersToSave.PartState = 1;
                    else
                        pdpInitPartnersToSave.PartState = 0;
                    if ((bool)(Request.Form["partFarmerCBox"] == "on"))
                        pdpInitPartnersToSave.PartFarmer = 1;
                    else
                        pdpInitPartnersToSave.PartFarmer = 0;
                    if ((bool)(Request.Form["partOtherCBox"] == "on"))
                        pdpInitPartnersToSave.PartOther = 1;
                    else
                        pdpInitPartnersToSave.PartOther = 0;

                    if ((bool)(Request.Form["trainExtCBox"] == "on"))
                        pdpInitPartnersToSave.TrainExt = 1;
                    else
                        pdpInitPartnersToSave.TrainExt = 0;
                    if ((bool)(Request.Form["trainNrcsCBox"] == "on"))
                        pdpInitPartnersToSave.TrainNRCS = 1;
                    else
                        pdpInitPartnersToSave.TrainNRCS = 0;
                    if ((bool)(Request.Form["trainNGOCBox"] == "on"))
                        pdpInitPartnersToSave.TrainNGO = 1;
                    else
                        pdpInitPartnersToSave.TrainNGO = 0;
                    if ((bool)(Request.Form["trainStateCBox"] == "on"))
                        pdpInitPartnersToSave.TrainState = 1;
                    else
                        pdpInitPartnersToSave.TrainState = 0;
                    if ((bool)(Request.Form["trainFarmerCBox"] == "on"))
                        pdpInitPartnersToSave.TrainFarmer = 1;
                    else
                        pdpInitPartnersToSave.TrainFarmer = 0;
                    if ((bool)(Request.Form["trainOtherCBox"] == "on"))
                        pdpInitPartnersToSave.TrainOther = 1;
                    else
                        pdpInitPartnersToSave.TrainOther = 0;

                    /*
                    if (partExt != null && partExt.Length > 0)
                        pdpInitPartnersToSave.PartExt = Int32.Parse(partExt);
                    if (partNrcs != null && partNrcs.Length > 0)
                        pdpInitPartnersToSave.PartNRCS = Int32.Parse(partNrcs);
                    if (partNgo != null && partNgo.Length > 0)
                        pdpInitPartnersToSave.PartNGO = Int32.Parse(partNgo);
                    if (partFarmer != null && partFarmer.Length > 0)
                        pdpInitPartnersToSave.PartFarmer = Int32.Parse(partFarmer);
                    if (partState != null && partState.Length > 0)
                        pdpInitPartnersToSave.PartState = Int32.Parse(partState);
                    if (partOther != null && partOther.Length > 0)
                        pdpInitPartnersToSave.PartOther = Int32.Parse(partOther);
                    if (trainExt != null && trainExt.Length > 0)
                        pdpInitPartnersToSave.TrainExt = Int32.Parse(trainExt);
                    if (trainNrcs != null && trainNrcs.Length > 0)
                        pdpInitPartnersToSave.TrainNRCS = Int32.Parse(trainNrcs);
                    if (trainNgo != null && trainNgo.Length > 0)
                        pdpInitPartnersToSave.TrainNGO = Int32.Parse(trainNgo);
                    if (trainFarmer != null && trainFarmer.Length > 0)
                        pdpInitPartnersToSave.TrainFarmer = Int32.Parse(trainFarmer);
                    if (trainState != null && trainState.Length > 0)
                        pdpInitPartnersToSave.TrainState = Int32.Parse(trainState);
                    if (trainOther != null && trainOther.Length > 0)
                        pdpInitPartnersToSave.TrainOther = Int32.Parse(trainOther);
                    if (devExt != null && devExt.Length > 0)
                        pdpInitPartnersToSave.DevExt = Int32.Parse(devExt);
                    if (devNrcs != null && devNrcs.Length > 0)
                        pdpInitPartnersToSave.DevNRCS = Int32.Parse(devNrcs);
                    if (devNgo != null && devNgo.Length > 0)
                        pdpInitPartnersToSave.DevNGO = Int32.Parse(devNgo);
                    if (devFarmer != null && devFarmer.Length > 0)
                        pdpInitPartnersToSave.DevFarmer = Int32.Parse(devFarmer);
                    if (devState != null && devState.Length > 0)
                        pdpInitPartnersToSave.DevState = Int32.Parse(devState);
                    if (devOther != null && devOther.Length > 0)
                        pdpInitPartnersToSave.DevOther = Int32.Parse(devOther);
                    if (invExt != null && invExt.Length > 0)
                        pdpInitPartnersToSave.InvExt = Int32.Parse(invExt);
                    if (invNrcs != null && invNrcs.Length > 0)
                        pdpInitPartnersToSave.InvNRCS = Int32.Parse(invNrcs);
                    if (invNgo != null && invNgo.Length > 0)
                        pdpInitPartnersToSave.InvNGO = Int32.Parse(invNgo);
                    if (invFarmer != null && invFarmer.Length > 0)
                        pdpInitPartnersToSave.InvFarmer = Int32.Parse(invFarmer);
                    if (invState != null && invState.Length > 0)
                        pdpInitPartnersToSave.InvState = Int32.Parse(invState);
                    if (invOther != null && invOther.Length > 0)
                        pdpInitPartnersToSave.InvOther = Int32.Parse(invOther);
                    */

                    if (intNum != null && intNum.Length > 0)
                        pdpInitPartnersToSave.InitiativeNum = Int32.Parse(intNum);
                    else
                        pdpInitPartnersToSave.InitiativeNum = 0;


                    pdpInitPartnersToSave.UpdatePDPInitPartnersToDB();

                    Session["statusMessage2"] = "Initiative/Topic and Partners data has been updated successfully.";
                    //Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projNum);

                }

                if (Request.Form["cmdPdpOurNarrUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    string outputSummary = Request.Form["outNarrSum"]; ;
                    string outputDesc = Request.Form["outNarrOutcomes"];
                    string outputOther = Request.Form["ourNarrOther"];

                    daikonPDP.PDPContents pdpOutNarrToSave;
                    pdpOutNarrToSave = new daikonPDP.PDPContents();

                    pdpOutNarrToSave.ProjectNum = projNum;
                    pdpOutNarrToSave.OutSummary = outputSummary;
                    pdpOutNarrToSave.OutDesc = outputDesc;
                    pdpOutNarrToSave.OutOther = outputOther;

                    pdpOutNarrToSave.UpdatePDPOutNarrToDB();

                    Session["statusMessage2"] = "PDP Output Narrative data has been updated successfully.";
                    Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projNum);
                    
                }

                if (Request.Form["cmdPdpKeyOutStudyUpdate"] != null)
                {
                    string projNum = Request.Params.Get("pn");
                    string studySess = Request.Form["studySession"];
                    string studyExt = Request.Form["studyExt"];
                    string studyNRCS = Request.Form["studyNRCS"];
                    string studyNGO = Request.Form["studyNGO"];
                    string studyST = Request.Form["studyST"];
                    string studyProfit = Request.Form["studyPro"];
                    string studyFarm = Request.Form["studyFarm"];
                    string studyAttOther = Request.Form["studyAttOther"];
                    string studyAttDesc = Request.Form["studyAttDesc"];
                    string studyLocation = Request.Form["studyLoc"];
                    string studyState = Request.Form["studyState"];
                    string studyMedia = Request.Form["studyMedia"];
                    string studyClient = Request.Form["studyClient"];
                    string studyDevel = Request.Form["studyDevel"];
                    string studyIncorp = Request.Form["studyIncorp"];
                    string studyProgram = Request.Form["studyProg"];
                    string studyConsult = Request.Form["studyConsult"];
                    string studyFarmers = Request.Form["studyFarmers"];
                    string studyOutOther = Request.Form["studyOutOther"];
                    string studyOutDesc = Request.Form["studyOutDesc"];


                    daikonPDP.PDPKeyOut pdpKeyOutStudyToSave;
                    pdpKeyOutStudyToSave = new daikonPDP.PDPKeyOut();

                    pdpKeyOutStudyToSave.ProjectNum = projNum;
                    if (studyExt != null && studyExt.Length > 0)
                        pdpKeyOutStudyToSave.StudyExt = Convert.ToInt32(studyExt);
                    if (studyNRCS != null && studyNRCS.Length > 0)
                        pdpKeyOutStudyToSave.StudyNRCS = Convert.ToInt32((studyNRCS));
                    if (studyNGO != null && studyNGO.Length > 0)
                        pdpKeyOutStudyToSave.StudyNGO = Convert.ToInt32(studyNGO);
                    if (studyST != null && studyST.Length > 0)
                        pdpKeyOutStudyToSave.StudyST = Convert.ToInt32(studyST);
                    if (studyProfit != null && studyProfit.Length > 0)
                        pdpKeyOutStudyToSave.StudyProfit = Convert.ToInt32(studyProfit);
                    if (studyFarm != null && studyFarm.Length > 0)
                        pdpKeyOutStudyToSave.StudyFarm = Convert.ToInt32(studyFarm);
                    pdpKeyOutStudyToSave.StudyAttOther = studyAttOther;
                    pdpKeyOutStudyToSave.StudyAttDesc = studyAttDesc;
                    pdpKeyOutStudyToSave.StudyLocation = studyLocation;
                    pdpKeyOutStudyToSave.StudyState = studyState;
                    if (studyMedia != null && studyMedia.Length > 0)
                        pdpKeyOutStudyToSave.StudyMedia = Convert.ToInt32(studyMedia);
                    if (studyClient != null && studyClient.Length > 0)
                        pdpKeyOutStudyToSave.StudyClient = Convert.ToInt32(studyClient);
                    if (studyDevel != null && studyDevel.Length > 0)
                        pdpKeyOutStudyToSave.StudyDevel = Convert.ToInt32(studyDevel);
                    if (studyIncorp != null && studyIncorp.Length > 0)
                        pdpKeyOutStudyToSave.StudyIncorp = Convert.ToInt32(studyIncorp);
                    if (studyProgram != null && studyProgram.Length > 0)
                        pdpKeyOutStudyToSave.StudyProgram = Convert.ToInt32(studyProgram);
                    if (studyConsult != null && studyConsult.Length > 0)
                        pdpKeyOutStudyToSave.StudyConsult = Convert.ToInt32(studyConsult);
                    if (studyFarmers != null && studyFarmers.Length > 0)
                        pdpKeyOutStudyToSave.StudyFarmers = Convert.ToInt32(studyFarmers);
                    pdpKeyOutStudyToSave.StudyOutOther = studyOutOther;
                    pdpKeyOutStudyToSave.StudyOutDesc = studyOutDesc;

                    pdpKeyOutStudyToSave.UpdatePDPKeyOutStudyToDB();

                    Session["statusMessage2"] = "PDP Key Outcome & Activities Study Circle data has been updated successfully.";
                    Response.Redirect("sare_main.aspx?do=pdpinit&pn=" + projNum);
                }

                /*
                if (Request.Form["savesubmitupload"] == "Save and Upload" || Request.Form["updatesubmitupload"] == "Save and Upload")
                {
                    string resourceID;
                    string URL;

                    //if (Request.Form["savesubmitupload"] != null)
                    //    resourceID = AddProductInfoFormHandler(sender, e);
                    //else
                        resourceID = UpdateProductInfoFormHandler(sender, e);

                    URL = "fileUpload.aspx?suid= " + resourceID + "&order=999";

                    string popupScript = "<script language='javascript'>" + "window.open('fileUpload.aspx?suid=60&order=999', 'CustomPopUp', " + "'width=200, height=200, menubar=yes, resizable=no')" + "</script>";
                    //System.Web.UI.Page.RegisterStartupScript("PopupScript", popupScript);
                    // Get a ClientScriptManager reference from the Page class.
                    ClientScriptManager cs = Page.ClientScript;
                    cs.RegisterClientScriptBlock(this.GetType(), "PopupScript", popupScript, true);
                }
                */
                else if (Request.Form.HasKeys())
                {
                    /*
                                    foreach (string formItemKey in Request.Form.AllKeys)
                                    {
                                        Response.Write(formItemKey + "\n");
                                    }
                    */
                    /*
                                    System.Collections.IEnumerator myEnumerator = Request.Form.GetEnumerator();
                                    int i = 0;
                                    while ((myEnumerator.MoveNext()) && (myEnumerator.Current != null))
                                        Response.Write(myEnumerator.Current.ToString()+ " : " + Request.Form[myEnumerator.Current.ToString()] + "\n");
                    */
                    FormHandler(sender, e);
                }
                else
                {
                    OutputPage(sender, e);
                }
			}
		}
		protected void Page_Unload(object sender, EventArgs e)
		{
			//            Session["prevPageURL"] = (UrlQuery.UrlQuery)Session["thisPageURL"];
			if (null != Session["prevPageURL"])
			{
				if (Session["prevPageURL"].ToString() != thisPageURL.AbsoluteUri)
					Session["prevPageURL"] = thisPageURL.AbsoluteUri;
			}
			else
				Session["prevPageURL"] = thisPageURL.AbsoluteUri;
			//            Session["prevPageURL"] = thisPageURL;
			Session["thisPageURL"] = thisPageURL;
		}

		protected void Session_OnEnd()
		{
			//Not writing files in Global.asax.cs
			DaikonUser currUser;
			
			string filename;

			StringWriter writerString;
			XmlTextWriter xmlWriter;
			XsltArgumentList xsltArgs;

			XmlDocument changeDoc;
			XPathNavigator changeNav;

			currUser = (DaikonUser)(Session["currUser"]);
			writerString = new StringWriter();
			xmlWriter = new XmlTextWriter(writerString);
			xsltArgs = new XsltArgumentList();

			if (Session["changedoc"] != null)
			{
				changeDoc = (XmlDocument)(Session["changedoc"]);
				changeNav = changeDoc.CreateNavigator();
				//                changeNav.MoveToRoot();
				//                filename = Server.MapPath("~/logs/");
				filename = "./logs/";
				filename += currUser.Username;
				filename += DateTime.Now.ToString("_yyyy-MM-dd_HH-mm");
				filename += "_log.xml";
				changeDoc.Save(filename);
			}
		}

		protected void OutputPage(object sender, EventArgs e)
		{
			outputMessage1 = "";
			outputMessage2 = "";            

			string doPage = "";
			string doPageXparam = "";
			if (Request.Params["do"] != null)
			{
				doPage = Request.Params["do"].ToLower();
				doPageXparam = Request.Params["do"];
			}
			//			Response.Write("Start Output: " + DateTime.UtcNow.ToLongTimeString());
			xslTemplate = ConfigurationManager.AppSettings["mainpageXslt"].ToString();
			string navbarXslTemplate = ConfigurationManager.AppSettings["navbarXslt"].ToString();


			StringReader readerString;
			XmlDocument xmlDoc = new XmlDocument();
			XslCompiledTransform xslTransform = new XslCompiledTransform();
			XslCompiledTransform xslTransformNavbar = new XslCompiledTransform();

			StringWriter writerStringNavbar;
			XmlTextWriter xmlWriterNavbar;
			XsltArgumentList xsltArgsNavbar;
			StringReader readerStringNavbar;
			XmlDocument xmlDocNavbar = new XmlDocument();

			writerStringNavbar = new StringWriter();
			xmlWriterNavbar = new XmlTextWriter(writerStringNavbar);
			xsltArgsNavbar = new XsltArgumentList();

			xmlWriter.Formatting = Formatting.Indented;
			xmlWriterNavbar.Formatting = Formatting.Indented;
			//            xmlWriter.Settings.ConformanceLevel = ConformanceLevel.Fragment;
			//            xmlWriter.Settings.Encoding = Encoding.UTF8;

			//            xmlWriter.WriteStartDocument();
			//            xmlWriterNavbar.WriteStartDocument();

			xmlWriter.WriteStartElement("SAREroot");
			xmlWriterNavbar.WriteStartElement("SAREroot");
			/*
			 * Moved to top
						DaikonGrantFieldValues staticVals = new DaikonGrantFieldValues();
						DaikonEventFieldValues staticCalVals = new DaikonEventFieldValues();

						staticVals.DaikonGrantFieldValues(ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
			*/
			currUser.toXML(xmlWriter, "current");
			currUser.toXML(xmlWriterNavbar, "current");

			xmlWriterNavbar.WriteEndElement();

			readerStringNavbar = new StringReader(writerStringNavbar.ToString());
			xmlDocNavbar.Load(readerStringNavbar);

            Response.ContentType = "text/html";

			switch (doPage)
			{
				case "edituser":
					{
						xslTemplate = ConfigurationManager.AppSettings["edituserXslt"].ToString();
						UserEditFormXMLWriter();
						break;
					}
				case "addparticipant":
					{
						xslTemplate = ConfigurationManager.AppSettings["editparticipantXslt"].ToString();
						if (Request.Params["pn"] != "")
							projectNum = "&pn=" + Request.Params["pn"];
						xsltArgs.AddParam("formaction", "", doPage + projectNum);
						UserEditFormXMLWriter();
						break;
					}
				case "editparticipant":
					{
						string user = "";
						xslTemplate = ConfigurationManager.AppSettings["editparticipantXslt"].ToString();
						if (Request.Params["user"] != "")
							user = "&user=" + Request.Params["user"];
						xsltArgs.AddParam("formaction", "", doPage + user);
						UserEditFormXMLWriter();
						break;
					}
				
				case "newgrant":
					{
						xslTemplate = ConfigurationManager.AppSettings["createprojectXslt"].ToString();
						//  newGrantPage(sender, e);
                        if (Request.Params["projType"] != null && Request.Params["projType"] != "")
                            xsltArgs.AddParam("projectType", "", Request.Params["projType"]);
                        if (Request.Params["region"] != null && Request.Params["region"] != "")
                            xsltArgs.AddParam("projectRegion", "", Request.Params["region"]);
                        else
                            xsltArgs.AddParam("projectRegion", "", currUser.Region);
                        break;
					}
                case "newpdp":
                    {
                        xslTemplate = ConfigurationManager.AppSettings["createpdpXslt"].ToString();
                        //  newGrantPage(sender, e);
                        if (Request.Params["projType"] != null && Request.Params["projType"] != "")
                            xsltArgs.AddParam("projectType", "", Request.Params["projType"]);
                        if (Request.Params["region"] != null && Request.Params["region"] != "")
                            xsltArgs.AddParam("projectRegion", "", Request.Params["region"]);
                        else
                            xsltArgs.AddParam("projectRegion", "", currUser.Region);
                        break;
                    }
                case "pdpinit":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        xslTemplate = ConfigurationManager.AppSettings["pdpInitXslt"].ToString();

                        if (Request.Params.Get("initNum") == null)
                        {
                            daikonPDP.PDPContents pdpInitPartnersRow = new daikonPDP.PDPContents();
                            pdpInitPartnersRow.ProjectNum = thisGrant;
                            pdpInitPartnersRow.getPdpInitPartnersByProjNum(thisGrant);
                            pdpInitPartnersRow.toXmlPdpInitPartners(xmlWriter);
                        }
                        else
                        {
                            daikonPDP.PDPContents pdpInitPartnersRow = new daikonPDP.PDPContents();
                            pdpInitPartnersRow.ProjectNum = thisGrant;
                            pdpInitPartnersRow.getPdpInitPartnersByProjNum(thisGrant, int.Parse(Request.Params.Get("initNum")));
                            pdpInitPartnersRow.toXmlPdpInitPartners(xmlWriter);
                        }
                        break;
                    }
                case "pdpkeyout":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        int initNum = 0;
                        int sessNum = 0;

                        if (Request.Params.Get("initNum") != null)
                            initNum = int.Parse(Request.Params.Get("initNum"));

                        if (Request.Params.Get("sessNum") != null)
                            sessNum = int.Parse(Request.Params.Get("sessNum"));

                        xslTemplate = ConfigurationManager.AppSettings["pdpKeyOutXslt"].ToString();

                        daikonPDP.PDPKeyOut pdpKeyOutWorkshopsRow = new daikonPDP.PDPKeyOut();
                        pdpKeyOutWorkshopsRow.getPdpKeyOutWorkshopsByProjNum(thisGrant, initNum, sessNum);
                        pdpKeyOutWorkshopsRow.toXmlPdpKeyOutWorkshops(xmlWriter);
                        break;
                    }
                case "pdpkeyoutfield":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        int initNum = 0;
                        int sessNum = 0;

                        if (Request.Params.Get("initNum") != null)
                            initNum = int.Parse(Request.Params.Get("initNum"));

                        if (Request.Params.Get("sessNum") != null)
                            sessNum = int.Parse(Request.Params.Get("sessNum"));

                        xslTemplate = ConfigurationManager.AppSettings["pdpKeyOutFieldXslt"].ToString();

                        daikonPDP.PDPKeyOut pdpKeyOutFieldRow = new daikonPDP.PDPKeyOut();
                        //if (Request.Params.Get("initNum") == null)
                        //    pdpKeyOutFieldRow.getPdpKeyOutFieldByProjNum(thisGrant);
                        //else
                        
                        pdpKeyOutFieldRow.getPdpKeyOutFieldByProjNum(thisGrant, initNum, sessNum);
                        pdpKeyOutFieldRow.toXmlPdpKeyOutField(xmlWriter);
                        break;
                    }
                case "pdpkeyoutstudy":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        int initNum = 0;
                        int sessNum = 0;

                        if (Request.Params.Get("initNum") != null)
                            initNum = int.Parse(Request.Params.Get("initNum"));

                        if (Request.Params.Get("sessNum") != null)
                            sessNum = int.Parse(Request.Params.Get("sessNum"));

                        xslTemplate = ConfigurationManager.AppSettings["pdpKeyOutStudyXslt"].ToString();

                        daikonPDP.PDPKeyOut pdpKeyOutStudyRow = new daikonPDP.PDPKeyOut();
                        pdpKeyOutStudyRow.getPdpKeyOutStudyByProjNum(thisGrant, initNum, sessNum);
                        pdpKeyOutStudyRow.toXmlPdpKeyOutStudy(xmlWriter);

                        break;
                    }
                case "pdpkeyoutweb":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        int initNum = 0;
                        int sessNum = 0;

                        if (Request.Params.Get("initNum") != null)
                            initNum = int.Parse(Request.Params.Get("initNum"));

                        if (Request.Params.Get("sessNum") != null)
                            sessNum = int.Parse(Request.Params.Get("sessNum"));

                        xslTemplate = ConfigurationManager.AppSettings["pdpKeyOutWebXslt"].ToString();

                        daikonPDP.PDPKeyOut pdpKeyOutWebRow = new daikonPDP.PDPKeyOut();
                        pdpKeyOutWebRow.getPdpKeyOutWebByProjNum(thisGrant, initNum, sessNum);
                        pdpKeyOutWebRow.toXmlPdpKeyOutWeb(xmlWriter);

                        break;
                    }
                case "pdpkeyoutgrants":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        int initNum = 0;
                        int sessNum = 0;

                        if (Request.Params.Get("initNum") != null)
                            initNum = int.Parse(Request.Params.Get("initNum"));

                        if (Request.Params.Get("sessNum") != null)
                            sessNum = int.Parse(Request.Params.Get("sessNum"));

                        xslTemplate = ConfigurationManager.AppSettings["pdpKeyOutGrantsXslt"].ToString();

                        daikonPDP.PDPKeyOut pdpKeyOutGrantsRow = new daikonPDP.PDPKeyOut();
                        pdpKeyOutGrantsRow.getPdpKeyOutGrantsByProjNum(thisGrant, initNum, sessNum);
                        pdpKeyOutGrantsRow.toXmlPdpKeyOutGrants(xmlWriter);
                        break;
                    }
                case "pdpkeyouttravel":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        int initNum = 0;
                        int sessNum = 0;

                        if (Request.Params.Get("initNum") != null)
                            initNum = int.Parse(Request.Params.Get("initNum"));

                        if (Request.Params.Get("sessNum") != null)
                            sessNum = int.Parse(Request.Params.Get("sessNum"));

                        xslTemplate = ConfigurationManager.AppSettings["pdpKeyOutTravelXslt"].ToString();

                        daikonPDP.PDPKeyOut pdpKeyOutTravelRow = new daikonPDP.PDPKeyOut();
                        pdpKeyOutTravelRow.getPdpKeyOutTravelByProjNum(thisGrant, initNum, sessNum);
                        pdpKeyOutTravelRow.toXmlPdpKeyOutTravel(xmlWriter);
                        break;
                    }
                case "pdpkeyoutother":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        int initNum = 0;
                        int sessNum = 0;

                        if (Request.Params.Get("initNum") != null)
                            initNum = int.Parse(Request.Params.Get("initNum"));

                        if (Request.Params.Get("sessNum") != null)
                            sessNum = int.Parse(Request.Params.Get("sessNum"));

                        xslTemplate = ConfigurationManager.AppSettings["pdpKeyOutOtherXslt"].ToString();

                        daikonPDP.PDPKeyOut pdpKeyOutOtherRow = new daikonPDP.PDPKeyOut();
                        pdpKeyOutOtherRow.getPdpKeyOutOtherByProjNum(thisGrant, initNum, sessNum);
                        pdpKeyOutOtherRow.toXmlPdpKeyOutOther(xmlWriter);
                        break;
                    }
                case "pdpoutnarrative":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        xslTemplate = ConfigurationManager.AppSettings["pdpOutNarrativeXslt"].ToString();

                        daikonPDP.PDPContents pdpOutNarrRow = new daikonPDP.PDPContents();
                        pdpOutNarrRow.getPdpOutNarrByProjNum(thisGrant);
                        pdpOutNarrRow.toXmlPdpOutNarr(xmlWriter);
                        pdpOutNarrRow.toXmlPdpAttachments(xmlWriter);
                        break;                 
                    }
				case "searchprojprofile":
					{
						xslTemplate = ConfigurationManager.AppSettings["profilesearchXslt"].ToString();
						//                        Session["statusMessage1"] = "Required Field(s) are missing.";
						if (null != Session["searchProfile"])
							((DaikonProfile)(Session["searchProfile"])).toXml(xmlWriter);
						//                        xmlWriter.WriteRaw(File.ReadAllText(this.MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["testprofileXml"].ToString()));
                       	SearchProfilesXMLWriter();
						xmlWriter.WriteRaw(File.ReadAllText(this.MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["profiledefinitionXml"].ToString()));
						//  newGrantPage(sender, e);
						break;
					}
				case "addprofile":
					{
						xslTemplate = ConfigurationManager.AppSettings["addprofileXslt"].ToString();
						//                        Session["statusMessage1"] = "Required Field(s) are missing.";
						if (null != Session["currProfile"])
							((DaikonProfile)(Session["currProfile"])).toXml(xmlWriter);
						//                        xmlWriter.WriteRaw(File.ReadAllText(this.MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["testprofileXml"].ToString()));
						xmlWriter.WriteRaw(File.ReadAllText(this.MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["profiledefinitionXml"].ToString()));
						//  newGrantPage(sender, e);
                        xsltArgs.AddParam("projType", "", Request.Params["type"]);
						break;
					}
				case "addprofile2":
					{
						xslTemplate = ConfigurationManager.AppSettings["addprofile2Xslt"].ToString();
						if (null != Session["currProfile"])
							((DaikonProfile)(Session["currProfile"])).toXml(xmlWriter);
						//                        xmlWriter.WriteRaw(File.ReadAllText(this.MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["testprofileXml"].ToString()));
						xmlWriter.WriteRaw(File.ReadAllText(this.MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["profiledefinitionXml"].ToString()));
						//  newGrantPage(sender, e);
						break;
					}
				case "editproj":
					{
                        string thisGrant = Request.Params.Get("pn");
                        string deleteProject = Request.Params.Get("deleteProj");

                        if (deleteProject != null && deleteProject.Length != 0)
                            xsltArgs.AddParam("deleteProj", "", "true");

                        if (currUser.Grants == null)
                        {
                            currUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
                        }
                        else
                        {
                            //This is added for REFRESH
                            currUser.Grants.Clear();
                        }

                        if (currUser.Grants.ContainsKey(thisGrant))
                        {
                            DaikonUserCollection projectPIs = new DaikonUserCollection(currUser.Grants[thisGrant].CoreID, true);
                            foreach (DaikonUser pis in projectPIs.UserList.Values)
                            {

                                if (pis.Username == currUser.Username)
                                    xsltArgs.AddParam("useradmin", "", "myprojectslist");                                
                            }
                        }
                      	xslTemplate = ConfigurationManager.AppSettings["editprojectXslt"].ToString();
						ProjectEditorXMLWriter();
						break;
					}
                case "editpdp":
                    {
                        string thisGrant = Request.Params.Get("pn");
                        string deleteProject = Request.Params.Get("deleteProj");

                        if (deleteProject != null && deleteProject.Length != 0)
                            xsltArgs.AddParam("deleteProj", "", "true");

                        if (currUser.Grants == null)
                        {
                            currUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
                        }
                        else
                        {
                            //This is added for REFRESH
                            currUser.Grants.Clear();
                        }

                        if (currUser.Grants.ContainsKey(thisGrant))
                        {
                            DaikonUserCollection projectPIs = new DaikonUserCollection(currUser.Grants[thisGrant].CoreID, true);
                            foreach (DaikonUser pis in projectPIs.UserList.Values)
                            {

                                if (pis.Username == currUser.Username)
                                    xsltArgs.AddParam("useradmin", "", "myprojectslist");
                            }
                        }
                        xslTemplate = ConfigurationManager.AppSettings["editpdpXslt"].ToString();
                        ProjectEditorXMLWriter();

                        daikonPDP.PDPContents pdpInfoRow = new daikonPDP.PDPContents();
                        pdpInfoRow.ProjectNum = thisGrant;
                        pdpInfoRow.getPdpInfoDetailsByPdpID(thisGrant);
                        pdpInfoRow.toXmlPdpInfoDetails(xmlWriter); 
                        break;
                    }
				case "claimproj":
					{
						xslTemplate = ConfigurationManager.AppSettings["claimprojectXslt"].ToString();
						//ClaimProjectForm(sender, e);
                        string userSQL;
                        string NCemails = "";
                        string NEemails = "";
                        string Semails = "";
                        string Wemails = "";
                        string region = "";
			            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();
			            SqlConnection userConnection;
			            SqlCommand userCommand;
			            SqlDataReader userDataReader;

			            userConnection = new SqlConnection(userConnString);

                        userSQL = "DaikonUserGetRegAdminEmailRecipients";
			            userCommand = new SqlCommand(userSQL, userConnection);
			            userCommand.CommandType = CommandType.StoredProcedure;
			            
			            userConnection.Open();
			            userDataReader = userCommand.ExecuteReader();

			            while (userDataReader.Read())
			            {
                            region = userDataReader["forRegion"].ToString();

                            if (region == "NC")
                            {
                                if (NCemails.Length == 0)
                                    NCemails = userDataReader["email"].ToString();
                                else
                                    NCemails = NCemails + ";" + userDataReader["email"].ToString();
                            }
                            else if (region == "NE")
                            {
                                if (NEemails.Length == 0)
                                    NEemails = userDataReader["email"].ToString();
                                else
                                    NEemails = NEemails + ";" + userDataReader["email"].ToString();
                            }
                            else if (region == "S")
                            {
                                if (Semails.Length == 0)
                                    Semails = userDataReader["email"].ToString();
                                else
                                    Semails = Semails + ";" + userDataReader["email"].ToString();
                            }
                            else
                            {
                                if (Wemails.Length == 0)
                                    Wemails = userDataReader["email"].ToString();
                                else
                                    Wemails = Wemails + ";" + userDataReader["email"].ToString();
                            }

			            }
			            userConnection.Dispose();

                        xsltArgs.AddParam("ncregadminlist", "", NCemails);
                        xsltArgs.AddParam("neregadminlist", "", NEemails);
                        xsltArgs.AddParam("sregadminlist", "", Semails);
                        xsltArgs.AddParam("wregadminlist", "", Wemails);
						break;
					}
                case "claimpdp":
                    {
                        xslTemplate = ConfigurationManager.AppSettings["claimpdpXslt"].ToString();
                        break;
                    }
                case "deleteproj":
                    {
                        xslTemplate = ConfigurationManager.AppSettings["deleteprojectXslt"].ToString();
                        break;
                    }
                case "infoproddetail":
                    {
                        string resourceID = "";
                        string uploadID = "";

                        if (Session["statusMessage2"] != null && (Session["statusMessage2"].ToString() == "File Uploaded." || Session["statusMessage2"].ToString() == "File Deleted."))
                        {
                            Session["statusMessage2"] = "Your file has been uploaded successfully. Now you can:";
                            //uploadID = Session["fileID"].ToString();

                        }
                        
                        //else
                        //{

                            xslTemplate = ConfigurationManager.AppSettings["infoproductdetailXslt"].ToString();
                            if (Request.Params.Get("type") != null)
                            {
                                if (Request.Params.Get("type") == "pdp")
                                    xsltArgs.AddParam("granttype", "", "pdp");
                                else
                                    xsltArgs.AddParam("granttype", "", "grant");
                            }

                            if (Request.Params.Get("resourceID") != null && Request.Params.Get("resourceID") != null)
                            {
                                resourceID = Request.Params.Get("resourceID");
                                uploadID = Request.Params.Get("uploadID");
                                //if (uploadID.Length == 0 && Session["fileID"] != null)
                                //    uploadID = Session["fileID"].ToString();
                                xsltArgs.AddParam("editprojectprodinfo", "", "True");
                                daikonProdInfo.ProductInfo prodInfoRow = new daikonProdInfo.ProductInfo();
                                if (uploadID != null && uploadID.Length == 0)
                                    prodInfoRow.getProdInfoDetailsByUploadID(Int32.Parse(resourceID));
                                else
                                    prodInfoRow.getProdInfoDetails(Int32.Parse(resourceID));
                                prodInfoRow.toXmlProdInfoDetails(xmlWriter);
                            }
                        //}
                        break;
                    }
				case "editrept":
					{
						xslTemplate = ConfigurationManager.AppSettings["editreportXslt"].ToString();
						ReportEditorXMLWriter();
						break;
					}
				case "viewrept":
					{
						xslTemplate = ConfigurationManager.AppSettings["viewreportXslt"].ToString();
						ReportEditorXMLWriter();
						break;
					}
				case "userlist":
					{
						xslTemplate = ConfigurationManager.AppSettings["userlistXslt"].ToString();
						UserListXMLWriter();
						break;
					}
				case "myproj":
					{
                        if (currUser.Roles.IsAdmin())
                            xsltArgs.AddParam("useradmin", "", "myprojectslist"); 
                        else
                            xsltArgs.AddParam("useradmin", "", ""); 
                        xslTemplate = ConfigurationManager.AppSettings["projectlistXslt"].ToString();
						MyProjXMLWriter();
                       
                        break;
					}
				case "adminproj":
					{
						xslTemplate = ConfigurationManager.AppSettings["projectlistXslt"].ToString();
						AdminProjXMLWriter();
                        break;
					}
				case "searchproj":
					{
						//						Response.Write("Start Search Page: " + DateTime.UtcNow.ToLongTimeString());
						xslTemplate = ConfigurationManager.AppSettings["projectsearchXslt"].ToString();
                        SearchProjXMLWriter();
						//						Response.Write("Finish Search Population: " + DateTime.UtcNow.ToLongTimeString());
						//xmlWriter.WriteRaw(File.ReadAllText(this.MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["profiledefinitionXml"].ToString()));
						//						Response.Write("Finish Read Profile XML: " + DateTime.UtcNow.ToLongTimeString());
						break;
					}
                case "searchcoord":
                    {
                        xslTemplate = ConfigurationManager.AppSettings["reportSearchCoordinatorXslt"].ToString();
                        SearchCoordReports();
                        break;
                    }
                case "searchunclaimproj":
                    {
                        xslTemplate = ConfigurationManager.AppSettings["unclaimprojectsearchXslt"].ToString();
                        AdminUnclaimedProjXMLWriter();
                        break;
                    }
                case "searchprojoverviewnosubmit":
                    {
                        xslTemplate = ConfigurationManager.AppSettings["notsubmittedprojoverviewsearchXslt"].ToString();
                        AdminNotSubmittedProjOverviewXMLWriter();
                        break;
                    }
                case "searchprojnoreports":
                    {
                        xslTemplate = ConfigurationManager.AppSettings["projectswithnoreportssearchXslt"].ToString();
                        AdminProjectsWithNoReportsXMLWriter();
                        break;
                    }
				case "sendpicall":
					{
						int msgID;
						msgID = 0;
                        // initialized for 4 becuase for all recipients
                        int reportStatus = 4;

						if ((Request.Params["msg"] != null) && (Request.Params["msg"] != ""))
							msgID = int.Parse(Request.Params["msg"]);

                        if ((Request.Params["reportStatus"] != null) && (Request.Params["reportStatus"] != ""))
                            reportStatus = int.Parse(Request.Params["reportStatus"]);

                        xsltArgs.AddParam("msgID", "", msgID);
                        xsltArgs.AddParam("reptStatus", "", reportStatus);
						xslTemplate = ConfigurationManager.AppSettings["sendpicallXslt"].ToString();
						UserMessages messageSet = new UserMessages(currUser.Username, (int)(Session["sessionKey"]));
						messageSet.toXML(xmlWriter);
						break;
					}
				case "sendmessage":
					{
						int msgID;
						msgID = 0;

						if ((Request.Params["msg"] != null) && (Request.Params["msg"] != ""))
							msgID = int.Parse(Request.Params["msg"]);

						xsltArgs.AddParam("msgID", "", msgID);
						DaikonUserCollection regadmins = new DaikonUserCollection();
						regadmins.PopulateRegadminList(currUser.Username);
						DaikonUserCollection admins = new DaikonUserCollection(currUser.Username);
						admins.toXML(xmlWriter, "admins");
						regadmins.toXML(xmlWriter, "regadmins");

						xslTemplate = ConfigurationManager.AppSettings["sendmessageXslt"].ToString();
						UserMessages messageSet = new UserMessages(currUser.Username, (int)(Session["sessionKey"]));
						messageSet.toXML(xmlWriter);
						break;
					}
				case "confirm":
                    {
						//It's not really catching this, is it?

                        string confirmType = "";
                        string type = "grant";
                        string eventStatus = "False";
                        
                        if ((Request.Params["confirmType"] != null) && (Request.Params["confirmType"] != ""))
                            confirmType = Request.Params["confirmType"];

                        if ((Request.Params["type"] != null) && (Request.Params["type"] != ""))
                            type = Request.Params["type"];

                        if (Request.Params["t"] != null && Request.Params["t"] != "")
                        {
                            xsltArgs.AddParam("reporttype", "", "Return to Project Overview");
                        }

                        if (Session["confirmthis"] != null && !(confirmType == "update" || confirmType == "delete" || confirmType == "deleteuser" || confirmType == "submit" || confirmType == "deleteProject"))
						{
							xmlWriter.WriteRaw(Session["confirmthis"].ToString());
							confirmType = "message";
						}

                        if (Request.Params["resourceID"] != null)
                        {
                           xsltArgs.AddParam("upload", "", "0");
                           xsltArgs.AddParam("resourceID", "", Request.Params["resourceID"].ToString());
                        }

                        if ((Request.Params["user"] != null) && (Request.Params["user"] != ""))
                        {
                            string backPage = "&user=" + Request.Params["user"];
                            xsltArgs.AddParam("backpage", "", Session["prevPageURL"].ToString() + backPage);
                        }
                        else if ((Request.Params["pn"] != null) && (Request.Params["pn"] != ""))
                        {
                            string backPage = "";
                            if (type == "pdp")
                                backPage = "editpdp&pn=" + Request.Params["pn"];
                            else
                                backPage = "editproj&pn=" + Request.Params["pn"];
                            xsltArgs.AddParam("backpage", "", backPage);
                        }
                        else if (confirmType == "deleteProject")
                        {
                            xsltArgs.AddParam("backpage", "", "");
                            confirmType = "delete";
                        }
                        else if (confirmType == "register")
                        {
                            xsltArgs.AddParam("backpage", "", "");
                            confirmType = "register";
                        }
                        else
                        {
                            xsltArgs.AddParam("backpage", "", Session["prevPageURL"]);
                        }
                        
                        xsltArgs.AddParam("confirmtype", "", confirmType);

                        if (Request.Params["ev"] != null)
                            xsltArgs.AddParam("event", "", Request.Params["ev"]);
                         
                        if (Request.Params["evStatus"] != null)
                        {
                            eventStatus = Request.Params["evStatus"];
                        }
                        
                        xslTemplate = ConfigurationManager.AppSettings["confirmXslt"].ToString();
						if (confirmType != "message")
						{
							try
							{
                                if (eventStatus == "False")
								    sareChangeMailer();
							}
							catch (SystemException ex)
							{
								outputMessage1 = "Unable to send confirmation email " + ex.Message;
								//							Response.Redirect("sare_main.aspx");
							}
						}
						break;
                    }

				
                case "viewstatecoordinator":
                    {
                        string user = "";
                        xslTemplate = ConfigurationManager.AppSettings["viewUserXslt"].ToString();
                        if (Request.Params["user"] != "")
                            user = "&user=" + Request.Params["user"];
                        xsltArgs.AddParam("formaction", "", doPage + user);
                        if (Request.Params["projType"] != null && Request.Params["projType"] != "")
                            xsltArgs.AddParam("projType", "", Request.Params["projType"]);
                        StateCoordinatorViewFormXMLWriter();
                        break;
                    }
                case "addcoordinator":
                    {
                        xslTemplate = ConfigurationManager.AppSettings["editcoordinatorXslt"].ToString();
                        if (Request.Params["pn"] != "")
                            projectNum = "&pn=" + Request.Params["pn"];
                        xsltArgs.AddParam("formaction", "", doPage + projectNum);
                        CoordinatorEditFormXMLWriter();
                        break;
                    }
                case "editcoordinator":
                    {
                        string user = "";
                        xslTemplate = ConfigurationManager.AppSettings["editcoordinatorXslt"].ToString();
                        if (Request.Params["user"] != "")
                            user = "&user=" + Request.Params["user"];
                        xsltArgs.AddParam("formaction", "", doPage + user);
                        CoordinatorEditFormXMLWriter();
                        break;
                    }
				/*
								case "grants":
									{
										xslTemplate = ConfigurationManager.AppSettings["projectlistXslt"].ToString();
										GrantXMLWriter();
										break;
									}
									*/
				case "logout":
					{
						try
						{
							sareChangeMailer();
						}
						catch (SystemException ex)
						{
							Response.Write("Unable to send confirmation email " + ex.Message);
						}
						logOut();
						break;
					}
				default:
					{
						xslTemplate = ConfigurationManager.AppSettings["mainpageXslt"].ToString();
						//                    UserMainPage(sender, e);
						break;
					}
				//                Response.Write(thisPageURL.AbsoluteUri + "<br>" + thisPageURL["Query"] + "<br>" + thisPageURL.Url);
			}

			xmlWriter.WriteRaw(staticVals.pStateInfo);
			xmlWriter.WriteRaw(staticVals.pRegionInfo);
			xmlWriter.WriteRaw(staticVals.pProjTypeInfo);
			xmlWriter.WriteRaw(staticVals.pTextSectionInfo);
			xmlWriter.WriteRaw(staticVals.pSubsectionTypeInfo);
			xmlWriter.WriteRaw(staticVals.pUserRoleInfo);

			xmlWriter.WriteEndElement();

			xmlWriter.Flush();

			if (Session["statusMessage1"] != null)
			{
				outputMessage1 += Session["statusMessage1"].ToString();
				Session.Remove("statusMessage1");
			}

			if (Session["statusMessage2"] != null)
			{
				outputMessage2 += Session["statusMessage2"].ToString();
				Session.Remove("statusMessage2");
			}
			
			xsltArgs.AddParam("message", "", outputMessage1);
			xsltArgs.AddParam("message2", "", outputMessage2);

			readerString = new StringReader(writerString.ToString());
			//			Response.Write("Start XML Doc: " + DateTime.UtcNow.ToLongTimeString());
			xmlDoc.Load(readerString);

			if (Request.Params["output"] == "xml")
			{
				//                Response.Write(xmlDoc.ToString());
				Response.Write(writerString.ToString());
				//                Response.Write(doPage);
			}
			else
			{
				///////
				HtmlTextWriter htmlCache = new HtmlTextWriter(Response.Output);

				System.IO.StreamReader headerFile;

                if (currUser.Roles.IsAdmin())
                {
                    if (doPage != "viewrept")
                        headerFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\header_admin.inc");
                    else
                        headerFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\header_admin_list_indent.inc");
                }
                else
                {
                    if (doPage != "viewrept")
                        headerFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\header_pi.inc");
                    else
                        headerFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\header_pi_list_indent.inc");
                }
				string htmlHeader = headerFile.ReadToEnd();
				headerFile.Close();

				System.IO.StreamReader navbarFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\leftsidebar.inc");
				string htmlNavbar = navbarFile.ReadToEnd();
				navbarFile.Close();

				System.IO.StreamReader footerFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\footer.inc");
				string htmlFooter = footerFile.ReadToEnd();
				footerFile.Close();

				htmlCache.Write(htmlHeader);

				htmlCache.Write("<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"><tbody><tr><td class=\"leftnav\" style=\"width: 159px; vertical-align: top;\">");

				if ((null != doPage) && (doPage.Length > 0))
				{
					xsltArgsNavbar.AddParam("currentpage", "", doPageXparam);
				}
				xslTransformNavbar.Load(MapPath(Page.TemplateSourceDirectory) + navbarXslTemplate);
				xslTransformNavbar.Transform(xmlDocNavbar, xsltArgsNavbar, htmlCache);

				//htmlCache.Write(htmlNavbar);

				htmlCache.Write("</td><td class=\"copy\">");
				///////

				//xslTransform.Load(MapPath(Page.TemplateSourceDirectory) + xslTemplate);
				string xsltFilePath = MapPath(Page.TemplateSourceDirectory);
				xslTransform.Load(xsltFilePath + xslTemplate);

				xslTransform.Transform(xmlDoc, xsltArgs, htmlCache);

				htmlCache.Write("</td></tr>");
				htmlCache.Write(htmlFooter);
				htmlCache.Write("</tbody></table>");

				//				Response.Write("Finished Output: " + DateTime.UtcNow.ToLongTimeString());
				htmlCache.Write("</body></html>");

				htmlCache.Close();
			}

		}

		//Abandoned in favor of db-based version
		/*
		public XPathNodeIterator determineMailRecipients(int coreType, int subType, string region)
		{
			XPathNavigator recipientNav;
			XPathDocument recipientsList = new XPathDocument(MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["mailRecipientsXml"].ToString());
			String navExpression;
			XPathNodeIterator recipients;

			if (subType == 0)
			{
				navExpression = "/SAREroot/user[emailrecipient/recipientfor@region='" + region + "'/core@type='" + coreType.ToString() + "]/contact/email";
			}
			else
			{
				navExpression = "/SAREroot/user[emailrecipient/recipientfor@region='" + region + "'/core@type='" + coreType.ToString() + "'/subtype='" + subType.ToString() + "']/contact/email";
			}

			recipientNav = recipientsList.CreateNavigator();
			return recipientNav.Select(navExpression);
		}
		*/

        public string RegionalAdminEmailListHandler(string projNumber)
        {

            string emailList = "";

            // NE region
            if (projNumber.Contains("LNE") || projNumber.Contains("lne"))
                emailList = "hhusher@uvm.edu";
            else if (projNumber.Contains("GNE") || projNumber.Contains("gne"))
                emailList = "candice.huber@uvm.edu";
            else if (projNumber.Contains("FNE") || projNumber.Contains("fne"))
                emailList = "carol.delaney@uvm.edu";
            else if (projNumber.Contains("CNE") || projNumber.Contains("cne"))
                emailList = "carol.delaney@uvm.edu, candice.huber@uvm.edu";
            else if (projNumber.Contains("ONE") || projNumber.Contains("one"))
                emailList = "carol.delaney@uvm.edu";
            else if (projNumber.Contains("ENE") || projNumber.Contains("ene"))
                emailList = "janet.mcallister@uconn.edu";

            // NC region
            else if (projNumber.Contains("ANC") || projNumber.Contains("anc"))
                emailList = "mart1817@umn.edu, schre002@umn.edu, jandreas@umn.edu";
            else if (projNumber.Contains("LNC") || projNumber.Contains("lnc"))
                emailList = "mart1817@umn.edu, schre002@umn.edu, jandreas@umn.edu";
            else if (projNumber.Contains("GNC") || projNumber.Contains("gnc"))
                emailList = "mart1817@umn.edu, schre002@umn.edu, jandreas@umn.edu";
            else if (projNumber.Contains("FNC") || projNumber.Contains("fnc"))
                emailList = "benjaminj@lincolnu.edu, mart1817@umn.edu, jandreas@umn.edu";
            else if (projNumber.Contains("YNC") || projNumber.Contains("ync"))
                emailList = "jbenjaminj@lincolnu.edu, mart1817@umn.edu, jandreas@umn.edu";
            else if (projNumber.Contains("YENC") || projNumber.Contains("yenc"))
                emailList = "benjaminj@lincolnu.edu, mart1817@umn.edu, jandreas@umn.edu";
            else if (projNumber.Contains("ENC") || projNumber.Contains("enc"))
                emailList = "mart1817@umn.edu, myersrob@missouri.edu, jandreas@umn.edu";

            // S region
            else if (projNumber.Contains("LS") || projNumber.Contains("ls"))
                emailList = "sueblum@uga.edu";
            else if (projNumber.Contains("FS") || projNumber.Contains("fs"))
                emailList = "sueblum@uga.edu";
            else if (projNumber.Contains("GS") || projNumber.Contains("gs"))
                emailList = "sueblum@uga.edu";
            else if (projNumber.Contains("OS") || projNumber.Contains("os"))
                emailList = "sueblum@uga.edu";
            else if (projNumber.Contains("CS") || projNumber.Contains("cs"))
                emailList = "sueblum@uga.edu";
            else if (projNumber.Contains("MS") || projNumber.Contains("ms"))
                emailList = "sueblum@uga.edu";
            else if (projNumber.Contains("ES") || projNumber.Contains("es"))
                emailList = "dredhage@kerrcenter.com";

            // W region
            else if (projNumber.Contains("SW") || projNumber.Contains("sw"))
                emailList = "kristi.jensen@usu.edu, bobn@ext.usu.edu, wsareoutreach@gmail.com, megan.wouden@usu.edu, kim.anderson@usu.edu";
            else if (projNumber.Contains("GW") || projNumber.Contains("gw"))
                emailList = "kristi.jensen@usu.edu, bobn@ext.usu.edu, wsareoutreach@gmail.com, megan.wouden@usu.edu, kim.anderson@usu.edu";
            else if (projNumber.Contains("FW") || projNumber.Contains("fw"))
                emailList = "kristi.jensen@usu.edu, bobn@ext.usu.edu, wsareoutreach@gmail.com, megan.wouden@usu.edu, kim.anderson@usu.edu";
            else if (projNumber.Contains("OW") || projNumber.Contains("ow"))
                emailList = "kristi.jensen@usu.edu, bobn@ext.usu.edu, wsareoutreach@gmail.com, megan.wouden@usu.edu, kim.anderson@usu.edu";
            else if (projNumber.Contains("EW") || projNumber.Contains("ew"))
                emailList = "kristi.jensen@usu.edu, alkurki@msn.com, megan.wouden@usu.edu, kim.anderson@usu.edu";

            return emailList;
        }


		public void sareChangeMailer()
		{
			/*
			int currentCore;
			DaikonUserCollection recipientsCollection;
			XmlDocument xmlSubDocToMail = new XmlDocument();
			System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsender"].ToString());
			StringWriter writerStringMailBody = new StringWriter();

			XslCompiledTransform xslTransformMailer = new XslCompiledTransform();

			XsltArgumentList xsltArgsMailer = new XsltArgumentList();
			StringReader readerStringMailer;
			*/

			//			message.To.Add(recipient);
			//			changeDoc.Save(Server.MapPath("~/logs/") + currUser.Username + "_pre_" + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.xml");

			changeNav.MoveToRoot();
			changeNav.MoveToChild("SAREroot", sareNamespace);

			while (changeNav.MoveToChild("SAREevent", sareNamespace))
			{
				int currentCore;
				DaikonUserCollection recipientsCollection;
				XmlDocument xmlSubDocToMail = new XmlDocument();
				System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
				System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
				System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);
				StringWriter writerStringMailBody = new StringWriter();

				XslCompiledTransform xslTransformMailer = new XslCompiledTransform();

				XsltArgumentList xsltArgsMailer = new XsltArgumentList();
				StringReader readerStringMailer;

				StringWriter writerStringTemp;
				XmlTextWriter xmlWriterTemp;

				writerStringTemp = new StringWriter();
				xmlWriterTemp = new XmlTextWriter(writerStringTemp);

				xmlWriterTemp.Formatting = Formatting.Indented;

				currentCore = Convert.ToInt32(changeNav.GetAttribute("coreID", sareNamespace));
				recipientsCollection = new DaikonUserCollection(currentCore, false);

				xsltArgsMailer.AddParam("mailtype", "", "submitevent");
				xslTransformMailer.Load(MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["mailerXslt"].ToString());

				xmlWriterTemp.WriteStartElement("SAREroot");
				currUser.toXML(xmlWriterTemp);
				string tempString = changeNav.OuterXml.ToString();
				xmlWriterTemp.WriteRaw(tempString);
				xmlWriterTemp.WriteRaw(staticVals.pStateInfo);
				xmlWriterTemp.WriteRaw(staticVals.pRegionInfo);
				xmlWriterTemp.WriteRaw(staticVals.pProjTypeInfo);
				xmlWriterTemp.WriteRaw(staticVals.pTextSectionInfo);
				xmlWriterTemp.WriteRaw(staticVals.pSubsectionTypeInfo);
				xmlWriterTemp.WriteRaw(staticVals.pUserRoleInfo);

				xmlWriterTemp.WriteEndElement();
				readerStringMailer = new StringReader(writerStringTemp.ToString());
				xmlSubDocToMail.RemoveAll();
				xmlSubDocToMail.Load(readerStringMailer);
				xmlWriterTemp.Flush();

				//				xmlSubDocToMail.Save(Server.MapPath("~/logs/") + currUser.Username + "_" + currentCore + "_" + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.xml");
				xslTransformMailer.Transform(xmlSubDocToMail, xsltArgsMailer, writerStringMailBody);
				/*
								System.IO.StreamWriter mailLog = new System.IO.StreamWriter(Server.MapPath("~/logs/") + currUser.Username + "_" + currentCore + "_" + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.txt");
								mailLog.Write(writerStringMailBody.ToString());
								mailLog.Flush();
								mailLog.Close();
				*/
				foreach (DaikonUser recipient in recipientsCollection.UserList.Values)
				{
					message.CC.Add(recipient.Email);
				}
				//message.CC.Add(ConfigurationManager.AppSettings["emailtestrecipient"].ToString());
				message.To.Add(currUser.Email);
				message.Subject = "MySARE: Event Added/Updated";

                message.Body = writerStringMailBody.ToString() + "\n\n-------------------------------------------------------------------------------" + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();
                //message.IsBodyHtml = true;

				System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

				try
				{
					mailClient.Send(message);
				}
				catch (System.Exception ex)
				{
					Session["statusMessage1"] = "Email could not be sent." + ex.Message;
				}
				//				Response.Write(writerStringMailBody.ToString());
				writerStringMailBody.Flush();
				changeNav.DeleteSelf();
				writerStringTemp.Close();
				xmlWriterTemp.Close();
			}
			changeNav.MoveToRoot();
			changeNav.MoveToChild("SAREroot", sareNamespace);

			while (changeNav.MoveToChild("SAREgrant", sareNamespace))
			{
				int currentCore;
                string projNumber;
				DaikonUserCollection recipientsCollection;
				XmlDocument xmlSubDocToMail = new XmlDocument();
				System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
				System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
				System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);
				StringWriter writerStringMailBody = new StringWriter();

				XslCompiledTransform xslTransformMailer = new XslCompiledTransform();

				XsltArgumentList xsltArgsMailer = new XsltArgumentList();
				StringReader readerStringMailer;

				StringWriter writerStringTemp;
				XmlTextWriter xmlWriterTemp;

				writerStringTemp = new StringWriter();
				xmlWriterTemp = new XmlTextWriter(writerStringTemp);

				xmlWriterTemp.Formatting = Formatting.Indented;

				currentCore = Convert.ToInt32(changeNav.GetAttribute("coreID", sareNamespace));
				recipientsCollection = new DaikonUserCollection(currentCore, false);

				xsltArgsMailer.AddParam("mailtype", "", "submitreport");
				xslTransformMailer.Load(MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["mailerXslt"].ToString());

				xmlWriterTemp.WriteStartElement("SAREroot");
				currUser.toXML(xmlWriterTemp);
				string tempString = changeNav.OuterXml.ToString();
				xmlWriterTemp.WriteRaw(tempString);
				xmlWriterTemp.WriteRaw(staticVals.pStateInfo);
				xmlWriterTemp.WriteRaw(staticVals.pRegionInfo);
				xmlWriterTemp.WriteRaw(staticVals.pProjTypeInfo);
				xmlWriterTemp.WriteRaw(staticVals.pTextSectionInfo);
				xmlWriterTemp.WriteRaw(staticVals.pSubsectionTypeInfo);
				xmlWriterTemp.WriteRaw(staticVals.pUserRoleInfo);
				xmlWriterTemp.WriteEndElement();
				readerStringMailer = new StringReader(writerStringTemp.ToString());
               
				xmlSubDocToMail.RemoveAll();
				xmlSubDocToMail.Load(readerStringMailer);
				xmlWriterTemp.Flush();

				//				xmlSubDocToMail.Save(Server.MapPath("~/logs/") + currUser.Username + "_" + currentCore + "_" + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.xml");
				xslTransformMailer.Transform(xmlSubDocToMail, xsltArgsMailer, writerStringMailBody);
				/*
								System.IO.StreamWriter mailLog = new System.IO.StreamWriter(Server.MapPath("~/logs/") + currUser.Username + "_" + currentCore + "_" + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.txt");
								mailLog.Write(writerStringMailBody.ToString());
								mailLog.Flush();
								mailLog.Close();
				*/
                projNumber = xmlSubDocToMail.DocumentElement.SelectSingleNode("SAREgrant").Attributes["projNum"].Value;
                // Commenting this so that it sends only to required persons
                /*
				foreach (DaikonUser recipient in recipientsCollection.UserList.Values)
				{
					message.CC.Add(recipient.Email);
				}
                */
				//message.CC.Add(ConfigurationManager.AppSettings["emailtestrecipient"].ToString());
                //message.CC.Add(RegionalAdminEmailListHandler(projNumber));
                //message.CC.Add("assoc_dir@sare.org, coordinator@sare.org");
				//message.CC.Add(currUser.Email);
               
                /*
                // NE region
                if (projNumber.Contains("LNE") || projNumber.Contains("lne"))
                    message.CC.Add("hhusher@sover.net");
                else if (projNumber.Contains("GNE") || projNumber.Contains("gne"))
                    message.CC.Add("hhusher@sover.net");
                else if (projNumber.Contains("FNE") || projNumber.Contains("fne"))
                    message.CC.Add("carol.delaney@uvm.edu");
                else if (projNumber.Contains("CNE") || projNumber.Contains("cne"))
                    message.CC.Add("carol.delaney@uvm.edu");
                else if (projNumber.Contains("ONE") || projNumber.Contains("one"))
                    message.CC.Add("carol.delaney@uvm.edu");
                else if (projNumber.Contains("ENE") || projNumber.Contains("ene"))
                    message.CC.Add("janet.mcallister@uconn.edu");

                // NC region
                else if (projNumber.Contains("LNC") || projNumber.Contains("lnc"))
                    message.CC.Add("mart1817@umn.edu, wilck001@umn.edu");
                else if (projNumber.Contains("GNC") || projNumber.Contains("gnc"))
                    message.CC.Add("mart1817@umn.edu, wilck001@umn.edu");
                else if (projNumber.Contains("FNC") || projNumber.Contains("fnc"))
                    message.CC.Add("jbenjamin2@unlnotes.unl.edu, mart1817@umn.edu, wilck001@umn.edu");
                else if (projNumber.Contains("YNC") || projNumber.Contains("ync"))
                    message.CC.Add("jbenjamin2@unlnotes.unl.edu, mart1817@umn.edu, wilck001@umn.edu");
                else if (projNumber.Contains("YENC") || projNumber.Contains("yenc"))
                    message.CC.Add("jbenjamin2@unlnotes.unl.edu, mart1817@umn.edu, wilck001@umn.edu");
                else if (projNumber.Contains("ENC") || projNumber.Contains("enc"))
                    message.CC.Add("lindakl@k-state.edu, mart1817@umn.edu, wilck001@umn.edu");

                // S region
                else if (projNumber.Contains("LS") || projNumber.Contains("ls"))
                    message.CC.Add("sueblum@uga.edu");
                else if (projNumber.Contains("FS") || projNumber.Contains("fs"))
                    message.CC.Add("sueblum@uga.edu");
                else if (projNumber.Contains("GS") || projNumber.Contains("gs"))
                    message.CC.Add("sueblum@uga.edu");
                else if (projNumber.Contains("OS") || projNumber.Contains("os"))
                    message.CC.Add("sueblum@uga.edu");
                else if (projNumber.Contains("CS") || projNumber.Contains("cs"))
                    message.CC.Add("sueblum@uga.edu");
                else if (projNumber.Contains("MS") || projNumber.Contains("ms"))
                    message.CC.Add("sueblum@uga.edu");
                else if (projNumber.Contains("ES") || projNumber.Contains("es"))
                    message.CC.Add("dredhage@kerrcenter.com");

                // W region
                else if (projNumber.Contains("SW") || projNumber.Contains("sw"))
                    message.CC.Add("kristi.jensen@usu.edu,rjdaines@msn.com, bobn@ext.usu.edu, philip.rasmussen@usu.edu, katejo@gmail.com");
                else if (projNumber.Contains("GW") || projNumber.Contains("gw"))
                    message.CC.Add("kristi.jensen@usu.edu,rjdaines@msn.com, bobn@ext.usu.edu, philip.rasmussen@usu.edu, katejo@gmail.com");
                else if (projNumber.Contains("FW") || projNumber.Contains("fw"))
                    message.CC.Add("kristi.jensen@usu.edu,rjdaines@msn.com, bobn@ext.usu.edu, philip.rasmussen@usu.edu, katejo@gmail.com");
                else if (projNumber.Contains("OW") || projNumber.Contains("ow"))
                    message.CC.Add("kristi.jensen@usu.edu,rjdaines@msn.com, bobn@ext.usu.edu, philip.rasmussen@usu.edu, katejo@gmail.com");
                else if (projNumber.Contains("EW") || projNumber.Contains("ew"))
                    message.CC.Add("alkurki@msn.com");
                */

                message.Subject = "MySARE: Project Added/Updated - " + projNumber;

				message.Body = writerStringMailBody.ToString() + "\n\n-------------------------------------------------------------------------------" + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

				System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

				try
				{
					mailClient.Send(message);
				}
				catch (System.Exception ex)
				{
					Session["statusMessage1"] = "Email could not be sent." + ex.Message;
				}
				//				Response.Write(writerStringMailBody.ToString());
				writerStringMailBody.Flush();
				changeNav.DeleteSelf();
				writerStringTemp.Close();
				xmlWriterTemp.Close();
			}

			changeNav.MoveToRoot();
			changeNav.MoveToChild("SAREroot", sareNamespace);

			while (changeNav.MoveToChild("changeduser", sareNamespace))
			{
				
				string changedusername;

                string userSQL;
                string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();
                SqlConnection userConnection;
                SqlCommand userCommand;
                SqlDataReader userDataReader;
                            

				DaikonUserCollection recipientsCollection = new DaikonUserCollection(0, 0, "");
				XmlDocument xmlSubDocToMail = new XmlDocument();
				System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
				System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
				System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);
				StringWriter writerStringMailBody = new StringWriter();

				XslCompiledTransform xslTransformMailer = new XslCompiledTransform();

				XsltArgumentList xsltArgsMailer = new XsltArgumentList();
				StringReader readerStringMailer;

				StringWriter writerStringTemp;
				XmlTextWriter xmlWriterTemp;

				writerStringTemp = new StringWriter();
				xmlWriterTemp = new XmlTextWriter(writerStringTemp);

				xmlWriterTemp.Formatting = Formatting.Indented;               
				

				xsltArgsMailer.AddParam("mailtype", "", "user");
				xslTransformMailer.Load(MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["mailerXslt"].ToString());

				xmlWriterTemp.WriteStartElement("SAREroot");
				currUser.toXML(xmlWriterTemp);
				string tempString = changeNav.OuterXml.ToString();
				xmlWriterTemp.WriteRaw(tempString);
				xmlWriterTemp.WriteRaw(staticVals.pStateInfo);
				xmlWriterTemp.WriteRaw(staticVals.pRegionInfo);
				xmlWriterTemp.WriteRaw(staticVals.pProjTypeInfo);
				xmlWriterTemp.WriteRaw(staticVals.pTextSectionInfo);
				xmlWriterTemp.WriteRaw(staticVals.pSubsectionTypeInfo);
				xmlWriterTemp.WriteRaw(staticVals.pUserRoleInfo);
				xmlWriterTemp.WriteEndElement();
				readerStringMailer = new StringReader(writerStringTemp.ToString());
				xmlSubDocToMail.RemoveAll();
				xmlSubDocToMail.Load(readerStringMailer);
				xmlWriterTemp.Flush();

				//				xmlSubDocToMail.Save(Server.MapPath("~/logs/") + currUser.Username + "_user_" + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.xml");
				xslTransformMailer.Transform(xmlSubDocToMail, xsltArgsMailer, writerStringMailBody);
				/*
								System.IO.StreamWriter mailLog = new System.IO.StreamWriter(Server.MapPath("~/logs/") + currUser.Username + "_user_" + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.txt");
								mailLog.Write(writerStringMailBody.ToString());
								mailLog.Flush();
								mailLog.Close();
				*/
				changedusername = xmlSubDocToMail.DocumentElement.SelectSingleNode("changeduser").Attributes["username"].Value;


                // We need to send email only when changed user is different from current user
                if (changedusername != currUser.Username)
                {

                    userConnection = new SqlConnection(userConnString);
                    userSQL = "DaikonUserGetRolesByUser";
                    userCommand = new SqlCommand(userSQL, userConnection);
                    userCommand.CommandType = CommandType.StoredProcedure;
                    userCommand.Parameters.Add("@user", SqlDbType.VarChar, 12);

                    userCommand.Parameters["@user"].Value = currUser.Username;

                    userConnection.Open();
                    userDataReader = userCommand.ExecuteReader();

                    while (userDataReader.Read())
                    {
                        if (userDataReader["userRole"].ToString() == "regAdmin")
                        {
                            recipientsCollection = new DaikonUserCollection(0, 0, userDataReader["forRegion"].ToString());
                        }
                    }

                    recipientsCollection.AddNewUser(new DaikonUser(changedusername));

                    foreach (DaikonUser recipient in recipientsCollection.UserList.Values)
                    {
                        if (changedusername == recipient.Username)
                            message.To.Add(recipient.Email);
                        else
                            message.CC.Add(recipient.Email);
                    }
                }
                else
                {
                    message.To.Add(currUser.Email);
                }
				//message.CC.Add(ConfigurationManager.AppSettings["emailtestrecipient"].ToString());
                //message.CC.Add("assoc_dir@sare.org, coordinator@sare.org");
				message.Subject = "MySARE: User Added/Updated";

				message.Body = writerStringMailBody.ToString() + "\n\n-------------------------------------------------------------------------------" + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

				System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

				try
				{
					mailClient.Send(message);
				}
				catch (System.Exception ex)
				{
					//Not actually being caught
					Session["statusMessage1"] = "Email could not be sent." + ex.Message;
				}

				//				Response.Write(writerStringMailBody.ToString());
				writerStringMailBody.Flush();
				changeNav.DeleteSelf();
				writerStringTemp.Close();
				xmlWriterTemp.Close();
			}

			changeNav.MoveToRoot();
			changeNav.MoveToChild("SAREroot", sareNamespace);

			while (changeNav.MoveToChild("SAREprofile", sareNamespace))
			{
			}

			//			changeDoc.Save(Server.MapPath("~/logs/") + currUser.Username + "_post_" + DateTime.Today.ToString("yyyy-MM-dd-hh-mm") + "_log.xml");

			// Response.Write("Mail should've been sent.");
		}
		/*
				public void sareGenMailerX(string recipient, XmlTextWriter mailXml, string mailtype)
				{
					System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsender"].ToString());
					StringWriter writerStringMailBody = new StringWriter();

					XslCompiledTransform xslTransformMailer = new XslCompiledTransform();

					XsltArgumentList xsltArgsMailer = new XsltArgumentList();
					StringReader readerStringMailer;
					XmlDocument xmlDocMailer = new XmlDocument();

					readerStringMailer = new StringReader(mailXml.ToString());
					xmlDocMailer.Load(readerStringMailer);

					xsltArgsMailer.AddParam("mailtype", "", mailtype);
					xslTransformMailer.Load(MapPath(Page.TemplateSourceDirectory) + ConfigurationManager.AppSettings["mailerXslt"].ToString());
					xslTransformMailer.Transform(xmlDocMailer, xsltArgsMailer, writerStringMailBody);

					message.To.Add(recipient);
					message.Subject = "MySARE Automated Email";

					message.Body = writerStringMailBody.ToString();

					System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

					mailClient.Send(message);
					// Response.Write("Mail should've been sent.");
				}
		*/
		public void sareMassMailer(DaikonUserCollection ccrecipients, DaikonUserCollection bccrecipients, string mailtitle, string mailtext)
		{
			System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
			System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
			System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);
//			StringWriter writerStringMailBody = new StringWriter();

			foreach (DaikonUser recipient in ccrecipients.UserList.Values)
			{
				message.CC.Add(recipient.Email);
			}
			foreach (DaikonUser recipient in bccrecipients.UserList.Values)
			{
				message.Bcc.Add(recipient.Email);
			}
			message.CC.Add(currUser.Email);

			message.Subject = "MySARE: " + mailtitle;

			//message.Body = mailtext;
			message.Body = mailtext + "\n\n-------------------------------------------------------------------------------" + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

			System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

			try
			{
				mailClient.Send(message);
			}
			catch (System.Exception ex)
			{
				//Not actually being caught
				Session["statusMessage1"] = "Email could not be sent." + ex.Message;
			}
			// Response.Write("Mail should've been sent.");
		}
		public void sareMassMailer(PackagedUserMessage packagedmessage)
		{
			System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
			System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
			System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);
			//			StringWriter writerStringMailBody = new StringWriter();

            string editedBccRecipients = "";

            if (Request.Params["boxDescription"] != null)
                editedBccRecipients = Request.Params["boxDescription"];

			foreach (DaikonUser recipient in packagedmessage.Recipients.UserList.Values)
			{
				message.CC.Add(recipient.Email);
			}
			foreach (DaikonUser recipient in packagedmessage.BccRecipients.UserList.Values)
			{
               if (editedBccRecipients.Contains(recipient.LastName))
                    message.Bcc.Add(recipient.Email);
			}
			message.CC.Add(currUser.Email);

			message.Subject = "MySARE: " + packagedmessage.Message.Subject;

//			message.Body = packagedmessage.Message.Message;
			message.Body = packagedmessage.Message.Message + "\n\n-------------------------------------------------------------------------------" + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

			System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

			try
			{
				mailClient.Send(message);
			}
			catch (System.Exception ex)
			{
				//Not actually being caught
				Session["statusMessage1"] = "Email could not be sent." + ex.Message;
			}
			// Response.Write("Mail should've been sent.");
		}

		public void projectCreateMailer(string recipient, string projnum, string claimcode, string region, bool AssignToPIs)
		{
			//JUST TEST CODE--this will be integrated into the regular mailer
			System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
			System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
			System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

			string msgBody = "";
            string mailMessage = "";

            if (recipient.Length == 0)
                recipient = currUser.Email;

            if (region.Length != 0)
            {
                string userSQL;
                string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();
                SqlConnection userConnection;
                SqlCommand userCommand;
                SqlDataReader userDataReader;

                DaikonUserCollection recipientsCollection = new DaikonUserCollection(currUser.Username, (int)Session["sessionkey"]); ;
                userConnection = new SqlConnection(userConnString);
                userSQL = "DaikonUserGetEmailRecipientsByRegion";
                userCommand = new SqlCommand(userSQL, userConnection);
                userCommand.CommandType = CommandType.StoredProcedure;
                userCommand.Parameters.Add("@region", SqlDbType.VarChar, 2);

                userCommand.Parameters["@region"].Value = region;

                userConnection.Open();
                userDataReader = userCommand.ExecuteReader();
                /*
                while (userDataReader.Read())
                {
                    if (userDataReader["userRole"].ToString() == "regAdmin")
                    {
                        string emailID = userDataReader["email"].ToString();
                        message.CC.Add(emailID);
                    }
                }
                */
                string emaillist = RegionalAdminEmailListHandler(projnum);
                if (emaillist.Length > 0)
                    message.CC.Add(emaillist);
            }
           
			message.To.Add(recipient);
			message.CC.Add(currUser.Email);
            //message.CC.Add("coordinator@sare.org, assoc_dir@sare.org");

            message.Subject = "MySARE: Add a project to your account - " + projnum.ToUpper();

            if (AssignToPIs)
            {
                mailMessage = "Dear MySARE User:\n\n";
                mailMessage += "You are receiving this message because a SARE administrator or project coordinator wants to give you access to the project reporting system for this project. ";
                mailMessage += "Please go to " + ConfigurationManager.AppSettings["website"].ToString() + "/MySare/login.aspx " + " to retrieve your project using the information below.\n\n";
                mailMessage += "If you have already registered for the MySARE system, you can use your existing username and password to retrieve and manage your new project. ";
                mailMessage += "If you a new user, you must register at " + ConfigurationManager.AppSettings["website"].ToString() + "/MySARE/newuser.aspx prior to retrieving your project.\n\n";
                mailMessage += "Once signed in to MySARE, find and click the Retrieve New Project link under My SARE-Funded Projects. Enter the project number then copy and paste the project code into the proper fields, then click the Retrieve Project button.\n\n";
               
                mailMessage += "\nProject Number: " + projnum.ToUpper() + "\nProject Code: " + claimcode + "\n\n";

                mailMessage += "This project code can only be used once to retrieve your project. You must use your username and password to access your project in the future.\n\nOnce you have retrieved the project, use the MySARE website to upload and submit the project overview, annual and final reports, and any resources developed as a part of your project to your regional administrator for approval.\n\n";
                mailMessage += "\n\n-------------------------------------------------------------------------------";
                mailMessage += "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

                message.Body = mailMessage;

            }
            else
            {
                msgBody = "Dear SARE Project Coordinator:\n\n";
                msgBody += "Your new SARE grant has been added to the SARE website. Please go to " + ConfigurationManager.AppSettings["website"].ToString() + " to retrieve your project. You must first register to use the system (click the <Register> button).\n";
                msgBody += "\nIf you have already registered for the MySARE system you may use your existing username and password for this new project. The MySARE reporting system is separate from the online application system. You must register for each system separately.\n";
                msgBody += "\nOnce signed onto the main page of your MySARE account click <Retrieve New Project>.\n";
                msgBody += "\nEnter the project number, and copy and paste the project code, then click the <Retrieve New Project> link.\n";
                msgBody += "\nProject Number: " + projnum.ToUpper() + "\nProject Code: " + claimcode;
                msgBody += "\n\nOnce you have retrieved the project, use MySARE to upload and submit the project overview, annual and final reports, and any resources developed as a part of your project to your regional administrator for approval.";
                msgBody += "\n\n-------------------------------------------------------------------------------";
                message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();
            }

			//message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

			try
			{
				mailClient.Send(message);
			}
			catch (System.Exception ex)
			{
				//Not actually being caught
				Session["statusMessage1"] = "Email could not be sent." + ex.Message;
			}
			// Response.Write("Mail should've been sent.");            
		}

        public void PDPCreateMailer(string recipient, string projnum, string claimcode, string region, bool AssignToPIs)
        {
            //JUST TEST CODE--this will be integrated into the regular mailer
            System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
            System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
            System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

            string msgBody = "";
            string mailMessage = "";

            if (recipient.Length == 0)
                recipient = currUser.Email;

            message.To.Add(recipient);
            message.CC.Add(currUser.Email);
            message.CC.Add("assoc_dir@sare.org, outreach@sare.org, akasala@ufl.edu");

            if (region.ToUpper() == "NC")
                message.CC.Add("myersrob@missouri.edu");
            if (region.ToUpper() == "W")
                message.CC.Add("freeburn@uwyo.edu, alkurki@msn.com");
            if (region.ToUpper() == "S")
                message.CC.Add("dredhage@kerrcenter.com");
            if (region.ToUpper() == "NE")
                message.CC.Add("Thomas.Morris@uconn.edu, janet.mcallister@uconn.edu");


            message.Subject = "MySARE: Add a State Report to your account - " + projnum.ToUpper();

            if (AssignToPIs)
            {
                mailMessage = "Dear MySARE User:\n\n";
                mailMessage += "You are receiving this message because a SARE administrator or project coordinator wants to give you access to the project reporting system for this project. ";
                mailMessage += "Please go to " + ConfigurationManager.AppSettings["website"].ToString() + " to retrieve your project using the information below.\n\n";
                mailMessage += "If you have already registered for the MySARE system, you can use your existing username and password to retrieve and manage your new state report. ";
                mailMessage += "If you a new user, you must register at " + ConfigurationManager.AppSettings["website"].ToString() + "/MySARE/newuser.aspx prior to retrieving your state report.\n\n";
                mailMessage += "Once signed in to MySARE, find and click the Retrieve New State Report link under My SARE-Funded Projects. Enter the project number then copy and paste the project code into the proper fields, then click the Retrieve State Report button.\n\n";

                mailMessage += "\nProject Number: " + projnum.ToUpper() + "\nProject Code: " + claimcode + "\n\n";

                mailMessage += "This project code can only be used once to retrieve your project. You must use your username and password to access your project in the future.\n\nOnce you have retrieved the project, use MySARE to upload and submit the general information, initiatives and partners, outcome narrative and any information products developed as a part of your project to your regional administrator for approval.\n\n";
                mailMessage += "\n\n-------------------------------------------------------------------------------";
                mailMessage += "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

                message.Body = mailMessage;

            }
            else
            {
                msgBody = "Dear State Coordinator:\n\n";
                msgBody += "Your new SARE grant has been added to the SARE website. Please go to " + ConfigurationManager.AppSettings["website"].ToString() + " to retrieve your project. You must first register to use the system (click the <Register> button).\n";
                msgBody += "\nIf you have already registered for the MySARE system you may use your existing username and password for this new project.\n";
                msgBody += "\nOnce signed onto the main page of your MySARE account click <Retrieve New State Report>.\n";
                msgBody += "\nEnter the project number, and copy and paste the project code, then click the <Retrieve State Report> link.\n";
                msgBody += "\nProject Number: " + projnum.ToUpper() + "\nProject Code: " + claimcode;
                msgBody += "\n\nOnce you have retrieved the project, use MySARE to upload and submit the general information, initiatives and partners, outcome narrative and any information products developed as a part of your project to your regional administrator for approval.";
                msgBody += "\n\n-------------------------------------------------------------------------------";
                message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();
            }

            //message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

            try
            {
                mailClient.Send(message);
            }
            catch (System.Exception ex)
            {
                //Not actually being caught
                Session["statusMessage1"] = "Email could not be sent." + ex.Message;
            }
            // Response.Write("Mail should've been sent.");            
        }

        public void PDPDetailsSubmitApproveMailer(string recipient, string projnum, string projtitle, string region, string action)
        {
            //JUST TEST CODE--this will be integrated into the regular mailer
            System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
            System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
            System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

            string msgBody = "";

            DaikonUserCollection projectPIs = new DaikonUserCollection(currUser.Grants[projnum].CoreID, true);
            foreach (DaikonUser pirecipient in projectPIs.UserList.Values)
            {
                if (action == "Submitted")
                    message.CC.Add(pirecipient.Email);
                else
                    message.To.Add(pirecipient.Email);
            }

            if (recipient.Length == 0)
                recipient = currUser.Email;


            if (action == "Submitted")
            {
                if (region.ToUpper() == "NC")
                    message.To.Add("myersrob@missouri.edu");
                if (region.ToUpper() == "W")
                    message.To.Add("freeburn@uwyo.edu, alkurki@msn.com");
                if (region.ToUpper() == "S")
                    message.To.Add("dredhage@kerrcenter.com");
                if (region.ToUpper() == "NE")
                    message.To.Add("janet.mcallister@uconn.edu");
            }
            else
            {
                if (region.ToUpper() == "NC")
                    message.CC.Add("myersrob@missouri.edu");
                if (region.ToUpper() == "W")
                    message.CC.Add("freeburn@uwyo.edu, alkurki@msn.com");
                if (region.ToUpper() == "S")
                    message.CC.Add("dredhage@kerrcenter.com");
                if (region.ToUpper() == "NE")
                    message.CC.Add("janet.mcallister@uconn.edu");
            }

            message.To.Add(recipient);
            message.CC.Add(currUser.Email);
            message.CC.Add("assoc_dir@sare.org, outreach@sare.org, akasala@ufl.edu");


            message.Subject = "MySARE: State Report " + action + " - " + projnum.ToUpper();

            msgBody = "Dear MySARE User:\n\n";

            if (action == "Submitted")
            {
                msgBody = "You are receiving this message because a state report for SARE project " + projnum.ToUpper() + " has been submitted for approval.\n\n";
            }
            else if (action == "Not Approved")
                msgBody = "You are receiving this message because an administrator has not approved a state report for SARE project " + projnum.ToUpper() + ".\n\n";
            else
                msgBody = "You are receiving this message because an administrator has approved a state report for SARE project " + projnum.ToUpper() + ".\n\n";

            msgBody += "\nProject Number: " + projnum.ToUpper() + "\nProject Title: " + projtitle + "\n\n";

            msgBody += ConfigurationManager.AppSettings["website"].ToString() + "/MySARE/sare_main.aspx?do=editPDP&pn=" + projnum + "\n\n";

            msgBody += "\n\nVisit " + ConfigurationManager.AppSettings["website"].ToString() + " to add or modify state reports.\n\n";

            msgBody += "\n\n-------------------------------------------------------------------------------";

            message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

            try
            {
                mailClient.Send(message);
            }
            catch (System.Exception ex)
            {
                //Not actually being caught
                Session["statusMessage1"] = "Email could not be sent." + ex.Message;
            }
            // Response.Write("Mail should've been sent.");            
        }


        public void projectDetailsSubmitApproveMailer(string recipient, string projnum, string projtitle, string region, string action)
        {
            //JUST TEST CODE--this will be integrated into the regular mailer
            System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
            System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
            System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

            string msgBody = "";

            DaikonUserCollection projectPIs = new DaikonUserCollection(currUser.Grants[projnum].CoreID, true);
            foreach (DaikonUser pirecipient in projectPIs.UserList.Values)
			{
                if (action == "Submitted")
                    message.CC.Add(pirecipient.Email);
                else
                    message.To.Add(pirecipient.Email);
			}

            if (recipient.Length == 0)
                recipient = currUser.Email;
            /*
            if (region.Length != 0)
            {
                string userSQL;
                string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();
                SqlConnection userConnection;
                SqlCommand userCommand;
                SqlDataReader userDataReader;

                DaikonUserCollection recipientsCollection = new DaikonUserCollection(currUser.Username, (int)Session["sessionkey"]); ;
                userConnection = new SqlConnection(userConnString);
                userSQL = "DaikonUserGetEmailRecipientsByRegion";
                userCommand = new SqlCommand(userSQL, userConnection);
                userCommand.CommandType = CommandType.StoredProcedure;
                userCommand.Parameters.Add("@region", SqlDbType.VarChar, 2);

                userCommand.Parameters["@region"].Value = region;

                userConnection.Open();
                userDataReader = userCommand.ExecuteReader();

                
                while (userDataReader.Read())
                {
                    if (userDataReader["userRole"].ToString() == "regAdmin")
                    {
                        string emailID = userDataReader["email"].ToString();
                        if (action == "Submitted")
                            message.To.Add(emailID);
                        else
                            message.CC.Add(emailID);
                    }
                }               
            
            }
            */

            if (action == "Submitted")
                message.To.Add(RegionalAdminEmailListHandler(projnum));
            else
                message.CC.Add(RegionalAdminEmailListHandler(projnum));

            message.To.Add(recipient);
            message.CC.Add(currUser.Email);
            //message.CC.Add("coordinator@sare.org, assoc_dir@sare.org");


            message.Subject = "MySARE: Project Overview " + action + " - " + projnum.ToUpper();

            msgBody = "Dear MySARE User:\n\n";

            if (action == "Submitted")
            {
                msgBody = "You are receiving this message because a project Overview for SARE project " + projnum.ToUpper() + " has been submitted for approval.\n\n";
            }
            else if (action == "Not Approved")
                msgBody = "You are receiving this message because an administrator has not approved a project Overview for SARE project " + projnum.ToUpper() + ".\n\n";
            else
                msgBody = "You are receiving this message because an administrator has approved a project Overview for SARE project " + projnum.ToUpper() + ".\n\n";

            msgBody += "\nProject Number: " + projnum.ToUpper() + "\nProject Title: " + projtitle + "\n\n";

            msgBody += ConfigurationManager.AppSettings["website"].ToString() + "/MySARE/sare_main.aspx?do=editproj&pn=" + projnum + "\n\n";

            msgBody += "\n\nVisit " + ConfigurationManager.AppSettings["website"].ToString() + " to add or modify project reports\n\n";

            msgBody += "\n\n-------------------------------------------------------------------------------";

            message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

            try
            {
                mailClient.Send(message);
            }
            catch (System.Exception ex)
            {
                //Not actually being caught
                Session["statusMessage1"] = "Email could not be sent." + ex.Message;
            }
            // Response.Write("Mail should've been sent.");            
        }

        public void ReportSubmitApproveMailer(string recipient, string projnum, int projtype, string projtitle, string region, string action)
        {
            //JUST TEST CODE--this will be integrated into the regular mailer
            System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
            System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
            System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

            string msgBody = "";
            string projectType = "";

            DaikonUserCollection projectPIs = new DaikonUserCollection(currUser.Grants[projnum].CoreID, true);
            foreach (DaikonUser pirecipient in projectPIs.UserList.Values)
            {
                if (action == "Submitted")
                {
                    if (currUser.Email != pirecipient.Email && recipient != pirecipient.Email)
                        message.CC.Add(pirecipient.Email);
                }
                else
                    message.To.Add(pirecipient.Email);
            }

            if (recipient.Length == 0)
                recipient = currUser.Email;
            /*
            if (region.Length != 0)
            {
                string userSQL;
                string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();
                SqlConnection userConnection;
                SqlCommand userCommand;
                SqlDataReader userDataReader;

                DaikonUserCollection recipientsCollection = new DaikonUserCollection(currUser.Username, (int)Session["sessionkey"]); ;
                userConnection = new SqlConnection(userConnString);
                userSQL = "DaikonUserGetEmailRecipientsByRegion";
                userCommand = new SqlCommand(userSQL, userConnection);
                userCommand.CommandType = CommandType.StoredProcedure;
                userCommand.Parameters.Add("@region", SqlDbType.VarChar, 2);

                userCommand.Parameters["@region"].Value = region;

                userConnection.Open();
                userDataReader = userCommand.ExecuteReader();

                while (userDataReader.Read())
                {
                    if (userDataReader["userRole"].ToString() == "regAdmin")
                    {
                        string emailID = userDataReader["email"].ToString();
                        if (action == "Submitted")
                            message.To.Add(emailID);
                        else
                            message.CC.Add(emailID);
                    }
                }
            }
            */

            if (action == "Submitted")
                message.To.Add(RegionalAdminEmailListHandler(projnum));
            else
                message.CC.Add(RegionalAdminEmailListHandler(projnum));

            message.To.Add(recipient);
            if (recipient != currUser.Email)
                message.CC.Add(currUser.Email);
            //message.CC.Add("coordinator@sare.org, assoc_dir@sare.org");

            if (projtype == 1)
                projectType = "Final Report";
            else
                projectType = "Annual Report";

            message.Subject = "MySARE: Project " + projectType + " " + action + " - " + projnum.ToUpper();

            msgBody = "Dear MySARE User:\n\n";

            if (action == "Submitted")
                msgBody += "You are receiving this message because a project " + projectType +" for SARE project " + projnum.ToUpper() + " has been submitted for approval. Submissions are subject to the approval for regional administrators.\n\n";
            else if (action == "Not Approved")
            {
                msgBody += "You are receiving this message because an administrator has not approved a project " + projectType + " for SARE project " +projnum.ToUpper() + ".\n\n";

                if (Request.Form["oHidden"] != null)
                {
                    string disapprovemsg = Request.Form["oHidden"];
                    msgBody += "\n\nReason for not approving : " + disapprovemsg + "\n\n";
                }
            }
            else
                msgBody += "You are receiving this message because an administrator has approved a project " + projectType + " for SARE project " + projnum.ToUpper() + ".\n\n";

            msgBody += "\nProject Number: " + projnum.ToUpper() + "\nProject Title: " + projtitle + "\n\n";

            msgBody += ConfigurationManager.AppSettings["website"].ToString() + "/MySARE/sare_main.aspx?do=editproj&pn=" + projnum + "\n\n";

            msgBody +="\n\nVisit " + ConfigurationManager.AppSettings["website"].ToString() + " to add or modify project reports\n\n";

            msgBody += "\n\n-------------------------------------------------------------------------------";

            message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

            try
            {
                mailClient.Send(message);
            }
            catch (System.Exception ex)
            {
                //Not actually being caught
                Session["statusMessage1"] = "Email could not be sent." + ex.Message;
            }
            // Response.Write("Mail should've been sent.");            
        }


        public void EventSubmitMailer(int coreID, string eventNumber, string eventTitle, string eventDesc, string user, string useremail, bool approval)
        {
            System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
            System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
            System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

            string msgBody = "";

            DaikonUserCollection recipientsCollection = new DaikonUserCollection(coreID, true);
            foreach (DaikonUser recipient in recipientsCollection.UserList.Values)
            {
                message.To.Add(recipient.Email);         
            }           
            
            if (approval)
            {
                message.CC.Add("info@sare.org");
                message.CC.Add("coordinator@sare.org, assoc_dir@sare.org, outreach@sare.org," + useremail);
                message.Subject = "MySARE: Calendar Event Approved";
                msgBody = "You are receiving this message because a calendar event has been approved by " + user + ".\n\n";

                msgBody += "Visit " + ConfigurationManager.AppSettings["website"].ToString() + " to administer this and other events.\n\n";
            }
            else
            {
                message.To.Add("info@sare.org");
                message.CC.Add("coordinator@sare.org, assoc_dir@sare.org, outreach@sare.org");
                message.Subject = "MySARE: Calendar Event Submitted";
                msgBody = "You are receiving this message because a calendar event has been submitted by " + user + ".\n\n";

                msgBody += "Please visit " + ConfigurationManager.AppSettings["website"].ToString() + " to administer this and other events.\n\n";
            }
            
            msgBody += "\nEvent Number: " + eventNumber + "\nEvent Title: " + eventTitle + "\nEvent Description: " + eventDesc;
            msgBody += "\n\n-------------------------------------------------------------------------------";

            message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            //message.IsBodyHtml = true;

            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

            try
            {
                mailClient.Send(message);
            }
            catch (System.Exception ex)
            {
                //Not actually being caught
                Session["statusMessage1"] = "Email could not be sent." + ex.Message;
            }
            // Response.Write("Mail should've been sent.");            
        }

        public void InfoProductSubmitApproveMailer(string recipient, string projnum, string projtitle, string region, string action)
        {
            System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
            System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
            System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

            string msgBody = "";
            
            DaikonUserCollection projectPIs = new DaikonUserCollection(currUser.Grants[projnum].CoreID, true);
            foreach (DaikonUser pirecipient in projectPIs.UserList.Values)
            {
                if (action == "Submitted")
                    message.CC.Add(pirecipient.Email);
                else
                    message.To.Add(pirecipient.Email);
            }
            
            if (recipient.Length == 0)
                recipient = currUser.Email;

            if (currUser.Grants[projnum].Type != 10)
            {
                if (action == "Submitted")
                    message.To.Add(RegionalAdminEmailListHandler(projnum));
                else
                    message.CC.Add(RegionalAdminEmailListHandler(projnum));
            }

            message.To.Add(recipient);
            message.CC.Add(currUser.Email);
            if (action == "Approved")
            {
                message.CC.Add("coordinator@sare.org");
                message.CC.Add("info@sare.org");
                if (projnum.Contains("S") || projnum.Contains("s"))
                    message.CC.Add("cpollock@uga.edu");
            }

            message.Subject = "MySARE: Project Information Product " + action + " - " + projnum.ToUpper();

            msgBody = "Dear MySARE User:\n\n";

            if (action == "Submitted")
                msgBody = "You are receiving this message because an information product for SARE project " + projnum.ToUpper() + " has been submitted for approval. Submissions are subject to the approval of regional administrators.\n\n";
            else if (action == "Not Approved")
            {
                msgBody = "You are receiving this message because an administrator has not approved an informaton product for a SARE project " + projnum.ToUpper() + ".\n\n";

                if (Request.Form["oHidden"] != null)
                {
                    string disapprovemsg = Request.Form["oHidden"];
                    msgBody += "\n\nReason for not approving : " + disapprovemsg + "\n\n";
                }
            }
            else
                msgBody = "You are receiving this message because an administrator has approved an information product for a SARE project " + projnum.ToUpper() + ".\n\n";

            msgBody += "\n\nProject Number: " + projnum.ToUpper() + "\n\nProject Title: " + currUser.Grants[projnum].projTitle + "\n";
            msgBody += "\n\nInformation Product Title: " + projtitle + "\n";
            msgBody += ConfigurationManager.AppSettings["website"].ToString() + "/MySARE/sare_main.aspx?do=editproj&pn=" + projnum + "\n\n";
            msgBody += "\n\nVisit " + ConfigurationManager.AppSettings["website"].ToString() + " to add or modify project reports.\n\n";
            msgBody += "\n\n-------------------------------------------------------------------------------";

            message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

            try
            {
                mailClient.Send(message);
            }
            catch (System.Exception ex)
            {
                //Not actually being caught
                Session["statusMessage1"] = "Email could not be sent." + ex.Message;
            }
            // Response.Write("Mail should've been sent.");            
        }


        public void DeleteMailer(string administrator, string userdeleted, string deletetype, string deleteTitle, string region)
        {

            System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
            System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
            System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

            string msgBody = "";

           
            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();
            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;

            DaikonUserCollection recipientsCollection = new DaikonUserCollection(currUser.Username, (int)Session["sessionkey"]); ;
            userConnection = new SqlConnection(userConnString);
            userSQL = "DaikonUserGetEmailRecipientsByRegion";
            userCommand = new SqlCommand(userSQL, userConnection);
            userCommand.CommandType = CommandType.StoredProcedure;
            userCommand.Parameters.Add("@region", SqlDbType.VarChar, 2);
            userCommand.Parameters["@region"].Value = region; //currUser.Region;

            userConnection.Open();
            userDataReader = userCommand.ExecuteReader();

            while (userDataReader.Read())
            {
                if (userDataReader["userRole"].ToString() == "regAdmin")
                {
                    string emailID = userDataReader["email"].ToString();
                    message.CC.Add(emailID);
                }
            }

            message.To.Add(userdeleted);
            if (deletetype == "Event")
                message.CC.Add("info@sare.org");
            message.CC.Add("coordinator@sare.org, assoc_dir@sare.org");

            if (deletetype == "User")
                message.Subject = "MySARE: " + deletetype + " has been deleted.";
            else
                message.Subject = "MySARE: " + deletetype + " is deleted.";

            if (deletetype == "Event")
                msgBody = "You are receiving this message because a calendar event has been deleted by " + administrator + ".\n\n";
            else if (deletetype == "User")
                msgBody = "You are receiving this message because a user has been deleted by " + administrator + ".\n\n";
            else
                msgBody = "You are receiving this message because a project has been deleted by " + administrator + ".\n\n";

            if (deletetype == "Event")
                msgBody += "Visit " + ConfigurationManager.AppSettings["website"].ToString() + "  to manage this and other events.\n\n";
            else if (deletetype == "User")
                msgBody += "Visit " + ConfigurationManager.AppSettings["website"].ToString() + "  to manage this and other users.\n\n";
            else
                msgBody += "Visit " + ConfigurationManager.AppSettings["website"].ToString() + "  to manage this and other projects.\n\n";

            msgBody += "\nDelete Type: " + deletetype + "\nDelete Title: " + deleteTitle;
            msgBody += "\n\n-------------------------------------------------------------------------------";

            message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

            try
            {
                mailClient.Send(message);
            }
            catch (System.Exception ex)
            {
                //Not actually being caught
                Session["statusMessage1"] = "Email could not be sent." + ex.Message;
            }

        }

        public void RemoveCoordinatorMailer(string recipient, string user,string projnum, string projtitle)
        {
            System.Net.Mail.MailAddress senderAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailsender"].ToString(), ConfigurationManager.AppSettings["emailsenderfriendly"].ToString());
            System.Net.Mail.MailAddress recipientAddress = new System.Net.Mail.MailAddress(ConfigurationManager.AppSettings["emailbaserecipient"].ToString(), ConfigurationManager.AppSettings["emailbaserecipientfriendly"].ToString());
            System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage(senderAddress, recipientAddress);

            string msgBody = "";

            message.To.Add(recipient);
            message.CC.Add("akasala@ufl.edu");
            message.Subject = "MySARE: Coordinator Removed - " + projnum.ToUpper();
            msgBody = "You are receiving this message because the admininstrator " + user + " has removed a project coordinator.\n\n";

            msgBody += "Project Number: " + projnum.ToUpper() + "\nProject Title: " + projtitle + "\n";
            msgBody += "\n\n-------------------------------------------------------------------------------";

            message.Body = msgBody + "\n\n" + ConfigurationManager.AppSettings["mailFooter"].ToString();

            
            System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient(ConfigurationManager.AppSettings["emailserver"].ToString(), 25);

            try
            {
                mailClient.Send(message);
            }
            catch (System.Exception ex)
            {
                //Not actually being caught
                Session["statusMessage1"] = "Email could not be sent." + ex.Message;
            }
                     
        }

		protected void FormHandler(object sender, System.EventArgs e)
		{
			thisPageURL.FormToQuery("Query");
			thisPageURL["q"] = thisPageURL["Query"];
			thisPageURL["Query"] = null;

			thisPageURL.FormToQuery("projType");

			if (Request.Form["projRegion"] != null)
			{
				thisPageURL.FormToQuery("projRegion");
				thisPageURL["region"] = thisPageURL["projRegion"];
				thisPageURL["projRegion"] = null;
			}
			else
			{
				thisPageURL.FormToQuery("region");
			}
			thisPageURL.FormToQuery("state");
			thisPageURL.FormToQuery("userRole");
			thisPageURL.FormToQuery("recent");
			thisPageURL.FormToQuery("sortby");

			/*
						if (thisPageURL["recent"] == null)
						{
							if (Request.Params.Get("recent") != null)
							{
								switch (Request.Params.Get("recent"))
								{
									case "on":
										thisPageURL["recent"] = "on";
										break;
									case "off":
										thisPageURL["recent"] = "off";
										break;
									default:
										thisPageURL["recent"] = "off";
										break;
								}
							}

							else { thisPageURL["recent"] = "off"; }
						}
			*/
			if (Request.Form["formID"] == "userSearch")
			{
				thisPageURL.FormToQuery("recent");
			}
			else
			{
				switch (Request.Params.Get("recent"))
				{
					case "on":
						thisPageURL["recent"] = "on";
						break;
					case "off":
						thisPageURL["recent"] = "off";
						break;
					default:
						thisPageURL["recent"] = "off";
						break;
				}
			}

			//            Response.Write(Request.Params.Get("recent"));
			Response.Redirect(thisPageURL.AbsoluteUri);
		}

		
		protected void MyProjXMLWriter()
		{
			DaikonGrantCollection userGrants = new DaikonGrantCollection();

			userGrants.populateByUsername(currUser.Username, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
            
            foreach (DaikonGrant tempGrant in userGrants.Values)
            {
                if (userGrants.Values.Count == 1)
                {
                    if (tempGrant.Type == 10)
                        Response.Redirect("sare_main.aspx?do=editPDP&pn=" + tempGrant.projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=editProj&pn=" + tempGrant.projNum);
                }
                else
                    tempGrant.toXml(ref xmlWriter);                  
            }       
		}

		protected void AdminProjXMLWriter()
		{
			DaikonGrantCollection userGrants = new DaikonGrantCollection();

			userGrants.populateByAdminAuth(currUser.Username, (int)Session["sessionkey"], ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());

			foreach (DaikonGrant tempGrant in userGrants.Values)
			{
				tempGrant.toXmlSummary(ref xmlWriter);
			}           

		}

        protected void AdminUnclaimedProjXMLWriter()
        {
            string projNumber = "";
            string region;

            if (currUser.Roles.GetRole("admin") != null)
                region = "%";
            else
                region = currUser.Region;

            DaikonGrantCollection userGrants = new DaikonGrantCollection();

            if (Request.Params != null && Request.Params["q"] != null)
                projNumber = Request.Params["q"].ToString();

            userGrants.populateByAdminUncliamedProjects(currUser.Username, (int)Session["sessionkey"], ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString(), region, projNumber);

            foreach (DaikonGrant tempGrant in userGrants.Values)
            {
                tempGrant.toXmlSummaryForNonReports(ref xmlWriter);
            }

        }

        protected void AdminNotSubmittedProjOverviewXMLWriter()
        {
            string region;

            if (currUser.Roles.GetRole("admin") != null)
                region = "%";
            else
                region = currUser.Region;

            DaikonGrantCollection userGrants = new DaikonGrantCollection();
            userGrants.populateByAdminProjectsOverviewNotSubmit(currUser.Username, (int)Session["sessionkey"], ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString(), region);

            foreach (DaikonGrant tempGrant in userGrants.Values)
            {
                tempGrant.toXmlSummaryForNonReports(ref xmlWriter);
            }
        }
       
        protected void AdminProjectsWithNoReportsXMLWriter()
        {
            string region;

            if (currUser.Roles.GetRole("admin") != null)
                region = "%";
            else
                region = currUser.Region;

            DaikonGrantCollection userGrants = new DaikonGrantCollection();
            userGrants.populateByAdminProjectsNoReports(currUser.Username, (int)Session["sessionkey"], ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString(), region);

            foreach (DaikonGrant tempGrant in userGrants.Values)
            {
                tempGrant.toXmlSummaryForNonReports(ref xmlWriter);
            }
        }

		protected void SearchProjXMLWriter()
		{
            string searchTerms = "";
            string searchRegion = "";
            string searchState = "";
            string searchmethod = "and";

            int searchProjType = 0;
			int thisPage;
			int resultsPerPage;
			int startRecord;
			int sortby = 1;

			bool orderDesc = true;

			thisPage = 1;
			resultsPerPage = Convert.ToInt32(ConfigurationManager.AppSettings["searchResultsPerPage"]);

			if (Request.Params.Get("page") != null)
			{
				thisPage = int.Parse(Request.Params.Get("page"));
			}
			startRecord = (resultsPerPage * (thisPage - 1) + 1);

//			searchTerms = "";

			/*
						if (Request.Params.Get("view") != null)
						{
							view = Request.Params.Get("view");
						}

						if (Request.Params.Get("q") != null)
						{
							searchTerms = Request.Params.Get("q");
						}
						if (Request.Params.Get("Query") != null)
						{
							searchTerms = Request.Params.Get("Query");
						}
			*/

            DaikonGrantCollection userGrants = new DaikonGrantCollection();
           // string test = Request.Form("searchmethod");
            if (thisPageURL["q"] != null)
            {
                searchTerms = thisPageURL["q"];
            }
			if (thisPageURL["region"] != null)
			{
				searchRegion = thisPageURL["region"];
			}
            if (thisPageURL["state"] != null)
            {
                searchState = thisPageURL["state"];
            }
			if (thisPageURL["projType"] != null)
			{
				searchProjType = Convert.ToInt16(thisPageURL["projType"]);
			}
			if (thisPageURL["sortby"] != null)
			{
				sortby = Convert.ToInt16(thisPageURL["sortby"]);
			}
            if (thisPageURL["amp;searchmethod"] != null)
            {
                searchmethod = thisPageURL["amp;searchmethod"];
            }
			if (sortby == 2)
				orderDesc = false;

			if (searchTerms != null)
			{
				//                    int thisPage = ((startRecord + resultsPerPage - 1) / resultsPerPage);
                userGrants.SearchSelection = searchmethod;
				userGrants.populateBySearch(searchTerms, searchRegion, searchState, searchProjType, sortby, orderDesc, resultsPerPage, thisPage, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString(), "admin");
                xsltArgs.AddParam("searchMode", "", "searchProj");
				xsltArgs.AddParam("startrecord", "", startRecord);
				xsltArgs.AddParam("maxrecords", "", userGrants.MaxRecord);
				xsltArgs.AddParam("resultsperpage", "", resultsPerPage);
				xsltArgs.AddParam("searchString", "", searchTerms);
				xsltArgs.AddParam("searchRegion", "", searchRegion);
                xsltArgs.AddParam("searchState", "", searchState);
				xsltArgs.AddParam("searchType", "", searchProjType);
				xsltArgs.AddParam("sortby", "", sortby);
                xsltArgs.AddParam("searchmethod", "", searchmethod);
			}

			foreach (DaikonGrant tempGrant in userGrants.Values)
			{
				tempGrant.toXml(ref xmlWriter);
			}

		}
		protected void SearchProfilesXMLWriter()
		{
			DaikonSearchProfile profile;
			if (null != Session["searchProfile"])
			{
				profile = (DaikonSearchProfile)(Session["searchProfile"]);

				
				string searchTerms;
                string searchmethod = "and";

				int thisPage;
				int resultsPerPage;
				int startRecord;
                int numChosenFields = 0;
                int sortby = 1;

                bool orderDesc = true;

				thisPage = 1;
				resultsPerPage = Convert.ToInt32(ConfigurationManager.AppSettings["searchResultsPerPage"]);

				if (Request.Params.Get("page") != null)
				{
					thisPage = int.Parse(Request.Params.Get("page"));
				}
				startRecord = (resultsPerPage * (thisPage - 1) + 1);

				searchTerms = "";

				/*
							if (Request.Params.Get("view") != null)
							{
								view = Request.Params.Get("view");
							}

							if (Request.Params.Get("q") != null)
							{
								searchTerms = Request.Params.Get("q");
							}
							if (Request.Params.Get("Query") != null)
							{
								searchTerms = Request.Params.Get("Query");
							}
				*/
				searchTerms = thisPageURL["q"];

				DaikonGrantCollection userGrants = new DaikonGrantCollection();

				string searchRegion = "";
                string searchState = "";
				int searchProjType = 0;

				if (thisPageURL["region"] != null)
				{
					searchRegion = thisPageURL["region"];
				}
                if (thisPageURL["state"] != null)
                {
                    searchState = thisPageURL["state"];
                }
				if (thisPageURL["projType"] != null)
				{
					searchProjType = Convert.ToInt16(thisPageURL["projType"]);
				}
                if (thisPageURL["sortby"] != null)
                {
                    sortby = Convert.ToInt16(thisPageURL["sortby"]);
                }
                if (thisPageURL["amp;searchmethod"] != null)
                {
                    searchmethod = thisPageURL["amp;searchmethod"];
                }
                if (sortby == 2)
                    orderDesc = false;

                switch (searchmethod)
                {
                    case "and":
                        numChosenFields = profile.countTerms();
                        break;
                    case "or":
                        numChosenFields = 0;
                        break;
                    default:
                        numChosenFields = 0;
                        break;
                }


				if (true)
				{
					//                    int thisPage = ((startRecord + resultsPerPage - 1) / resultsPerPage);
                    userGrants.populateByProfileSearch(searchTerms, searchRegion, searchState, searchProjType, numChosenFields, orderDesc, orderDesc, resultsPerPage, thisPage, profile, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
					xsltArgs.AddParam("searchMode", "", "searchprojprofile");
					xsltArgs.AddParam("startrecord", "", startRecord);
					xsltArgs.AddParam("maxrecords", "", userGrants.MaxRecord);
					xsltArgs.AddParam("resultsperpage", "", resultsPerPage);
					xsltArgs.AddParam("searchString", "", MNS(searchTerms));
					xsltArgs.AddParam("searchRegion", "", searchRegion);
                    xsltArgs.AddParam("searchState", "", searchState);
					xsltArgs.AddParam("searchType", "", searchProjType);
                    xsltArgs.AddParam("searchAndOr", "", searchmethod);
				}

				foreach (DaikonGrant tempGrant in userGrants.Values)
				{
					tempGrant.toXml(ref xmlWriter);
				}
			}

		}

        protected void SearchCoordReports()
        {

            string searchTerms = "";

            int thisPage = 1;
            int resultsPerPage;
            int startRecord;
            
            DaikonGrantCollection userGrants = new DaikonGrantCollection();


            resultsPerPage = Convert.ToInt32(ConfigurationManager.AppSettings["searchResultsPerPage"]);

            if (Request.Params.Get("page") != null)
            {
                thisPage = int.Parse(Request.Params.Get("page"));
            }

            startRecord = (resultsPerPage * (thisPage - 1) + 1);

            if (thisPageURL["q"] != null)
            {
                searchTerms = thisPageURL["q"];
            }

            if (searchTerms != null && searchTerms.Length != 0)
            {
                searchTerms = searchTerms.Replace('"', ' ');
                userGrants.populateByCoordinateNameSearch(searchTerms, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
                xsltArgs.AddParam("searchMode", "", "searchcoord");
                xsltArgs.AddParam("startrecord", "", startRecord);
                xsltArgs.AddParam("maxrecords", "", userGrants.MaxRecord);
                xsltArgs.AddParam("resultsperpage", "", resultsPerPage);
                xsltArgs.AddParam("searchString", "", searchTerms);
            }

            foreach (DaikonGrant tempGrant in userGrants.Values)
            {
                tempGrant.toXml(ref xmlWriter);
            }


        }

		protected void GrantXMLWriter()
		{
			string view;
			string searchTerms;

			int thisPage;
			int resultsPerPage;
			int startRecord;

			thisPage = 1;
			resultsPerPage = 20;

			if (Request.Params.Get("page") != null)
			{
				thisPage = int.Parse(Request.Params.Get("page"));
			}
			startRecord = (resultsPerPage * (thisPage - 1) + 1);

			view = "default";
			searchTerms = "";

			/*
						if (Request.Params.Get("view") != null)
						{
							view = Request.Params.Get("view");
						}

						if (Request.Params.Get("q") != null)
						{
							searchTerms = Request.Params.Get("q");
						}
						if (Request.Params.Get("Query") != null)
						{
							searchTerms = Request.Params.Get("Query");
						}
			*/
			view = thisPageURL["view"];
			searchTerms = thisPageURL["q"];

			DaikonGrantCollection userGrants = new DaikonGrantCollection();
			if (view == "admin")
			{
				userGrants.populateByAdminAuth(currUser.Username, (int)Session["sessionkey"], ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
				xslTemplate = ConfigurationManager.AppSettings["projectlistXslt"].ToString();
			}
			else if (view == "search")
			{
				string searchRegion = "";
				int searchProjType = 0;

				if (thisPageURL["region"] != null)
				{
					searchRegion = thisPageURL["region"];
				}
				if (thisPageURL["projType"] != null)
				{
					searchProjType = Convert.ToInt16(thisPageURL["projType"]);
				}

				if (searchTerms != null)
				{
					//                    int thisPage = ((startRecord + resultsPerPage - 1) / resultsPerPage);
					userGrants.populateBySearch(searchTerms, searchRegion, "", searchProjType, 0, true, resultsPerPage, thisPage, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString(), "admin");
					xsltArgs.AddParam("startrecord", "", startRecord);
					xsltArgs.AddParam("maxrecords", "", userGrants.MaxRecord);
					xsltArgs.AddParam("resultsperpage", "", resultsPerPage);
					xsltArgs.AddParam("searchString", "", searchTerms);
					xsltArgs.AddParam("searchRegion", "", searchRegion);
					xsltArgs.AddParam("searchType", "", searchProjType);
				}
				xslTemplate = ConfigurationManager.AppSettings["projectsearchXslt"].ToString();
			}
			else
			{
				userGrants.populateByUsername(currUser.Username, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
				xslTemplate = ConfigurationManager.AppSettings["projectlistXslt"].ToString();
			}

			foreach (DaikonGrant tempGrant in userGrants.Values)
			{
				tempGrant.toXml(ref xmlWriter);
			}

		}

		protected void UserListXMLWriter()
		{
			int thisPage;
			int resultsPerPage;
			int startRecord;
			string searchRole;
			string searchTerms;
			string searchRegion;
			string searchState;
			bool searchRecent;

			thisPage = 1;
			resultsPerPage = 20;

			if (Request.Params.Get("page") != null)
			{
				thisPage = int.Parse(Request.Params.Get("page"));
			}
			startRecord = (resultsPerPage * (thisPage - 1) + 1);

			DaikonUserCollection searchDUC;

			if (Request.Params.Get("region") != null)
			{
				searchRegion = Request.Params.Get("region");
			}
			else if (thisPageURL["region"] != null)
			{
				searchRegion = thisPageURL["region"];
			}
			else
			{
				searchRegion = "";
			}

			if (Request.Params.Get("state") != null)
			{
				searchState = Request.Params.Get("state");
			}
			else if (thisPageURL["state"] != null)
			{
				searchState = thisPageURL["state"];
			}
			else
			{
				searchState = "";
			}

			if (Request.Params.Get("userRole") != null)
			{
				searchRole = Request.Params.Get("userRole");
			}
			else if (thisPageURL["userRole"] != null)
			{
				searchRole = thisPageURL["userRole"];
			}
			else
			{
				searchRole = "";
			}
			//*****

			if (Request.Form["formID"] == "userSearch")
			{
				thisPageURL.FormToQuery("recent");
			}
			else
			{
				switch (Request.Params.Get("recent"))
				{
					case "on":
						thisPageURL["recent"] = "on";
						break;
					case "off":
						thisPageURL["recent"] = "off";
						break;
					default:
						thisPageURL["recent"] = "off";
						break;
				}
			}

			switch (thisPageURL["recent"])
			{
				case null:
					searchRecent = false;
					break;
				case "on":
					searchRecent = true;
					break;
				case "off":
					searchRecent = false;
					break;
				default:
					searchRecent = false;
					break;
			}
			/*
			thisPageURL.FormToQuery("recent");

			if (thisPageURL["recent"] == null)
			{
				if (Request.Params.Get("recent") != null)
				{
					switch (Request.Params.Get("recent"))
					{
						case "on":
							thisPageURL["recent"] = "on";
							break;
						case "off":
							thisPageURL["recent"] = "off";
							break;
						default:
							thisPageURL["recent"] = "off";
							break;
					}
				}

				else { thisPageURL["recent"] = "off"; }
			}

			switch (thisPageURL["recent"])
			{
				case null:
					searchRecent = false;
					break;
				case "on":
					searchRecent = true;
					break;
				case "off":
					searchRecent = false;
					break;
				default:
					searchRecent = false;
					break;
			}
*/
			//*****
			/*
						if (Request.Params.Get("recent") != null)
						{
							switch (Request.Params.Get("recent"))
							{
								case "on":
									searchRecent = true;
									break;
								case "off":
									searchRecent = false;
									break;
								default:
									searchRecent = false;
									break;
							}
						}
						else if (thisPageURL["userRole"] != null)
						{
							switch (thisPageURL["recent"])
							{
								case "on":
									searchRecent = true;
									break;
								case "off":
									searchRecent = false;
									break;
								default:
									searchRecent = false;
									break;
							}
						}
						else
						{
							searchRecent = false;
						}
			*/
			if (Request.Params.Get("Query") != null)
			{
				searchTerms = Request.Params.Get("Query");
			}
			else if (thisPageURL["q"] != null)
			{
				searchTerms = thisPageURL["q"];
			}
			else
			{
				searchTerms = "";
			}

			searchDUC = new DaikonUserCollection(currUser.Username, (int)Session["sessionkey"], searchTerms, searchRole, searchRegion, searchState, searchRecent);
			//            searchDUC = new DaikonUserCollection(currUser.Username, (int)Session["sessionkey"]);

			searchDUC.toXML(xmlWriter, "searchresult");

			string searchAsString = searchRecent.ToString();

			xsltArgs.AddParam("startrecord", "", startRecord);
			xsltArgs.AddParam("thispage", "", thisPage);
			xsltArgs.AddParam("resultsperpage", "", resultsPerPage);
			xsltArgs.AddParam("searchString", "", searchTerms);
			xsltArgs.AddParam("searchRole", "", searchRole);
			xsltArgs.AddParam("searchRegion", "", searchRegion);
			xsltArgs.AddParam("searchState", "", searchState);
			xsltArgs.AddParam("searchRecent", "", searchAsString);
		}

		protected void ProjectEditorXMLWriter()
		{
			String thisGrant = Request.Params.Get("pn");
			DaikonParticipantCollection grantParticipants = new DaikonParticipantCollection(thisGrant, false);
			DaikonParticipantCollection grantNonuserCoords = new DaikonParticipantCollection(thisGrant, true);
			DaikonGrant grantRow = new DaikonGrant(thisGrant, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
			DaikonUserCollection grantPIs = new DaikonUserCollection(grantRow.CoreID, true);

            daikonProdInfo.ProductInfo prodInfoRow = new daikonProdInfo.ProductInfo(thisGrant);

			Session.Remove("editparticipant");

            if (currUser.Grants == null)
            {
                currUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
            }

            if (currUser.Grants.ContainsKey(thisGrant))
			{
				currUser.Grants[thisGrant].toXml(ref xmlWriter);
				grantPIs.toXML(xmlWriter, "projectpis");
				grantNonuserCoords.toXML(xmlWriter, "projectpis");
				grantParticipants.toXML(xmlWriter, "projectparticipants");
                if (grantParticipants.UserList.Count > 0)
                    Session["projectParticipants"] = "true";
                prodInfoRow.toXml(xmlWriter);

			}
			else if (grantRow.HasGrantRow)
			{
				currUser.Grants.Add(thisGrant, grantRow);
				currUser.Grants[thisGrant].toXml(ref xmlWriter);
				grantPIs.toXML(xmlWriter, "projectpis");
				grantNonuserCoords.toXML(xmlWriter, "projectpis");
				grantParticipants.toXML(xmlWriter, "projectparticipants");
                if (grantParticipants.UserList.Count > 0)
                    Session["projectParticipants"] = "true";
                prodInfoRow.toXml(xmlWriter);
			}
			else
			{
				Session["statusMessage1"] = "Project Number and(or) Code do not match.";
				Response.Redirect("sare_main.aspx?do=claimproj");
				return;
			}

			Session.Remove("currReport");
			Session["currGrant"] = thisGrant;
			Session["currProfile"] = currUser.Grants[thisGrant].Profile;
		}

		protected void PICallHandler(object sender, EventArgs e)
		{
			DaikonUser currUser, targetUser;
			currUser = (DaikonUser)(Session["currUser"]);

			DaikonUserCollection callRecipients;
			DaikonUserCollection msgCcRecipients = new DaikonUserCollection();

			string[] targetemailset;
			string searchRegion = "%";
			string searchProjType = "%";
            int reportStatus = 1;
			int searchStartYear = 0;
			int searchEndYear = 10000;
			string callTextTitle = "";
			string callSubject = "";
			string callText = "";

			if (Request.Params["region"] != null)
			{
				searchRegion = Request.Params["region"];
			}
			if (Request.Params["projType"] != null)
			{
				searchProjType = Request.Params["projType"];
			}
            if (Request.Params["reportStatus"] != null)
            {
                reportStatus = int.Parse(Request.Params["reportStatus"]);
            }
			if (Request.Params["startYear"] != null)
			{
				searchStartYear = int.Parse(Request.Params["startYear"]);
			}
			if (Request.Params["endYear"] != null)
			{
				searchEndYear = int.Parse(Request.Params["endYear"]);
			}
			if ((Request.Params["callmsg"] != null) && (Request.Params["callmsg"].Trim() != string.Empty))
			{
				if ((Request.Params["msgtitle"] != null) && (Request.Params["msgtitle"].Trim() != string.Empty))
				{
					callTextTitle = Request.Params["msgtitle"].Trim();
				}
				if ((Request.Params["msgsubject"] != null) && (Request.Params["msgsubject"].Trim() != string.Empty))
				{
					callSubject = Request.Params["msgsubject"].Trim();
				}
				callText = Request.Params["callmsg"].Trim();

                callRecipients = new DaikonUserCollection(searchProjType, searchRegion, reportStatus, searchStartYear, searchEndYear);

				if (Request.Params["cclist"] != null)
				{
					targetemailset = Request.Params["cclist"].Split(',');
					foreach (string targetemail in targetemailset)
					{
						targetemail.Trim();
						if (IsValidEmailAddress(targetemail))
						{
							targetUser = new DaikonUser("", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", targetemail, "", false);
							msgCcRecipients.AddNewUser(targetUser);
						}
					}
				}
				if (Request.Params["bcclist"] != null)
				{
					targetemailset = Request.Params["bcclist"].Split(',');
					foreach (string targetemail in targetemailset)
					{
						targetemail.Trim();
						if (IsValidEmailAddress(targetemail))
						{
							targetUser = new DaikonUser("", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", targetemail, "", false);
							callRecipients.AddNewUser(targetUser);
						}
					}
				}
				foreach (string targetadmin in ConfigurationManager.AppSettings["emailadmins"].ToString().Split(','))
				{
					targetadmin.Trim();
					targetUser = new DaikonUser(targetadmin);
					msgCcRecipients.AddNewUser(targetUser);
				}

				PackagedUserMessage thisMessage = new PackagedUserMessage(new UserMessage("genUser", true, callTextTitle, callSubject, callText), msgCcRecipients, callRecipients);

				thisMessage.toXML(xmlWriter);

				Session["queuedmessage"] = thisMessage;
				Session["confirmthis"] = writerString.ToString();

//				sareMassMailer(msgCcRecipients, callRecipients, callSubject, callText);
			}

		}
		protected void SendMessageHandler(object sender, EventArgs e)
		{
			DaikonUser currUser;
			currUser = (DaikonUser)(Session["currUser"]);

			DaikonUserCollection msgBccRecipients;
			DaikonUserCollection msgCcRecipients = new DaikonUserCollection();

			string[] targetusernameset;
			string[] targetemailset;
			string callTextTitle = "";
			string callSubject = "";
			string callText = "";
			DaikonUser targetUser;

			if (Session["targetuserset"] != null)
			{
				msgBccRecipients = (DaikonUserCollection)(Session["targetuserset"]);
			}
			else
			{
				msgBccRecipients = new DaikonUserCollection();
			}

			if (Request.Params["admins"] != null)
			{
				targetusernameset = Request.Params["admins"].Split(',');
				foreach (string targetusername in targetusernameset)
				{
					targetusername.Trim();
					targetUser = new DaikonUser(targetusername);
					msgCcRecipients.AddNewUser(targetUser);
				}
			}
			if (Request.Params["cclist"] != null)
			{
				targetemailset = Request.Params["cclist"].Split(',');
				foreach (string targetemail in targetemailset)
				{
					targetemail.Trim();
					if (IsValidEmailAddress(targetemail))
					{
						targetUser = new DaikonUser("", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", targetemail, "", false);
						msgCcRecipients.AddNewUser(targetUser);
					}
				}
			}
			if (Request.Params["bcclist"] != null)
			{
				targetemailset = Request.Params["bcclist"].Split(',');
				foreach (string targetemail in targetemailset)
				{
					targetemail.Trim();
					if (IsValidEmailAddress(targetemail))
					{
						targetUser = new DaikonUser("", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", targetemail, "", false);
						msgBccRecipients.AddNewUser(targetUser);
					}
				}
			}
			foreach (string targetadmin in ConfigurationManager.AppSettings["emailadmins"].ToString().Split(','))
			{
				targetadmin.Trim();
				targetUser = new DaikonUser(targetadmin);
				msgCcRecipients.AddNewUser(targetUser);
			}

			if ((Request.Params["callmsg"] != null) && (Request.Params["callmsg"].Trim() != string.Empty))
			{
				if ((Request.Params["msgtitle"] != null) && (Request.Params["msgtitle"].Trim() != string.Empty))
				{
					callTextTitle = Request.Params["msgtitle"].Trim();
				}
				if ((Request.Params["msgsubject"] != null) && (Request.Params["msgsubject"].Trim() != string.Empty))
				{
					callSubject = Request.Params["msgsubject"].Trim();
				}
				callText = Request.Params["callmsg"].Trim();

				//				sareMassMailer(callRecipients, callSubject, callText);

				PackagedUserMessage thisMessage = new PackagedUserMessage(new UserMessage("genUser", true, callTextTitle, callSubject, callText), msgCcRecipients, msgBccRecipients);

				thisMessage.toXML(xmlWriter);

				Session["queuedmessage"] = thisMessage;
				Session["confirmthis"] = writerString.ToString();
			}

		}
		protected void SavePICallHandler(object sender, EventArgs e)
		{
			DaikonUser currUser;
			currUser = (DaikonUser)(Session["currUser"]);
			int msgID;
			UserMessage thisMessage;
			UserMessages messageSet = new UserMessages(currUser.Username, (int)(Session["sessionKey"]));

			string callTextTitle = "";
			string callSubject = "";
			string callText = "";


			if ((Request.Params["callmsg"] != null) && (Request.Params["callmsg"].Trim() != string.Empty))
			{
				callText = Request.Params["callmsg"].Trim();
				if ((Request.Params["msgtitle"] != null) && (Request.Params["msgtitle"].Trim() != string.Empty))
				{
					callTextTitle = Request.Params["msgtitle"].Trim();
				}
				if ((Request.Params["msgsubject"] != null) && (Request.Params["msgsubject"].Trim() != string.Empty))
				{
					callSubject = Request.Params["msgsubject"].Trim();
				}

				if ((Request.Form["msgID"] != null) && (Request.Form["msgID"] != ""))
				{
					msgID = int.Parse(Request.Form["msgID"]);
					if (messageSet.HasMessage(msgID))
					{
						messageSet.GetMessage(msgID).Message = callText;
						messageSet.GetMessage(msgID).Title = callTextTitle;
						messageSet.GetMessage(msgID).Subject = callSubject;

						messageSet.GetMessage(msgID).SaveToDB(currUser.Username, (int)(Session["sessionKey"]));
					}
					else if (msgID == 0)
					{
						thisMessage = new UserMessage("genUser", true, callTextTitle, callSubject, callText);
						thisMessage.SaveToDB(currUser.Username, (int)(Session["sessionKey"]));
					}

					else
					{
					}
					//					Response.Redirect("?do=sendpicall&msg=" + msgID.ToString(), true);
				}
				else
				{
					thisMessage = new UserMessage("genUser", true, callTextTitle, callSubject, callText);
					thisMessage.SaveToDB(currUser.Username, (int)(Session["sessionKey"]));
				}
			}
		}

		protected void AssignClaimSubmissionHandler(object sender, EventArgs e)
		{
			DaikonUser currUser;
			currUser = (DaikonUser)(Session["currUser"]);
            string thisGrant = "";

            if (Request.Params.Get("pn") != null && Request.Params.Get("pn") != "")
                thisGrant = Request.Params.Get("pn");

            DaikonGrant projectToSave;
            if (currUser.Grants == null)
            {
                currUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
            }

            if (currUser.Grants.ContainsKey(thisGrant))
            {
                projectToSave = currUser.Grants[(string)(Session["currGrant"])];
            }
            else
            {
                currUser.Grants.Add(thisGrant, new DaikonGrant(thisGrant, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString()));
                projectToSave = currUser.Grants[(string)(Session["currGrant"])];
            }

			string claimKey;
			claimKey = projectToSave.AssignClaimKey(currUser.Username, (int)(Session["sessionKey"]), ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());

			string recipient;
			recipient = Request.Params["claimRecipient"];
            if (recipient == "")
            {
                Session["statusMessage1"] = "Please Enter Email Address.";
                return;
            }
            else if (!IsValidEmailAddress(recipient))
            {
                Session["statusMessage1"] = "Please Enter Correctly Formatted Email Address.";
                //Session.Remove("statusMessage1");
                return;
            }
            else if (projectToSave.Type == 10)
                PDPCreateMailer(recipient, projectToSave.projNum, claimKey, "", true);
            else
				projectCreateMailer(recipient, projectToSave.projNum, claimKey, "", true);

            Session["statusMessage2"] = "A project access code has been emailed to " + recipient;
            Response.Redirect("sare_main.aspx?do=confirm&confirmType=update");

		}

        protected void MassClaimMailer(object sender, EventArgs e)
        {
            string recipients = "";
            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();
            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;

            userConnection = new SqlConnection(userConnString);

            userSQL = "DaikonNonusercontactMailCoords";
            userCommand = new SqlCommand(userSQL, userConnection);
            userCommand.CommandType = CommandType.StoredProcedure;
            

            userConnection.Open();
            userDataReader = userCommand.ExecuteReader();

            while (userDataReader.Read())
            {
                string claimKey = userDataReader["claimKey"].ToString(); ;
                string recipient = userDataReader["email"].ToString();
                string projectNum = userDataReader["proj_num"].ToString();

                projectCreateMailer(recipient, projectNum, claimKey, "", true);

                if (recipients.Length == 0)
                    recipients = recipient;
                else
                    recipients = recipients + ", " + recipient;
                
            }

            if (recipients.Length > 0)
            {
                Session["statusMessage2"] = "A project access code has been emailed to " + recipients;
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=update");
            }

            userConnection.Dispose();

        }

		protected void projectSubmissionHandler(object sender, EventArgs e)
		{
			DaikonUser currUser;
			currUser = (DaikonUser)(Session["currUser"]);
			changeNav.MoveToRoot();
			changeNav.MoveToChild("SAREroot", sareNamespace);
			//            changeNav.MoveToChild("projects", "");
            string thisGrant = "";
            string fieldsMissingMsg = "";
            string TitleFlag = "";
            string FundsFlag = "";
            string stateFlag = "";

            if (Request.Params.Get("pn") != null && Request.Params.Get("pn") != "")
                thisGrant = Request.Params.Get("pn");

			DaikonGrant projectToSave;
            if (currUser.Grants == null)
            {
                currUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
            }

            if (currUser.Grants.ContainsKey(thisGrant))
            {
                projectToSave = currUser.Grants[(string)(Session["currGrant"])];
            }
            else
            {
                currUser.Grants.Add(thisGrant, new DaikonGrant(thisGrant, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString()));
                projectToSave = currUser.Grants[(string)(Session["currGrant"])];
            }

			while (changeNav.MoveToChild("SAREgrant", sareNamespace))
			{
				if (projectToSave.projNum.ToString() == changeNav.GetAttribute("projNum", sareNamespace))
					break;
			}
			if (projectToSave.projNum.ToString() != changeNav.GetAttribute("projNum", sareNamespace))
			{
				if (changeNav.LocalName == "SAREgrant")
					changeNav.MoveToParent();
				changeNav.PrependChildElement("", "SAREgrant", sareNamespace, "");
				changeNav.MoveToChild("SAREgrant", sareNamespace);
				changeNav.CreateAttribute("", "projNum", sareNamespace, projectToSave.projNum.ToString());
				changeNav.CreateAttribute("", "coreID", sareNamespace, projectToSave.CoreID.ToString());
				changeNav.CreateAttribute("", "title", sareNamespace, projectToSave.projTitle.ToString());
			}

			if (projectToSave.projTitle != Request.Params["projectTitle"])
			{
				changeNav.PrependChildElement("", "change", sareNamespace, "Project Title");
				changeNav.MoveToFirstChild();
				changeNav.CreateAttribute("", "type", sareNamespace, "Update");
				changeNav.CreateAttribute("", "previousval", sareNamespace, projectToSave.projTitle);
				changeNav.CreateAttribute("", "currentval", sareNamespace, Request.Params["projectTitle"]);
				changeNav.MoveToParent();
				projectToSave.projTitle = Request.Params["projectTitle"];
			}

            if (projectToSave.fundsSare != MND(Request.Params["fundsSARE"]))
			{
				changeNav.PrependChildElement("", "change", sareNamespace, "SARE Funding");
				changeNav.MoveToFirstChild();
				changeNav.CreateAttribute("", "type", sareNamespace, "Update");
				changeNav.CreateAttribute("", "previousval", sareNamespace, projectToSave.fundsSare.ToString());
				changeNav.CreateAttribute("", "currentval", sareNamespace, MND(Request.Params["fundsSARE"]).ToString());
				changeNav.MoveToParent();
                projectToSave.fundsSare = MND(Request.Params["fundsSARE"]);
			}

			if (projectToSave.fundsMatchingFed != MNI(Request.Params["fundsMatchingFed"]))
			{
				changeNav.PrependChildElement("", "change", sareNamespace, "Matching Federal Funding");
				changeNav.MoveToFirstChild();
				changeNav.CreateAttribute("", "type", sareNamespace, "Update");
				changeNav.CreateAttribute("", "previousval", sareNamespace, projectToSave.fundsMatchingFed.ToString());
				changeNav.CreateAttribute("", "currentval", sareNamespace, MNI(Request.Params["fundsMatchingFed"]).ToString());
				changeNav.MoveToParent();
				projectToSave.fundsMatchingFed = MNI(Request.Params["fundsMatchingFed"]);
			}

			if (projectToSave.fundsMatchingNonfed != MNI(Request.Params["fundsMatchingNonfed"]))
			{
				changeNav.PrependChildElement("", "change", sareNamespace, "Matching Non-federal Funding");
				changeNav.MoveToFirstChild();
				changeNav.CreateAttribute("", "type", sareNamespace, "Update");
				changeNav.CreateAttribute("", "previousval", sareNamespace, projectToSave.fundsMatchingNonfed.ToString());
				changeNav.CreateAttribute("", "currentval", sareNamespace, Request.Params["fundsMatchingNonfed"]);
				changeNav.MoveToParent();
				projectToSave.fundsMatchingNonfed = MNI(Request.Params["fundsMatchingNonfed"]);
			}

            if (projectToSave.ProjEndYear != MNI(Request.Params["projEndYear"]))
            {
                changeNav.PrependChildElement("", "change", sareNamespace, "Projected End Date");
                changeNav.MoveToFirstChild();
                changeNav.CreateAttribute("", "type", sareNamespace, "Update");
                changeNav.CreateAttribute("", "previousval", sareNamespace, projectToSave.ProjEndYear.ToString());
                changeNav.CreateAttribute("", "currentval", sareNamespace, Request.Params["projEndYear"]);
                changeNav.MoveToParent();
                projectToSave.ProjEndYear = MNI(Request.Params["projEndYear"]);
            }

            if ((Request.Params["projectTitle"] != null && Request.Params["projectTitle"].Trim() != "") && (Request.Params["fundsSARE"] != null && Request.Params["fundsSARE"] != "") && ((Request.Params["addrState"] != null && Request.Params["addrState"] != "") || (Request.Params["strStatePro"] != null && Request.Params["strStatePro"] != "")))
			{
                if (Request.Params["strStatePro"] != null && Request.Params["strStatePro"] != "")
                  projectToSave.ProjectState = Request.Params["strStatePro"];
               else
                    projectToSave.ProjectState = Request.Params["addrState"];
				projectToSave.SaveToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());

				currUser.Grants[(string)(Session["currGrant"])] = projectToSave;
				Session["currUser"] = currUser;
				Session["changedoc"] = changeDoc;
               
				projectToSave.toXml(ref xmlWriter);

				Session["confirmthis"] = writerString.ToString();


				//				Response.Write(changeDoc.InnerXml);
                //projectDetialsUpdateHandler(sender, e);

			}
			else
			{
                if (Request.Params["projectTitle"] == null || Request.Params["projectTitle"].Trim() == "")
                    TitleFlag = "Title ";
                if ((Request.Params["fundsSARE"] == null || Request.Params["fundsSARE"] == "" || Request.Params["fundsSARE"] == "0"))
                    FundsFlag = "Funding Amount ";
                if ((Request.Params["addrState"] == null || Request.Params["addrState"] == "") && (Request.Params["strStatePro"] == null || Request.Params["strStatePro"] == ""))
                    stateFlag = "State ";

                fieldsMissingMsg = TitleFlag + FundsFlag + stateFlag;

                Session["statusMessage1"] = fieldsMissingMsg + "required.";
				return;
			}

		}

        protected void projectDetialsUpdateHandler(object sender, EventArgs e)
        {
            DaikonUser currUser = (DaikonUser)(Session["currUser"]);
            DaikonGrant projectDetails = currUser.Grants[(string)(Session["currGrant"])];

            int count = projectDetails.Reports.Count;
            int rept_year = 0;

            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();

            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;
            SqlParameter userReturnParameter;

            for (int cnt = 0; cnt < count; cnt++)
            {
                if (projectDetails.Reports.Values[cnt].Type == 2)
                {
                    rept_year = projectDetails.Reports.Values[cnt].Year;                   
                }
            }

            userConnection = new SqlConnection(userConnString);
            userSQL = "DaikonProjectSubmitApprove";
            userCommand = new SqlCommand(userSQL, userConnection);
            userCommand.CommandType = CommandType.StoredProcedure;
            userReturnParameter = new SqlParameter("@RETURN_VALUE", SqlDbType.Int);
            userReturnParameter.Direction = ParameterDirection.ReturnValue;

            userCommand.Parameters.Add("@user", SqlDbType.VarChar, 12).Value = ((DaikonUser)(Session["currUser"])).Username;
            userCommand.Parameters.Add("@sKey", SqlDbType.Int).Value = (int)Session["sessionkey"];
            userCommand.Parameters.Add("@proj_num", SqlDbType.VarChar, 50).Value = projectDetails.projNum;
            if (Request.Form["btnSubmit"] == "Submit")
            {
                userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = true;
                userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = false;
            }
            else if (Request.Form["btnProjectDetailsApprove"] != null)
            {
                userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = false;
                userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = true;
            }
            else
            {
                userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = false;
                userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = false;
            }           

            userCommand.Parameters.Add("@rept_year", SqlDbType.Int).Value = rept_year;
            userCommand.Parameters.Add("@rept_isfinal", SqlDbType.TinyInt).Value = Request.Params["t"];
            userCommand.Parameters.Add(userReturnParameter);


            userConnection.Open();
            userDataReader = userCommand.ExecuteReader();

            userDataReader.Read();
            userDataReader.Dispose();
            
        }

        protected void projectDetialsSubmissionHandler(object sender, EventArgs e)
		{
			DaikonUser currUser = (DaikonUser)(Session["currUser"]);
            DaikonGrant projectDetails = currUser.Grants[(string)(Session["currGrant"])];
            int count = projectDetails.Reports.Count;
            int type = 0;
            int rept_year = 0;

            string action = "";
            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();

            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;
            SqlParameter userReturnParameter;
                
            for(int cnt=0;cnt < count; cnt++)
            {
                if (projectDetails.Reports.Values[cnt].Type == 2)
                {
                    rept_year = projectDetails.Reports.Values[cnt].Year;
                    type = 2;
                }
            }

            if (projectDetails.projTitle.Length != 0 && projectDetails.fundsSare != 0 && type == 2 &&
                projectDetails.Profile.ProfileID != 0 && (projectDetails.Type == 3 || projectDetails.Type == 7 || projectDetails.Type == 8 || (string)Session["projectParticipants"] == "true"))
			{

                userConnection = new SqlConnection(userConnString);
                userSQL = "DaikonProjectSubmitApprove";
                userCommand = new SqlCommand(userSQL, userConnection);
                userCommand.CommandType = CommandType.StoredProcedure;
                userReturnParameter = new SqlParameter("@RETURN_VALUE", SqlDbType.Int);
                userReturnParameter.Direction = ParameterDirection.ReturnValue;
                 
                userCommand.Parameters.Add("@user", SqlDbType.VarChar, 12).Value = ((DaikonUser)(Session["currUser"])).Username;
                userCommand.Parameters.Add("@sKey", SqlDbType.Int).Value = (int)Session["sessionkey"];
                userCommand.Parameters.Add("@proj_num", SqlDbType.VarChar, 50).Value = projectDetails.projNum;                
                if (Request.Form["btnProjectDetailsSubmit"] != null)
                {
                    userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = true;
                    userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = false;
                    action = "Submitted";
                }
                else if (Request.Form["btnProjectDetailsNotApprove"] != null)
                {
                    userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = false;
                    userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = false;
                    action = "Not Approved";
                }
                else
                {
                    userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = true;
                    userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = false;
                    action = "Approved";
                }
                userCommand.Parameters.Add("@rept_year", SqlDbType.Int).Value = rept_year;
                userCommand.Parameters.Add("@rept_isfinal", SqlDbType.TinyInt).Value = type;
                userCommand.Parameters.Add(userReturnParameter);


                userConnection.Open();
                userDataReader = userCommand.ExecuteReader();

                userDataReader.Read();
                userDataReader.Dispose();

                if (userReturnParameter.Value.ToString() == "1")
                {

                    projectDetailsSubmitApproveMailer(currUser.Email, projectDetails.projNum, projectDetails.projTitle, projectDetails.Region, action);
                    //Session["statusMessage2"] = "Project Details have been " + action + " are emailed to " + projectDetails.Region.ToUpper() + " Regional Admins.";
                    if (action == "Submitted")
                        Session["statusMessage2"] = "This project was submitted successfully. A confirmation was e-mailed to the Regional Administrator.";
                    else if (action == "Approved")
                        Session["statusMessage2"] = "This project was approved successfully. A confirmation was e-mailed to the PI.";
                    else
                        Session["statusMessage2"] = "This project was not approved. A confirmation was e-mailed to the PI.";
                    Response.Redirect("sare_main.aspx?do=confirm&confirmType=update");
                }

			}
			else
			{
                Session["statusMessage1"] = "Title, Funding, Project Profile, Participants and Proposal Narrative are required for submission.";                
				return;
			}

		}

        protected void PDPSubmissionHandler(object sender, EventArgs e)
        {
            DaikonUser currUser = (DaikonUser)(Session["currUser"]);
            DaikonGrant projectDetails = currUser.Grants[(string)(Session["currGrant"])];
            int count = projectDetails.Reports.Count;
            int type = 0;
            int rept_year = 0;

            string action = "";
            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();

            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;
            SqlParameter userReturnParameter;

            for (int cnt = 0; cnt < count; cnt++)
            {
                if (projectDetails.Reports.Values[cnt].Type == 2)
                {
                    rept_year = projectDetails.Reports.Values[cnt].Year;
                    type = 2;
                }
            }

            userConnection = new SqlConnection(userConnString);
            userSQL = "DaikonProjectSubmitApprove";
            userCommand = new SqlCommand(userSQL, userConnection);
            userCommand.CommandType = CommandType.StoredProcedure;
            userReturnParameter = new SqlParameter("@RETURN_VALUE", SqlDbType.Int);
            userReturnParameter.Direction = ParameterDirection.ReturnValue;

            userCommand.Parameters.Add("@user", SqlDbType.VarChar, 12).Value = ((DaikonUser)(Session["currUser"])).Username;
            userCommand.Parameters.Add("@sKey", SqlDbType.Int).Value = (int)Session["sessionkey"];
            userCommand.Parameters.Add("@proj_num", SqlDbType.VarChar, 50).Value = projectDetails.projNum;
            if (Request.Form["btnPDPDetailsSubmit"] != null)
            {
                userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = true;
                userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = false;
                action = "Submitted";
            }
            else if (Request.Form["btnPDPDetailsNotApprove"] != null)
            {
                userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = false;
                userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = false;
                action = "Not Approved";
            }
            else
            {
                userCommand.Parameters.Add("@approved", SqlDbType.Bit).Value = true;
                userCommand.Parameters.Add("@submitted", SqlDbType.Bit).Value = false;
                action = "Approved";
            }
            userCommand.Parameters.Add("@rept_year", SqlDbType.Int).Value = rept_year;
            userCommand.Parameters.Add("@rept_isfinal", SqlDbType.TinyInt).Value = type;
            userCommand.Parameters.Add(userReturnParameter);


            userConnection.Open();
            userDataReader = userCommand.ExecuteReader();

            userDataReader.Read();
            userDataReader.Dispose();

            if (userReturnParameter.Value.ToString() == "1")
            {

                PDPDetailsSubmitApproveMailer(currUser.Email, projectDetails.projNum, projectDetails.projTitle, projectDetails.Region, action);
                if (action == "Submitted")
                    Session["statusMessage2"] = "This state report project was submitted successfully. A confirmation was e-mailed to the Regional Administrator.";
                else if (action == "Approved")
                    Session["statusMessage2"] = "This state report project was approved successfully. A confirmation was e-mailed to the PI.";
                else
                    Session["statusMessage2"] = "This sate report project was not approved. A confirmation was e-mailed to the PI.";
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=update");
            }
           

        }

		protected void createProjectFormHandler(object sender, EventArgs e)
		{
			int createsuccess = 0;
			string projectNumber = "";
			string projectRegion = "";
			string projectYear = "";
			int projectType = 0;
			int projectSequence = 0;
            string projectEndYear = "0";

			string userEmail = "";

			DaikonUser currUser;
			currUser = (DaikonUser)(Session["currUser"]);

			DaikonGrant projectToCreate;

			if (Request.Form["projNum"] == null || Request.Form["projNum"] == "")
			{
				projectNumber = "";
				projectRegion = Request.Form["projRegion"];
				projectYear = Request.Form["projYear"].Remove(0, 2);
				projectType = MNI(Request.Form["projType"]);
				projectSequence = MNI(Request.Form["sequenceNum"]);
                projectEndYear = Request.Form["projEndYear"];
			}
			if (projectSequence != 0)
			{

				switch (projectType)
				{
					case 1:
						projectNumber = projectNumber + "E";
						break;
					case 2:
						if (projectRegion == "W")
						{
							projectNumber = projectNumber + "S";
						}
						else
						{
							projectNumber = projectNumber + "L";
						}
						break;
					case 3:
						projectNumber = projectNumber + "F";
						break;
					case 4:
						projectNumber = projectNumber + "G";
						break;
					case 5:
						projectNumber = projectNumber + "O";
						break;
					case 6:
						projectNumber = projectNumber + "C";
						break;
                    case 7:
                        projectNumber = projectNumber + "Y";
                        break;
                    case 8:
                        projectNumber = projectNumber + "YE";
                        break;
                    case 9:
                        projectNumber = projectNumber + "M";
                        break;
					default:
						break;
				}

				projectNumber = projectNumber + projectRegion;
				projectNumber = projectNumber + MNS(projectYear);

				if ((MNS(projectSequence).Length) == 2)
					projectNumber = projectNumber + "-0" + MNS(projectSequence);
				else if ((MNS(projectSequence).Length) == 1)
					projectNumber = projectNumber + "-00" + MNS(projectSequence);
				else
					projectNumber = projectNumber + "-" + MNS(projectSequence);

			}

			else
			{
				projectNumber = Request.Form["projNum"];
			}

            if (projectNumber.Length == 0)
            {
                Session["statusMessage1"] = "Please Enter Sequence Number";
                return;
            }
            else
            {

                if (projectNumber.Contains("-") && (projectNumber.Length == 10 || projectNumber.Length == 9 || projectNumber.Length == 8))
                {
                    string grantType = projectNumber.Substring(0, 1);
                    string regionType = projectNumber.Substring(1, 1);

                    if (projectNumber.Length == 10 && grantType == "Y")
                    {
                        grantType = projectNumber.Substring(0, 2);
                        regionType = projectNumber.Substring(2, 1);
                    }
                    

                    grantType = grantType.ToUpper();
                    regionType = regionType.ToUpper();

                    if (!(grantType == "E" || grantType == "S" || grantType == "L" || grantType == "F" ||
                          grantType == "G" || grantType == "O" || grantType == "C" || grantType == "Y" ||
                          grantType == "YE" || grantType == "M"))
                    {
                        Session["statusMessage1"] = "Please Enter Correct Grant Type";
                        return;
                    }

                    if (!(regionType == "N" || regionType == "W" || regionType == "S"))
                    {
                        Session["statusMessage1"] = "Please Enter Region Type";
                        return;
                    }
                }
                else
                {
                    Session["statusMessage1"] = "Please Enter Correct Project Format XXX00-000 or XX00-000";
                    return;
                }
            }

            projectNumber = projectNumber.ToUpper();

			projectToCreate = new DaikonGrant(projectNumber);
			//            projectToCreate.projNum = projectNumber;

            /* if (Request.Form["projEmail"] == "" && projectType != 3 && !projectNumber.Contains("F"))
			{
				Session["statusMessage1"] = "Please Enter Email Address.";
				return;
			}
            
            if (!IsValidEmailAddress(Request.Form["projEmail"]) && projectType != 3 && !projectNumber.Contains("F"))
			{
				Session["statusMessage1"] = "Please Enter Correctly Formatted Email Address.";
				//Session.Remove("statusMessage1");
				return;
			}
             */

			createsuccess = projectToCreate.Create(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Int32.Parse(projectEndYear), ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
			if (createsuccess == 1)
			{
				if (Request.Form["projEmail"] != null || Request.Form["projEmail"] == "")
				{
					userEmail = Request.Form["projEmail"];
                    //if (userEmail.Length == 0 && projectType != 3 && !projectNumber.Contains("F"))
					//	Session["statusMessage1"] = "Please Enter Email Address.";
					//else
					//{
                        projectCreateMailer(userEmail, projectToCreate.projNum, projectToCreate.ClaimCode, projectRegion, false);

                        if (Request.Form["btnAdminCreateProjConfirm"] == "Create and Edit")
                            Response.Redirect("sare_main.aspx?do=editProj&pn=" + projectToCreate.projNum);
                        else
                        {
                            if (userEmail.Length == 0 /* && (projectType == 3 || projectNumber.Contains("F") || projectNumber.Contains("F"))*/)
                                Session["statusMessage2"] = "Project was created successfully."; //No e-mail confirmation was sent for this farmer/rancher grant";
                            else
                                Session["statusMessage2"] = "Project was created successfully and email sent to " + userEmail;
                        }

					//}
				}
			}
			else if (createsuccess == 2)
			{
				Session["statusMessage1"] = "Project already exists.  Please choose a different project number.";
			}
			else if (createsuccess == 0)
			{
				Session["statusMessage1"] = "Project not created.  You might not have rights to create a project of this type or region.";
			}
			Session["currUser"] = currUser;            

		}

        protected void createPDPFormHandler(object sender, EventArgs e)
        {
            int createsuccess = 0;
            string projectNumber = "";
            string projectState = "";
            string projectRegion = "";
            string projectYear = "";
            int projectType = 0;
            int projectSequence = 0;
            string projectEndYear = "0";

            string userEmail = "";

            DaikonUser currUser;
            currUser = (DaikonUser)(Session["currUser"]);

            DaikonGrant projectToCreate;

            if (Request.Form["projNum"] == null || Request.Form["projNum"] == "")
            {
                projectNumber = "";
                projectState = Request.Form["addrState"];
                projectRegion = Request.Form["projRegion"];
                projectYear = Request.Form["projYear"].Remove(0, 2);
                projectType = MNI(Request.Form["projType"]);
                projectSequence = MNI(Request.Form["sequenceNum"]);
                projectEndYear = Request.Form["projEndYear"];
            }
            
            if (projectSequence != 0)
            {
                /*
                switch (projectType)
                {
                    case 1:
                        projectNumber = projectNumber + "E";
                        break;
                    case 2:
                        if (projectRegion == "W")
                        {
                            projectNumber = projectNumber + "S";
                        }
                        else
                        {
                            projectNumber = projectNumber + "L";
                        }
                        break;
                    case 3:
                        projectNumber = projectNumber + "F";
                        break;
                    case 4:
                        projectNumber = projectNumber + "G";
                        break;
                    case 5:
                        projectNumber = projectNumber + "O";
                        break;
                    case 6:
                        projectNumber = projectNumber + "C";
                        break;
                    case 7:
                        projectNumber = projectNumber + "Y";
                        break;
                    case 8:
                        projectNumber = projectNumber + "YE";
                        break;
                    case 9:
                        projectNumber = projectNumber + "M";
                        break;
                    default:
                        break;
                }
                */

                projectNumber = projectNumber + projectRegion + projectState;
                projectNumber = projectNumber + MNS(projectYear);

                if ((MNS(projectSequence).Length) == 2)
                    projectNumber = projectNumber + "-0" + MNS(projectSequence);
                else if ((MNS(projectSequence).Length) == 1)
                    projectNumber = projectNumber + "-00" + MNS(projectSequence);
                else
                    projectNumber = projectNumber + "-" + MNS(projectSequence);

            }

            else
            {
                projectNumber = Request.Form["projNum"];
            }

            if (projectNumber.Length == 0)
            {
                Session["statusMessage1"] = "Please Enter Sequence Number";
                return;
            }
            else
            {

                if (projectNumber.Contains("-") && (projectNumber.Length == 10 || projectNumber.Length == 9 || projectNumber.Length == 8))
                {
                    string stateType = projectNumber.Substring(1, 2);
                    string regionType = projectNumber.Substring(0, 1);
                    string projEndYr = projectNumber.Substring(3, 2);

                    if (projectNumber.Length == 10)
                    {
                        stateType = projectNumber.Substring(2, 2);
                        regionType = projectNumber.Substring(0, 2);
                        projEndYr = projectNumber.Substring(4, 2);
                    }


                    projectState = stateType.ToUpper();
                    projectRegion = regionType.ToUpper();
                    projectEndYear = projEndYr;

                    if (stateType.Length == 0)
                    {
                        Session["statusMessage1"] = "Please Enter Correct State";
                        return;
                    }
                    /*
                    if (!(regionType == "N" || regionType == "W" || regionType == "S"))
                    {
                        Session["statusMessage1"] = "Please Enter Region Type";
                        return;
                    }
                    */
                }
                else
                {
                    Session["statusMessage1"] = "Please Enter Correct Project Format XXX00-000 or XX00-000";
                    return;
                }
            }

            projectNumber = projectNumber.ToUpper();


            String nc_states = "|SD|WI|IA|IL|IN|KS|MI|MN|MO|ND|NE|OH|";

            String ne_states = "|NH|NJ|MA|MD|ME|CT|DC|DE|WV|NY|VT|RI|PA|";

            String s_states = "|PR|SC|TN|TX|VA|VI|FL|AL|AR|KY|LA|GA|MS|OK|NC|";

            String w_states = "|AK|OR|NM|NV|MT|MP|GU|HI|ID|AS|AZ|CA|CO|FM|WA|WY|UT|";

            String state = "";
            String region = "";

            if (projectNumber.Length == 10)
            {
                region = projectNumber.Substring(0, 2).ToUpper();
                state = projectNumber.Substring(2, 2).ToUpper();
            }

            if (projectNumber.Length == 9)
            {
                region = projectNumber.Substring(0, 1).ToUpper();
                state = projectNumber.Substring(1, 2).ToUpper();
            }

            if (region == "NC" && nc_states.IndexOf(state) > 0)
	        {
                Session["statusMessage2"] = "North Central State Report.";
	        }
            else if (region == "NE" && ne_states.IndexOf(state) > 0)
	        {
                Session["statusMessage2"] = "North East State Report.";
	        }
            else if (region == "S" && s_states.IndexOf(state) > 0)
	        {
                Session["statusMessage2"] = "South State Report.";
	        }
            else if (region == "W" && w_states.IndexOf(state) > 0)
	        {
                Session["statusMessage2"] = "West State Report.";		        		
	        }
	        else
	        {
                Session["statusMessage1"] = "Please Enter Correct Region for State.";
                return;
	        }


            projectToCreate = new DaikonGrant(projectNumber);

            createsuccess = projectToCreate.Create(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Int32.Parse(projectEndYear), projectRegion, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());

            if (createsuccess == 1)
            {
                if (Request.Form["projEmail"] != null || Request.Form["projEmail"] == "")
                {
                    userEmail = Request.Form["projEmail"];
                    
                    PDPCreateMailer(userEmail, projectToCreate.projNum, projectToCreate.ClaimCode, projectRegion, false);

                    if (Request.Form["btnAdminCreatePDPConfirm"] == "Create and Edit")
                        Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projectToCreate.projNum);
                    else
                    {
                        if (userEmail.Length == 0 /* && (projectType == 3 || projectNumber.Contains("F") || projectNumber.Contains("F"))*/)
                            Session["statusMessage2"] = "Project was created successfully."; //No e-mail confirmation was sent for this farmer/rancher grant";
                        else
                            Session["statusMessage2"] = "Project was created successfully and email sent to " + userEmail;
                    }
                   
                }
            }
            else if (createsuccess == 2)
            {
                Session["statusMessage1"] = "Project already exists.  Please choose a different project number.";
            }
            else if (createsuccess == 0)
            {
                Session["statusMessage1"] = "Project not created.  You might not have rights to create a project of this type or region.";
            }
            Session["currUser"] = currUser;

        }


        public void DeleteProjectFormHandler(Object sender, EventArgs e)
        {
            int deleteSuccess = 0;
            string projectNumber;

            DaikonUser currUser;
            currUser = (DaikonUser)(Session["currUser"]);

            DaikonGrant projectToDelete;

            projectNumber = (string)(Session["currGrant"]);

            projectToDelete = new DaikonGrant(projectNumber.Trim());

            deleteSuccess = projectToDelete.DeleteProject(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());

            if (deleteSuccess == 1)
            {
                Session["statusMessage2"] = "Project " + projectNumber + " has been deleted.";
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=deleteProject");
            }

            else if (deleteSuccess == 2)
                Session["statusMessage1"] = "Project does not exist.";
            else
                Session["statusMessage1"] = "System failed to delete";

            //Response.Redirect("sare_main.aspx?do=deleteproj");
            //Response.Redirect("sare_main.aspx");

            return;
            
        }

		protected void ReportEditorXMLWriter()
		{
			String thisGrant = "";
			int thisReptYear = 0;
			int thisReptType = 0;
			int thisReptSection = 0;
			int thisReptSubSection = 0;
			DaikonUserCollection projectPIs;
			DaikonParticipantCollection projectParticipants;

			if (Request.Params.Get("pn") != null && Request.Params.Get("pn") != "")
				thisGrant = Request.Params.Get("pn");

			if (Request.Params.Get("y") != null && Request.Params.Get("y") != "")
				thisReptYear = int.Parse(Request.Params.Get("y"));
			else
				return;

			if (Request.Params.Get("t") != null && Request.Params.Get("t") != "")
				thisReptType = int.Parse(Request.Params.Get("t"));

			if (Request.Params.Get("rs") != null && Request.Params.Get("rs") != "")
			{
				thisReptSection = int.Parse(Request.Params.Get("rs"));
			}
			if (Request.Params.Get("ss") != null && Request.Params.Get("ss") != "")
			{
				thisReptSubSection = int.Parse(Request.Params.Get("ss"));
			}

            if (currUser.Grants == null)
            {
                currUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
            }

			if (currUser.Grants.ContainsKey(thisGrant))
			{
				//                currUser.Grants[thisGrant].Reports[thisReptYear.ToString() + thisReptType.ToString()].Refresh();
				if (currUser.Grants[thisGrant].Reports.ContainsKey(thisReptYear.ToString() + thisReptType.ToString()))
					currUser.Grants[thisGrant].toXmlReport(thisReptYear, thisReptType, ref xmlWriter);
				else
				{
					currUser.Grants[thisGrant].addReport(new DaikonGrantReport(thisGrant, thisReptYear, thisReptType, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString()));
					currUser.Grants[thisGrant].toXmlReport(thisReptYear, thisReptType, ref xmlWriter);
				}
			}
			else
			{
				currUser.Grants.Add(thisGrant, new DaikonGrant(thisGrant, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString()));
				if (currUser.Grants[thisGrant].Reports.ContainsKey(thisReptYear.ToString() + thisReptType.ToString()))
					currUser.Grants[thisGrant].toXmlReport(thisReptYear, thisReptType, ref xmlWriter);
				else
				{
					currUser.Grants[thisGrant].addReport(new DaikonGrantReport(thisGrant, thisReptYear, thisReptType, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString()));
					currUser.Grants[thisGrant].toXmlReport(thisReptYear, thisReptType, ref xmlWriter);
				}
			}

			projectPIs = new DaikonUserCollection(currUser.Grants[thisGrant].CoreID, true);
            // This is added to get the project coordinators
            DaikonParticipantCollection grantNonuserCoords = new DaikonParticipantCollection(thisGrant, true);
			projectParticipants = new DaikonParticipantCollection(thisGrant, false);

			projectPIs.toXML(xmlWriter, "projectpis");
            // This is added to get the project coordinators
            grantNonuserCoords.toXML(xmlWriter, "projectpis");
			projectParticipants.toXML(xmlWriter, "projectparticipants");

			xsltArgs.AddParam("reptsection", "", thisReptSection);
			xsltArgs.AddParam("reptsubsection", "", thisReptSubSection);

			Session["currUser"] = currUser;
			if (currUser.Grants[thisGrant].Reports.ContainsKey(thisReptYear.ToString() + thisReptType.ToString()))
				Session["currReport"] = currUser.Grants[thisGrant].Reports[thisReptYear.ToString() + thisReptType.ToString()];
			Session["currGrant"] = thisGrant;
		}

        protected void projectOverviewSubmissionApproveHandler(object sender, EventArgs e)
        {
            DaikonUser currUser;
            currUser = (DaikonUser)(Session["currUser"]);

            DaikonGrantReport reportToSave;
            reportToSave = (DaikonGrantReport)(Session["currReport"]);

            //            String thisGrant = Request.Params.Get("pn");
            //            int thisReptYear = int.Parse(Request.Params.Get("y"));
            //            int thisReptType = int.Parse(Request.Params.Get("t"));

            changeNav.MoveToRoot();
            changeNav.MoveToChild("SAREroot", sareNamespace);
            //            changeNav.MoveToChild("projects", "");

            string thisGrant = "";

            if (Request.Params.Get("pn") != null && Request.Params.Get("pn") != "")
                thisGrant = Request.Params.Get("pn");

            DaikonGrant projectToSave;
            if (currUser.Grants == null)
            {
                currUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
            }

            if (currUser.Grants.ContainsKey(thisGrant))
            {
                projectToSave = currUser.Grants[(string)(Session["currGrant"])];
            }
            else
            {
                currUser.Grants.Add(thisGrant, new DaikonGrant(thisGrant, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString()));
                projectToSave = currUser.Grants[(string)(Session["currGrant"])];
            }

            while (changeNav.MoveToChild("SAREgrant", sareNamespace))
            {
                if (projectToSave.projNum.ToString() == changeNav.GetAttribute("projNum", sareNamespace))
                    break;
            }
            if (projectToSave.projNum.ToString() != changeNav.GetAttribute("projNum", sareNamespace))
            {
                if (changeNav.LocalName == "SAREgrant")
                    changeNav.MoveToParent();
                changeNav.PrependChildElement("", "SAREgrant", sareNamespace, "");
                changeNav.MoveToChild("SAREgrant", sareNamespace);
                changeNav.CreateAttribute("", "projNum", sareNamespace, projectToSave.projNum.ToString());
                changeNav.CreateAttribute("", "title", sareNamespace, projectToSave.projTitle.ToString());
                changeNav.CreateAttribute("", "type", sareNamespace, projectToSave.Type.ToString());
                changeNav.CreateAttribute("", "region", sareNamespace, projectToSave.projNum.ToString());
                changeNav.CreateAttribute("", "coreID", sareNamespace, projectToSave.CoreID.ToString());
            }
            while (changeNav.MoveToChild("report", sareNamespace))
            {
                if ((reportToSave.Year.ToString() == changeNav.GetAttribute("year", sareNamespace)) && (reportToSave.Type.ToString() == changeNav.GetAttribute("type", sareNamespace)))
                    break;
            }
            if ((reportToSave.Year.ToString() != changeNav.GetAttribute("year", sareNamespace)) || (reportToSave.Type.ToString() != changeNav.GetAttribute("type", sareNamespace)))
            {
                changeNav.PrependChildElement("", "report", sareNamespace, "");
                changeNav.MoveToChild("report", sareNamespace);
                changeNav.CreateAttribute("", "year", sareNamespace, reportToSave.Year.ToString());
                changeNav.CreateAttribute("", "type", sareNamespace, reportToSave.Type.ToString());
            }

            bool reptStatus = false;
            if (Request.Form["btnProjectDetailsApprove"] != null)
                bool.TryParse("true", out reptStatus);
            if (reportToSave.Status != reptStatus)
            {
                    changeNav.PrependChildElement("", "change", sareNamespace, "Report");
                    changeNav.MoveToFirstChild();
                    changeNav.CreateAttribute("", "type", sareNamespace, "Approval Status");
                    if (reportToSave.Status == true)
                        changeNav.CreateAttribute("", "previousval", sareNamespace, "Approved");
                    else
                        changeNav.CreateAttribute("", "previousval", sareNamespace, "Not Approved");
                    if (reptStatus == true)
                        changeNav.CreateAttribute("", "currentval", sareNamespace, "Approved");
                    else
                        changeNav.CreateAttribute("", "currentval", sareNamespace, "Not Approved");
                    changeNav.MoveToParent();

                    reportToSave.Status = reptStatus;
                }

                bool submitStatus;

                if (Request.Form["btnProjectDetailsSubmit"] != null)
                    submitStatus = true;
                else
                    submitStatus = false;

                if ((submitStatus == true) || (submitStatus != reportToSave.Status))
                {
                    changeNav.PrependChildElement("", "change", sareNamespace, "Report");
                    changeNav.MoveToFirstChild();
                    changeNav.CreateAttribute("", "type", sareNamespace, "Submission Status");
                    if (reportToSave.Status == true)
                        changeNav.CreateAttribute("", "previousval", sareNamespace, "Submitted");
                    else
                        changeNav.CreateAttribute("", "previousval", sareNamespace, "Not Submitted");
                    if (submitStatus == true)
                        changeNav.CreateAttribute("", "currentval", sareNamespace, "Submitted");
                    else
                        changeNav.CreateAttribute("", "currentval", sareNamespace, "Not Submitted");
                    changeNav.MoveToParent();

                    reportToSave.SubmitStatus = submitStatus;
                }

                reportToSave.saveToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], projectToSave.projNum, projectToSave.Type, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());

                reportToSave.toXML(ref xmlWriter);
                
        }

		protected void reportSubmissionHandler(object sender, EventArgs e)
		{
			DaikonUser currUser;
			currUser = (DaikonUser)(Session["currUser"]);

			DaikonGrantReport reportToSave;
			reportToSave = (DaikonGrantReport)(Session["currReport"]);

			//            String thisGrant = Request.Params.Get("pn");
			//            int thisReptYear = int.Parse(Request.Params.Get("y"));
			//            int thisReptType = int.Parse(Request.Params.Get("t"));

			changeNav.MoveToRoot();
			changeNav.MoveToChild("SAREroot", sareNamespace);
			//            changeNav.MoveToChild("projects", "");

            string thisGrant = "";

            if (Request.Params.Get("pn") != null && Request.Params.Get("pn") != "")
                thisGrant = Request.Params.Get("pn");

            DaikonGrant projectToSave;
            if (currUser.Grants == null)
            {
                currUser = new DaikonUser(currUser.Username, (int)Session["sessionkey"], currUser.Username);
            }

            if (currUser.Grants.ContainsKey(thisGrant))
            {
                projectToSave = currUser.Grants[(string)(Session["currGrant"])];
            }
            else
            {
                currUser.Grants.Add(thisGrant, new DaikonGrant(thisGrant, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString()));
                projectToSave = currUser.Grants[(string)(Session["currGrant"])];
            }

			while (changeNav.MoveToChild("SAREgrant", sareNamespace))
			{
				if (projectToSave.projNum.ToString() == changeNav.GetAttribute("projNum", sareNamespace))
					break;
			}
			if (projectToSave.projNum.ToString() != changeNav.GetAttribute("projNum", sareNamespace))
			{
				if (changeNav.LocalName == "SAREgrant")
					changeNav.MoveToParent();
				changeNav.PrependChildElement("", "SAREgrant", sareNamespace, "");
				changeNav.MoveToChild("SAREgrant", sareNamespace);
				changeNav.CreateAttribute("", "projNum", sareNamespace, projectToSave.projNum.ToString());
				changeNav.CreateAttribute("", "title", sareNamespace, projectToSave.projTitle.ToString());
				changeNav.CreateAttribute("", "type", sareNamespace, projectToSave.Type.ToString());
				changeNav.CreateAttribute("", "region", sareNamespace, projectToSave.projNum.ToString());
				changeNav.CreateAttribute("", "coreID", sareNamespace, projectToSave.CoreID.ToString());
			}
			while (changeNav.MoveToChild("report", sareNamespace))
			{
				if ((reportToSave.Year.ToString() == changeNav.GetAttribute("year", sareNamespace)) && (reportToSave.Type.ToString() == changeNav.GetAttribute("type", sareNamespace)))
					break;
			}
			if ((reportToSave.Year.ToString() != changeNav.GetAttribute("year", sareNamespace)) || (reportToSave.Type.ToString() != changeNav.GetAttribute("type", sareNamespace)))
			{
				changeNav.PrependChildElement("", "report", sareNamespace, "");
				changeNav.MoveToChild("report", sareNamespace);
				changeNav.CreateAttribute("", "year", sareNamespace, reportToSave.Year.ToString());
				changeNav.CreateAttribute("", "type", sareNamespace, reportToSave.Type.ToString());
			}

			if ((Request.Form["confDel"] != null) && (Request.Form["cmdDeleteReport"] != null))
			{
				changeNav.PrependChildElement("", "change", sareNamespace, "Report");
				changeNav.MoveToFirstChild();
				changeNav.CreateAttribute("", "type", sareNamespace, "deletion");
				//                changeNav.CreateAttribute("", "previousval", sareNamespace, "report text");
				//                changeNav.CreateAttribute("", "currentval", sareNamespace, "null");
				changeNav.MoveToParent();
				reportToSave.deleteFromDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Session["currGrant"].ToString(), ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
			}
			else
			{
				//			if (Session["currReport"].GetType() == Type.GetType("DaikonGrantReport"))

				//			reportToSave = (DaikonGrantReport)Session["currReport"];
				//			reportToSave = currUser.Grants[

				int sectionMatch;
				int subheadMatch;
				int subtextMatch;
				int currentOrder;

				foreach (string formItemKey in Request.Form.Keys)
				{
					//					Response.Write(formItemKey & "<br>" & vbCrLf)

					if (Regex.IsMatch(formItemKey, "\\w*subheading(\\d+)\\w*"))
					{
						sectionMatch = int.Parse(Regex.Replace(formItemKey, "\\w*section(\\d+)\\w*", "$1"));
						subheadMatch = int.Parse(Regex.Replace(formItemKey, "\\w*subheading(\\d+)\\w*", "$1"));
						//					Response.Write("Section: " & sectionMatch & "<br>" & vbCrLf)
						//					Response.Write("Subheading: " & subheadMatch & "<br>" & vbCrLf)
						if (0 != String.Compare(((DaikonGrantReportSubSection)((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).Subsections[subheadMatch]).SubsectionHeading, Request.Form[formItemKey], false))
						{
							changeNav.PrependChildElement("", "change", sareNamespace, "Subheading");
							changeNav.MoveToFirstChild();
							changeNav.CreateAttribute("", "section", sareNamespace, sectionMatch.ToString());
							changeNav.CreateAttribute("", "sectionName", sareNamespace, ((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).SectionName);
							changeNav.CreateAttribute("", "subsection", sareNamespace, subheadMatch.ToString());
							changeNav.CreateAttribute("", "type", sareNamespace, "Update");
							changeNav.CreateAttribute("", "previousval", sareNamespace, ((DaikonGrantReportSubSection)((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).Subsections[subheadMatch]).SubsectionHeading);
							changeNav.CreateAttribute("", "currentval", sareNamespace, Request.Form[formItemKey]);
							changeNav.MoveToParent();

							reportToSave.UpdateSub(sectionMatch, -1, Request.Form[formItemKey], "-1", subheadMatch, -1);
						}
					}
					else if (Regex.IsMatch(formItemKey, "\\w*subtext(\\d+)\\w*"))
					{
						sectionMatch = int.Parse(Regex.Replace(formItemKey, "\\w*section(\\d+)\\w*", "$1"));
						subtextMatch = int.Parse(Regex.Replace(formItemKey, "\\w*subtext(\\d+)\\w*", "$1"));
						//					Response.Write("Section: " & sectionMatch & "<br>" & vbCrLf)
						//					Response.Write("Subsection: " & subtextMatch & "<br>" & vbCrLf)
						if (0 != String.Compare(((DaikonGrantReportSubSection)((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).Subsections[subtextMatch]).SubsectionText, Request.Form[formItemKey], false))
						{
							changeNav.PrependChildElement("", "change", sareNamespace, "Subsection");
							changeNav.MoveToFirstChild();
							changeNav.CreateAttribute("", "section", sareNamespace, sectionMatch.ToString());
							changeNav.CreateAttribute("", "sectionName", sareNamespace, ((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).SectionName);
							changeNav.CreateAttribute("", "subsection", sareNamespace, subtextMatch.ToString());
							changeNav.CreateAttribute("", "type", sareNamespace, "Update");
							changeNav.CreateAttribute("", "previousval", sareNamespace, ((DaikonGrantReportSubSection)((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).Subsections[subtextMatch]).SubsectionText);
							changeNav.CreateAttribute("", "currentval", sareNamespace, Request.Form[formItemKey]);
							changeNav.MoveToParent();
                            reportToSave.UpdateSub(sectionMatch, -1, "-1", Request.Form[formItemKey], subtextMatch, -1);
						}
					}
					else if (Regex.IsMatch(formItemKey, "\\w*subtype(\\d+)\\w*"))
					{
						sectionMatch = int.Parse(Regex.Replace(formItemKey, "\\w*listParagraphType(\\d+)\\w*", "$1"));
						subtextMatch = int.Parse(Regex.Replace(formItemKey, "\\w*subtype(\\d+)\\w*", "$1"));
						//					Response.Write("Section: " & sectionMatch & "<br>" & vbCrLf)
						//					Response.Write("Subsection: " & subtextMatch & "<br>" & vbCrLf)
						if (0 != String.Compare(((DaikonGrantReportSubSection)((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).Subsections[subtextMatch]).SubsectionType.ToString(), Request.Form[formItemKey], true))
						{
							changeNav.PrependChildElement("", "change", sareNamespace, "Subsection Type");
							changeNav.MoveToFirstChild();
							changeNav.CreateAttribute("", "section", sareNamespace, sectionMatch.ToString());
							changeNav.CreateAttribute("", "sectionName", sareNamespace, ((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).SectionName);
							changeNav.CreateAttribute("", "subsection", sareNamespace, subtextMatch.ToString());
							changeNav.CreateAttribute("", "type", sareNamespace, "Update");
							changeNav.CreateAttribute("", "previousval", sareNamespace, ((DaikonGrantReportSubSection)((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).Subsections[subtextMatch]).SubsectionText);
							changeNav.CreateAttribute("", "currentval", sareNamespace, Request.Form[formItemKey]);
							changeNav.MoveToParent();

							reportToSave.UpdateSub(sectionMatch, -1, "-1", "-1", subtextMatch, int.Parse(Request.Form[formItemKey]));
						}
					}

					//				' Response.Write(Request.Form.Item(formItemKey) & "<p>" & vbCrLf)
					//				'				testReport.UpdateSub(sectionMatch, -1, -1, Request.Form.Item(formItemKey), -1, subtextMatch)
				}

				foreach (string formItemKey in Request.Form.Keys)
				{
					if (Regex.IsMatch(formItemKey, "\\w*moveup(\\d+)\\w*"))
					{
						sectionMatch = int.Parse(Regex.Replace(formItemKey, "\\w*section(\\d+)\\w*", "$1"));
						currentOrder = int.Parse(Regex.Replace(formItemKey, "\\w*moveup(\\d+)\\w*", "$1"));

						changeNav.PrependChildElement("", "change", sareNamespace, "Subsection");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "section", sareNamespace, sectionMatch.ToString());
						changeNav.CreateAttribute("", "sectionName", sareNamespace, ((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).SectionName);
						changeNav.CreateAttribute("", "subsection", sareNamespace, currentOrder.ToString());
						changeNav.CreateAttribute("", "type", sareNamespace, "Move");
						changeNav.CreateAttribute("", "previousval", sareNamespace, currentOrder.ToString());
						changeNav.CreateAttribute("", "currentval", sareNamespace, (currentOrder - 1).ToString());
						changeNav.MoveToParent();
                        if (currentOrder > 1)
						    reportToSave.MoveSub(sectionMatch, currentOrder, currentOrder - 1);
						Response.Redirect("sare_main.aspx?do=editRept&pn=" + (string)(Session["currGrant"]) + "&y=" + reportToSave.Year + "&t=" + reportToSave.Type);
					}
					else if (Regex.IsMatch(formItemKey, "\\w*movedown(\\d+)\\w*"))
					{
						sectionMatch = int.Parse(Regex.Replace(formItemKey, "\\w*section(\\d+)\\w*", "$1"));
						currentOrder = int.Parse(Regex.Replace(formItemKey, "\\w*movedown(\\d+)\\w*", "$1"));

						changeNav.PrependChildElement("", "change", sareNamespace, "Subsection");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "section", sareNamespace, sectionMatch.ToString());
						changeNav.CreateAttribute("", "sectionName", sareNamespace, ((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).SectionName);
						changeNav.CreateAttribute("", "subsection", sareNamespace, currentOrder.ToString());
						changeNav.CreateAttribute("", "type", sareNamespace, "Move");
						changeNav.CreateAttribute("", "previousval", sareNamespace, currentOrder.ToString());
						changeNav.CreateAttribute("", "currentval", sareNamespace, (currentOrder + 1).ToString());
						changeNav.MoveToParent();
                        reportToSave.MoveSub(sectionMatch, currentOrder, currentOrder + 1);
						Response.Redirect("sare_main.aspx?do=editRept&pn=" + (string)(Session["currGrant"]) + "&y=" + reportToSave.Year + "&t=" + reportToSave.Type);
					}
					else if (Regex.IsMatch(formItemKey, "\\w*insert(\\d+)\\w*"))
					{
						sectionMatch = int.Parse(Regex.Replace(formItemKey, "\\w*section(\\d+)\\w*", "$1"));
						currentOrder = int.Parse(Regex.Replace(formItemKey, "\\w*insert(\\d+)\\w*", "$1"));

						changeNav.PrependChildElement("", "change", sareNamespace, "Subsection");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "section", sareNamespace, sectionMatch.ToString());
						changeNav.CreateAttribute("", "sectionName", sareNamespace, ((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).SectionName);
						changeNav.CreateAttribute("", "subsection", sareNamespace, currentOrder.ToString());
						changeNav.CreateAttribute("", "type", sareNamespace, "Insert (to location listed)");
						changeNav.CreateAttribute("", "previousval", sareNamespace, "0");
						changeNav.CreateAttribute("", "currentval", sareNamespace, currentOrder.ToString());
						changeNav.MoveToParent();

						reportToSave.InsertSub(sectionMatch, currentOrder);
						Response.Redirect("sare_main.aspx?do=editRept&pn=" + (string)(Session["currGrant"]) + "&y=" + reportToSave.Year + "&t=" + reportToSave.Type);
					}
					else if (Regex.IsMatch(formItemKey, "\\w*delete(\\d+)\\w*"))
					{
						sectionMatch = int.Parse(Regex.Replace(formItemKey, "\\w*section(\\d+)\\w*", "$1"));
						currentOrder = int.Parse(Regex.Replace(formItemKey, "\\w*delete(\\d+)\\w*", "$1"));

						changeNav.PrependChildElement("", "change", sareNamespace, "Subsection");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "section", sareNamespace, sectionMatch.ToString());
						changeNav.CreateAttribute("", "sectionName", sareNamespace, ((DaikonGrantReportSection)(reportToSave.Sections[sectionMatch])).SectionName);
						changeNav.CreateAttribute("", "subsection", sareNamespace, currentOrder.ToString());
						changeNav.CreateAttribute("", "type", sareNamespace, "Delete (from location listed)");
						changeNav.CreateAttribute("", "previousval", sareNamespace, currentOrder.ToString());
						changeNav.CreateAttribute("", "currentval", sareNamespace, "0");
						changeNav.MoveToParent();
                        if (currentOrder > 1 && currentOrder < 100)
						    reportToSave.DeleteSub(sectionMatch, currentOrder);
						Response.Redirect("sare_main.aspx?do=editRept&pn=" + (string)(Session["currGrant"]) + "&y=" + reportToSave.Year + "&t=" + reportToSave.Type);
					}
					else if (Regex.IsMatch(formItemKey, "\\w*fileUp\\w*"))
					{
						reportToSave.saveToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], projectToSave.projNum, projectToSave.Type, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
						reportToSave.Refresh(ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());

						Response.Redirect("sare_main.aspx?do=editRept&pn=" + (string)(Session["currGrant"]) + "&y=" + reportToSave.Year + "&t=" + reportToSave.Type);
					}
					else if (Regex.IsMatch(formItemKey, "\\w*saveandstay\\w*"))
					{
						reportToSave.saveToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], projectToSave.projNum, projectToSave.Type, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
						reportToSave.Refresh(ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
						Response.Redirect("sare_main.aspx?do=editRept&pn=" + (string)(Session["currGrant"]) + "&y=" + reportToSave.Year + "&t=" + reportToSave.Type);
					}
					else if (Regex.IsMatch(formItemKey, "\\w*saveandpreview\\w*"))
					{
                        if (Request.Form["approved"] != null)
                        {
                            reportToSave.Status = true;
                            //ReportSubmitApproveMailer(currUser.Email, projectToSave.projNum, reportToSave.Type, projectToSave.projTitle, projectToSave.Region, "Approved");
                            //Session["statusMessage2"] = "The project report has been approved";
                        }
                        else
                        {
                            reportToSave.Status = false;
                            //ReportSubmitApproveMailer(currUser.Email, projectToSave.projNum, reportToSave.Type, projectToSave.projTitle, projectToSave.Region, "Not Approved");
                            //Session["statusMessage2"] = "The project report has not been approved.";
                        }
                        
						reportToSave.saveToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], projectToSave.projNum, projectToSave.Type, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
						reportToSave.Refresh(ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());                        
						Response.Redirect("sare_main.aspx?do=viewRept&pn=" + (string)(Session["currGrant"]) + "&y=" + reportToSave.Year + "&t=" + reportToSave.Type);
					}
				}
				bool reptStatus;
                if (Request.Form["btnProjectDetailsApprove"] != null)
                    bool.TryParse("true", out reptStatus);
                else
				    bool.TryParse(Request.Form["approved"], out reptStatus);

                if (Request.Form["btnProjectDetailsNotApprove"] != null)
                    reportToSave.NotApproved = true;
                else
                    reportToSave.NotApproved = false;

				if (reportToSave.Status != reptStatus)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Report");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Approval Status");
					if (reportToSave.Status == true)
						changeNav.CreateAttribute("", "previousval", sareNamespace, "Approved");
					else
						changeNav.CreateAttribute("", "previousval", sareNamespace, "Not Approved");
					if (reptStatus == true)
						changeNav.CreateAttribute("", "currentval", sareNamespace, "Approved");
					else
						changeNav.CreateAttribute("", "currentval", sareNamespace, "Not Approved");
					changeNav.MoveToParent();

					reportToSave.Status = reptStatus;
				}

				bool submitStatus;
								
				if (Request.Form["btnSubmit"] == "Submit" || Request.Form["btnProjectDetailsSubmit"] != null)
					submitStatus = true;
				else
					submitStatus = false;

				if ((submitStatus == true) || (submitStatus != reportToSave.Status))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Report");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Submission Status");
					if (reportToSave.Status == true)
						changeNav.CreateAttribute("", "previousval", sareNamespace, "Submitted");
					else
						changeNav.CreateAttribute("", "previousval", sareNamespace, "Not Submitted");
					if (submitStatus == true)
						changeNav.CreateAttribute("", "currentval", sareNamespace, "Submitted");
					else
						changeNav.CreateAttribute("", "currentval", sareNamespace, "Not Submitted");
					changeNav.MoveToParent();

					reportToSave.SubmitStatus = submitStatus;
				}


				//				'	testReport.saveToDB(5, 1, ConfigurationManager.ConnectionStrings("sareDaikonConnectionString"))

				//*****//
				reportToSave.saveToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], projectToSave.projNum, projectToSave.Type, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());

				reportToSave.toXML(ref xmlWriter);

				//Session["confirmthis"] = writerString.ToString();                

				//*****//
				//			'			Session.Item("currReport") = testReport
				/*
							StringWriter writerString = new StringWriter();

							XmlTextWriter tempXmlWriter = new XmlTextWriter(writerString);
				//			'(Response.Output)	   '(tempStream, Encoding.UTF8)
							tempXmlWriter.Formatting = Formatting.Indented;

							reportToSave.toXML(ref tempXmlWriter);
				//			'	tempsub1.toXML(tempXmlWriter)

							tempXmlWriter.Flush();

				//			'		Response.Write(vbCrLf & "Test: " & (tempsub1.CompareTo(1)).ToString())
				//			'		Response.Write(testSection.toHTML())
				//			'		Response.Write(tempXmlWriter.ToString())

							StringReader readerString = new StringReader(writerString.ToString());

							Response.Write("\nXML Output: \n" + writerString.ToString());
				*/
				//switch (reportToSave.Type)
				//{
				//    case 0:
				//        currUser.Grants[(string)(Session["currGrant"])].AnnualRepts[reportToSave.Year] = reportToSave;
				//        break;
				//    case 1:
				//        currUser.Grants[(string)(Session["currGrant"])].FinalRepts[reportToSave.Year] = reportToSave;
				//        break;
				//    case 2:
				//        currUser.Grants[(string)(Session["currGrant"])].ProposalRepts[reportToSave.Year] = reportToSave;
				//        break;
				//    default:
				//        currUser.Grants[(string)(Session["currGrant"])].FinalRepts[reportToSave.Year] = reportToSave;
				//        break;
				//}
				currUser.Grants[(string)(Session["currGrant"])].Reports[reportToSave.Year.ToString() + reportToSave.Type.ToString()] = reportToSave;
			}
			Session["currUser"] = currUser;

            /*if (Request.Form["btnProjectDetailsSubmit"] == null ||
                Request.Form["btnProjectDetailsApprove"] == null ||
                Request.Form["btnProjectDetailsNotApprove"] == null)
            {*/
                //projectDetialsUpdateHandler(sender, e);
            //}
            if (reportToSave.SubmitStatus == true && reportToSave.NotApproved == false)
            {
                try
                {
                    //sareChangeMailer();

                    if (reportToSave.Status == false)
                    {
                        if (Request.Form["btnSave"] == "Save Without Submitting")
                        {
                            Session["statusMessage2"] = "Your report has been saved, but it has not been submitted. To submit the report, return to the Project Overview page, open the report, then click Submit.";
                        }
                        else
                        {
                            ReportSubmitApproveMailer(currUser.Email, projectToSave.projNum, reportToSave.Type, projectToSave.projTitle, projectToSave.Region, "Submitted");
                            Session["statusMessage2"] = "Thank you for using the SARE Reporting System.  Notification of your changes and report submission has been sent to your regional Communications Specialist.  ";                       
                        }
                    }
                    else
                    {
                        ReportSubmitApproveMailer(currUser.Email, projectToSave.projNum, reportToSave.Type, projectToSave.projTitle, projectToSave.Region, "Approved");
                        Session["statusMessage2"] = "Thank you for using the SARE Reporting System.  Notification of report approval has been sent to PI.  ";
                    }
                }
                catch (SystemException ex)
                {
                    outputMessage1 = "Unable to send confirmation email" + ex.Message;
                    Session["statusMessage2"] = "Thank you for using the SARE Reporting System.  While the server was unable to send email notification of your changes and report submission to your regional communications specialist, your submission has still been saved successfully and will show up as a submitted report in their list.  ";
                }
            }
            else
            {
                if (reportToSave.Type == 2)
                    Session["statusMessage2"] = "Your proposal narrative has been saved but the Project Overview has not been submitted for approval yet. To edit and/or submit the Project Overview for approval, return to the Project Overview page.";
                else
                    //Session["statusMessage2"] = "Your report has been saved. Click Project Overview to return to the Project Overview page and submit the report for approval.";
                    Session["statusMessage2"] = "Your report has been saved, but it has not been submitted. To submit the report, return to the Project Overview page, open the report, then click Submit.";
            }

            if (writerString != null)
            {

                if (Request.Form["btnProjectDetailsApprove"] != null)
                {
                    ReportSubmitApproveMailer(currUser.Email, projectToSave.projNum, reportToSave.Type, projectToSave.projTitle, projectToSave.Region, "Approved");
                    Session["statusMessage2"] = "The project report has been approved.";
                }
                else if (Request.Form["btnProjectDetailsNotApprove"] != null)
                {
                    ReportSubmitApproveMailer(currUser.Email, projectToSave.projNum, reportToSave.Type, projectToSave.projTitle, projectToSave.Region, "Not Approved");
                    Session["statusMessage2"] = "The project report has not been approved.";
                }
                else
                {
                    if (currUser.Roles.IsAdmin())
                    {
                        if ((Request.Form["confDel"] != null) && (Request.Form["cmdDeleteReport"] != null))
                            Session["statusMessage2"] = "The " + reportToSave.StrType + " report for this project has been deleted.";
                        //else
                        //    Session["statusMessage2"] = Session["statusMessage2"] + "Project " + reportToSave.StrType + " has been saved. Please click Return to Project Overview, make sure you have reviewed all sections of the project overview, then click the Submit button.";
                    }
                    //else
                    //    Session["statusMessage2"] = Session["statusMessage2"] + "Project " + reportToSave.StrType + " has been saved. Please click BACK, make sure you have filled in all the required information, and click Submit for Approval button";

                }
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=submit&pn=" + (string)(Session["currGrant"]) + "&t=" + reportToSave.Type);
            }


			/*
			System.Net.Mail.MailMessage message = new System.Net.Mail.MailMessage("if-svc-sareuser@ufl.edu", "if-svc-sareuser@ufl.edu"); //"estragon@ufl.edu", "Test", "Message Text");

//            message.Sender = "if-svc-sareuser@ufl.edu";
			message.To.Add("san@sare.org");
			message.To.Add("estragon@ufl.edu");
			message.Subject = "MySARE Report Submission";
			message.Body = currUser.FirstName + " " + currUser.LastName + " has submitted a new " + reportToSave.Year + " " + reportToSave.StrType + " report for " + (string)(Session["currGrant"]) + ".  Please log in to MySARE to review and approve this report.";

			System.Net.Mail.SmtpClient mailClient = new System.Net.Mail.SmtpClient("smtp.ifas.ufl.edu", 25);

			mailClient.Send(message); 
			*/
			//            Response.Redirect("sare_main.aspx?do=myProj");
			//            OutputPage(sender, e);
			//            Response.Redirect("");
		}

		protected void logOut()
		{
			//            Session_OnEnd();

			Session.Abandon();
			this.Dispose();
			FormsAuthentication.SignOut();
			Response.Redirect("login.aspx", true);
		}

		public string pageGetPath()
		{
			return this.MapPath(Page.TemplateSourceDirectory);
		}

		public static void showUserFilesList(HtmlTextWriter htmlOut, string pagePath, DaikonUser user)
		{
			string htmlCache = "<p>\n<span class=\"pagetitledown\">My Files</span>\n<br><br>\n";
			try
			{
				foreach (UserRole role in user.Roles.RoleSet)
				{

					DirectoryInfo di = new DirectoryInfo(@pagePath + "\\fileshare\\" + role.RoleCode + "\\");

					foreach (FileInfo f in di.GetFiles())
					{
						String name = f.Name;
						htmlCache = htmlCache + "<a href=\"./getfile.aspx?file=" + role.RoleCode + "\\" + name + "\">" + name + "</a><br>\n";

					}
				}
				/*
								// Get only subdirectories that contain the letter "p."
								DirectoryInfo[] dirs = di.GetDirectories("*f*");

								htmlCache = htmlCache + "Number of directories with an f: {0}" + dirs.Length;

								// Count all the files in each subdirectory that contain the letter "e."
								foreach (DirectoryInfo diNext in dirs) 
								{
									htmlCache = htmlCache + "The number of files in {0} with an e is {1}" + diNext + 
										diNext.GetFiles("*e*").Length;
								}
				*/
			}
			catch (Exception e)
			{
				htmlCache = htmlCache + "The file list process failed: {0}" + e.ToString();
			}

			htmlOut.Write(htmlCache);
		}

		public void UserEditFormXMLWriter()
		{
			DaikonUser editingUser;
			string targetUsername;
			string currUsername = ((DaikonUser)(Session["currUser"])).Username;
			string userOp = Request.Params.Get("do");
			string userType;

			if (userOp == "addparticipant")
			{
				if (Session["editparticipant"] != null)
				{
					editingUser = (DaikonParticipant)Session["editparticipant"];
				}
				else
					editingUser = new DaikonParticipant();
				userType = "participant";
			}
			else if (userOp == "editparticipant")
			{
				if (Request.Params.Get("user") != null)
				{
					targetUsername = Request.Params.Get("user");
					if (targetUsername != "")
					{
						if (Session["editparticipant"] != null)
						{
							editingUser = (DaikonParticipant)Session["editparticipant"];
						}
						else
						{
							editingUser = new DaikonParticipant(Convert.ToInt32(targetUsername));
						}
					}
					else
					{
						if (Session["editparticipant"] != null)
						{
							editingUser = (DaikonParticipant)Session["editparticipant"];
						}
						else
						{
							editingUser = new DaikonParticipant();
						}
					}
				}
				else
				{
					editingUser = new DaikonParticipant();
					if (Session["editparticipant"] != null)
					{
						editingUser = (DaikonParticipant)Session["editparticipant"];
					}
				}
				userType = "participant";
			}
			else if (Session["currUser"] != null)
			{
				if (Request.Params.Get("user") != null)
				{
					targetUsername = Request.Params.Get("user");
					if (((DaikonUser)(Session["currUser"])).Roles.IsAdmin())
					{
						if (targetUsername != "")
						{
							editingUser = new DaikonUser(currUsername, (int)Session["sessionkey"], targetUsername);
						}
						else
						{
							editingUser = (DaikonUser)(Session["currUser"]);
						}
					}
					else
					{
						editingUser = (DaikonUser)(Session["currUser"]);
					}
				}
                else if (Session["editingUser"] != null &&
                         Session["editingUser"].ToString() != "daikon.DaikonParticipant")
                {
                    //if (Request.Params["user"] != null)
                        editingUser = (DaikonUser)(Session["editingUser"]);
                    //else
                    //    editingUser = (DaikonUser)(Session["currUser"]);
                }
                else
                {
                    editingUser = (DaikonUser)(Session["currUser"]);
                }
				userType = "user";
			}
			else
			{
				editingUser = new DaikonUser();
				userType = "user";
			}

			Session["editingUser"] = editingUser;

			editingUser.toXML(xmlWriter, "editing");

			xsltArgs.AddParam("loggedinUser", "", currUsername);
			xsltArgs.AddParam("editingUser", "", editingUser.Username);
			xsltArgs.AddParam("usertype", "", userType);
			
		}

        public void CoordinatorEditFormXMLWriter()
        {
            DaikonUser editingUser;
            string targetUsername;
            string currUsername = ((DaikonUser)(Session["currUser"])).Username;
            string userOp = Request.Params.Get("do");
            string userType;

            if (userOp == "addcoordinator")
            {
                if (Session["editcoordinator"] != null)
                {
                    editingUser = (DaikonParticipant)Session["editcoordinator"];
                }
                else
                    editingUser = new DaikonParticipant();
                userType = "coordinator";
            }
            else if (userOp == "editcoordinator")
            {
                if (Request.Params.Get("user") != null)
                {
                    targetUsername = Request.Params.Get("user");
                    if (targetUsername != "")
                    {
                        if (Session["editcoordinator"] != null)
                        {
                            editingUser = (DaikonParticipant)Session["editcoordinator"];
                        }
                        else
                        {
                            editingUser = new DaikonParticipant(Convert.ToInt32(targetUsername));
                        }
                    }
                    else
                    {
                        if (Session["editcoordinator"] != null)
                        {
                            editingUser = (DaikonParticipant)Session["editcoordinator"];
                        }
                        else
                        {
                            editingUser = new DaikonParticipant();
                        }
                    }
                }
                else
                {
                    editingUser = new DaikonParticipant();
                    if (Session["editcoordinator"] != null)
                    {
                        editingUser = (DaikonParticipant)Session["editcoordinator"];
                    }
                }
                userType = "coordinator";
            }
            else
            {
                editingUser = new DaikonUser();
                userType = "user";
            }

            Session["editingUser"] = editingUser;

            editingUser.toXML(xmlWriter, "editing");

            xsltArgs.AddParam("loggedinUser", "", currUsername);
            xsltArgs.AddParam("editingUser", "", editingUser.Username);
            xsltArgs.AddParam("usertype", "", userType);
        }

        public void StateCoordinatorViewFormXMLWriter()
        {
            DaikonUser editingUser;
            string targetUsername;
            string currUsername = ((DaikonUser)(Session["currUser"])).Username;
            string userOp = Request.Params.Get("do");
            string userType = "";

            targetUsername = Request.Params.Get("user");
            if (targetUsername != "")
            {
                editingUser = new DaikonUser(currUsername, (int)Session["sessionkey"], targetUsername);
            }
            else
            {
                editingUser = new DaikonUser();
                userType = "user";
            }

            Session["editingUser"] = editingUser;

            editingUser.toXML(xmlWriter, "viewing");
            xsltArgs.AddParam("loggedinUser", "", currUsername);
            xsltArgs.AddParam("usertype", "", userType);
        }

		public Boolean FormFieldValidator(object fieldVal)
		{
			Boolean valid = false;
			//  ^([1-zA-Z0-1@.\s]{1,255})$

			String fieldValAsString = MNS(fieldVal);

			if (Regex.IsMatch(fieldValAsString, "^([1-zA-Z0-1/&-@.\\s]{1,255})$"))
			{
				valid = true;
			}

			return valid;
		}

		public void UserEditFormHandler(object sender, System.EventArgs e)
		{
			//			Response.Write("User Updated");
			DaikonUser editedUser;
			DaikonUser currentUser;
			changeNav.MoveToRoot();
			changeNav.MoveToChild("SAREroot", sareNamespace);

			if (Session["currUser"] != null)
			{
				currentUser = (DaikonUser)(Session["currUser"]);
			}
			else
			{
				currentUser = null;
			}
			//			UserRoles currUserRoles;
			// = ((DaikonUser)(Session["currUser"])).Roles;
			/*
						string username;
						string firstName;
						string lastName;
						string org;
						string position;
						string addrStreet;
						string addrCity;
						string addrState;
						string addrZip;
						string numPhone;
						string email;
						string website;
			*/
			string username = Request.Form["targetUser"];
			//				((DaikonUser)(Session["currUser"])).Username; //Request.Form["username"];
			string nameTitle = Request.Form["nameTitle"];
			string firstName = Request.Form["firstName"];
			string lastName = Request.Form["lastName"];
			string namePostfix = Request.Form["namePostfix"];
			string org = Request.Form["org"];
			string orgPosition = Request.Form["orgPosition"];
			string addrStreet1 = Request.Form["addrStreet1"];
			string addrStreet2 = Request.Form["addrStreet2"];
			string addrCity = Request.Form["addrCity"];
			string addrState = Request.Form["addrState"];
			string addrZip = Request.Form["addrZip"];
			string addrZip4 = Request.Form["addrZip4"];
			string numPhone = Request.Form["numPhone"];
			string numFax = Request.Form["numFax"];
			string numCell = Request.Form["numCell"];
			string email = Request.Form["email"];
			string website = Request.Form["website"];

            bool isnatadmin = (bool)(Request.Form["natAdmin"] == "on");
			bool isregadmin = (bool)(Request.Form["regAdmin"] == "on");
			string regadminregion = Request.Form["regAdminRegion"];
			bool isprojpi = (bool)(Request.Form["projPI"] == "on");
			bool isgenuser = (bool)(Request.Form["genUser"] == "on");
			bool isrescompmanager = (bool)(Request.Form["resCompManager"] == "on");
			bool isresmanager = (bool)(Request.Form["resManager"] == "on");
			bool iscalsubmitter = (bool)(Request.Form["calSubmitter"] == "on");
			bool isresauthor = (bool)(Request.Form["resAuthor"] == "on");
			bool isadmin = (bool)(Request.Form["admin"] == "on");
			bool isnatstaff = (bool)(Request.Form["natStaff"] == "on");
			bool isprojproposer = (bool)(Request.Form["projProposer"] == "on");

			bool onEmailList = (bool)(Request.Form["sareMailList"] == "on");

			if ((Session["editingUser"] != null) && (currentUser != null))
			{
				editedUser = (DaikonUser)Session["editingUser"];
				username = editedUser.Username;
				while (changeNav.MoveToChild("changeduser", sareNamespace))
				{
					if (editedUser.Username == changeNav.GetAttribute("username", sareNamespace))
						break;
				}
				if (editedUser.Username != changeNav.GetAttribute("username", sareNamespace))
				{
					if (changeNav.LocalName == "changeduser")
						changeNav.MoveToParent();
					changeNav.PrependChildElement("", "changeduser", sareNamespace, "");
					changeNav.MoveToChild("changeduser", sareNamespace);
					changeNav.CreateAttribute("", "username", sareNamespace, username);
					changeNav.CreateAttribute("", "changed", sareNamespace, "1");
				}

				if (editedUser.NameTitle != nameTitle)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Title");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.NameTitle);
					changeNav.CreateAttribute("", "currentval", sareNamespace, nameTitle);
					changeNav.MoveToParent();
					editedUser.NameTitle = nameTitle;
				}

				if (editedUser.FirstName != firstName)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "First Name");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.FirstName);
					changeNav.CreateAttribute("", "currentval", sareNamespace, firstName);
					changeNav.MoveToParent();
					editedUser.FirstName = firstName;
				}

				editedUser.LastName = lastName;
				if (editedUser.LastName != lastName)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Last Name");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.LastName);
					changeNav.CreateAttribute("", "currentval", sareNamespace, lastName);
					changeNav.MoveToParent();
					editedUser.LastName = lastName;
				}

				if (editedUser.NamePostfix != namePostfix)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Name Postfix");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.NamePostfix);
					changeNav.CreateAttribute("", "currentval", sareNamespace, namePostfix);
					changeNav.MoveToParent();
					editedUser.NamePostfix = namePostfix;
				}

				if (editedUser.Org != org)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Organization");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.Org);
					changeNav.CreateAttribute("", "currentval", sareNamespace, org);
					changeNav.MoveToParent();
					editedUser.Org = org;
				}

				if (editedUser.OrgPosition != orgPosition)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Position");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.OrgPosition);
					changeNav.CreateAttribute("", "currentval", sareNamespace, orgPosition);
					changeNav.MoveToParent();
					editedUser.OrgPosition = orgPosition;
				}

				if (editedUser.AddrStreet1 != addrStreet1)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Street Address");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.AddrStreet1);
					changeNav.CreateAttribute("", "currentval", sareNamespace, addrStreet1);
					changeNav.MoveToParent();
					editedUser.AddrStreet1 = addrStreet1;
				}

				if (editedUser.AddrStreet2 != addrStreet2)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Street Address 2");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.AddrStreet2);
					changeNav.CreateAttribute("", "currentval", sareNamespace, addrStreet2);
					changeNav.MoveToParent();
					editedUser.AddrStreet2 = addrStreet2;
				}

				if (editedUser.AddrCity != addrCity)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "City");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.AddrCity);
					changeNav.CreateAttribute("", "currentval", sareNamespace, addrCity);
					changeNav.MoveToParent();
					editedUser.AddrCity = addrCity;
				}

				if (editedUser.AddrState != addrState)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "State");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.AddrState);
					changeNav.CreateAttribute("", "currentval", sareNamespace, addrState);
					changeNav.MoveToParent();
					editedUser.AddrState = addrState;
				}

				if (editedUser.AddrZip != addrZip)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "ZIP Code");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.AddrZip);
					changeNav.CreateAttribute("", "currentval", sareNamespace, addrZip);
					changeNav.MoveToParent();
					editedUser.AddrZip = addrZip;
				}

				if (editedUser.AddrZip4 != addrZip4)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "ZIP +4");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.AddrZip4);
					changeNav.CreateAttribute("", "currentval", sareNamespace, addrZip4);
					changeNav.MoveToParent();
					editedUser.AddrZip4 = addrZip4;
				}

				if (editedUser.NumPhone != numPhone)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Phone");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
                    changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.NumPhone);
                    changeNav.CreateAttribute("", "currentval", sareNamespace, numPhone);
					changeNav.MoveToParent();
					editedUser.NumPhone = numPhone;
				}

				if (editedUser.NumFax != numFax)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Fax");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.NumFax);
					changeNav.CreateAttribute("", "currentval", sareNamespace, numFax);
					changeNav.MoveToParent();
					editedUser.NumFax = numFax;
				}

				if (editedUser.NumCell != numCell)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Cell");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.NumCell);
					changeNav.CreateAttribute("", "currentval", sareNamespace, numCell);
					changeNav.MoveToParent();
					editedUser.NumCell = numCell;
				}

				if (editedUser.Email != email)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Email");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.Email);
					changeNav.CreateAttribute("", "currentval", sareNamespace, email);
					changeNav.MoveToParent();
					editedUser.Email = email;
				}

				if (editedUser.Website != website)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Website");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.Website);
					changeNav.CreateAttribute("", "currentval", sareNamespace, website);
					changeNav.MoveToParent();
					editedUser.Website = website;
				}

				if (editedUser.OnEmailList != onEmailList)
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "On Email List");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "change");
					changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.OnEmailList.ToString());
					changeNav.CreateAttribute("", "currentval", sareNamespace, onEmailList.ToString());
					changeNav.MoveToParent();
					editedUser.OnEmailList = onEmailList;
				}
                
				if (isnatadmin)
				{
					if (!editedUser.Roles.HasRole("natAdmin"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "National Admin Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "natAdmin", "");
					}
				}
				else if (editedUser.Roles.HasRole("natAdmin"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "National Admin Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "natAdmin", "");
				}
				if (isregadmin)
				{
					if (!editedUser.Roles.HasRole("regAdmin"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "Regional Admin Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.CreateAttribute("", "region", sareNamespace, regadminregion);
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "regAdmin", regadminregion);
					}
					else
					{
						int roleID = editedUser.Roles.GetRole("regAdmin").RoleID;
						if (editedUser.Roles.GetRole("regAdmin").ForRegion != regadminregion)
						{
							changeNav.PrependChildElement("", "change", sareNamespace, "Regional Admin Role");
							changeNav.MoveToFirstChild();
							changeNav.CreateAttribute("", "type", sareNamespace, "Changed Region");
							changeNav.CreateAttribute("", "previousval", sareNamespace, editedUser.Roles.GetRole("regAdmin").ForRegion);
							changeNav.CreateAttribute("", "currentval", sareNamespace, regadminregion);
							changeNav.MoveToParent();
							editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, roleID);
							//editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "regAdmin", regadminregion);
						}
					}

				}
				else if (editedUser.Roles.HasRole("regAdmin"))
				{
					int roleID = editedUser.Roles.GetRole("regAdmin").RoleID;
					changeNav.PrependChildElement("", "change", sareNamespace, "Regional Admin Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, roleID);
				}
				if (isprojpi)
				{
					if (!editedUser.Roles.HasRole("projPI"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "Project PI Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "projPI", "");
					}
				}
				else if (editedUser.Roles.HasRole("projPI"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Project PI Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "projPI", "");
				}

				// Commented so that General User role is true all the time
				// Uncommented to enable "Disable User"
             
				if (currUser.Roles.IsAdmin())
				{
                    /*if (!editedUser.Roles.HasRole("genUser"))
                    {
                        changeNav.PrependChildElement("", "change", sareNamespace, "General User Role");
                        changeNav.MoveToFirstChild();
                        changeNav.CreateAttribute("", "type", sareNamespace, "Restored");
                        changeNav.MoveToParent();
                        editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "genUser", "");
                    }
                    else
                    {
                        changeNav.PrependChildElement("", "change", sareNamespace, "General User Role");
                        changeNav.MoveToFirstChild();
                        changeNav.CreateAttribute("", "type", sareNamespace, "Removed (account locked)");
                        changeNav.MoveToParent();
                        editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "lockAcct", "");
                        editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "genUser", "");
				
                    }
                    */
                    if (isgenuser == false)
                    {
                        changeNav.PrependChildElement("", "change", sareNamespace, "General User Role");
                        changeNav.MoveToFirstChild();
                        changeNav.CreateAttribute("", "type", sareNamespace, "Removed (account locked)");
                        changeNav.MoveToParent();
                        editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "lockAcct", "");
                        editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "genUser", "");
				
                    }
                    if (editedUser.Roles.HasRole("lockAcct") && isgenuser == true)
					{
                        changeNav.PrependChildElement("", "change", sareNamespace, "General User Role");
                        changeNav.MoveToFirstChild();
                        changeNav.CreateAttribute("", "type", sareNamespace, "Restored");
                        changeNav.MoveToParent();
                        editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "genUser", "");
                   		editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "lockAcct", "");
					}
				}/*
                else if (editedUser.Roles.HasRole("genUser") && currUser.Roles.IsAdmin())
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "General User Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed (account locked)");
					changeNav.MoveToParent();
					//editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "lockAcct", "");
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "genUser", "");
				}
                */
				if (isrescompmanager)
				{
					if (!editedUser.Roles.HasRole("resCompManager"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "Resource Compilation Manager Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "resCompManager", "");
					}
				}
				else if (editedUser.Roles.HasRole("resCompManager"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Resource Compilation Manager Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "resCompManager", "");
				}
				if (isresmanager)
				{
					if (!editedUser.Roles.HasRole("resManager"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "Resource Manager Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "resManager", "");
					}
				}
				else if (editedUser.Roles.HasRole("resManager"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Resource Manager Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "resManager", "");
				}
                
				if (iscalsubmitter)
				{
					if (!editedUser.Roles.HasRole("calSubmitter"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "Calendar Submitter Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "calSubmitter", "");
					}
				}
				else if (editedUser.Roles.HasRole("calSubmitter"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Calendar Submitter Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "calSubmitter", "");
				}
                
				if (isresauthor)
				{
					if (!editedUser.Roles.HasRole("resAuthor"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "Resource Author Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "resAuthor", "");
					}
				}
				else if (editedUser.Roles.HasRole("resAuthor"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Resource Author Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "resAuthor", "");
				}

				if (isadmin)
				{
					if (!editedUser.Roles.HasRole("admin"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "Administrator Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "admin", "");
					}
				}
				else if (editedUser.Roles.HasRole("admin"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Administrator Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "admin", "");
				}
                
				if (isnatstaff)
				{
					if (!editedUser.Roles.HasRole("natStaff"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "National Staff Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "natStaff", "");
					}
				}
				else if (editedUser.Roles.HasRole("natStaff"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "National Staff Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "natStaff", "");
				}
				if (isprojproposer)
				{
					if (!editedUser.Roles.HasRole("projProposer"))
					{
						changeNav.PrependChildElement("", "change", sareNamespace, "Project Proposer Role");
						changeNav.MoveToFirstChild();
						changeNav.CreateAttribute("", "type", sareNamespace, "Added");
						changeNav.MoveToParent();
						editedUser.Roles.AddRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "projProposer", "");
					}
				}
				else if (editedUser.Roles.HasRole("projProposer"))
				{
					changeNav.PrependChildElement("", "change", sareNamespace, "Project Proposer Role");
					changeNav.MoveToFirstChild();
					changeNav.CreateAttribute("", "type", sareNamespace, "Removed");
					changeNav.MoveToParent();
					editedUser.Roles.RemoveRole(currentUser.Username, (int)Session["sessionkey"], editedUser.Username, "projProposer", "");
				}
                

			}
			else
			{
				editedUser = new DaikonUser(username, nameTitle, firstName, lastName, namePostfix, org,
					orgPosition, addrStreet1, addrStreet2, addrCity, addrState,
					addrZip, addrZip4, numPhone, numFax, numCell, email, website, onEmailList);
			}

			//			Response.Write(isnatadmin + "<br>");
			//			Response.Write(isgenuser + "<br>");


			//			Response.Write(Request.Form["rolenatadmin"] + "<br>");
			//			Response.Write(Request.Form["rolegenuser"] + "<br>");

			//			currUserRoles = new UserRoles(isgenuser, isnatadmin, isregadmin, isrescompmanager, isresmanager, isprojpi, false, iscalsubmitter, isresauthor, isadmin, isnatstaff);

			//			editedUser.Roles = currUserRoles;

			//			Response.Write(editedUser.showUser());

			//			Response.Write("Username: " + Request.Form["username"] + "Password: " + Request.Form["password"]);

			if (FormFieldValidator(username) && FormFieldValidator(firstName) && FormFieldValidator(lastName)
				&& FormFieldValidator(org) && FormFieldValidator(addrStreet1) && FormFieldValidator(addrCity)
                && FormFieldValidator(addrState) && FormFieldValidator(addrZip) && (Request.Form["phoneCheck"] != null || FormFieldValidator(numPhone))
				&& FormFieldValidator(email))
			{

				Session.Remove("statusMessage1");

				if (Request.Form["password"].CompareTo(Request.Form["passconf"]) == 0)
				{
                    if (Request.Form["password"].Length != 0 && Request.Form["passconf"].Length != 0)
                    {
                        changeNav.PrependChildElement("", "change", sareNamespace, "Password");
                        changeNav.MoveToFirstChild();
                        changeNav.CreateAttribute("", "type", sareNamespace, "Password Changed");
                        changeNav.MoveToParent();
                    }

					if (editedUser.saveUserToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], username, Request.Form["password"]))
					{
						if (((DaikonUser)(Session["currUser"])).Username.CompareTo(username) == 0)
						{
							Session["currUser"] = editedUser;
							Session.Remove("editingUser");
						}
						editedUser.toXML(xmlWriter, "editeduser");

                        Session["confirmthis"] = writerString.ToString();

                        Session.Remove("editingUser");
                        Session["statusMessage2"] = "User information has been updated.";
                        Response.Redirect("sare_main.aspx?do=confirm&confirmType=update&user="+username);
						//Response.Redirect("sare_main.aspx");
					}
					else
					{
                        Session["statusMessage1"] = "Don't have required permission to save this edited user information.";
                        Session["editingUser"] = editedUser;
                        UserEditFormXMLWriter();
                        return;
						//OutputPage(sender, e);
						
					}
					
				}
				else if (Request.Form["password"].ToString().Length == 0)
				{
					Session["statusMessage1"] = "Please enter a Valid password.";
					Session["editingUser"] = editedUser;
					UserEditFormXMLWriter();
					return;
				}
				else if (Request.Form["passconf"].ToString().Length == 0)
				{
					Session["statusMessage1"] = "Please retype the password.";
					Session["editingUser"] = editedUser;
					UserEditFormXMLWriter();
					return;
				}
				else if (Request.Form["password"].CompareTo(Request.Form["passconf"]) != 0)
				{
					Session["statusMessage1"] = "Retyped password did not match.";
					Session["editingUser"] = editedUser;
					UserEditFormXMLWriter();
					return;
				}
				else if (editedUser.saveUserToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], username))
				{
					//				editedUser.setRoles(currUserRoles);
					//				Session["currUser"] = editedUser;
					if (((DaikonUser)(Session["currUser"])).Username.CompareTo(username) == 0)
					{
						Session["currUser"] = editedUser;
						Session.Remove("editingUser");
					}
					editedUser.toXML(xmlWriter, "editeduser");

					Session["confirmthis"] = writerString.ToString();

					Session.Remove("editingUser");
                    Session["statusMessage2"] = "User information has been updated.";
                    Response.Redirect("sare_main.aspx?do=confirm&confirmType=update&user="+username);
					//Response.Redirect("sare_main.aspx");
				}
				else
				{
					OutputPage(sender, e);
					//  UserEditForm(sender, e);
				}
			}
			else
			{
                string prev = editedUser.LastName;
				Session["statusMessage1"] = "A required field was not filled.";
				Session["editingUser"] = editedUser;
				UserEditFormXMLWriter();
				return;
				//OutputPage(sender, e);
				//  UserEditForm(sender, e);
			}


		}

		public void AddParticipantFormHandler(object sender, System.EventArgs e)
		{
			string nameTitle = Request.Form["nameTitle"];
			string firstName = Request.Form["firstName"];
			string lastName = Request.Form["lastName"];
			string namePostfix = Request.Form["namePostfix"];
			string org = Request.Form["org"];
			string orgPosition = Request.Form["orgPosition"];
			string addrStreet1 = Request.Form["addrStreet1"];
			string addrStreet2 = Request.Form["addrStreet2"];
			string addrCity = Request.Form["addrCity"];
			string addrState = Request.Form["addrState"];
			string addrZip = Request.Form["addrZip"];
			string addrZip4 = Request.Form["addrZip4"];
			string numPhone = Request.Form["numPhone"];
			string numFax = Request.Form["numFax"];
			string numCell = Request.Form["numCell"];
			string email = Request.Form["email"];
			string website = Request.Form["website"];

			DaikonParticipant addParticipant = new DaikonParticipant();

			addParticipant.NameTitle = nameTitle;
			addParticipant.FirstName = firstName;
			addParticipant.LastName = lastName;
			addParticipant.NamePostfix = namePostfix;
			addParticipant.Org = org;
			addParticipant.OrgPosition = orgPosition;
			addParticipant.AddrStreet1 = addrStreet1;
			addParticipant.AddrStreet2 = addrStreet2;
			addParticipant.AddrCity = addrCity;
			addParticipant.AddrState = addrState;
			addParticipant.AddrZip = addrZip;
			addParticipant.AddrZip4 = addrZip4;
			addParticipant.NumPhone = numPhone;
			addParticipant.NumFax = numFax;
			addParticipant.NumCell = numCell;
			addParticipant.Email = email;
			addParticipant.Website = website;

			if (((FormFieldValidator(firstName) && FormFieldValidator(lastName)) || FormFieldValidator(org))
				&& FormFieldValidator(addrStreet1) && FormFieldValidator(addrCity)
                && FormFieldValidator(addrState) && FormFieldValidator(addrZip) && (Request.Form["partPhone"] != null || FormFieldValidator(numPhone)) && (Request.Form["partEmail"] != null || FormFieldValidator(email)))
			{
				Session.Remove("editparticipant");

				Session.Remove("statusMessage1");
				addParticipant.saveNewParticipantToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Request.Params["pn"]);

                if (Request.Form["cmdAddNextParticipant"] == null)
				    Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                else
                    Response.Redirect("sare_main.aspx?do=addparticipant&type=grant&pn=" + Session["currGrant"]);                
			}
			else
			{
				Session["statusMessage1"] = "A required field was not filled.";
				Session["editparticipant"] = addParticipant;
				UserEditFormXMLWriter();
				return;
				//OutputPage(sender, e);
				//  UserEditForm(sender, e);
			}

		}

        public void AddCoordinatorFormHandler(object sender, System.EventArgs e)
        {
            string nameTitle = Request.Form["nameTitle"];
            string firstName = Request.Form["firstName"];
            string lastName = Request.Form["lastName"];
            string namePostfix = Request.Form["namePostfix"];
            string org = Request.Form["org"];
            string orgPosition = Request.Form["orgPosition"];
            string addrStreet1 = Request.Form["addrStreet1"];
            string addrStreet2 = Request.Form["addrStreet2"];
            string addrCity = Request.Form["addrCity"];
            string addrState = Request.Form["addrState"];
            string addrZip = Request.Form["addrZip"];
            string addrZip4 = Request.Form["addrZip4"];
            string numPhone = Request.Form["numPhone"];
            string numFax = Request.Form["numFax"];
            string numCell = Request.Form["numCell"];
            string email = Request.Form["email"];
            string website = Request.Form["website"];

            DaikonParticipant addCoordinator = new DaikonParticipant();

            addCoordinator.NameTitle = nameTitle;
            addCoordinator.FirstName = firstName;
            addCoordinator.LastName = lastName;
            addCoordinator.NamePostfix = namePostfix;
            addCoordinator.Org = org;
            addCoordinator.OrgPosition = orgPosition;
            addCoordinator.AddrStreet1 = addrStreet1;
            addCoordinator.AddrStreet2 = addrStreet2;
            addCoordinator.AddrCity = addrCity;
            addCoordinator.AddrState = addrState;
            addCoordinator.AddrZip = addrZip;
            addCoordinator.AddrZip4 = addrZip4;
            addCoordinator.NumPhone = numPhone;
            addCoordinator.NumFax = numFax;
            addCoordinator.NumCell = numCell;
            addCoordinator.Email = email;
            addCoordinator.Website = website;

            if (((FormFieldValidator(firstName) && FormFieldValidator(lastName)) || FormFieldValidator(org))
                && FormFieldValidator(addrStreet1) && FormFieldValidator(addrCity)
                && FormFieldValidator(addrState) && FormFieldValidator(addrZip) && (Request.Form["partPhone"] != null || FormFieldValidator(numPhone)) && (Request.Form["partEmail"] != null || FormFieldValidator(email)))
            {
                Session.Remove("editcoordinator");

                Session.Remove("statusMessage1");
                addCoordinator.saveNewCoordinatorToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], currUser.Grants[Request.Params["pn"]].CoreID);

                if (Request.Form["cmdAddNextCoordinator"] == null)
                    Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
                else
                    Response.Redirect("sare_main.aspx?do=addcoordinator&type=grant&pn=" + Session["currGrant"]);
            }
            else
            {
                Session["statusMessage1"] = "A required field was not filled.";
                Session["editcoordinator"] = addCoordinator;
                CoordinatorEditFormXMLWriter();
                return;
               
            }

        }


		public void UpdateParticipantFormHandler(object sender, System.EventArgs e)
		{
			DaikonParticipant editingUser = new DaikonParticipant();

			string nameTitle = Request.Form["nameTitle"];
			string firstName = Request.Form["firstName"];
			string lastName = Request.Form["lastName"];
			string namePostfix = Request.Form["namePostfix"];
			string org = Request.Form["org"];
			string orgPosition = Request.Form["orgPosition"];
			string addrStreet1 = Request.Form["addrStreet1"];
			string addrStreet2 = Request.Form["addrStreet2"];
			string addrCity = Request.Form["addrCity"];
			string addrState = Request.Form["addrState"];
			string addrZip = Request.Form["addrZip"];
			string addrZip4 = Request.Form["addrZip4"];
			string numPhone = Request.Form["numPhone"];
			string numFax = Request.Form["numFax"];
			string numCell = Request.Form["numCell"];
			string email = Request.Form["email"];
			string website = Request.Form["website"];

			editingUser.NameTitle = nameTitle;
			editingUser.FirstName = firstName;
			editingUser.LastName = lastName;
			editingUser.NamePostfix = namePostfix;
			editingUser.Org = org;
			editingUser.OrgPosition = orgPosition;
			editingUser.AddrStreet1 = addrStreet1;
			editingUser.AddrStreet2 = addrStreet2;
			editingUser.AddrCity = addrCity;
			editingUser.AddrState = addrState;
			editingUser.AddrZip = addrZip;
			editingUser.AddrZip4 = addrZip4;
			editingUser.NumPhone = numPhone;
			editingUser.NumFax = numFax;
			editingUser.NumCell = numCell;
			editingUser.Email = email;
			editingUser.Website = website;

			if (((FormFieldValidator(firstName) && FormFieldValidator(lastName)) || FormFieldValidator(org))
				&& FormFieldValidator(addrStreet1) && FormFieldValidator(addrCity)
                && FormFieldValidator(addrState) && FormFieldValidator(addrZip) && (Request.Form["partPhone"] != null || FormFieldValidator(numPhone)) && (Request.Form["partEmail"] != null || FormFieldValidator(email)))
			{
				editingUser.updateParticipantToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Int32.Parse(Request.Params["user"]));
				Session.Remove("editparticipant");

				Session.Remove("statusMessage1");
				Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
			}
			else
			{
				Session["statusMessage1"] = "A required field was not filled.";
				Session["editparticipant"] = editingUser;
				UserEditFormXMLWriter();
				return;
				//OutputPage(sender, e);
				//  UserEditForm(sender, e);
			}

		}

        public void UpdateCoordinatorFormHandler(object sender, System.EventArgs e)
		{
			DaikonParticipant editingUser = new DaikonParticipant();

			string nameTitle = Request.Form["nameTitle"];
			string firstName = Request.Form["firstName"];
			string lastName = Request.Form["lastName"];
			string namePostfix = Request.Form["namePostfix"];
			string org = Request.Form["org"];
			string orgPosition = Request.Form["orgPosition"];
			string addrStreet1 = Request.Form["addrStreet1"];
			string addrStreet2 = Request.Form["addrStreet2"];
			string addrCity = Request.Form["addrCity"];
			string addrState = Request.Form["addrState"];
			string addrZip = Request.Form["addrZip"];
			string addrZip4 = Request.Form["addrZip4"];
			string numPhone = Request.Form["numPhone"];
			string numFax = Request.Form["numFax"];
			string numCell = Request.Form["numCell"];
			string email = Request.Form["email"];
			string website = Request.Form["website"];

			editingUser.NameTitle = nameTitle;
			editingUser.FirstName = firstName;
			editingUser.LastName = lastName;
			editingUser.NamePostfix = namePostfix;
			editingUser.Org = org;
			editingUser.OrgPosition = orgPosition;
			editingUser.AddrStreet1 = addrStreet1;
			editingUser.AddrStreet2 = addrStreet2;
			editingUser.AddrCity = addrCity;
			editingUser.AddrState = addrState;
			editingUser.AddrZip = addrZip;
			editingUser.AddrZip4 = addrZip4;
			editingUser.NumPhone = numPhone;
			editingUser.NumFax = numFax;
			editingUser.NumCell = numCell;
			editingUser.Email = email;
			editingUser.Website = website;

			if (((FormFieldValidator(firstName) && FormFieldValidator(lastName)) || FormFieldValidator(org))
				&& FormFieldValidator(addrStreet1) && FormFieldValidator(addrCity)
                && FormFieldValidator(addrState) && FormFieldValidator(addrZip) && (Request.Form["partPhone"] != null || FormFieldValidator(numPhone)) && (Request.Form["partEmail"] != null || FormFieldValidator(email)))
			{
				editingUser.updateParticipantToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Int32.Parse(Request.Params["user"]));
				Session.Remove("editcoordinator");

				Session.Remove("statusMessage1");
				Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);
			}
			else
			{
				Session["statusMessage1"] = "A required field was not filled.";
				Session["editcoordinator"] = editingUser;
				UserEditFormXMLWriter();
				return;				
			}

		}

        public string AddProductInfoFormHandler(object sender, System.EventArgs e)
        {
            string res_projNum = Request.Params["pn"];
            string type = Request.Params["type"];
            string title = Request.Form["titletxt"];
            string desc = Request.Form["desctxt"];
            int resourceID = 0;
            decimal ordercost = 0;
            decimal ordershipping = 0;

            bool book = (bool)(Request.Form["format"] == "Book");
            bool video = (bool)(Request.Form["format"] == "Video");
            bool extpub = (bool)(Request.Form["format"] == "extPub");
            bool handbook = (bool)(Request.Form["format"] == "HandBook");
            bool factsheet = (bool)(Request.Form["format"] == "factSheet");
            bool software = (bool)(Request.Form["format"] == "software");
            bool workbook = (bool)(Request.Form["format"] == "WorkBook");
            bool manual = (bool)(Request.Form["format"] == "manual");
            bool website = (bool)(Request.Form["format"] == "Websitecheck");
            bool cdrom = (bool)(Request.Form["format"] == "CD-ROM");
            bool newsletter = (bool)(Request.Form["format"] == "Newsletter");
            bool journal = (bool)(Request.Form["format"] == "Journal");
            bool other = (bool)(Request.Form["format"] == "Other");
            string othertxt = Request.Form["othertxt"];

            bool beg = (bool)(Request.Form["beg"] == "on");
            bool inter = (bool)(Request.Form["int"] == "on");
            bool adv = (bool)(Request.Form["Adv"] == "on");


            bool farmers = (bool)(Request.Form["farmers"] == "on");
            bool edu = (bool)(Request.Form["edu"] == "on");
            bool res = (bool)(Request.Form["res"] == "on");
            bool consumers = (bool)(Request.Form["consumers"] == "on");

            string authoreditor = Request.Form["firstxt1"];
            string authoreditorLast = Request.Form["lasttxt1"];

            string author2 = Request.Form["firstxt2"];
            string author2Last = Request.Form["lasttxt2"];

            string author3 = Request.Form["firstxt3"];
            string author3Last = Request.Form["lasttxt3"];

            string author4 = Request.Form["firstxt4"];
            string author4Last = Request.Form["lasttxt4"];

            string author5 = Request.Form["firstxt5"];
            string author5Last = Request.Form["lasttxt5"];

            string website_url = Request.Form["url"];
            string website_pdf = Request.Form["pdf"];


            string orderfirst = Request.Form["contfirstxt"];
            string orderlast = Request.Form["contlasttxt"];
            string orderorg = Request.Form["org"];
            string orderaddress = Request.Form["address"];
            string ordercity = Request.Form["city"];
            string orderstate = Request.Form["state"];
            string orderzip = Request.Form["zip"];
            string orderphone = Request.Form["phone"];
            string orderfax = Request.Form["fax"];
            string orderemail = Request.Form["email"];
            string orderwebsite = Request.Form["website"];
            string orderproductID = Request.Form["productID"];
            string orderreleasedate = Request.Form["releaseDate"];
            bool avalqty = (bool)(Request.Form["qty"] == "on");
            if (Request.Form["cost"] != null && Request.Form["cost"].ToString() != "")
                ordercost =  decimal.Parse(Request.Form["cost"]);
            if (Request.Form["shipping"] != null && Request.Form["shipping"].ToString() != "")
                ordershipping = decimal.Parse(Request.Form["shipping"]);
            string ordercomments = Request.Form["comments"];
            string proddesc = Request.Form["desctxt"];

            daikonProdInfo.ProductInfo productInfoToSave;
            productInfoToSave = new daikonProdInfo.ProductInfo();

            if (res_projNum == null)
                res_projNum = (string)(Session["currGrant"]);

            productInfoToSave.ResourceProjNum = res_projNum;
            productInfoToSave.Title = title;
            productInfoToSave.Description = desc;
            productInfoToSave.Book = book;
            productInfoToSave.Handbook = handbook;
            productInfoToSave.Workbook = workbook;
            productInfoToSave.CDRom = cdrom;
            productInfoToSave.Video = video;
            productInfoToSave.Factsheet = factsheet;
            productInfoToSave.Manual = manual;
            productInfoToSave.Newsletter = newsletter;
            productInfoToSave.ExtPub = extpub;
            productInfoToSave.Software = software;
            productInfoToSave.Website = website;
            productInfoToSave.Journal = journal;
            productInfoToSave.Other = other;
            productInfoToSave.Beg = beg;
            productInfoToSave.Inter = inter;
            productInfoToSave.Adv = adv;
            productInfoToSave.Farmers = farmers;
            productInfoToSave.Edu = edu;
            productInfoToSave.Res = res;
            productInfoToSave.Consumers = consumers;
            productInfoToSave.AvalQty = avalqty;
            productInfoToSave.AuthorEditor = (authoreditor);
            productInfoToSave.AuthorEditorLast = (authoreditorLast);
            productInfoToSave.Author2 = (author2);
            productInfoToSave.Author2Last = (author2Last);
            productInfoToSave.Author3 = (author3);
            productInfoToSave.Author3Last = (author3Last);
            productInfoToSave.Author4 = (author4);
            productInfoToSave.Author4Last = (author4Last);
            productInfoToSave.Author5 = (author5);
            productInfoToSave.Author5Last = (author5Last);
            productInfoToSave.WebsiteURL = (website_url);
            productInfoToSave.WebsitePDF = (website_pdf);
            productInfoToSave.OrderFirst = (orderfirst);
            productInfoToSave.OrderLast = (orderlast);
            productInfoToSave.OrderOrg = (orderorg);
            productInfoToSave.OrderAddress = (orderaddress);
            productInfoToSave.OrderCity = (ordercity);
            productInfoToSave.OrderState = (orderstate);
            productInfoToSave.OrderZip = (orderzip);
            productInfoToSave.OrderPhone = (orderphone);
            productInfoToSave.OrderFax = (orderfax);
            productInfoToSave.OrderEmail = (orderemail);
            productInfoToSave.OrderWebsite = (orderwebsite);
            productInfoToSave.OrderProductID = (orderproductID);
            productInfoToSave.OrderReleasedate = (orderreleasedate);
            productInfoToSave.OrderComments = (ordercomments);
            productInfoToSave.OtherTxt = othertxt;
            productInfoToSave.OrderCost = ordercost;
            productInfoToSave.OrderShipping = ordershipping;
            productInfoToSave.ProdDescription = proddesc;
            if (Request.Form["uploadID"] != null)
                productInfoToSave.UploadID = Int32.Parse(Request.Form["uploadID"].ToString());

            if (Request.Form["savesubmitprodinfo"] != null)
                productInfoToSave.Submitted = true;
            else
                productInfoToSave.Submitted = false;

            productInfoToSave.Approved = false;

            if (title.Length == 0 || desc.Length == 0)
            {
                Session["statusMessage1"] = "A required field was not filled.";
            }
            else
            {
                resourceID = productInfoToSave.saveNewProdInfoToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"]);
                //Response.Redirect("sare_main.aspx?do=editProj&pn=" + Session["currGrant"]);  
                
                if (productInfoToSave.Submitted == true)
                {
                    Session["statusMessage2"] = "Project Product Information has been saved and submitted successfully. Do you want to upload the file also.";
                    InfoProductSubmitApproveMailer(currUser.Email, (string)(Session["currGrant"]), productInfoToSave.Title, "", "Submitted");
                    Response.Redirect("sare_main.aspx?do=confirm&confirmType=submit&pn=" + (string)(Session["currGrant"]) + "&resourceID=" + resourceID.ToString() + "&upload=0" + "&type=" + type);
                    
                }
                else
                {

                    Session["statusMessage2"] = "Your information product description has been saved successfully. Now you can:";
                    Response.Redirect("sare_main.aspx?do=infoproddetail&pn=" + "&resourceID=" + resourceID.ToString() + "&type=" + type + "&uploadID=");
                }
            }
            return resourceID.ToString();            

        }

        public string UpdateProductInfoFormHandler(Object sender, System.EventArgs e)
        {
            int resourceID = Int32.Parse(Request.Params["resourceID"]);
            string type = Request.Params["type"];
            string title = Request.Form["titletxt"];
            string desc = Request.Form["desctxt"];


            bool book = (bool)(Request.Form["format"] == "Book");
            bool video = (bool)(Request.Form["format"] == "Video");
            bool extpub = (bool)(Request.Form["format"] == "extPub");
            bool handbook = (bool)(Request.Form["format"] == "HandBook");
            bool factsheet = (bool)(Request.Form["format"] == "factSheet");
            bool software = (bool)(Request.Form["format"] == "software");
            bool workbook = (bool)(Request.Form["format"] == "WorkBook");
            bool manual = (bool)(Request.Form["format"] == "manual");
            bool website = (bool)(Request.Form["format"] == "Websitecheck");
            bool cdrom = (bool)(Request.Form["format"] == "CD-ROM");
            bool newsletter = (bool)(Request.Form["format"] == "Newsletter");
            bool journal = (bool)(Request.Form["format"] == "Journal");
            bool other = (bool)(Request.Form["format"] == "Other");
            string othertxt = Request.Form["othertxt"];

            bool beg = (bool)(Request.Form["beg"] == "on");
            bool inter = (bool)(Request.Form["int"] == "on");
            bool adv = (bool)(Request.Form["Adv"] == "on");


            bool farmers = (bool)(Request.Form["farmers"] == "on");
            bool edu = (bool)(Request.Form["edu"] == "on");
            bool res = (bool)(Request.Form["res"] == "on");
            bool consumers = (bool)(Request.Form["consumers"] == "on");

            string authoreditor = Request.Form["firstxt1"];
            string authoreditorLast = Request.Form["lasttxt1"];

            string author2 = Request.Form["firstxt2"];
            string author2Last = Request.Form["lasttxt2"];

            string author3 = Request.Form["firstxt3"];
            string author3Last = Request.Form["lasttxt3"];

            string author4 = Request.Form["firstxt4"];
            string author4Last = Request.Form["lasttxt4"];

            string author5 = Request.Form["firstxt5"];
            string author5Last = Request.Form["lasttxt5"];

            string website_url = Request.Form["url"];
            string website_pdf = Request.Form["pdf"];


            string orderfirst = Request.Form["contfirstxt"];
            string orderlast = Request.Form["contlasttxt"];
            string orderorg = Request.Form["org"];
            string orderaddress = Request.Form["address"];
            string ordercity = Request.Form["city"];
            string orderstate = Request.Form["state"];
            string orderzip = Request.Form["zip"];
            string orderphone = Request.Form["phone"];
            string orderfax = Request.Form["fax"];
            string orderemail = Request.Form["email"];
            string orderwebsite = Request.Form["website"];
            string orderproductID = Request.Form["productID"];
            string orderreleasedate = Request.Form["releaseDate"];
            bool avalqty = (bool)(Request.Form["qty"] == "on");
            string ordercost = Request.Form["cost"];
            string ordershipping = Request.Form["shipping"];
            string ordercomments = Request.Form["comments"];
            string proddesc = Request.Form["desctxt"];

            daikonProdInfo.ProductInfo productInfoToSave;
            productInfoToSave = new daikonProdInfo.ProductInfo();

            productInfoToSave.ResourceID = resourceID;
            productInfoToSave.Title = title;
            productInfoToSave.Description = desc;
            productInfoToSave.Book = book;
            productInfoToSave.Handbook = handbook;
            productInfoToSave.Workbook = workbook;
            productInfoToSave.CDRom = cdrom;
            productInfoToSave.Video = video;
            productInfoToSave.Factsheet = factsheet;
            productInfoToSave.Manual = manual;
            productInfoToSave.Newsletter = newsletter;
            productInfoToSave.ExtPub = extpub;
            productInfoToSave.Software = software;
            productInfoToSave.Website = website;
            productInfoToSave.Journal = journal;
            productInfoToSave.Other = other;
            productInfoToSave.Beg = beg;
            productInfoToSave.Inter = inter;
            productInfoToSave.Adv = adv;
            productInfoToSave.Farmers = farmers;
            productInfoToSave.Edu = edu;
            productInfoToSave.Res = res;
            productInfoToSave.Consumers = consumers;
            productInfoToSave.AvalQty = avalqty;
            productInfoToSave.AuthorEditor = (authoreditor);
            productInfoToSave.AuthorEditorLast = (authoreditorLast);
            productInfoToSave.Author2 = (author2);
            productInfoToSave.Author2Last = (author2Last);
            productInfoToSave.Author3 = (author3);
            productInfoToSave.Author3Last = (author3Last);
            productInfoToSave.Author4 = (author4);
            productInfoToSave.Author4Last = (author4Last);
            productInfoToSave.Author5 = (author5);
            productInfoToSave.Author5Last = (author5Last);
            productInfoToSave.WebsiteURL = (website_url);
            productInfoToSave.WebsitePDF = (website_pdf);
            productInfoToSave.OrderFirst = (orderfirst);
            productInfoToSave.OrderLast = (orderlast);
            productInfoToSave.OrderOrg = (orderorg);
            productInfoToSave.OrderAddress = (orderaddress);
            productInfoToSave.OrderCity = (ordercity);
            productInfoToSave.OrderState = (orderstate);
            productInfoToSave.OrderZip = (orderzip);
            productInfoToSave.OrderPhone = (orderphone);
            productInfoToSave.OrderFax = (orderfax);
            productInfoToSave.OrderEmail = (orderemail);
            productInfoToSave.OrderWebsite = (orderwebsite);
            productInfoToSave.OrderProductID = (orderproductID);
            productInfoToSave.OrderReleasedate = (orderreleasedate);
            productInfoToSave.OtherTxt = othertxt;
            productInfoToSave.OrderComments = (ordercomments);
            productInfoToSave.OrderCost = decimal.Parse(ordercost);
            productInfoToSave.OrderShipping = decimal.Parse(ordershipping);
            productInfoToSave.ProdDescription = proddesc;
            if (Request.Params["uploadID"] != null && Request.Params["uploadID"].ToString() != "")
                productInfoToSave.UploadID = Int32.Parse(Request.Params["uploadID"].ToString());
            else if (Session["fileID"] != null)
                productInfoToSave.UploadID = Int32.Parse(Session["fileID"].ToString());

            if (Request.Form["submitprodinfo"] != null)
                productInfoToSave.Submitted = true;
            else
                productInfoToSave.Submitted = false;

            if (Request.Form["approveprodinfo"] != null)
                productInfoToSave.Approved = true;
            else
                productInfoToSave.Approved = false;

            productInfoToSave.UpdateProdInfoToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"]);
            
            if (productInfoToSave.Submitted == true)
            {
                Session["statusMessage2"] = "Your information product  has been submitted for approval.  Note: You cannot edit the information product while it is pending approval.";
                InfoProductSubmitApproveMailer(currUser.Email, (string)(Session["currGrant"]), productInfoToSave.Title, "", "Submitted");
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=submit&pn=" + (string)(Session["currGrant"]) + "&resourceID=" + resourceID.ToString() + "&type=" + type);
                
            }
            else if (productInfoToSave.Approved == true)
            {
                Session["statusMessage2"] = "Your information product  has been approved.";
                //if (productInfoToSave.Submitted == true)
                    InfoProductSubmitApproveMailer(currUser.Email, (string)(Session["currGrant"]), productInfoToSave.Title, "", "Approved");
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=submit&pn=" + (string)(Session["currGrant"]) + "&resourceID=" + resourceID.ToString() + "&type=" + type);

            }
            else if (productInfoToSave.Approved == false && Request.Form["notapproveprodinfo"] == "Not Approve")
            {
                Session["statusMessage2"] = "Your information product  has been not approved.";
                InfoProductSubmitApproveMailer(currUser.Email, (string)(Session["currGrant"]), productInfoToSave.Title, "", "Not Approved");
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=submit&pn=" + (string)(Session["currGrant"]) + "&resourceID=" + resourceID.ToString() + "&type=" + type);

            }
            else
            {
                Session["statusMessage2"] = "Your information product description has been saved successfully. Now you can:";
                Response.Redirect("sare_main.aspx?do=infoproddetail&pn=" + "&resourceID=" + resourceID.ToString() + "&type=" + type + "&uploadID=");
            }
            
            return resourceID.ToString();
        }

        public void DeleteProductInfoFormHandler(Object sender, System.EventArgs e)
        {
            string res_id = Request.Params["resourceID"];
            string upload_id = Request.Params["uploadID"];
            bool result = false;

            if (upload_id.Length == 0)
                upload_id = "0";

            daikonProdInfo.ProductInfo productInfoToDelete;
            productInfoToDelete = new daikonProdInfo.ProductInfo();

            if (Request.Form["ConfirmDelete"] != null)
                result = productInfoToDelete.DeleteProdInfoFromDB(Int32.Parse(res_id), Int32.Parse(upload_id));

            if (result == true)
            {
                Session["statusMessage2"] = "Your information product  has been deleted.";
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=delete&pn=" + (string)(Session["currGrant"]) + "&resourceID=" + res_id);
                
            }
            else
            {
                if (Request.Form["ConfirmDelete"] == null)
                    Session["statusMessage2"] = "Information product failed to delete. To delete an information product, check the Confirm Delete box, then click Delete.";
                else
                    Session["statusMessage2"] = "Failed to delete information product.";
                Response.Redirect("sare_main.aspx?do=confirm&confirmType=delete");                                
            }
            
        }
        public int CancelProfile(int profileID)
        {
            DaikonProfile profile;
            if (null != Session["currProfile"])
                profile = (DaikonProfile)(Session["currProfile"]);
            else
                profile = new DaikonProfile();

            profile.cancelNewHighProfileProjectFromDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], profileID);

            return 1;
        }

		public int AddProfile1(object sender, System.EventArgs e)
		{
			DaikonProfile profile;
			if (null != Session["currProfile"])
				profile = (DaikonProfile)(Session["currProfile"]);
			else
				profile = new DaikonProfile();

			changeNav.MoveToRoot();
			changeNav.MoveToChild("SAREroot", sareNamespace);
			changeNav.MoveToChild("profile", "");

			/* Need to talk with Daniel what is this use for
			while (changeNav.MoveToChild("profilecategory", sareNamespace))
			{
				if (profile.CategoryA.ToString() == changeNav.GetAttribute("profileoption", sareNamespace))
					break;            
			}

			if (profile.CategoryA.ToString() != changeNav.GetAttribute("profileoption", sareNamespace))
			{
				changeNav.MoveToChild("profileoption", sareNamespace);
				changeNav.CreateAttribute("", "practices", sareNamespace, profile.CategoryA.ToString());
			}
			*/

			int profileID;

			bool planning = (bool)(Request.Form["inv_planning"] == "on");
			bool research = (bool)(Request.Form["inv_research"] == "on");
			bool land = (bool)(Request.Form["inv_land"] == "on");
			bool present = (bool)(Request.Form["inv_present"] == "on");

			profile.InvPlanning = planning;
			profile.InvResearch = research;
			profile.InvLand = land;
			profile.InvPresent = present;

			string cntPlanning = Request.Form["inv_planningcount"];
			string cntResarch = Request.Form["inv_researchcount"];
			string cntland = Request.Form["inv_landcount"];
			string cntpresent = Request.Form["inv_presentcount"];

            if (cntPlanning != null && cntPlanning.Length > 0)
				profile.InvNumPlanning = Int32.Parse(cntPlanning);
            if (cntResarch != null && cntResarch.Length > 0)
				profile.InvNumResearch = Int32.Parse(cntResarch);
            if (cntland != null && cntland.Length > 0)
				profile.InvNumLand = Int32.Parse(cntland);
            if (cntpresent != null && cntpresent.Length > 0)
				profile.InvNumPresent = Int32.Parse(cntpresent);

			bool extApplied = (bool)(Request.Form["inv_extapplied"] == "on");
			bool extPlanning = (bool)(Request.Form["inv_extplanning"] == "on");

			profile.InvExtApplied = extApplied;
			profile.InvExtPlanning = extPlanning;

			bool audFarm = (bool)(Request.Form["aud_farmranchers"] == "on");
			bool audEdu = (bool)(Request.Form["aud_educators"] == "on");
			bool audRes = (bool)(Request.Form["aud_researchers"] == "on");
			bool audCons = (bool)(Request.Form["aud_consumers"] == "on");

			profile.AudFarmRanchers = audFarm;
			profile.AudEducators = audEdu;
			profile.AudResearchers = audRes;
			profile.Audconsumers = audCons;

			bool techBeg = (bool)(Request.Form["techlvl_beginner"] == "on");
			bool techInt = (bool)(Request.Form["techlvl_intermediate"] == "on");
			bool techAdv = (bool)(Request.Form["techlvl_advanced"] == "on");

			profile.TechlvlBeginner = techAdv;
			profile.TechlvlIntermediate = techInt;
			profile.TechlvlAdvanced = techAdv;

			string catA = Request.Form["cata"];
			string catAother = MNS(Request.Form["cata_other"]);
			string catB = Request.Form["catb"];
			string catBother = MNS(Request.Form["catb_other"]);

			profile.CategoryA = catA;
			profile.CatAother = catAother;
			profile.CategoryB = catB;
			profile.CatBother = catBother;

            if (catA == null || catB == null)
                return 0;
            else if ((catA == "other" && catAother.Length == 0) || (catB == "other" && catBother.Length == 0))
                return -1;

			if (profile.ProfileID == 0)
			{
				profileID = profile.saveNewHighProfileProjectToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"], Session["currGrant"].ToString());


			}
			else
			{
				profileID = profile.ProfileID;
				profile.saveProfileToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"]);
			}
			Session["currProfile"] = profile;

			return profileID;
		}

		public void ProfileSearchHandler(object sender, System.EventArgs e)
		{
			DaikonSearchProfile profile;

			if (null != Session["searchProfile"])
				profile = (DaikonSearchProfile)(Session["searchProfile"]);
			else
				profile = new DaikonSearchProfile();

			

            bool andSearch = (bool)(Request.Form["andsearch"] == "on");

			bool planning = (bool)(Request.Form["inv_planning"] == "on");
			bool research = (bool)(Request.Form["inv_research"] == "on");
			bool land = (bool)(Request.Form["inv_land"] == "on");
			bool present = (bool)(Request.Form["inv_present"] == "on");

			profile.InvPlanning = planning;
			profile.InvResearch = research;
			profile.InvLand = land;
			profile.InvPresent = present;

			/*
						string cntPlanning = Request.Form["inv_planningcount"];
						string cntResarch = Request.Form["inv_researchcount"];
						string cntland = Request.Form["inv_landcount"];
						string cntpresent = Request.Form["inv_presentcount"];

						if (cntPlanning.Length > 0)
							profile.InvNumPlanning = Int32.Parse(cntPlanning);
						if (cntResarch.Length > 0)
							profile.InvNumResearch = Int32.Parse(cntResarch);
						if (cntland.Length > 0)
							profile.InvNumLand = Int32.Parse(cntland);
						if (cntpresent.Length > 0)
							profile.InvNumPresent = Int32.Parse(cntpresent);
			*/
			bool extApplied = (bool)(Request.Form["inv_extapplied"] == "on");
			bool extPlanning = (bool)(Request.Form["inv_extplanning"] == "on");

			profile.InvExtApplied = extApplied;
			profile.InvExtPlanning = extPlanning;

			bool audFarm = (bool)(Request.Form["aud_farmranchers"] == "on");
			bool audEdu = (bool)(Request.Form["aud_educators"] == "on");
			bool audRes = (bool)(Request.Form["aud_researchers"] == "on");
			bool audCons = (bool)(Request.Form["aud_consumers"] == "on");

			profile.AudFarmRanchers = audFarm;
			profile.AudEducators = audEdu;
			profile.AudResearchers = audRes;
			profile.Audconsumers = audCons;

			bool techBeg = (bool)(Request.Form["techlvl_beginner"] == "on");
			bool techInt = (bool)(Request.Form["techlvl_intermediate"] == "on");
			bool techAdv = (bool)(Request.Form["techlvl_advanced"] == "on");

			profile.TechlvlBeginner = techAdv;
			profile.TechlvlIntermediate = techInt;
			profile.TechlvlAdvanced = techAdv;

			string catA = Request.Form["cata"];
			//            string catAother = MNS(Request.Form["catb_other"]);
			string catB = Request.Form["catb"];
			//            string catBother = MNS(Request.Form["catb_other"]);

			profile.CategoryA = catA;
			//            profile.CatAother = catAother;
			profile.CategoryB = catB;
			//            profile.CatBother = catBother;

			bool IntegraEcoSys = (bool)(Request.Form["intgfrs_agroecosystemanalysis"] == "on");
			bool IntegraWhFarmPlan = (bool)(Request.Form["intgfrs_wholefarmplanning"] == "on");
			bool IntegraOrgAgri = (bool)(Request.Form["intgfrs_organicagriculture"] == "on");
			bool IntegraPerma = (bool)(Request.Form["intgfrs_permaculture"] == "on");
			//            string IntegraOther = MNS(Request.Form["intgfrs_other"]);

			profile.IntgfrsAgroEcoSystemAnalysis = IntegraEcoSys;
			profile.IntgfrsWholeFarmPlanning = IntegraWhFarmPlan;
			profile.IntgfrsOrgAgri = IntegraOrgAgri;
			profile.IntgfrsPermaCulture = IntegraPerma;
			//            profile.IntgfrsOther = IntegraOther;

			bool CropPrdAgro = (bool)(Request.Form["cropprd_agroforestry"] == "on");
			bool CropPrdFolFeed = (bool)(Request.Form["cropprd_foliarfeeding"] == "on");
			bool CropPrdNutriCyc = (bool)(Request.Form["cropprd_nutrientcycling"] == "on");
			bool CropPrdStripCrop = (bool)(Request.Form["cropprd_stripcropping"] == "on");
			bool CropPrdBioLogic = (bool)(Request.Form["cropprd_biologicalinoculants"] == "on");
			bool CropPrdForestry = (bool)(Request.Form["cropprd_forestry"] == "on");
			bool CropPrdOrgFerti = (bool)(Request.Form["cropprd_organicfertilizers"] == "on");
			bool CropPrdStubbMulch = (bool)(Request.Form["cropprd_stubblemulching"] == "on");
			bool CropPrdConticrop = (bool)(Request.Form["cropprd_continuouscropping"] == "on");
			bool CropPrdGreenManu = (bool)(Request.Form["cropprd_greenmanures"] == "on");
			bool CropPrdOrgMatt = (bool)(Request.Form["cropprd_organicmatter"] == "on");
			bool CropPrdTissueAnaly = (bool)(Request.Form["cropprd_tissueanalysis"] == "on");
			bool CropPrdCoverCrop = (bool)(Request.Form["cropprd_covercrops"] == "on");
			bool CropPrdIntCrop = (bool)(Request.Form["cropprd_intercropping"] == "on");
			bool CropPrdPermaCul = (bool)(Request.Form["cropprd_permaculture"] == "on");
            bool CropPrdTransToOrg = (bool)(Request.Form["cropprd_transitioning"] == "on");
			bool CropPrdDbleCrop = (bool)(Request.Form["cropprd_doublecropping"] == "on");
			bool CropPrdMiniTillage = (bool)(Request.Form["cropprd_minimumtillage"] == "on");
			bool CropPrdReduceAppli = (bool)(Request.Form["cropprd_reducedapplications"] == "on");
			bool CropPrdEarthworms = (bool)(Request.Form["cropprd_earthworms"] == "on");
			bool CropPrdMulticrop = (bool)(Request.Form["cropprd_multiplecropping"] == "on");
			bool CropPrdRelayCrop = (bool)(Request.Form["cropprd_relaycropping"] == "on");
			bool CropPrdFallow = (bool)(Request.Form["cropprd_fallow"] == "on");
			bool CropPrdMuniWste = (bool)(Request.Form["cropprd_municipalwastes"] == "on");
			bool CropPrdRedgeTillage = (bool)(Request.Form["cropprd_ridgetillage"] == "on");
			bool CropPrdFertigation = (bool)(Request.Form["cropprd_fertigation"] == "on");
			bool CropPrdNoTill = (bool)(Request.Form["cropprd_no-till"] == "on");
			bool CropPrdSoilAnaly = (bool)(Request.Form["cropprd_soilanalysis"] == "on");
			bool CropPrdCatchCrop = (bool)(Request.Form["cropprd_catchcrops"] == "on");
			bool CropPrdCropRota = (bool)(Request.Form["cropprd_croprotation"] == "on");
			bool CropPrdCropBreed = (bool)(Request.Form["cropprd_cropbreeding"] == "on");
			bool CropPrdIrrigation = (bool)(Request.Form["cropprd_irrigation"] == "on");
			//            string CropPrdOther = MNS(Request.Form["cropprd_other"]);

			profile.CropprdAgroforesty = CropPrdAgro;
			profile.CropprdBioInoculants = CropPrdBioLogic;
            profile.CropprdForestry = CropPrdForestry;
			profile.CropprdCatchCrops = CropPrdCatchCrop;
			profile.CropprdContinousCrop = CropPrdConticrop;
			profile.CropprdCoverCrops = CropPrdCoverCrop;
			profile.CropprdCropBreeding = CropPrdCropBreed;
			profile.CropprdCropRotation = CropPrdCropRota;
			profile.CropprdDoubleCropping = CropPrdDbleCrop;
			profile.CropprdEarthworms = CropPrdEarthworms;
			profile.CropprdFallow = CropPrdFallow;
			profile.CropprdFoliarFeeding = CropPrdFolFeed;
			profile.CropprdFertigation = CropPrdFertigation;
			profile.CropprdGreenManures = CropPrdGreenManu;
			profile.CropprdInterCropping = CropPrdIntCrop;
			profile.CropprdIrrigation = CropPrdIrrigation;
			profile.CropprdMiniTillage = CropPrdMiniTillage;
			profile.CropprdMultiCropping = CropPrdMulticrop;
			profile.CropprdMunicipalWastes = CropPrdMuniWste;
			profile.CropprdNoTill = CropPrdNoTill;
			profile.CropprdNutriCycling = CropPrdNutriCyc;
			profile.CropprdOrgFertilizers = CropPrdOrgFerti;
			profile.CropprdOrgMatter = CropPrdOrgMatt;
			profile.CropprdPermaCulture = CropPrdPermaCul;
			profile.CropprdReduceApps = CropPrdReduceAppli;
			profile.CropprdRelayCropping = CropPrdRelayCrop;
			profile.CropprdRidgeTillage = CropPrdRedgeTillage;
			profile.CropprdSoilAnalysis = CropPrdSoilAnaly;
			profile.CropprdStripCropping = CropPrdStripCrop;
			profile.CropprdStubbleMulch = CropPrdStubbMulch;
			profile.CropprdTissueAnalysis = CropPrdTissueAnaly;
			profile.CropprdTrans = CropPrdTransToOrg;
			//            profile.CropprdOther = CropPrdOther;

			bool AnimPrdAltFeedStuff = (bool)(Request.Form["animprd_alternativefeedstuffs"] == "on");
			bool AnimPrdFeedRations = (bool)(Request.Form["animprd_feedrations"] == "on");
			bool AnimPrdMultiSpeciesGrz = (bool)(Request.Form["animprd_multispeciesgrazing"] == "on");
			bool AnimPrdStockPiledForg = (bool)(Request.Form["animprd_stockpiledforages"] == "on");
			bool AnimPrdAltHouse = (bool)(Request.Form["animprd_alternativehousing"] == "on");
			bool AnimPrdFreeRange = (bool)(Request.Form["animprd_freerange"] == "on");
			bool AnimPrdPastureFerti = (bool)(Request.Form["animprd_pasturefertility"] == "on");
			bool AnimPrdVaccine = (bool)(Request.Form["animprd_vaccines"] == "on");
			bool AnimPrdAltParasiteCont = (bool)(Request.Form["animprd_alternparasitecontrol"] == "on");
			bool AnimPrdHerbalMed = (bool)(Request.Form["animprd_herbalmedicines"] == "on");
			bool AnimPrdPastureReno = (bool)(Request.Form["animprd_pasturerenovation"] == "on");
			bool AnimPrdWaterSys = (bool)(Request.Form["animprd_wateringsystem"] == "on");
			bool AnimPrdAnimalProtect = (bool)(Request.Form["animprd_animalprotection"] == "on");
			bool AnimPrdHomeopathy = (bool)(Request.Form["animprd_homeopathy"] == "on");
			bool AnimPrdPrePrac = (bool)(Request.Form["animprd_preventivepractices"] == "on");
			bool AnimPrdWinterForage = (bool)(Request.Form["animprd_winterforage"] == "on");
			bool AnimPrdComposting = (bool)(Request.Form["animprd_composting"] == "on");
			bool AnimPrdImplants = (bool)(Request.Form["animprd_implants"] == "on");
			bool AnimPrdProbiotics = (bool)(Request.Form["animprd_probiotics"] == "on");
			bool AnimPrdContGraze = (bool)(Request.Form["animprd_continuousgrazing"] == "on");
			bool AnimPrdInoculants = (bool)(Request.Form["animprd_inoculants"] == "on");
			bool AnimPrdRangeImp = (bool)(Request.Form["animprd_rangeimprovement"] == "on");
			bool AnimPrdFeedAddti = (bool)(Request.Form["animprd_feedadditives"] == "on");
			bool AnimPrdManuMgmt = (bool)(Request.Form["animprd_manuremanagement"] == "on");
			bool AnimPrdRotaGraz = (bool)(Request.Form["animprd_rotationalgrazing"] == "on");
			bool AnimPrdFeedFormula = (bool)(Request.Form["animprd_feedformulation"] == "on");
			bool AnimPrdMineralSupp = (bool)(Request.Form["animprd_mineralsupplements"] == "on");
			bool AnimPrdShadShelter = (bool)(Request.Form["animprd_shadeshelter"] == "on");
			bool AnimPrdGrazMgmt = (bool)(Request.Form["animprd_grazingmanagement"] == "on");
			bool AnimPrdTherapeutics = (bool)(Request.Form["animprd_therapeutics"] == "on");
			bool AnimPrdLiveBreed = (bool)(Request.Form["animprd_livestockbreeding"] == "on");
			bool AnimPrdStockRate = (bool)(Request.Form["animprd_stockingrate"] == "on");
			//            string AnimPrdOther = MNS(Request.Form["animprd_other"]);

			profile.AnimprdAltFeedstuffs = AnimPrdAltFeedStuff;
			profile.AnimprdAltHousing = AnimPrdAltHouse;
			profile.AnimprdAltParasiteControl = AnimPrdAltParasiteCont;
			profile.AnimprdAnimalProtection = AnimPrdAnimalProtect;
			profile.AnimprdComposting = AnimPrdComposting;
			profile.AnimprdContGrazing = AnimPrdContGraze;
			profile.AnimprdFeedAdditives = AnimPrdFeedAddti;
			profile.AnimprdFeedFormulation = AnimPrdFeedFormula;
			profile.AnimprdFeedRations = AnimPrdFeedRations;
			profile.AnimprdFreeRange = AnimPrdFreeRange;
			profile.AnimprdGrazMgmt = AnimPrdGrazMgmt;
			profile.AnimprdHerbalMed = AnimPrdHerbalMed;
			profile.AnimprdHomeopathy = AnimPrdHomeopathy;
			profile.AnimprdImplants = AnimPrdImplants;
			profile.AnimprdInoculants = AnimPrdInoculants;
			profile.AnimprdLivestockBreeding = AnimPrdLiveBreed;
			profile.AnimprdManureMgmt = AnimPrdManuMgmt;
			profile.AnimprdMineralSupp = AnimPrdMineralSupp;
			profile.AnimprdMultiSpeciesGrazing = AnimPrdMultiSpeciesGrz;
			//            profile.AnimprdOther = AnimPrdOther;
			profile.AnimprdPastureFerti = AnimPrdPastureFerti;
			profile.AnimprdPastureRenovation = AnimPrdPastureReno;
			profile.AnimprdPreventivePract = AnimPrdPrePrac;
			profile.AnimprdProbiotics = AnimPrdProbiotics;
			profile.AnimprdRangeImprovement = AnimPrdRangeImp;
			profile.AnimprdRotGrazing = AnimPrdRotaGraz;
			profile.AnimprdShadeShelter = AnimPrdShadShelter;
			profile.AnimprdStockingRate = AnimPrdStockRate;
			profile.AnimprdStockpiledForages = AnimPrdStockPiledForg;
			profile.AnimprdTherapeutics = AnimPrdTherapeutics;
			profile.AnimprdVaccines = AnimPrdVaccine;
			profile.AnimprdWateringSys = AnimPrdWaterSys;
			profile.AnimprdWinterForage = AnimPrdWinterForage;

			bool PestMgmtAllelopathy = (bool)(Request.Form["pestmgt_allelopathy"] == "on");
			bool PestMgmtEcoThres = (bool)(Request.Form["pestmgt_economicthreshold"] == "on");
			bool PestMgmtMechCont = (bool)(Request.Form["pestmgt_mechanicalcontrol"] == "on");
			bool PestMgmtSmthCrop = (bool)(Request.Form["pestmgt_smothercrops"] == "on");
			bool PestMgmtBioCont = (bool)(Request.Form["pestmgt_biologicalcontrol"] == "on");
			bool PestMgmtEradication = (bool)(Request.Form["pestmgt_eradication"] == "on");
			bool PestMgmtPhyCont = (bool)(Request.Form["pestmgt_physicalcontrol"] == "on");
			bool PestMgmtTraps = (bool)(Request.Form["pestmgt_traps"] == "on");
			bool PestMgmtBioratPest = (bool)(Request.Form["pestmgt_biorationalpesticides"] == "on");
			bool PestMgmtFlame = (bool)(Request.Form["pestmgt_flame"] == "on");
			bool PestMgmtPlstMulch = (bool)(Request.Form["pestmgt_plasticmulching"] == "on");
			bool PestMgmtTrapCrop = (bool)(Request.Form["pestmgt_trapcrops"] == "on");
			bool PestMgmtBotPest = (bool)(Request.Form["pestmgt_botanicalpesticides"] == "on");
			bool PestMgmtFieldMoni = (bool)(Request.Form["pestmgt_fieldmonitoring"] == "on");
			bool PestMgmtPreciCult = (bool)(Request.Form["pestmgt_precisioncultivation"] == "on");
			bool PestMgmtVegMulch = (bool)(Request.Form["pestmgt_vegetativemulching"] == "on");
			bool PestMgmtChemCont = (bool)(Request.Form["pestmgt_chemicalcontrol"] == "on");
			bool PestMgmtGeneticResis = (bool)(Request.Form["pestmgt_geneticresistance"] == "on");
			bool PestMgmtpreciheruse = (bool)(Request.Form["pestmgt_precisionherbicideuse"] == "on");
			bool PestMgmtWeatherMoni = (bool)(Request.Form["pestmgt_weathermonitoring"] == "on");
			bool PestMgmtCompetition = (bool)(Request.Form["pestmgt_competition"] == "on");
			bool PestMgmtIPM = (bool)(Request.Form["pestmgt_IPM"] == "on");
			bool PestMgmtPrevention = (bool)(Request.Form["pestmgt_prevention"] == "on");
			bool PestMgmtWeedEco = (bool)(Request.Form["pestmgt_weedecology"] == "on");
			bool PestMgmtCompostExt = (bool)(Request.Form["pestmgt_compostextracts"] == "on");
			bool PestMgmtKilledMulch = (bool)(Request.Form["pestmgt_killedmulches"] == "on");
			bool PestMgmtRowCover = (bool)(Request.Form["pestmgt_rowcovers"] == "on");
			bool PestMgmtWeedGeese = (bool)(Request.Form["pestmgt_weedergeese"] == "on");
			bool PestMgmtculturalCont = (bool)(Request.Form["pestmgt_culturalcontrol"] == "on");
			bool PestMgmtLivingMulch = (bool)(Request.Form["pestmgt_livingmulches"] == "on");
			bool PestMgmtSanitation = (bool)(Request.Form["pestmgt_sanitation"] == "on");
			bool PestMgmtDiseaseVect = (bool)(Request.Form["pestmgt_diseasevectors"] == "on");
			bool PestMgmtMatingDis = (bool)(Request.Form["pestmgt_matingdisruption"] == "on");
			bool PestMgmtSoilSolar = (bool)(Request.Form["pestmgt_soilsolarization"] == "on");
			//            string PestMgmtOther = MNS(Request.Form["pestmgt_other"]);

			profile.PestMgmtAllelopathy = PestMgmtAllelopathy;
			profile.PestMgmtBioControl = PestMgmtBioCont;
			profile.PestMgmtBioPest = PestMgmtBioratPest;
			profile.PestMgmtBotaPest = PestMgmtBotPest;
			profile.PestMgmtChemControl = PestMgmtChemCont;
			profile.PestMgmtCompetition = PestMgmtCompetition;
			profile.PestMgmtCompostExtracts = PestMgmtCompostExt;
			profile.PestMgmtCulturalControl = PestMgmtculturalCont;
			profile.PestMgmtDiseaseVectors = PestMgmtDiseaseVect;
			profile.PestMgmtEcoThreshold = PestMgmtEcoThres;
			profile.PestMgmtEradication = PestMgmtEradication;
			profile.PestMgmtFieldMonitoring = PestMgmtFieldMoni;
			profile.PestMgmtFlame = PestMgmtFlame;
			profile.PestMgmtGeneticResis = PestMgmtGeneticResis;
			profile.PestMgmtIPM = PestMgmtIPM;
			profile.PestMgmtKilledMulches = PestMgmtKilledMulch;
			profile.PestMgmtLivingMulches = PestMgmtLivingMulch;
			profile.PestMgmtMatingDisruption = PestMgmtMatingDis;
			profile.PestMgmtMechControl = PestMgmtMechCont;
			//            profile.PestMgmtOther = PestMgmtOther;
			profile.PestMgmtPhyControl = PestMgmtPhyCont;
			profile.PestMgmtPlasticMulch = PestMgmtPlstMulch;
			profile.PestMgmtPrecisiCulti = PestMgmtPreciCult;
			profile.PestMgmtPrecisiHerbicideUse = PestMgmtpreciheruse;
			profile.PestMgmtPrevention = PestMgmtPrevention;
			profile.PestMgmtRowCovers = PestMgmtRowCover;
			profile.PestMgmtSanitation = PestMgmtSanitation;
			profile.PestMgmtSmotherCrops = PestMgmtSmthCrop;
			profile.PestMgmtSoilSolar = PestMgmtSoilSolar;
			profile.PestMgmtTrapCrops = PestMgmtTrapCrop;
			profile.PestMgmtTraps = PestMgmtTraps;
			profile.PestMgmtVegMulch = PestMgmtVegMulch;
			profile.PestMgmtWeatherMoni = PestMgmtWeatherMoni;
			profile.PestMgmtWeedEco = PestMgmtWeedEco;
			profile.PestMgmtWeedGeese = PestMgmtWeedGeese;

			bool SoilMgmtNutriMineral = (bool)(Request.Form["soilmgt_nutrientmineralization"] == "on");
			bool SoilMgmtSoilBio = (bool)(Request.Form["soilmgt_SoilMicrobiology"] == "on");
			bool SoilMgmtSoilOrgMatter = (bool)(Request.Form["soilmgt_soilorganicmatter"] == "on");
			bool SoilMgmtSoilQty = (bool)(Request.Form["soilmgt_soilquality"] == "on");
			bool SoilMgmtSoilChem = (bool)(Request.Form["soilmgt_soilchemistry"] == "on");
			bool SoilMgmtSoilPhy = (bool)(Request.Form["soilmgt_soilphysics"] == "on");
			bool SoilMgmtCarbonSeq = (bool)(Request.Form["soilmgt_carbonsequestration"] == "on");
			//            string SoilMgmtOther = MNS(Request.Form["soilmgt_other"]);

			profile.SoilMgmtCarbonSequestration = SoilMgmtCarbonSeq;
			profile.SoilMgmtNutriMineralization = SoilMgmtNutriMineral;
			profile.SoilMgmtOrgtMatter = SoilMgmtSoilOrgMatter;
			//            profile.SoilMgmtOther = SoilMgmtOther;
			profile.SoilMgmtQty = SoilMgmtSoilQty;
			profile.SoilMgmtSoilMicroBio = SoilMgmtSoilBio;
			profile.SoilMgmtSoilChem = SoilMgmtSoilChem;
			profile.SoilMgmtSoilPhy = SoilMgmtSoilPhy;

			bool NResEnvAfforestation = (bool)(Request.Form["nresenv_afforestation"] == "on");
			bool NResEnvGrassHedges = (bool)(Request.Form["nresenv_grasshedges"] == "on");
			bool NResEnvRipariPlant = (bool)(Request.Form["nresenv_riparianplantings"] == "on");
			bool NResEnvWildlife = (bool)(Request.Form["nresenv_wildlife"] == "on");
			bool NResEnvBioDiver = (bool)(Request.Form["nresenv_biodiversity"] == "on");
			bool NResEnvGrassWater = (bool)(Request.Form["nresenv_grasswaterways"] == "on");
			bool NResEnvRiverBankProtect = (bool)(Request.Form["nresenv_riverbankprotection"] == "on");
			bool NResEnvWindBreak = (bool)(Request.Form["nresenv_windbreaks"] == "on");
			bool NResEnvBiosphere = (bool)(Request.Form["nresenv_biosphere"] == "on");
			bool NResEnvHabitEnhance = (bool)(Request.Form["nresenv_habitatenhancement"] == "on");
			bool NResEnvSoilStab = (bool)(Request.Form["nresenv_soilstabilization"] == "on");
			bool NResEnvWoodyHedge = (bool)(Request.Form["nresenv_woodyhedges"] == "on");
			bool NResEnvConservTillage = (bool)(Request.Form["nresenv_conservationtillage"] == "on");
			bool NResEnvHedgeRow = (bool)(Request.Form["nresenv_hedgerows"] == "on");
			bool NResEnvTerraces = (bool)(Request.Form["nresenv_terraces"] == "on");
			bool NResEnvContourCulti = (bool)(Request.Form["nresenv_contourcultivation"] == "on");
			bool NResEnvIndicators = (bool)(Request.Form["nresenv_indicators"] == "on");
			bool NResEnvWetlands = (bool)(Request.Form["nresenv_wetlands"] == "on");
			//            string NResEnvOther = MNS(Request.Form["nresenv_other"]);

			profile.NResEnvAfforestation = NResEnvAfforestation;
			profile.NResEnvBiodiver = NResEnvBioDiver;
			profile.NResEnvBiosphere = NResEnvBiosphere;
			profile.NResEnvConserTillage = NResEnvConservTillage;
			profile.NResEnvContourCulti = NResEnvContourCulti;
			profile.NResEnvGrassHedges = NResEnvGrassHedges;
			profile.NResEnvGrassWaterWays = NResEnvGrassWater;
			profile.NResEnvHabitatEnhance = NResEnvHabitEnhance;
			profile.NResEnvHedgerows = NResEnvHedgeRow;
			profile.NResEnvIndi = NResEnvIndicators;
			//            profile.NResEnvOther = NResEnvOther;
			profile.NResEnvRiparianPlantings = NResEnvRipariPlant;
			profile.NResEnvRiverBnkProtect = NResEnvRiverBankProtect;
			profile.NResEnvSoilStabilization = NResEnvSoilStab;
			profile.NResEnvTerraces = NResEnvTerraces;
			profile.NResEnvWetlands = NResEnvWetlands;
			profile.NResEnvWildlife = NResEnvWildlife;
			profile.NResEnvWindbreaks = NResEnvWindBreak;
			profile.NResEnvWoodyHedges = NResEnvWoodyHedge;

			bool EduTrnCaseStudy = (bool)(Request.Form["edu_trn_casestudy"] == "on");
			bool EduTrnDemo = (bool)(Request.Form["edu_trn_demonstration"] == "on");
			bool EduTrnFocusGroup = (bool)(Request.Form["edu_trn_focusgroup"] == "on");
			bool EduTrnStudyCircle = (bool)(Request.Form["edu_trn_studycircle"] == "on");
			bool EduTrnConfer = (bool)(Request.Form["edu_trn_conference"] == "on");
			bool EduTrnDisplay = (bool)(Request.Form["edu_trn_display"] == "on");
			bool EduTrnMentoring = (bool)(Request.Form["edu_trn_mentoring"] == "on");
			bool EduTrnWorkshop = (bool)(Request.Form["edu_trn_workshop"] == "on");
			bool EduTrnCurriculum = (bool)(Request.Form["edu_trn_curriculum"] == "on");
			bool EduTrnExt = (bool)(Request.Form["edu_trn_Extension"] == "on");
			bool EduTrnNetwork = (bool)(Request.Form["edu_trn_network"] == "on");
			bool EduTrnDB = (bool)(Request.Form["edu_trn_database"] == "on");
			bool EduTrnFactSheet = (bool)(Request.Form["edu_trn_factsheet"] == "on");
			bool EduTrnOnFarmRes = (bool)(Request.Form["edu_trn_on-farmresearch"] == "on");
			bool EduTrnDeciSupportSys = (bool)(Request.Form["edu_trn_decisionsupportsystem"] == "on");
			bool EduTrnFarmToFarm = (bool)(Request.Form["edu_trn_farmertofarmer"] == "on");
			bool EduTrnPartRes = (bool)(Request.Form["edu_trn_participatoryresearch"] == "on");
			bool EduTrnYouthEdu = (bool)(Request.Form["edu_trn_youtheducation"] == "on");
			//            string EduTrnOther = MNS(Request.Form["edu_trn_other"]);

			profile.EdTrainCaseStudy = EduTrnCaseStudy;
			profile.EdTrainConference = EduTrnConfer;
			profile.EdTrainCurriculum = EduTrnCurriculum;
			profile.EdTrainDB = EduTrnDB;
			profile.EdTrainDecisionSupportSys = EduTrnDeciSupportSys;
			profile.EdTrainDemo = EduTrnDemo;
			profile.EdTrainDisplay = EduTrnDisplay;
			profile.EdTrainExt = EduTrnExt;
			profile.EdTrainFactSheet = EduTrnFactSheet;
			profile.EdTrainFarmerToFarmer = EduTrnFarmToFarm;
			profile.EdTrainFocusGroup = EduTrnFocusGroup;
			profile.EdTrainMentor = EduTrnMentoring;
			profile.EdTrainNet = EduTrnNetwork;
			profile.EdTrainOnFarmResearch = EduTrnOnFarmRes;
			//            profile.EdTrainOther = EduTrnOther;
			profile.EdTrainParticipatoryResearch = EduTrnPartRes;
			profile.EdTrainStudyCircle = EduTrnStudyCircle;
			profile.EdTrainWorkshop = EduTrnWorkshop;
			profile.EdTrainYouthEdu = EduTrnYouthEdu;

			bool EconMktAltEnt = (bool)(Request.Form["econmkt_alternativeenterprise"] == "on");
			bool EconMktCSA = (bool)(Request.Form["econmkt_CSA"] == "on");
			bool EconMktFeasibilityStudy = (bool)(Request.Form["econmkt_feasibilitystudy"] == "on");
			bool EconMktRiskMgmt = (bool)(Request.Form["econmkt_riskmanagement"] == "on");
			bool EconMktBudget = (bool)(Request.Form["econmkt_budget"] == "on");
			bool EconMktCostNReturn = (bool)(Request.Form["econmkt_costandreturns"] == "on");
			bool EconMktFinAnaly = (bool)(Request.Form["econmkt_financialanalysis"] == "on");
			bool EconMktValueAdd = (bool)(Request.Form["econmkt_valueadded"] == "on");
			bool EconMktCoop = (bool)(Request.Form["econmkt_cooperatives"] == "on");
			bool EconMktDirectMark = (bool)(Request.Form["econmkt_directmarketing"] == "on");
			bool EconMktMarkStudy = (bool)(Request.Form["econmkt_marketstudy"] == "on");
			bool EconMktFoodProdQtySafe = (bool)(Request.Form["econmkt_foodproductqualitysafety"] == "on");
			bool EconMktLaborEmp = (bool)(Request.Form["econmkt_laboremployment"] == "on");
			bool EconMktECom = (bool)(Request.Form["econmkt_e-commerce"] == "on");
			bool EconMktFarmInst = (bool)(Request.Form["econmkt_farmtoinstitution"] == "on");
			//            string EconMktOther = MNS(Request.Form["econmkt_other"]);

			profile.EconMktAltEnt = EconMktAltEnt;
			profile.EconMktBudget = EconMktBudget;
			profile.EconMktCoop = EconMktCoop;
			profile.EconMktCostNReturns = EconMktCostNReturn;
			profile.EconMktCSA = EconMktCSA;
			profile.EconMktDirectMkt = EconMktDirectMark;
			profile.EconMktECom = EconMktECom;
			profile.EconMktFarmToInstitution = EconMktFarmInst;
			profile.EconMktFeasibilityStudy = EconMktFeasibilityStudy;
			profile.EconMktFinAnalysis = EconMktFinAnaly;
			profile.EconMktFoodProductQtySafety = EconMktFoodProdQtySafe;
			profile.EconMktLaborEmp = EconMktLaborEmp;
			profile.EconMktMarketStudy = EconMktMarkStudy;
			//            profile.EconMktOther = EconMktOther;
			profile.EconMktRiskMgmt = EconMktRiskMgmt;
			profile.EconMktValueAdd = EconMktValueAdd;


			bool CommDevInfraAnaly = (bool)(Request.Form["commdev_infrastructureanalysis"] == "on");
			bool CommDevTechAssist = (bool)(Request.Form["commdev_technicalassistance"] == "on");
			bool CommDevNewBusOpp = (bool)(Request.Form["commdev_newbusinessopportunities"] == "on");
			bool CommDevPartnerships = (bool)(Request.Form["commdev_partnerships"] == "on");
			bool CommDevUrbanAgri = (bool)(Request.Form["commdev_urbanagriculture"] == "on");
			bool CommDevPublicPart = (bool)(Request.Form["commdev_publicparticipation"] == "on");
			bool CommDevUrbanRuralInt = (bool)(Request.Form["commdev_urbanruralintegration"] == "on");
			bool CommDevLocalRegComFoodSys = (bool)(Request.Form["commdev_localregionalcommunityfoodsystems"] == "on");
			bool CommDevAgritourism = (bool)(Request.Form["commdev_agritourism"] == "on");
			bool CommDevCommPlan = (bool)(Request.Form["commdev_communityplanning"] == "on");
			bool CommDevPublicPolicy = (bool)(Request.Form["commdev_publicpolicy"] == "on");
			bool CommDevLeadDev = (bool)(Request.Form["commdev_leadershipdevelopment"] == "on");
			bool CommDevEthicDiffCultDemo = (bool)(Request.Form["commdev_ethnicdifferencesculturaldemographicchange"] == "on");
			//            string CommDevOther = MNS(Request.Form["commdev_other"]);

			profile.CommDevAgritourism = CommDevAgritourism;
			profile.CommDevCommunityPlanning = CommDevCommPlan;
			profile.CommDevEthnicDiffCulturDemoChange = CommDevEthicDiffCultDemo;
			profile.CommDevInfraAnalysis = CommDevInfraAnaly;
			profile.CommDevLeadershipDev = CommDevLeadDev;
			profile.CommDevLocalRegionalCommunityFoodSys = CommDevLocalRegComFoodSys;
			profile.CommDevNewBusOpp = CommDevNewBusOpp;
			//            profile.CommDevOther = CommDevOther;
			profile.CommDevPartner = CommDevPartnerships;
			profile.CommDevPublicPolicy = CommDevPublicPolicy;
			profile.CommDevPubPart = CommDevPublicPart;
			profile.CommDevTechAssist = CommDevTechAssist;
			profile.CommDevUrbanAgri = CommDevUrbanAgri;
			profile.CommDevUrbanRuralInt = CommDevUrbanRuralInt;

			bool QOfLifeAnalyPerFam = (bool)(Request.Form["qoflife_analysisofpersonalfamilylife"] == "on");
			bool QOfLifeSocialCapital = (bool)(Request.Form["qoflife_socialcapital"] == "on");
			bool QOfLifeSusMeasure = (bool)(Request.Form["qoflife_sustainabilitymeasures"] == "on");
			bool QOfLifeCommSrv = (bool)(Request.Form["qoflife_communityservices"] == "on");
			bool QOfLifeSocialNet = (bool)(Request.Form["qoflife_socialnetworks"] == "on");
			bool QOfLifeEmpOpp = (bool)(Request.Form["qoflife_employmentopportunities"] == "on");
			bool QOfLifeSocialPsyInc = (bool)(Request.Form["qoflife_socialpsychologicalindicators"] == "on");
			//            string QOfLifeOther = MNS(Request.Form["qoflife_other"]);

			profile.QofLifeAnalysisOfPersonalFamilyLife = QOfLifeAnalyPerFam;
			profile.QofLifeCommunitySrv = QOfLifeCommSrv;
			profile.QofLifeEmpOpp = QOfLifeEmpOpp;
			//            profile.QofLifeOther = QOfLifeOther;
			profile.QofLifeSocialCap = QOfLifeSocialCapital;
			profile.QofLifeSocialNet = QOfLifeSocialNet;
			profile.QofLifeSocialPsyInd = QOfLifeSocialPsyInc;
			profile.QofLifeSustainMeasures = QOfLifeSusMeasure;

			bool EngConsBioEngNFuel = (bool)(Request.Form["engcons_bioenergybiofuels"] == "on");
			bool EngConsWindPower = (bool)(Request.Form["engcons_windpower"] == "on");
			bool EngConsEngUseNConsump = (bool)(Request.Form["engcons_energyuseonsumption"] == "on");
			bool EngConsSolarEng = (bool)(Request.Form["engcons_solarenergy"] == "on");
			bool EngConsEngConserEff = (bool)(Request.Form["engcons_energyconservationefficiency"] == "on");
			//            string EngConsOther = MNS(Request.Form["engcons_other"]);

			profile.EngBioEngFuels = EngConsBioEngNFuel;
			profile.EngEngConservEff = EngConsEngConserEff;
			profile.EngEngUseConsumption = EngConsEngUseNConsump;
			//            profile.EngOther = EngConsOther;
			profile.EngSolarEng = EngConsSolarEng;
			profile.EngWindPower = EngConsWindPower;

			bool CommplAgrBarley = (bool)(Request.Form["commplagr_barley"] == "on");
			bool CommplAgrGrassLegumeHay = (bool)(Request.Form["commplagr_grasslegumehay"] == "on");
			bool CommplAgrPeanuts = (bool)(Request.Form["commplagr_peanuts"] == "on");
			bool CommplAgrSorghum = (bool)(Request.Form["commplagr_sorghum"] == "on");
			bool CommplAgrSweetpotatoes = (bool)(Request.Form["commplagr_sweetpotatoes"] == "on");
			bool CommplAgrCanola = (bool)(Request.Form["commplagr_canola"] == "on");
			bool CommplAgrLegumeHay = (bool)(Request.Form["commplagr_legumehay"] == "on");
			bool CommplAgrPotatoes = (bool)(Request.Form["commplagr_potatoes"] == "on");
			bool CommplAgrSoybeans = (bool)(Request.Form["commplagr_soybeans"] == "on");
			bool CommplAgrTobacco = (bool)(Request.Form["commplagr_tobacco"] == "on");
			bool CommplAgrCorn = (bool)(Request.Form["commplagr_corn"] == "on");
			bool CommplAgrHops = (bool)(Request.Form["commplagr_hops"] == "on");
			bool CommplAgrRapeseed = (bool)(Request.Form["commplagr_rapeseed"] == "on");
			bool CommplAgrSpelt = (bool)(Request.Form["commplagr_spelt"] == "on");
			bool CommplAgrWheat = (bool)(Request.Form["commplagr_wheat"] == "on");
			bool CommplAgrCotton = (bool)(Request.Form["commplagr_cotton"] == "on");
			bool CommplAgrKenaf = (bool)(Request.Form["commplagr_kenaf"] == "on");
			bool CommplAgrRice = (bool)(Request.Form["commplagr_rice"] == "on");
			bool CommplAgrSugarbeets = (bool)(Request.Form["commplagr_sugarbeets"] == "on");
			bool CommplAgrFlax = (bool)(Request.Form["commplagr_flax"] == "on");
			bool CommplAgrMillet = (bool)(Request.Form["commplagr_millet"] == "on");
			bool CommplAgrRye = (bool)(Request.Form["commplagr_rye"] == "on");
			bool CommplAgrSugarcane = (bool)(Request.Form["commplagr_sugarcane"] == "on");
			bool CommplAgrGrassHay = (bool)(Request.Form["commplagr_grasshay"] == "on");
			bool CommplAgrOats = (bool)(Request.Form["commplagr_oats"] == "on");
			bool CommplAgrSafflower = (bool)(Request.Form["commplagr_safflower"] == "on");
			bool CommplAgrSunflower = (bool)(Request.Form["commplagr_sunflower"] == "on");
			//            string CommplAgrOther = MNS(Request.Form["commplagr_Other"]);

			profile.CommPlAgrBarley = CommplAgrBarley;
			profile.CommPlAgrCanola = CommplAgrCanola;
			profile.CommPlAgrCorn = CommplAgrCorn;
			profile.CommPlAgrCotton = CommplAgrCotton;
			profile.CommPlAgrFlax = CommplAgrFlax;
			profile.CommPlAgrGrassHay = CommplAgrGrassHay;
			profile.CommPlAgrGrassLegHay = CommplAgrGrassLegumeHay;
			profile.CommPlAgrHops = CommplAgrHops;
			profile.CommPlAgrKenaf = CommplAgrKenaf;
			profile.CommPlAgrLegHay = CommplAgrLegumeHay;
			profile.CommPlAgrMillet = CommplAgrMillet;
			profile.CommPlAgrOats = CommplAgrOats;
			//            profile.CommPlAgrOther = CommplAgrOther;
			profile.CommPlAgrPeanuts = CommplAgrPeanuts;
			profile.CommPlAgrPotatoes = CommplAgrPotatoes;
			profile.CommPlAgrRapeseed = CommplAgrRapeseed;
			profile.CommPlAgrRice = CommplAgrRice;
			profile.CommPlAgrRye = CommplAgrRye;
			profile.CommPlAgrSafflower = CommplAgrSafflower;
			profile.CommPlAgrSorghum = CommplAgrSorghum;
			profile.CommPlAgrSoybeans = CommplAgrSoybeans;
			profile.CommPlAgrSpelt = CommplAgrSpelt;
			profile.CommPlAgrSugarbeets = CommplAgrSugarbeets;
			profile.CommPlAgrSugarcane = CommplAgrSugarcane;
			profile.CommPlAgrSunflower = CommplAgrSunflower;
			profile.CommPlAgrSweetpotatoes = CommplAgrSweetpotatoes;
			profile.CommPlAgrTobacco = CommplAgrTobacco;
			profile.CommPlAgrWheat = CommplAgrWheat;

			bool CommplVegArtichokes = (bool)(Request.Form["commplveg_artichokes"] == "on");
			bool CommplVegCabbage = (bool)(Request.Form["commplveg_cabbage"] == "on");
			bool CommplVegEscarole = (bool)(Request.Form["commplveg_escarole"] == "on");
			bool CommplVegOnions = (bool)(Request.Form["commplveg_onions"] == "on");
			bool CommplVegSweetcorn = (bool)(Request.Form["commplveg_sweetcorn"] == "on");
			bool CommplVegAsparagus = (bool)(Request.Form["commplveg_asparagus"] == "on");
			bool CommplVegCarrots = (bool)(Request.Form["commplveg_carrots"] == "on");
			bool CommplVegGarlic = (bool)(Request.Form["commplveg_garlic"] == "on");
			bool CommplVegParsnips = (bool)(Request.Form["commplveg_parsnips"] == "on");
			bool CommplVegTomatoes = (bool)(Request.Form["commplveg_tomatoes"] == "on");
			bool CommplVegBeans = (bool)(Request.Form["commplveg_beans"] == "on");
			bool CommplVegCauliflower = (bool)(Request.Form["commplveg_cauliflower"] == "on");
			bool CommplVegGreens = (bool)(Request.Form["commplveg_greens"] == "on");
			bool CommplVegPeas = (bool)(Request.Form["commplveg_peas"] == "on");
			bool CommplVegTurnips = (bool)(Request.Form["commplveg_turnips"] == "on");
			bool CommplVegBeets = (bool)(Request.Form["commplveg_beets"] == "on");
			bool CommplVegCelery = (bool)(Request.Form["commplveg_celery"] == "on");
			bool CommplVegKale = (bool)(Request.Form["commplveg_kale"] == "on");
			bool CommplVegPeppers = (bool)(Request.Form["commplveg_peppers"] == "on");
			bool CommplVegWatermelon = (bool)(Request.Form["commplveg_watermelon"] == "on");
			bool CommplVegBroccoli = (bool)(Request.Form["commplveg_broccoli"] == "on");
			bool CommplVegCucumbers = (bool)(Request.Form["commplveg_cucumbers"] == "on");
			bool CommplVegLentils = (bool)(Request.Form["commplveg_lentils"] == "on");
			bool CommplVegRutabagas = (bool)(Request.Form["commplveg_rutabagas"] == "on");
			bool CommplVegBrusselSprouts = (bool)(Request.Form["commplveg_brusselsprouts"] == "on");
			bool CommplVegEggplant = (bool)(Request.Form["commplveg_eggplant"] == "on");
			bool CommplVegLettuce = (bool)(Request.Form["commplveg_lettuce"] == "on");
			bool CommplVegSpinach = (bool)(Request.Form["commplveg_spinach"] == "on");
			bool CommplVegLeeks = (bool)(Request.Form["commplveg_leeks"] == "on");
			bool CommplVegPumpkins = (bool)(Request.Form["commplveg_pumpkins"] == "on");
			bool CommplVegSquashes = (bool)(Request.Form["commplveg_squashes"] == "on");
			bool CommplVegRadishes = (bool)(Request.Form["commplveg_radishes"] == "on");
			//            string CommplVegOther = MNS(Request.Form["commplveg_Other"]);

			profile.CommPlVegArtichokes = CommplVegArtichokes;
			profile.CommPlVegAsparagus = CommplVegAsparagus;
			profile.CommPlVegBeans = CommplVegBeans;
			profile.CommPlVegBeets = CommplVegBeets;
			profile.CommPlVegBroccoli = CommplVegBroccoli;
			profile.CommPlVegBrusselSprouts = CommplVegBrusselSprouts;
			profile.CommPlVegCabbage = CommplVegCabbage;
			profile.CommPlVegCarrots = CommplVegCarrots;
			profile.CommPlVegCauliflower = CommplVegCauliflower;
			profile.CommPlVegCelery = CommplVegCelery;
			profile.CommPlVegCucumbers = CommplVegCucumbers;
			profile.CommPlVegEggplant = CommplVegEggplant;
			profile.CommPlVegEscarole = CommplVegEscarole;
			profile.CommPlVegGarlic = CommplVegGarlic;
			profile.CommPlVegGreens = CommplVegGreens;
			profile.CommPlVegKale = CommplVegKale;
			profile.CommPlVegLeeks = CommplVegLeeks;
			profile.CommPlVegLentils = CommplVegLentils;
			profile.CommPlVegLettuce = CommplVegLettuce;
			profile.CommPlVegOnions = CommplVegOnions;
			//            profile.CommPlVegOther = CommplVegOther;
			profile.CommPlVegParsnips = CommplVegParsnips;
			profile.CommPlVegPeas = CommplVegPeas;
			profile.CommPlVegPeppers = CommplVegPeppers;
			profile.CommPlVegRutabagas = CommplVegRutabagas;
			profile.CommPlVegSpinach = CommplVegSpinach;
			profile.CommPlVegPumpkins = CommplVegPumpkins;
			profile.CommPlVegRadishes = CommplVegRadishes;
			profile.CommPlVegSquashes = CommplVegSquashes;
			profile.CommPlVegSweetCorn = CommplVegSweetcorn;
			profile.CommPlVegTomatoes = CommplVegTomatoes;
			profile.CommPlVegTurnips = CommplVegTurnips;
			profile.CommPlVegWatermelon = CommplVegWatermelon;

			bool CommplFruitApples = (bool)(Request.Form["commplfruit_apples"] == "on");
			bool CommplFruitCherries = (bool)(Request.Form["ccommplfruit_cherries"] == "on");
			bool CommplFruitLemons = (bool)(Request.Form["ccommplfruit_lemons"] == "on");
			bool CommplFruitPeaches = (bool)(Request.Form["ccommplfruit_peaches"] == "on");
			bool CommplFruitStrawberries = (bool)(Request.Form["ccommplfruit_strawberries"] == "on");
			bool CommplFruitApricots = (bool)(Request.Form["ccommplfruit_apricots"] == "on");
			bool CommplFruitCranberries = (bool)(Request.Form["ccommplfruit_cranberries"] == "on");
			bool CommplFruitLimes = (bool)(Request.Form["ccommplfruit_limes"] == "on");
			bool CommplFruitPears = (bool)(Request.Form["ccommplfruit_pears"] == "on");
			bool CommplFruitFigs = (bool)(Request.Form["ccommplfruit_figs"] == "on");
			bool CommplFruitMelons = (bool)(Request.Form["ccommplfruit_melons"] == "on");
			bool CommplFruitPineapples = (bool)(Request.Form["ccommplfruit_pineapples"] == "on");
			bool CommplFruitAvocados = (bool)(Request.Form["ccommplfruit_avocados"] == "on");
			bool CommplFruitTangerines = (bool)(Request.Form["ccommplfruit_tangerines"] == "on");
			bool CommplFruitBananas = (bool)(Request.Form["ccommplfruit_bananas"] == "on");
			bool CommplFruitGrapefruit = (bool)(Request.Form["ccommplfruit_grapefruit"] == "on");
			bool CommplFruitOlives = (bool)(Request.Form["ccommplfruit_olives"] == "on");
			bool CommplFruitPlums = (bool)(Request.Form["ccommplfruit_plums"] == "on");
			bool CommplFruitBerries = (bool)(Request.Form["ccommplfruit_berries"] == "on");
			bool CommplFruitGrapes = (bool)(Request.Form["ccommplfruit_grapes"] == "on");
			bool CommplFruitOranges = (bool)(Request.Form["ccommplfruit_oranges"] == "on");
			bool CommplFruitQuinces = (bool)(Request.Form["ccommplfruit_quinces"] == "on");
			bool CommplFruitBrambles = (bool)(Request.Form["ccommplfruit_brambles"] == "on");
			bool CommplFruitBlueberries = (bool)(Request.Form["ccommplfruit_blueberries"] == "on");
			//            string CommplFruitOther = MNS(Request.Form["ccommplfruit_Other"]);

			profile.CommPlFruitApples = CommplFruitApples;
			profile.CommPlFruitApricots = CommplFruitApricots;
			profile.CommPlFruitAvocados = CommplFruitAvocados;
			profile.CommPlFruitBananas = CommplFruitBananas;
			profile.CommPlFruitBerries = CommplFruitBerries;
			profile.CommPlFruitBlueberries = CommplFruitBlueberries;
			profile.CommPlFruitBrambles = CommplFruitBrambles;
			profile.CommPlFruitCherries = CommplFruitCherries;
			profile.CommPlFruitCranberries = CommplFruitCranberries;
			profile.CommPlFruitFigs = CommplFruitFigs;
			profile.CommPlFruitGrapefruit = CommplFruitGrapefruit;
			profile.CommPlFruitGrapes = CommplFruitGrapes;
			profile.CommPlFruitLemons = CommplFruitLemons;
			profile.CommPlFruitLimes = CommplFruitLimes;
			profile.CommPlFruitMelons = CommplFruitMelons;
			profile.CommPlFruitOlives = CommplFruitOlives;
			//            profile.CommPlFruitOther = CommplFruitOther;
			profile.CommPlFruitOranges = CommplFruitOranges;
			profile.CommPlFruitPeaches = CommplFruitPeaches;
			profile.CommPlFruitPears = CommplFruitPears;
			profile.CommPlFruitPineapples = CommplFruitPineapples;
			profile.CommPlFruitPlums = CommplFruitPlums;
			profile.CommPlFruitQuinces = CommplFruitQuinces;
			profile.CommPlFruitStrawberries = CommplFruitStrawberries;
			profile.CommPlFruitTangerines = CommplFruitTangerines;

			bool CommplnutsAlmonds = (bool)(Request.Form["commplnuts_almonds"] == "on");
			bool CommplnutsHazelnuts = (bool)(Request.Form["commplnuts_hazelnuts"] == "on");
			bool CommplnutsPecans = (bool)(Request.Form["commplnuts_pecans"] == "on");
			bool CommplnutsWalnuts = (bool)(Request.Form["commplnuts_walnuts"] == "on");
			bool CommplnutsChestnuts = (bool)(Request.Form["commplnuts_chestnuts"] == "on");
			bool CommplnutsMacadamia = (bool)(Request.Form["commplnuts_macadamia"] == "on");
			bool CommplnutsPistachios = (bool)(Request.Form["commplnuts_pistachios"] == "on");
			//            string CommplnutsOther = MNS(Request.Form["commplnuts_other"]);

			profile.CommPlNutsAlmonds = CommplnutsAlmonds;
			profile.CommPlNutsChestnuts = CommplnutsChestnuts;
			profile.CommPlNutsHazel = CommplnutsHazelnuts;
			//            profile.CommPlNutsOther = CommplnutsOther;
			profile.CommPlNutsMacadamia = CommplnutsMacadamia;
			profile.CommPlNutsPecans = CommplnutsPecans;
			profile.CommPlNutsPistachios = CommplnutsPistachios;
			profile.CommPlNutsWalnuts = CommplnutsWalnuts;

			bool CommplAddHerbs = (bool)(Request.Form["commpladd_herbs"] == "on");
			bool CommplAddOrnamentals = (bool)(Request.Form["commpladd_ornamentals"] == "on");
			bool CommplAddTrees = (bool)(Request.Form["commpladd_trees"] == "on");
			bool CommplAddMushrooms = (bool)(Request.Form["commpladd_mushrooms"] == "on");
			bool CommplAddNativePlants = (bool)(Request.Form["commpladd_nativeplants"] == "on");
			//            string CommplAddOther = MNS(Request.Form["commpladd_other"]);

			profile.CommPlAddHerbs = CommplAddHerbs;
			profile.CommPlAddMushrooms = CommplAddMushrooms;
			profile.CommPlAddNativePlants = CommplAddNativePlants;
			profile.CommPlAddOrnamentals = CommplAddOrnamentals;
			//            profile.CommPlAddOther = CommplAddOther;
			profile.CommPlAddTrees = CommplAddTrees;

			bool CommAnimBeef = (bool)(Request.Form["commanim_beef"] == "on");
			bool CommAnimChicken = (bool)(Request.Form["commanim_chicken"] == "on");
			bool CommAnimRabbits = (bool)(Request.Form["commanim_rabbits"] == "on");
			bool CommAnimSwine = (bool)(Request.Form["commanim_swine"] == "on");
			bool CommAnimDairy = (bool)(Request.Form["commanim_dairy"] == "on");
			bool CommAnimGoats = (bool)(Request.Form["commanim_goats"] == "on");
			bool CommAnimTurkeys = (bool)(Request.Form["commanim_turkeys"] == "on");
			bool CommAnimSheep = (bool)(Request.Form["commanim_sheep"] == "on");
			//            string CommAnimOther = MNS(Request.Form["commanim_other"]);

			profile.CommAnimBeef = CommAnimBeef;
			profile.CommAnimChicken = CommAnimChicken;
			profile.CommAnimDairy = CommAnimDairy;
			profile.CommAnimGoats = CommAnimGoats;
			//            profile.CommAnimOther = CommAnimOther;
			profile.CommAnimRabbits = CommAnimRabbits;
			profile.CommAnimSheep = CommAnimSheep;
			profile.CommAnimSwine = CommAnimSwine;
			profile.CommAnimTurkeys = CommAnimTurkeys;

			bool CommMiscBees = (bool)(Request.Form["commmisc_Bees"] == "on");
			bool CommMiscFish = (bool)(Request.Form["commmisc_fish"] == "on");
			bool CommMiscRatites = (bool)(Request.Form["commmisc_ratites"] == "on");
			bool CommMiscShellFish = (bool)(Request.Form["commmisc_shellfish"] == "on");
			//            string CommMiscOther = MNS(Request.Form["commmisc_other"]);

			profile.CommMiscBees = CommMiscBees;
			profile.CommMiscFish = CommMiscFish;
			//            profile.CommMiscOther = CommMiscOther;
			profile.CommMiscRatites = CommMiscRatites;
			profile.CommMiscShellfish = CommMiscShellFish;


			Session["searchProfile"] = profile;

		}

		public void AddProfile2(object sender, System.EventArgs e)
		{
			DaikonProfile profile;
			if (null != Session["currProfile"])
				profile = (DaikonProfile)(Session["currProfile"]);
			else
				profile = new DaikonProfile();

			bool IntegraEcoSys = (bool)(Request.Form["intgfrs_agroecosystemanalysis"] == "on");
			bool IntegraWhFarmPlan = (bool)(Request.Form["intgfrs_wholefarmplanning"] == "on");
			bool IntegraOrgAgri = (bool)(Request.Form["intgfrs_organicagriculture"] == "on");
			bool IntegraPerma = (bool)(Request.Form["intgfrs_permaculture"] == "on");
            bool IntegraHolisticMgmt = (bool)(Request.Form["intgfrs_HolisticManagement"] == "on");
			string IntegraOther = MNS(Request.Form["intgfrs_other"]);

			profile.IntgfrsAgroEcoSystemAnalysis = IntegraEcoSys;
			profile.IntgfrsWholeFarmPlanning = IntegraWhFarmPlan;
			profile.IntgfrsOrgAgri = IntegraOrgAgri;
			profile.IntgfrsPermaCulture = IntegraPerma;
            profile.IntgfrsHolisticMgmt = IntegraHolisticMgmt;
			profile.IntgfrsOther = IntegraOther;

			bool CropPrdAgro = (bool)(Request.Form["cropprd_agroforestry"] == "on");
			bool CropPrdFolFeed = (bool)(Request.Form["cropprd_foliarfeeding"] == "on");
			bool CropPrdNutriCyc = (bool)(Request.Form["cropprd_nutrientcycling"] == "on");
			bool CropPrdStripCrop = (bool)(Request.Form["cropprd_stripcropping"] == "on");
			bool CropPrdBioLogic = (bool)(Request.Form["cropprd_biologicalinoculants"] == "on");
			bool CropPrdForestry = (bool)(Request.Form["cropprd_forestry"] == "on");
			bool CropPrdOrgFerti = (bool)(Request.Form["cropprd_organicfertilizers"] == "on");
			bool CropPrdStubbMulch = (bool)(Request.Form["cropprd_stubblemulching"] == "on");
			bool CropPrdConticrop = (bool)(Request.Form["cropprd_continuouscropping"] == "on");
			bool CropPrdGreenManu = (bool)(Request.Form["cropprd_greenmanures"] == "on");
			bool CropPrdOrgMatt = (bool)(Request.Form["cropprd_organicmatter"] == "on");
			bool CropPrdTissueAnaly = (bool)(Request.Form["cropprd_tissueanalysis"] == "on");
			bool CropPrdCoverCrop = (bool)(Request.Form["cropprd_covercrops"] == "on");
			bool CropPrdIntCrop = (bool)(Request.Form["cropprd_intercropping"] == "on");
			bool CropPrdPermaCul = (bool)(Request.Form["cropprd_permaculture"] == "on");
            bool CropPrdTransToOrg = (bool)(Request.Form["cropprd_transitioning"] == "on");
			bool CropPrdDbleCrop = (bool)(Request.Form["cropprd_doublecropping"] == "on");
			bool CropPrdMiniTillage = (bool)(Request.Form["cropprd_minimumtillage"] == "on");
			bool CropPrdReduceAppli = (bool)(Request.Form["cropprd_reducedapplications"] == "on");
			bool CropPrdEarthworms = (bool)(Request.Form["cropprd_earthworms"] == "on");
			bool CropPrdMulticrop = (bool)(Request.Form["cropprd_multiplecropping"] == "on");
			bool CropPrdRelayCrop = (bool)(Request.Form["cropprd_relaycropping"] == "on");
			bool CropPrdFallow = (bool)(Request.Form["cropprd_fallow"] == "on");
			bool CropPrdMuniWste = (bool)(Request.Form["cropprd_municipalwastes"] == "on");
			bool CropPrdRedgeTillage = (bool)(Request.Form["cropprd_ridgetillage"] == "on");
			bool CropPrdFertigation = (bool)(Request.Form["cropprd_fertigation"] == "on");
			bool CropPrdNoTill = (bool)(Request.Form["cropprd_notill"] == "on");
			bool CropPrdSoilAnaly = (bool)(Request.Form["cropprd_soilanalysis"] == "on");
			bool CropPrdCatchCrop = (bool)(Request.Form["cropprd_catchcrops"] == "on");
			bool CropPrdCropRota = (bool)(Request.Form["cropprd_croprotation"] == "on");
			bool CropPrdCropBreed = (bool)(Request.Form["cropprd_cropbreeding"] == "on");
			bool CropPrdIrrigation = (bool)(Request.Form["cropprd_irrigation"] == "on");
			string CropPrdOther = MNS(Request.Form["cropprd_other"]);

			profile.CropprdAgroforesty = CropPrdAgro;
			profile.CropprdBioInoculants = CropPrdBioLogic;
            profile.CropprdForestry = CropPrdForestry;
			profile.CropprdCatchCrops = CropPrdCatchCrop;
			profile.CropprdContinousCrop = CropPrdConticrop;
			profile.CropprdCoverCrops = CropPrdCoverCrop;
			profile.CropprdCropBreeding = CropPrdCropBreed;
			profile.CropprdCropRotation = CropPrdCropRota;
			profile.CropprdDoubleCropping = CropPrdDbleCrop;
			profile.CropprdEarthworms = CropPrdEarthworms;
			profile.CropprdFallow = CropPrdFallow;
			profile.CropprdFoliarFeeding = CropPrdFolFeed;
			profile.CropprdFertigation = CropPrdFertigation;
			profile.CropprdGreenManures = CropPrdGreenManu;
			profile.CropprdInterCropping = CropPrdIntCrop;
			profile.CropprdIrrigation = CropPrdIrrigation;
			profile.CropprdMiniTillage = CropPrdMiniTillage;
			profile.CropprdMultiCropping = CropPrdMulticrop;
			profile.CropprdMunicipalWastes = CropPrdMuniWste;
			profile.CropprdNoTill = CropPrdNoTill;
			profile.CropprdNutriCycling = CropPrdNutriCyc;
			profile.CropprdOrgFertilizers = CropPrdOrgFerti;
			profile.CropprdOrgMatter = CropPrdOrgMatt;
			profile.CropprdPermaCulture = CropPrdPermaCul;
			profile.CropprdReduceApps = CropPrdReduceAppli;
			profile.CropprdRelayCropping = CropPrdRelayCrop;
			profile.CropprdRidgeTillage = CropPrdRedgeTillage;
			profile.CropprdSoilAnalysis = CropPrdSoilAnaly;
			profile.CropprdStripCropping = CropPrdStripCrop;
			profile.CropprdStubbleMulch = CropPrdStubbMulch;
			profile.CropprdTissueAnalysis = CropPrdTissueAnaly;
			profile.CropprdTrans = CropPrdTransToOrg;
			profile.CropprdOther = CropPrdOther;



			bool AnimPrdAltFeedStuff = (bool)(Request.Form["animprd_alternativefeedstuffs"] == "on");
			bool AnimPrdFeedRations = (bool)(Request.Form["animprd_feedrations"] == "on");
			bool AnimPrdMultiSpeciesGrz = (bool)(Request.Form["animprd_multispeciesgrazing"] == "on");
			bool AnimPrdStockPiledForg = (bool)(Request.Form["animprd_stockpiledforages"] == "on");
			bool AnimPrdAltHouse = (bool)(Request.Form["animprd_alternativehousing"] == "on");
			bool AnimPrdFreeRange = (bool)(Request.Form["animprd_freerange"] == "on");
			bool AnimPrdPastureFerti = (bool)(Request.Form["animprd_pasturefertility"] == "on");
			bool AnimPrdVaccine = (bool)(Request.Form["animprd_vaccines"] == "on");
			bool AnimPrdAltParasiteCont = (bool)(Request.Form["animprd_alternparasitecontrol"] == "on");
			bool AnimPrdHerbalMed = (bool)(Request.Form["animprd_herbalmedicines"] == "on");
			bool AnimPrdPastureReno = (bool)(Request.Form["animprd_pasturerenovation"] == "on");
			bool AnimPrdWaterSys = (bool)(Request.Form["animprd_wateringsystem"] == "on");
			bool AnimPrdAnimalProtect = (bool)(Request.Form["animprd_animalprotection"] == "on");
			bool AnimPrdHomeopathy = (bool)(Request.Form["animprd_homeopathy"] == "on");
			bool AnimPrdPrePrac = (bool)(Request.Form["animprd_preventivepractices"] == "on");
			bool AnimPrdWinterForage = (bool)(Request.Form["animprd_winterforage"] == "on");
			bool AnimPrdComposting = (bool)(Request.Form["animprd_composting"] == "on");
			bool AnimPrdImplants = (bool)(Request.Form["animprd_implants"] == "on");
			bool AnimPrdProbiotics = (bool)(Request.Form["animprd_probiotics"] == "on");
			bool AnimPrdContGraze = (bool)(Request.Form["animprd_continuousgrazing"] == "on");
			bool AnimPrdInoculants = (bool)(Request.Form["animprd_inoculants"] == "on");
			bool AnimPrdRangeImp = (bool)(Request.Form["animprd_rangeimprovement"] == "on");
			bool AnimPrdFeedAddti = (bool)(Request.Form["animprd_feedadditives"] == "on");
			bool AnimPrdManuMgmt = (bool)(Request.Form["animprd_manuremanagement"] == "on");
			bool AnimPrdRotaGraz = (bool)(Request.Form["animprd_rotationalgrazing"] == "on");
			bool AnimPrdFeedFormula = (bool)(Request.Form["animprd_feedformulation"] == "on");
			bool AnimPrdMineralSupp = (bool)(Request.Form["animprd_mineralsupplements"] == "on");
			bool AnimPrdShadShelter = (bool)(Request.Form["animprd_shadeshelter"] == "on");
			bool AnimPrdGrazMgmt = (bool)(Request.Form["animprd_grazingmanagement"] == "on");
			bool AnimPrdTherapeutics = (bool)(Request.Form["animprd_therapeutics"] == "on");
			bool AnimPrdLiveBreed = (bool)(Request.Form["animprd_livestockbreeding"] == "on");
			bool AnimPrdStockRate = (bool)(Request.Form["animprd_stockingrate"] == "on");
			string AnimPrdOther = MNS(Request.Form["animprd_other"]);

			profile.AnimprdAltFeedstuffs = AnimPrdAltFeedStuff;
			profile.AnimprdAltHousing = AnimPrdAltHouse;
			profile.AnimprdAltParasiteControl = AnimPrdAltParasiteCont;
			profile.AnimprdAnimalProtection = AnimPrdAnimalProtect;
			profile.AnimprdComposting = AnimPrdComposting;
			profile.AnimprdContGrazing = AnimPrdContGraze;
			profile.AnimprdFeedAdditives = AnimPrdFeedAddti;
			profile.AnimprdFeedFormulation = AnimPrdFeedFormula;
			profile.AnimprdFeedRations = AnimPrdFeedRations;
			profile.AnimprdFreeRange = AnimPrdFreeRange;
			profile.AnimprdGrazMgmt = AnimPrdGrazMgmt;
			profile.AnimprdHerbalMed = AnimPrdHerbalMed;
			profile.AnimprdHomeopathy = AnimPrdHomeopathy;
			profile.AnimprdImplants = AnimPrdImplants;
			profile.AnimprdInoculants = AnimPrdInoculants;
			profile.AnimprdLivestockBreeding = AnimPrdLiveBreed;
			profile.AnimprdManureMgmt = AnimPrdManuMgmt;
			profile.AnimprdMineralSupp = AnimPrdMineralSupp;
			profile.AnimprdMultiSpeciesGrazing = AnimPrdMultiSpeciesGrz;
			profile.AnimprdOther = AnimPrdOther;
			profile.AnimprdPastureFerti = AnimPrdPastureFerti;
			profile.AnimprdPastureRenovation = AnimPrdPastureReno;
			profile.AnimprdPreventivePract = AnimPrdPrePrac;
			profile.AnimprdProbiotics = AnimPrdProbiotics;
			profile.AnimprdRangeImprovement = AnimPrdRangeImp;
			profile.AnimprdRotGrazing = AnimPrdRotaGraz;
			profile.AnimprdShadeShelter = AnimPrdShadShelter;
			profile.AnimprdStockingRate = AnimPrdStockRate;
			profile.AnimprdStockpiledForages = AnimPrdStockPiledForg;
			profile.AnimprdTherapeutics = AnimPrdTherapeutics;
			profile.AnimprdVaccines = AnimPrdVaccine;
			profile.AnimprdWateringSys = AnimPrdWaterSys;
			profile.AnimprdWinterForage = AnimPrdWinterForage;


			bool PestMgmtAllelopathy = (bool)(Request.Form["pestmgt_allelopathy"] == "on");
			bool PestMgmtEcoThres = (bool)(Request.Form["pestmgt_economicthreshold"] == "on");
			bool PestMgmtMechCont = (bool)(Request.Form["pestmgt_mechanicalcontrol"] == "on");
			bool PestMgmtSmthCrop = (bool)(Request.Form["pestmgt_smothercrops"] == "on");
			bool PestMgmtBioCont = (bool)(Request.Form["pestmgt_biologicalcontrol"] == "on");
			bool PestMgmtEradication = (bool)(Request.Form["pestmgt_eradication"] == "on");
			bool PestMgmtPhyCont = (bool)(Request.Form["pestmgt_physicalcontrol"] == "on");
			bool PestMgmtTraps = (bool)(Request.Form["pestmgt_traps"] == "on");
			bool PestMgmtBioratPest = (bool)(Request.Form["pestmgt_biorationalpesticides"] == "on");
			bool PestMgmtFlame = (bool)(Request.Form["pestmgt_flame"] == "on");
			bool PestMgmtPlstMulch = (bool)(Request.Form["pestmgt_plasticmulching"] == "on");
			bool PestMgmtTrapCrop = (bool)(Request.Form["pestmgt_trapcrops"] == "on");
			bool PestMgmtBotPest = (bool)(Request.Form["pestmgt_botanicalpesticides"] == "on");
			bool PestMgmtFieldMoni = (bool)(Request.Form["pestmgt_fieldmonitoring"] == "on");
			bool PestMgmtPreciCult = (bool)(Request.Form["pestmgt_precisioncultivation"] == "on");
			bool PestMgmtVegMulch = (bool)(Request.Form["pestmgt_vegetativemulching"] == "on");
			bool PestMgmtChemCont = (bool)(Request.Form["pestmgt_chemicalcontrol"] == "on");
			bool PestMgmtGeneticResis = (bool)(Request.Form["pestmgt_geneticresistance"] == "on");
			bool PestMgmtpreciheruse = (bool)(Request.Form["pestmgt_precisionherbicideuse"] == "on");
			bool PestMgmtWeatherMoni = (bool)(Request.Form["pestmgt_weathermonitoring"] == "on");
			bool PestMgmtCompetition = (bool)(Request.Form["pestmgt_competition"] == "on");
			bool PestMgmtIPM = (bool)(Request.Form["pestmgt_IPM"] == "on");
			bool PestMgmtPrevention = (bool)(Request.Form["pestmgt_prevention"] == "on");
			bool PestMgmtWeedEco = (bool)(Request.Form["pestmgt_weedecology"] == "on");
			bool PestMgmtCompostExt = (bool)(Request.Form["pestmgt_compostextracts"] == "on");
			bool PestMgmtKilledMulch = (bool)(Request.Form["pestmgt_killedmulches"] == "on");
			bool PestMgmtRowCover = (bool)(Request.Form["pestmgt_rowcovers"] == "on");
			bool PestMgmtWeedGeese = (bool)(Request.Form["pestmgt_weedergeese"] == "on");
			bool PestMgmtculturalCont = (bool)(Request.Form["pestmgt_culturalcontrol"] == "on");
			bool PestMgmtLivingMulch = (bool)(Request.Form["pestmgt_livingmulches"] == "on");
			bool PestMgmtSanitation = (bool)(Request.Form["pestmgt_sanitation"] == "on");
			bool PestMgmtDiseaseVect = (bool)(Request.Form["pestmgt_diseasevectors"] == "on");
			bool PestMgmtMatingDis = (bool)(Request.Form["pestmgt_matingdisruption"] == "on");
			bool PestMgmtSoilSolar = (bool)(Request.Form["pestmgt_soilsolarization"] == "on");
			string PestMgmtOther = MNS(Request.Form["pestmgt_other"]);

			profile.PestMgmtAllelopathy = PestMgmtAllelopathy;
			profile.PestMgmtBioControl = PestMgmtBioCont;
			profile.PestMgmtBioPest = PestMgmtBioratPest;
			profile.PestMgmtBotaPest = PestMgmtBotPest;
			profile.PestMgmtChemControl = PestMgmtChemCont;
			profile.PestMgmtCompetition = PestMgmtCompetition;
			profile.PestMgmtCompostExtracts = PestMgmtCompostExt;
			profile.PestMgmtCulturalControl = PestMgmtculturalCont;
			profile.PestMgmtDiseaseVectors = PestMgmtDiseaseVect;
			profile.PestMgmtEcoThreshold = PestMgmtEcoThres;
			profile.PestMgmtEradication = PestMgmtEradication;
			profile.PestMgmtFieldMonitoring = PestMgmtFieldMoni;
			profile.PestMgmtFlame = PestMgmtFlame;
			profile.PestMgmtGeneticResis = PestMgmtGeneticResis;
			profile.PestMgmtIPM = PestMgmtIPM;
			profile.PestMgmtKilledMulches = PestMgmtKilledMulch;
			profile.PestMgmtLivingMulches = PestMgmtLivingMulch;
			profile.PestMgmtMatingDisruption = PestMgmtMatingDis;
			profile.PestMgmtMechControl = PestMgmtMechCont;
			profile.PestMgmtOther = PestMgmtOther;
			profile.PestMgmtPhyControl = PestMgmtPhyCont;
			profile.PestMgmtPlasticMulch = PestMgmtPlstMulch;
			profile.PestMgmtPrecisiCulti = PestMgmtPreciCult;
			profile.PestMgmtPrecisiHerbicideUse = PestMgmtpreciheruse;
			profile.PestMgmtPrevention = PestMgmtPrevention;
			profile.PestMgmtRowCovers = PestMgmtRowCover;
			profile.PestMgmtSanitation = PestMgmtSanitation;
			profile.PestMgmtSmotherCrops = PestMgmtSmthCrop;
			profile.PestMgmtSoilSolar = PestMgmtSoilSolar;
			profile.PestMgmtTrapCrops = PestMgmtTrapCrop;
			profile.PestMgmtTraps = PestMgmtTraps;
			profile.PestMgmtVegMulch = PestMgmtVegMulch;
			profile.PestMgmtWeatherMoni = PestMgmtWeatherMoni;
			profile.PestMgmtWeedEco = PestMgmtWeedEco;
			profile.PestMgmtWeedGeese = PestMgmtWeedGeese;

			bool SoilMgmtNutriMineral = (bool)(Request.Form["soilmgt_nutrientmineralization"] == "on");
			bool SoilMgmtSoilBio = (bool)(Request.Form["soilmgt_SoilMicrobiology"] == "on");
			bool SoilMgmtSoilOrgMatter = (bool)(Request.Form["soilmgt_soilorganicmatter"] == "on");
			bool SoilMgmtSoilQty = (bool)(Request.Form["soilmgt_soilquality"] == "on");
			bool SoilMgmtSoilChem = (bool)(Request.Form["soilmgt_soilchemistry"] == "on");
			bool SoilMgmtSoilPhy = (bool)(Request.Form["soilmgt_soilphysics"] == "on");
			bool SoilMgmtCarbonSeq = (bool)(Request.Form["soilmgt_carbonsequestration"] == "on");
			string SoilMgmtOther = MNS(Request.Form["soilmgt_other"]);

			profile.SoilMgmtCarbonSequestration = SoilMgmtCarbonSeq;
			profile.SoilMgmtNutriMineralization = SoilMgmtNutriMineral;
			profile.SoilMgmtOrgtMatter = SoilMgmtSoilOrgMatter;
			profile.SoilMgmtOther = SoilMgmtOther;
			profile.SoilMgmtQty = SoilMgmtSoilQty;
			profile.SoilMgmtSoilMicroBio = SoilMgmtSoilBio;
			profile.SoilMgmtSoilChem = SoilMgmtSoilChem;
			profile.SoilMgmtSoilPhy = SoilMgmtSoilPhy;

			bool NResEnvAfforestation = (bool)(Request.Form["nresenv_afforestation"] == "on");
			bool NResEnvGrassHedges = (bool)(Request.Form["nresenv_grasshedges"] == "on");
			bool NResEnvRipariPlant = (bool)(Request.Form["nresenv_riparianplantings"] == "on");
			bool NResEnvWildlife = (bool)(Request.Form["nresenv_wildlife"] == "on");
			bool NResEnvBioDiver = (bool)(Request.Form["nresenv_biodiversity"] == "on");
			bool NResEnvGrassWater = (bool)(Request.Form["nresenv_grasswaterways"] == "on");
			bool NResEnvRiverBankProtect = (bool)(Request.Form["nresenv_riverbankprotection"] == "on");
			bool NResEnvWindBreak = (bool)(Request.Form["nresenv_windbreaks"] == "on");
			bool NResEnvBiosphere = (bool)(Request.Form["nresenv_biosphere"] == "on");
			bool NResEnvHabitEnhance = (bool)(Request.Form["nresenv_habitatenhancement"] == "on");
			bool NResEnvSoilStab = (bool)(Request.Form["nresenv_soilstabilization"] == "on");
			bool NResEnvWoodyHedge = (bool)(Request.Form["nresenv_woodyhedges"] == "on");
			bool NResEnvConservTillage = (bool)(Request.Form["nresenv_conservationtillage"] == "on");
			bool NResEnvHedgeRow = (bool)(Request.Form["nresenv_hedgerows"] == "on");
			bool NResEnvTerraces = (bool)(Request.Form["nresenv_terraces"] == "on");
			bool NResEnvContourCulti = (bool)(Request.Form["nresenv_contourcultivation"] == "on");
			bool NResEnvIndicators = (bool)(Request.Form["nresenv_indicators"] == "on");
			bool NResEnvWetlands = (bool)(Request.Form["nresenv_wetlands"] == "on");
			string NResEnvOther = MNS(Request.Form["nresenv_other"]);

			profile.NResEnvAfforestation = NResEnvAfforestation;
			profile.NResEnvBiodiver = NResEnvBioDiver;
			profile.NResEnvBiosphere = NResEnvBiosphere;
			profile.NResEnvConserTillage = NResEnvConservTillage;
			profile.NResEnvContourCulti = NResEnvContourCulti;
			profile.NResEnvGrassHedges = NResEnvGrassHedges;
			profile.NResEnvGrassWaterWays = NResEnvGrassWater;
			profile.NResEnvHabitatEnhance = NResEnvHabitEnhance;
			profile.NResEnvHedgerows = NResEnvHedgeRow;
			profile.NResEnvIndi = NResEnvIndicators;
			profile.NResEnvOther = NResEnvOther;
			profile.NResEnvRiparianPlantings = NResEnvRipariPlant;
			profile.NResEnvRiverBnkProtect = NResEnvRiverBankProtect;
			profile.NResEnvSoilStabilization = NResEnvSoilStab;
			profile.NResEnvTerraces = NResEnvTerraces;
			profile.NResEnvWetlands = NResEnvWetlands;
			profile.NResEnvWildlife = NResEnvWildlife;
			profile.NResEnvWindbreaks = NResEnvWindBreak;
			profile.NResEnvWoodyHedges = NResEnvWoodyHedge;

			bool EduTrnCaseStudy = (bool)(Request.Form["edu_trn_casestudy"] == "on");
			bool EduTrnDemo = (bool)(Request.Form["edu_trn_demonstration"] == "on");
			bool EduTrnFocusGroup = (bool)(Request.Form["edu_trn_focusgroup"] == "on");
			bool EduTrnStudyCircle = (bool)(Request.Form["edu_trn_studycircle"] == "on");
			bool EduTrnConfer = (bool)(Request.Form["edu_trn_conference"] == "on");
			bool EduTrnDisplay = (bool)(Request.Form["edu_trn_display"] == "on");
			bool EduTrnMentoring = (bool)(Request.Form["edu_trn_mentoring"] == "on");
			bool EduTrnWorkshop = (bool)(Request.Form["edu_trn_workshop"] == "on");
			bool EduTrnCurriculum = (bool)(Request.Form["edu_trn_curriculum"] == "on");
			bool EduTrnExt = (bool)(Request.Form["edu_trn_Extension"] == "on");
			bool EduTrnNetwork = (bool)(Request.Form["edu_trn_network"] == "on");
			bool EduTrnDB = (bool)(Request.Form["edu_trn_database"] == "on");
			bool EduTrnFactSheet = (bool)(Request.Form["edu_trn_factsheet"] == "on");
			bool EduTrnOnFarmRes = (bool)(Request.Form["edu_trn_onfarmresearch"] == "on");
			bool EduTrnDeciSupportSys = (bool)(Request.Form["edu_trn_decisionsupportsystem"] == "on");
			bool EduTrnFarmToFarm = (bool)(Request.Form["edu_trn_farmertofarmer"] == "on");
			bool EduTrnPartRes = (bool)(Request.Form["edu_trn_participatoryresearch"] == "on");
			bool EduTrnYouthEdu = (bool)(Request.Form["edu_trn_youtheducation"] == "on");
			string EduTrnOther = MNS(Request.Form["edu_trn_other"]);

			profile.EdTrainCaseStudy = EduTrnCaseStudy;
			profile.EdTrainConference = EduTrnConfer;
			profile.EdTrainCurriculum = EduTrnCurriculum;
			profile.EdTrainDB = EduTrnDB;
			profile.EdTrainDecisionSupportSys = EduTrnDeciSupportSys;
			profile.EdTrainDemo = EduTrnDemo;
			profile.EdTrainDisplay = EduTrnDisplay;
			profile.EdTrainExt = EduTrnExt;
			profile.EdTrainFactSheet = EduTrnFactSheet;
			profile.EdTrainFarmerToFarmer = EduTrnFarmToFarm;
			profile.EdTrainFocusGroup = EduTrnFocusGroup;
			profile.EdTrainMentor = EduTrnMentoring;
			profile.EdTrainNet = EduTrnNetwork;
			profile.EdTrainOnFarmResearch = EduTrnOnFarmRes;
			profile.EdTrainOther = EduTrnOther;
			profile.EdTrainParticipatoryResearch = EduTrnPartRes;
			profile.EdTrainStudyCircle = EduTrnStudyCircle;
			profile.EdTrainWorkshop = EduTrnWorkshop;
			profile.EdTrainYouthEdu = EduTrnYouthEdu;

			bool EconMktAltEnt = (bool)(Request.Form["econmkt_alternativeenterprise"] == "on");
			bool EconMktCSA = (bool)(Request.Form["econmkt_CSA"] == "on");
			bool EconMktFeasibilityStudy = (bool)(Request.Form["econmkt_feasibilitystudy"] == "on");
			bool EconMktRiskMgmt = (bool)(Request.Form["econmkt_riskmanagement"] == "on");
			bool EconMktBudget = (bool)(Request.Form["econmkt_budget"] == "on");
			bool EconMktCostNReturn = (bool)(Request.Form["econmkt_costandreturns"] == "on");
			bool EconMktFinAnaly = (bool)(Request.Form["econmkt_financialanalysis"] == "on");
			bool EconMktValueAdd = (bool)(Request.Form["econmkt_valueadded"] == "on");
			bool EconMktCoop = (bool)(Request.Form["econmkt_cooperatives"] == "on");
			bool EconMktDirectMark = (bool)(Request.Form["econmkt_directmarketing"] == "on");
			bool EconMktMarkStudy = (bool)(Request.Form["econmkt_marketstudy"] == "on");
			bool EconMktFoodProdQtySafe = (bool)(Request.Form["econmkt_foodproductqualitysafety"] == "on");
			bool EconMktLaborEmp = (bool)(Request.Form["econmkt_laboremployment"] == "on");
			bool EconMktECom = (bool)(Request.Form["econmkt_ecommerce"] == "on");
			bool EconMktFarmInst = (bool)(Request.Form["econmkt_farmtoinstitution"] == "on");
			string EconMktOther = MNS(Request.Form["econmkt_other"]);

			profile.EconMktAltEnt = EconMktAltEnt;
			profile.EconMktBudget = EconMktBudget;
			profile.EconMktCoop = EconMktCoop;
			profile.EconMktCostNReturns = EconMktCostNReturn;
			profile.EconMktCSA = EconMktCSA;
			profile.EconMktDirectMkt = EconMktDirectMark;
			profile.EconMktECom = EconMktECom;
			profile.EconMktFarmToInstitution = EconMktFarmInst;
			profile.EconMktFeasibilityStudy = EconMktFeasibilityStudy;
			profile.EconMktFinAnalysis = EconMktFinAnaly;
			profile.EconMktFoodProductQtySafety = EconMktFoodProdQtySafe;
			profile.EconMktLaborEmp = EconMktLaborEmp;
			profile.EconMktMarketStudy = EconMktMarkStudy;
			profile.EconMktOther = EconMktOther;
			profile.EconMktRiskMgmt = EconMktRiskMgmt;
			profile.EconMktValueAdd = EconMktValueAdd;


			bool CommDevInfraAnaly = (bool)(Request.Form["commdev_infrastructureanalysis"] == "on");
			bool CommDevTechAssist = (bool)(Request.Form["commdev_technicalassistance"] == "on");
			bool CommDevNewBusOpp = (bool)(Request.Form["commdev_newbusinessopportunities"] == "on");
			bool CommDevPartnerships = (bool)(Request.Form["commdev_partnerships"] == "on");
			bool CommDevUrbanAgri = (bool)(Request.Form["commdev_urbanagriculture"] == "on");
			bool CommDevPublicPart = (bool)(Request.Form["commdev_publicparticipation"] == "on");
			bool CommDevUrbanRuralInt = (bool)(Request.Form["commdev_urbanruralintegration"] == "on");
			bool CommDevLocalRegComFoodSys = (bool)(Request.Form["commdev_localregionalcommunityfoodsystems"] == "on");
			bool CommDevAgritourism = (bool)(Request.Form["commdev_agritourism"] == "on");
			bool CommDevCommPlan = (bool)(Request.Form["commdev_communityplanning"] == "on");
			bool CommDevPublicPolicy = (bool)(Request.Form["commdev_publicpolicy"] == "on");
			bool CommDevLeadDev = (bool)(Request.Form["commdev_leadershipdevelopment"] == "on");
			bool CommDevEthicDiffCultDemo = (bool)(Request.Form["commdev_ethnicdifferencesculturaldemographicchange"] == "on");
			string CommDevOther = MNS(Request.Form["commdev_other"]);

			profile.CommDevAgritourism = CommDevAgritourism;
			profile.CommDevCommunityPlanning = CommDevCommPlan;
			profile.CommDevEthnicDiffCulturDemoChange = CommDevEthicDiffCultDemo;
			profile.CommDevInfraAnalysis = CommDevInfraAnaly;
			profile.CommDevLeadershipDev = CommDevLeadDev;
			profile.CommDevLocalRegionalCommunityFoodSys = CommDevLocalRegComFoodSys;
			profile.CommDevNewBusOpp = CommDevNewBusOpp;
			profile.CommDevOther = CommDevOther;
			profile.CommDevPartner = CommDevPartnerships;
			profile.CommDevPublicPolicy = CommDevPublicPolicy;
			profile.CommDevPubPart = CommDevPublicPart;
			profile.CommDevTechAssist = CommDevTechAssist;
			profile.CommDevUrbanAgri = CommDevUrbanAgri;
			profile.CommDevUrbanRuralInt = CommDevUrbanRuralInt;

			bool QOfLifeAnalyPerFam = (bool)(Request.Form["qoflife_analysisofpersonalfamilylife"] == "on");
			bool QOfLifeSocialCapital = (bool)(Request.Form["qoflife_socialcapital"] == "on");
			bool QOfLifeSusMeasure = (bool)(Request.Form["qoflife_sustainabilitymeasures"] == "on");
			bool QOfLifeCommSrv = (bool)(Request.Form["qoflife_communityservices"] == "on");
			bool QOfLifeSocialNet = (bool)(Request.Form["qoflife_socialnetworks"] == "on");
			bool QOfLifeEmpOpp = (bool)(Request.Form["qoflife_employmentopportunities"] == "on");
			bool QOfLifeSocialPsyInc = (bool)(Request.Form["qoflife_socialpsychologicalindicators"] == "on");
			string QOfLifeOther = MNS(Request.Form["qoflife_other"]);

			profile.QofLifeAnalysisOfPersonalFamilyLife = QOfLifeAnalyPerFam;
			profile.QofLifeCommunitySrv = QOfLifeCommSrv;
			profile.QofLifeEmpOpp = QOfLifeEmpOpp;
			profile.QofLifeOther = QOfLifeOther;
			profile.QofLifeSocialCap = QOfLifeSocialCapital;
			profile.QofLifeSocialNet = QOfLifeSocialNet;
			profile.QofLifeSocialPsyInd = QOfLifeSocialPsyInc;
			profile.QofLifeSustainMeasures = QOfLifeSusMeasure;

			bool EngConsBioEngNFuel = (bool)(Request.Form["engcons_bioenergybiofuels"] == "on");
			bool EngConsWindPower = (bool)(Request.Form["engcons_windpower"] == "on");
			bool EngConsEngUseNConsump = (bool)(Request.Form["engcons_energyuseconsumption"] == "on");
			bool EngConsSolarEng = (bool)(Request.Form["engcons_solarenergy"] == "on");
			bool EngConsEngConserEff = (bool)(Request.Form["engcons_energyconservationefficiency"] == "on");
			string EngConsOther = MNS(Request.Form["engcons_other"]);

			profile.EngBioEngFuels = EngConsBioEngNFuel;
			profile.EngEngConservEff = EngConsEngConserEff;
			profile.EngEngUseConsumption = EngConsEngUseNConsump;
			profile.EngOther = EngConsOther;
			profile.EngSolarEng = EngConsSolarEng;
			profile.EngWindPower = EngConsWindPower;

			bool CommplAgrBarley = (bool)(Request.Form["commplagr_barley"] == "on");
			bool CommplAgrGrassLegumeHay = (bool)(Request.Form["commplagr_grasslegumehay"] == "on");
			bool CommplAgrPeanuts = (bool)(Request.Form["commplagr_peanuts"] == "on");
			bool CommplAgrSorghum = (bool)(Request.Form["commplagr_sorghum"] == "on");
			bool CommplAgrSweetpotatoes = (bool)(Request.Form["commplagr_sweetpotatoes"] == "on");
			bool CommplAgrCanola = (bool)(Request.Form["commplagr_canola"] == "on");
			bool CommplAgrLegumeHay = (bool)(Request.Form["commplagr_legumehay"] == "on");
			bool CommplAgrPotatoes = (bool)(Request.Form["commplagr_potatoes"] == "on");
			bool CommplAgrSoybeans = (bool)(Request.Form["commplagr_soybeans"] == "on");
			bool CommplAgrTobacco = (bool)(Request.Form["commplagr_tobacco"] == "on");
			bool CommplAgrCorn = (bool)(Request.Form["commplagr_corn"] == "on");
			bool CommplAgrHops = (bool)(Request.Form["commplagr_hops"] == "on");
			bool CommplAgrRapeseed = (bool)(Request.Form["commplagr_rapeseed"] == "on");
			bool CommplAgrSpelt = (bool)(Request.Form["commplagr_spelt"] == "on");
			bool CommplAgrWheat = (bool)(Request.Form["commplagr_wheat"] == "on");
			bool CommplAgrCotton = (bool)(Request.Form["commplagr_cotton"] == "on");
			bool CommplAgrKenaf = (bool)(Request.Form["commplagr_kenaf"] == "on");
			bool CommplAgrRice = (bool)(Request.Form["commplagr_rice"] == "on");
			bool CommplAgrSugarbeets = (bool)(Request.Form["commplagr_sugarbeets"] == "on");
			bool CommplAgrFlax = (bool)(Request.Form["commplagr_flax"] == "on");
			bool CommplAgrMillet = (bool)(Request.Form["commplagr_millet"] == "on");
			bool CommplAgrRye = (bool)(Request.Form["commplagr_rye"] == "on");
			bool CommplAgrSugarcane = (bool)(Request.Form["commplagr_sugarcane"] == "on");
			bool CommplAgrGrassHay = (bool)(Request.Form["commplagr_grasshay"] == "on");
			bool CommplAgrOats = (bool)(Request.Form["commplagr_oats"] == "on");
			bool CommplAgrSafflower = (bool)(Request.Form["commplagr_safflower"] == "on");
			bool CommplAgrSunflower = (bool)(Request.Form["commplagr_sunflower"] == "on");
			string CommplAgrOther = MNS(Request.Form["commplagr_Other"]);

			profile.CommPlAgrBarley = CommplAgrBarley;
			profile.CommPlAgrCanola = CommplAgrCanola;
			profile.CommPlAgrCorn = CommplAgrCorn;
			profile.CommPlAgrCotton = CommplAgrCotton;
			profile.CommPlAgrFlax = CommplAgrFlax;
			profile.CommPlAgrGrassHay = CommplAgrGrassHay;
			profile.CommPlAgrGrassLegHay = CommplAgrGrassLegumeHay;
			profile.CommPlAgrHops = CommplAgrHops;
			profile.CommPlAgrKenaf = CommplAgrKenaf;
			profile.CommPlAgrLegHay = CommplAgrLegumeHay;
			profile.CommPlAgrMillet = CommplAgrMillet;
			profile.CommPlAgrOats = CommplAgrOats;
			profile.CommPlAgrOther = CommplAgrOther;
			profile.CommPlAgrPeanuts = CommplAgrPeanuts;
			profile.CommPlAgrPotatoes = CommplAgrPotatoes;
			profile.CommPlAgrRapeseed = CommplAgrRapeseed;
			profile.CommPlAgrRice = CommplAgrRice;
			profile.CommPlAgrRye = CommplAgrRye;
			profile.CommPlAgrSafflower = CommplAgrSafflower;
			profile.CommPlAgrSorghum = CommplAgrSorghum;
			profile.CommPlAgrSoybeans = CommplAgrSoybeans;
			profile.CommPlAgrSpelt = CommplAgrSpelt;
			profile.CommPlAgrSugarbeets = CommplAgrSugarbeets;
			profile.CommPlAgrSugarcane = CommplAgrSugarcane;
			profile.CommPlAgrSunflower = CommplAgrSunflower;
			profile.CommPlAgrSweetpotatoes = CommplAgrSweetpotatoes;
			profile.CommPlAgrTobacco = CommplAgrTobacco;
			profile.CommPlAgrWheat = CommplAgrWheat;

			bool CommplVegArtichokes = (bool)(Request.Form["commplveg_artichokes"] == "on");
			bool CommplVegCabbage = (bool)(Request.Form["commplveg_cabbage"] == "on");
			bool CommplVegEscarole = (bool)(Request.Form["commplveg_escarole"] == "on");
			bool CommplVegOnions = (bool)(Request.Form["commplveg_onions"] == "on");
			bool CommplVegSweetcorn = (bool)(Request.Form["commplveg_sweetcorn"] == "on");
			bool CommplVegAsparagus = (bool)(Request.Form["commplveg_asparagus"] == "on");
			bool CommplVegCarrots = (bool)(Request.Form["commplveg_carrots"] == "on");
			bool CommplVegGarlic = (bool)(Request.Form["commplveg_garlic"] == "on");
			bool CommplVegParsnips = (bool)(Request.Form["commplveg_parsnips"] == "on");
			bool CommplVegTomatoes = (bool)(Request.Form["commplveg_tomatoes"] == "on");
			bool CommplVegBeans = (bool)(Request.Form["commplveg_beans"] == "on");
			bool CommplVegCauliflower = (bool)(Request.Form["commplveg_cauliflower"] == "on");
			bool CommplVegGreens = (bool)(Request.Form["commplveg_greens"] == "on");
			bool CommplVegPeas = (bool)(Request.Form["commplveg_peas"] == "on");
			bool CommplVegTurnips = (bool)(Request.Form["commplveg_turnips"] == "on");
			bool CommplVegBeets = (bool)(Request.Form["commplveg_beets"] == "on");
			bool CommplVegCelery = (bool)(Request.Form["commplveg_celery"] == "on");
			bool CommplVegKale = (bool)(Request.Form["commplveg_kale"] == "on");
			bool CommplVegPeppers = (bool)(Request.Form["commplveg_peppers"] == "on");
			bool CommplVegWatermelon = (bool)(Request.Form["commplveg_watermelon"] == "on");
			bool CommplVegBroccoli = (bool)(Request.Form["commplveg_broccoli"] == "on");
			bool CommplVegCucumbers = (bool)(Request.Form["commplveg_cucumbers"] == "on");
			bool CommplVegLentils = (bool)(Request.Form["commplveg_lentils"] == "on");
			bool CommplVegRutabagas = (bool)(Request.Form["commplveg_rutabagas"] == "on");
			bool CommplVegBrusselSprouts = (bool)(Request.Form["commplveg_brusselsprouts"] == "on");
			bool CommplVegEggplant = (bool)(Request.Form["commplveg_eggplant"] == "on");
			bool CommplVegLettuce = (bool)(Request.Form["commplveg_lettuce"] == "on");
			bool CommplVegSpinach = (bool)(Request.Form["commplveg_spinach"] == "on");
			bool CommplVegLeeks = (bool)(Request.Form["commplveg_leeks"] == "on");
			bool CommplVegPumpkins = (bool)(Request.Form["commplveg_pumpkins"] == "on");
			bool CommplVegSquashes = (bool)(Request.Form["commplveg_squashes"] == "on");
			bool CommplVegRadishes = (bool)(Request.Form["commplveg_radishes"] == "on");
			string CommplVegOther = MNS(Request.Form["commplveg_Other"]);

			profile.CommPlVegArtichokes = CommplVegArtichokes;
			profile.CommPlVegAsparagus = CommplVegAsparagus;
			profile.CommPlVegBeans = CommplVegBeans;
			profile.CommPlVegBeets = CommplVegBeets;
			profile.CommPlVegBroccoli = CommplVegBroccoli;
			profile.CommPlVegBrusselSprouts = CommplVegBrusselSprouts;
			profile.CommPlVegCabbage = CommplVegCabbage;
			profile.CommPlVegCarrots = CommplVegCarrots;
			profile.CommPlVegCauliflower = CommplVegCauliflower;
			profile.CommPlVegCelery = CommplVegCelery;
			profile.CommPlVegCucumbers = CommplVegCucumbers;
			profile.CommPlVegEggplant = CommplVegEggplant;
			profile.CommPlVegEscarole = CommplVegEscarole;
			profile.CommPlVegGarlic = CommplVegGarlic;
			profile.CommPlVegGreens = CommplVegGreens;
			profile.CommPlVegKale = CommplVegKale;
			profile.CommPlVegLeeks = CommplVegLeeks;
			profile.CommPlVegLentils = CommplVegLentils;
			profile.CommPlVegLettuce = CommplVegLettuce;
			profile.CommPlVegOnions = CommplVegOnions;
			profile.CommPlVegOther = CommplVegOther;
			profile.CommPlVegParsnips = CommplVegParsnips;
			profile.CommPlVegPeas = CommplVegPeas;
			profile.CommPlVegPeppers = CommplVegPeppers;
			profile.CommPlVegRutabagas = CommplVegRutabagas;
			profile.CommPlVegSpinach = CommplVegSpinach;
			profile.CommPlVegPumpkins = CommplVegPumpkins;
			profile.CommPlVegRadishes = CommplVegRadishes;
			profile.CommPlVegSquashes = CommplVegSquashes;
			profile.CommPlVegSweetCorn = CommplVegSweetcorn;
			profile.CommPlVegTomatoes = CommplVegTomatoes;
			profile.CommPlVegTurnips = CommplVegTurnips;
			profile.CommPlVegWatermelon = CommplVegWatermelon;

			bool CommplFruitApples = (bool)(Request.Form["commplfruit_apples"] == "on");
			bool CommplFruitCherries = (bool)(Request.Form["commplfruit_cherries"] == "on");
			bool CommplFruitLemons = (bool)(Request.Form["commplfruit_lemons"] == "on");
			bool CommplFruitPeaches = (bool)(Request.Form["commplfruit_peaches"] == "on");
			bool CommplFruitStrawberries = (bool)(Request.Form["commplfruit_strawberries"] == "on");
			bool CommplFruitApricots = (bool)(Request.Form["commplfruit_apricots"] == "on");
			bool CommplFruitCranberries = (bool)(Request.Form["commplfruit_cranberries"] == "on");
			bool CommplFruitLimes = (bool)(Request.Form["commplfruit_limes"] == "on");
			bool CommplFruitPears = (bool)(Request.Form["commplfruit_pears"] == "on");
			bool CommplFruitFigs = (bool)(Request.Form["commplfruit_figs"] == "on");
			bool CommplFruitMelons = (bool)(Request.Form["commplfruit_melons"] == "on");
			bool CommplFruitPineapples = (bool)(Request.Form["commplfruit_pineapples"] == "on");
			bool CommplFruitAvocados = (bool)(Request.Form["commplfruit_avocados"] == "on");
			bool CommplFruitTangerines = (bool)(Request.Form["commplfruit_tangerines"] == "on");
			bool CommplFruitBananas = (bool)(Request.Form["commplfruit_bananas"] == "on");
			bool CommplFruitGrapefruit = (bool)(Request.Form["commplfruit_grapefruit"] == "on");
			bool CommplFruitOlives = (bool)(Request.Form["commplfruit_olives"] == "on");
			bool CommplFruitPlums = (bool)(Request.Form["commplfruit_plums"] == "on");
			bool CommplFruitBerries = (bool)(Request.Form["commplfruit_berries"] == "on");
			bool CommplFruitGrapes = (bool)(Request.Form["commplfruit_grapes"] == "on");
			bool CommplFruitOranges = (bool)(Request.Form["commplfruit_oranges"] == "on");
			bool CommplFruitQuinces = (bool)(Request.Form["commplfruit_quinces"] == "on");
			bool CommplFruitBrambles = (bool)(Request.Form["commplfruit_brambles"] == "on");
			bool CommplFruitBlueberries = (bool)(Request.Form["commplfruit_blueberries"] == "on");
			string CommplFruitOther = MNS(Request.Form["commplfruit_Other"]);

			profile.CommPlFruitApples = CommplFruitApples;
			profile.CommPlFruitApricots = CommplFruitApricots;
			profile.CommPlFruitAvocados = CommplFruitAvocados;
			profile.CommPlFruitBananas = CommplFruitBananas;
			profile.CommPlFruitBerries = CommplFruitBerries;
			profile.CommPlFruitBlueberries = CommplFruitBlueberries;
			profile.CommPlFruitBrambles = CommplFruitBrambles;
			profile.CommPlFruitCherries = CommplFruitCherries;
			profile.CommPlFruitCranberries = CommplFruitCranberries;
			profile.CommPlFruitFigs = CommplFruitFigs;
			profile.CommPlFruitGrapefruit = CommplFruitGrapefruit;
			profile.CommPlFruitGrapes = CommplFruitGrapes;
			profile.CommPlFruitLemons = CommplFruitLemons;
			profile.CommPlFruitLimes = CommplFruitLimes;
			profile.CommPlFruitMelons = CommplFruitMelons;
			profile.CommPlFruitOlives = CommplFruitOlives;
			profile.CommPlFruitOther = CommplFruitOther;
			profile.CommPlFruitOranges = CommplFruitOranges;
			profile.CommPlFruitPeaches = CommplFruitPeaches;
			profile.CommPlFruitPears = CommplFruitPears;
			profile.CommPlFruitPineapples = CommplFruitPineapples;
			profile.CommPlFruitPlums = CommplFruitPlums;
			profile.CommPlFruitQuinces = CommplFruitQuinces;
			profile.CommPlFruitStrawberries = CommplFruitStrawberries;
			profile.CommPlFruitTangerines = CommplFruitTangerines;

			bool CommplnutsAlmonds = (bool)(Request.Form["commplnuts_almonds"] == "on");
			bool CommplnutsHazelnuts = (bool)(Request.Form["commplnuts_hazelnuts"] == "on");
			bool CommplnutsPecans = (bool)(Request.Form["commplnuts_pecans"] == "on");
			bool CommplnutsWalnuts = (bool)(Request.Form["commplnuts_walnuts"] == "on");
			bool CommplnutsChestnuts = (bool)(Request.Form["commplnuts_chestnuts"] == "on");
			bool CommplnutsMacadamia = (bool)(Request.Form["commplnuts_macadamia"] == "on");
			bool CommplnutsPistachios = (bool)(Request.Form["commplnuts_pistachios"] == "on");
			string CommplnutsOther = MNS(Request.Form["commplnuts_other"]);

			profile.CommPlNutsAlmonds = CommplnutsAlmonds;
			profile.CommPlNutsChestnuts = CommplnutsChestnuts;
			profile.CommPlNutsHazel = CommplnutsHazelnuts;
			profile.CommPlNutsOther = CommplnutsOther;
			profile.CommPlNutsMacadamia = CommplnutsMacadamia;
			profile.CommPlNutsPecans = CommplnutsPecans;
			profile.CommPlNutsPistachios = CommplnutsPistachios;
			profile.CommPlNutsWalnuts = CommplnutsWalnuts;

			bool CommplAddHerbs = (bool)(Request.Form["commpladd_herbs"] == "on");
			bool CommplAddOrnamentals = (bool)(Request.Form["commpladd_ornamentals"] == "on");
			bool CommplAddTrees = (bool)(Request.Form["commpladd_trees"] == "on");
			bool CommplAddMushrooms = (bool)(Request.Form["commpladd_mushrooms"] == "on");
			bool CommplAddNativePlants = (bool)(Request.Form["commpladd_nativeplants"] == "on");
			string CommplAddOther = MNS(Request.Form["commpladd_other"]);

			profile.CommPlAddHerbs = CommplAddHerbs;
			profile.CommPlAddMushrooms = CommplAddMushrooms;
			profile.CommPlAddNativePlants = CommplAddNativePlants;
			profile.CommPlAddOrnamentals = CommplAddOrnamentals;
			profile.CommPlAddOther = CommplAddOther;
			profile.CommPlAddTrees = CommplAddTrees;

			bool CommAnimBeef = (bool)(Request.Form["commanim_beef"] == "on");
			bool CommAnimChicken = (bool)(Request.Form["commanim_chicken"] == "on");
			bool CommAnimRabbits = (bool)(Request.Form["commanim_rabbits"] == "on");
			bool CommAnimSwine = (bool)(Request.Form["commanim_swine"] == "on");
			bool CommAnimDairy = (bool)(Request.Form["commanim_dairy"] == "on");
			bool CommAnimGoats = (bool)(Request.Form["commanim_goats"] == "on");
			bool CommAnimTurkeys = (bool)(Request.Form["commanim_turkeys"] == "on");
			bool CommAnimSheep = (bool)(Request.Form["commanim_sheep"] == "on");
			string CommAnimOther = MNS(Request.Form["commanim_other"]);

			profile.CommAnimBeef = CommAnimBeef;
			profile.CommAnimChicken = CommAnimChicken;
			profile.CommAnimDairy = CommAnimDairy;
			profile.CommAnimGoats = CommAnimGoats;
			profile.CommAnimOther = CommAnimOther;
			profile.CommAnimRabbits = CommAnimRabbits;
			profile.CommAnimSheep = CommAnimSheep;
			profile.CommAnimSwine = CommAnimSwine;
			profile.CommAnimTurkeys = CommAnimTurkeys;

			bool CommMiscBees = (bool)(Request.Form["commmisc_Bees"] == "on");
			bool CommMiscFish = (bool)(Request.Form["commmisc_fish"] == "on");
			bool CommMiscRatites = (bool)(Request.Form["commmisc_ratites"] == "on");
			bool CommMiscShellFish = (bool)(Request.Form["commmisc_shellfish"] == "on");
			string CommMiscOther = MNS(Request.Form["commmisc_other"]);

			profile.CommMiscBees = CommMiscBees;
			profile.CommMiscFish = CommMiscFish;
			profile.CommMiscOther = CommMiscOther;
			profile.CommMiscRatites = CommMiscRatites;
			profile.CommMiscShellfish = CommMiscShellFish;

			profile.ProfileID = Int32.Parse(Request.Params["profileID"]);
			profile.saveNewLowProfileProjectToDB(((DaikonUser)(Session["currUser"])).Username, (int)Session["sessionkey"]);

			Session["currProfile"] = profile;

		}

		public void ClaimProjectForm(object sender, System.EventArgs e)
		{
			DaikonUser currUser = (DaikonUser)(Session["currUser"]);

			HtmlTextWriter htmlCache = new HtmlTextWriter(Response.Output);

			System.IO.StreamReader headerFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\header.inc");
			string htmlHeader = headerFile.ReadToEnd();
			headerFile.Close();

			System.IO.StreamReader navbarFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\leftsidebar.inc");
			string htmlNavbar = navbarFile.ReadToEnd();
			navbarFile.Close();

			System.IO.StreamReader footerFile = new System.IO.StreamReader(this.MapPath(Page.TemplateSourceDirectory) + "\\includes\\footer.inc");
			string htmlFooter = footerFile.ReadToEnd();
			footerFile.Close();

			htmlCache.Write(htmlHeader);

			htmlCache.Write("<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\"><tbody><tr><td class=\"leftnav\" style=\"width: 159px; vertical-align: top;\">");
			htmlCache.Write(htmlNavbar);
			htmlCache.Write("</td><td class=\"copy\">");

			StringWriter writerString = new StringWriter();
			XmlTextWriter xmlWriter = new XmlTextWriter(writerString);
			xmlWriter.Formatting = Formatting.Indented;

			xmlWriter.WriteStartElement("SAREroot");
			currUser.toXML(xmlWriter);

			xmlWriter.WriteEndElement();

			xmlWriter.Flush();

			StringReader readerString = new StringReader(writerString.ToString());

			if ((thisPageURL["output"] != null) && (thisPageURL["output"] == "xml"))
			{
				Response.Clear();
				Response.Write(writerString.ToString());
			}
			else
			{

				XmlDocument xmlDoc = new XmlDocument();

				xmlDoc.Load(readerString);

				XslCompiledTransform xslTransform = new XslCompiledTransform();
				XsltArgumentList xsltArgs = new XsltArgumentList();

                xslTransform.Load(MapPath(Page.TemplateSourceDirectory) + "//claimProject.xsl");
				//			xslTransform.Transform(xmlDoc, null, Response.Output);

				//////

				xslTransform.Transform(xmlDoc, xsltArgs, htmlCache);

				htmlCache.Write("</td></tr>");
				htmlCache.Write(htmlFooter);
				htmlCache.Write("</tbody></table>");
				htmlCache.Write("</body></html>");
			}

			htmlCache.Close();


		}

		public void ClaimProjectFormHandler(object sender, System.EventArgs e)
		{
			DaikonUser currUser;
			currUser = (DaikonUser)(Session["currUser"]);

			string projNum;
			string claimCode;

			projNum = Request.Params["projNum"];
			claimCode = Request.Params["claimCode"];

            string[] states = { "AL", "AK", "AS", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FM", "FL", "GA", "GU", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MH", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "MP", "OH", "OK", "OR", "PW", "PA", "PR", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VI", "VA", "WA", "WV", "WI", "WY" };

            string state = "";

            if (projNum.Length == 10)
            {
                if (projNum.Substring(0, 2) == "YE")
                    state = "Z";
                else
                    state = projNum.Substring(2, 2);
            }

            if (projNum.Length == 9)
            {
                string regions = projNum.Substring(0, 1);
                if (regions == "E" || regions == "S" || regions == "L" || regions == "F" || regions == "G" || regions == "O" || regions == "C" || regions == "M" || regions == "Y")
                    state = "Z";
                else
                    state = projNum.Substring(1, 2);
            }
            bool has = Array.IndexOf(states, state) >= 0;

            /*
            if (has)
            {
                Session["statusMessage1"] = "This is a state report.";
                Response.Redirect("sare_main.aspx?do=claimproj");
                return;
            }
            */

			if (FormFieldValidator(projNum) && FormFieldValidator(claimCode))
			{
                int nClaimSuccess = currUser.claimProject((int)Session["sessionkey"], projNum, claimCode);
                if (nClaimSuccess == 1 || nClaimSuccess == 3)
				{
					//currUser.Grants.populateByUsername(currUser.Username, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
					Session["currUser"] = currUser;
                    if (has)
                        Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projNum);
                    else
					    Response.Redirect("sare_main.aspx?do=editProj&pn=" + projNum);
				}
                else if (nClaimSuccess == 2)
                {
                    Session["statusMessage1"] = "Invalid Claim Code - please contact your regional administrator.";
                    Response.Redirect("sare_main.aspx?do=claimproj");
                    return;
                }
				else
				{
					Session["statusMessage1"] = "Project " + projNum  + " does not exist";
					Response.Redirect("sare_main.aspx?do=claimproj");
					return;
				}

			}
			else
			{
				Session["statusMessage1"] = "Project Number and Claim Code are required.";
				Response.Redirect("sare_main.aspx?do=claimproj");
				return;
			}

		}

        public void ClaimPdpFormHandler(object sender, System.EventArgs e)
        {
            DaikonUser currUser;
            currUser = (DaikonUser)(Session["currUser"]);

            string projNum;
            string claimCode;

            projNum = Request.Params["projNum"];
            claimCode = Request.Params["claimCode"];

            string[] states = { "AL", "AK", "AS", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FM", "FL", "GA", "GU", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MH", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "MP", "OH", "OK", "OR", "PW", "PA", "PR", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VI", "VA", "WA", "WV", "WI", "WY" };

            string state = projNum;

            if (projNum.Length == 9)
            {
                string regions = projNum.Substring(0, 1);
                if (regions == "E" || regions == "L" || regions == "F" || regions == "G" || regions == "O" || regions == "C" || regions == "M" || regions == "Y")
                    state = "";
                if (regions == "S")
                {
                    state = projNum.Substring(1, 2);
                    bool has = Array.IndexOf(states, state) >= 0;
                    if (has == false)
                        state = "";
                }
            }
            /*
            if (state == "")
            {
                Session["statusMessage1"] = "This is not state report.";
                Response.Redirect("sare_main.aspx?do=claimpdp");
                return;
            }
            */
            if (FormFieldValidator(projNum) && FormFieldValidator(claimCode))
            {
                int nClaimSuccess = currUser.claimProject((int)Session["sessionkey"], projNum, claimCode);
                if (nClaimSuccess == 1 || nClaimSuccess == 3)
                {
                    //currUser.Grants.populateByUsername(currUser.Username, ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString());
                    Session["currUser"] = currUser;
                    if (state == "")
                        Response.Redirect("sare_main.aspx?do=editProj&pn=" + projNum);
                    else
                        Response.Redirect("sare_main.aspx?do=editPdp&pn=" + projNum);
                }
                else if (nClaimSuccess == 2)
                {
                    Session["statusMessage1"] = "Invalid Claim Code - please contact your regional administrator.";
                    Response.Redirect("sare_main.aspx?do=claimpdp");
                    return;
                }
                else
                {
                    Session["statusMessage1"] = "Project " + projNum + " does not exist";
                    Response.Redirect("sare_main.aspx?do=claimpdp");
                    return;
                }

            }
            else
            {
                Session["statusMessage1"] = "Project Number and Claim Code are required.";
                Response.Redirect("sare_main.aspx?do=claimpdp");
                return;
            }

        }

		// return default value for integer if the object is null
		public int MNI(object i)
		{
			if (i == null)
				return 0;
			else if ((i is string) && (string.IsNullOrEmpty(i.ToString())))
				return 0;
			else
			{
				string strValue = i.ToString();
				strValue = strValue.Replace(",", "");
                strValue = strValue.Replace(".00", "");
				i = (object)strValue;
                if (i.ToString() == "")
                    i = 0;
				return Convert.ToInt32(i);
			}
		}

		// return default value for decimal if the object is null
		public decimal MND(object o)
		{
			if (o == null)
				return 0;
			else if ((o is string) && (string.IsNullOrEmpty(o.ToString())))
				return 0;
			else
				return Convert.ToDecimal(o);
		}

		// return empty string if the object is null
		public string MNS(object s)
		{
			if (s == null)
				return string.Empty;
			else
				return Convert.ToString(s);
		}

		public static bool IsValidEmailAddress(string sEmail)
		{
			if (sEmail == null)
			{
				return false;
			}
			/*
			else
			{
				return Regex.IsMatch(sEmail, @"
											^
											[-a-zA-Z0-9][-.a-zA-Z0-9]*
											@
											[-.a-zA-Z0-9]+
											(\.[-.a-zA-Z0-9]+)*
											\.
											(
											com|edu|info|gov|int|mil|net|org|biz|
											name|museum|coop|aero|pro
											|
											[a-zA-Z]{2}
											)
											_
											$",
				RegexOptions.IgnorePatternWhitespace);
			}
			*/

			//Valid Email Addresses according to RFC2822:

			int atSym = sEmail.LastIndexOf("@");
			if (atSym < 1) { return false; } // no local-part
			if (atSym == sEmail.Length - 1) { return false; } // no domain
			if (atSym > 64) { return false; } // there may only be 64 octets in the local-part
			if (sEmail.Length - atSym > 255) { return false; } // there may only be 255 octets in the domain

			// Is the domain plausible?
			int lastDot = sEmail.LastIndexOf(".");
			// Check if it is a dot-atom such as example.com
			if (lastDot > atSym + 1 && lastDot < sEmail.Length - 1) { return true; }
			//  Check if could be a domain-literal.
			if (sEmail[atSym + 1] == '[' && sEmail[sEmail.Length - 1] == ']') { return true; }
			return false;

		}

        /// <summary>
        /// generate the .pdf
        /// </summary>
        /// <param name="path">path of the document</param>
        /// <param name="fileName">name of the .pdf documen</param>
        /// <param name="download">is this downloadable</param>
        /// <param name="text">text to place in the .pdf</param>
        private void GeneratePDF(string path, string fileName, bool download, string projNum, string projTitle, int reportType, int reportYear)
        {
            string reptTypeName = reportYear.ToString();
            if (reportType == 0)
                reptTypeName += " Annual Report";
            else if (reportType == 1)
                reptTypeName += " Final Report";
            else
                reptTypeName += " Proposal";

            // System.IO.FileStream docStream = new System.IO.FileStream(path + fileName, FileMode.Create); This line is commented becuase it is add up in associaFiles Director
            Document document = new Document(PageSize.LETTER, 60, 60, 15, 15);
            MemoryStream docStream = new MemoryStream(); // PDF data will be written here
            PdfWriter myPDFWriter = PdfWriter.GetInstance(document, docStream);  // tie a PdfWriter instance to the stream

            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();

            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;

            userConnection = new SqlConnection(userConnString);

            try
            {
                //PdfWriter myPDFWriter = PdfWriter.GetInstance(document, docStream); tie a PdfWriter instance to the stream

                document.Open();


                userConnection = new SqlConnection(userConnString);
                userSQL = "DaikonGeneratePDFReport";
                userCommand = new SqlCommand(userSQL, userConnection);
                userCommand.CommandType = CommandType.StoredProcedure;
                userCommand.Parameters.Add("@proj_num", SqlDbType.VarChar, 50).Value = projNum;
                userCommand.Parameters.Add("@rept_year", SqlDbType.Int).Value = reportYear;
                userCommand.Parameters.Add("@rept_isfinal", SqlDbType.TinyInt).Value = reportType;

                userConnection.Open();


                iTextSharp.text.ListItem li = new iTextSharp.text.ListItem();

                Paragraph paragraph = new Paragraph();
                Paragraph paragraphProject = new Paragraph();
                Paragraph paragraphProjectPIs = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));
                Paragraph paragraphCoords = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));
                Paragraph paragraphParticipants = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));
                Paragraph paragraphSupportingFiles = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));
                Paragraph paragraphAttachments = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));

                Paragraph projViewParagraph = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));



                string sareamount;
                string text;
                string sectionName = "";
                string section_sub_head = "";
                string htmlText = "";

                // Add the image now
                iTextSharp.text.Image gif = iTextSharp.text.Image.GetInstance(Server.MapPath("~/SARE_CMYK_Small.jpg"));
                gif.ScaleToFit(80f, 80f);
                document.Add(gif);

                Paragraph heading = new Paragraph(projTitle, new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 16, iTextSharp.text.Font.BOLD));
                heading.SpacingAfter = 12f;
                document.Add(heading);

                Paragraph headingReptType = new Paragraph(reptTypeName, new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));
                heading.SpacingAfter = 12f;
                document.Add(headingReptType);

                using (userDataReader = userCommand.ExecuteReader())
                {

                    while (userDataReader.Read())
                    {
                        sareamount = string.Format("{0:c}", userDataReader["funds_sare"]);
                        Chunk cProjNu = new Chunk("Project Number : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjNu);
                        Chunk cProjNuValue = new Chunk(userDataReader["proj_num"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjNuValue);
                        paragraphProject.Add("\n");

                        Chunk cProjType = new Chunk("Type : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjType);
                        Chunk cProjTypeValue = new Chunk(userDataReader["proj_type_text"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjTypeValue);
                        paragraphProject.Add("\n");

                        Chunk cProjReg = new Chunk("Region : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjReg);
                        Chunk cProjRegValue = new Chunk(userDataReader["proj_region_text"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjRegValue);
                        paragraphProject.Add("\n");

                        Chunk cProjGrant = new Chunk("SARE Grant : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjGrant);
                        Chunk cProjGrantValue = new Chunk(sareamount, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjGrantValue);
                        paragraphProject.Add("\n\n");
                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {

                        paragraphProjectPIs.Add(userDataReader["firstName"].ToString() + " " + userDataReader["lastName"].ToString());
                        paragraphProjectPIs.Add("\n");
                        if (userDataReader["orgPosition"].ToString() != "")
                        {
                            paragraphProjectPIs.Add(userDataReader["orgPosition"].ToString());
                            paragraphProjectPIs.Add("\n");
                        }
                        if (userDataReader["org"].ToString() != "")
                        {
                            paragraphProjectPIs.Add(userDataReader["org"].ToString());
                            paragraphProjectPIs.Add("\n");
                        }
                        if (userDataReader["addrStreet1"].ToString() != "")
                        {
                            paragraphProjectPIs.Add(userDataReader["addrStreet1"].ToString());
                            if (userDataReader["addrStreet2"].ToString() != "")
                            {
                                paragraphProjectPIs.Add(", " + userDataReader["addrStreet2"].ToString());
                                paragraphProjectPIs.Add("\n");
                            }
                            else
                                paragraphProjectPIs.Add("\n");
                        }
                        if (userDataReader["addrCity"].ToString() != "")
                        {
                            paragraphProjectPIs.Add(userDataReader["addrCity"].ToString());
                            if (userDataReader["addrState"].ToString() != "")
                            {
                                paragraphProjectPIs.Add(", " + userDataReader["addrState"].ToString());
                                if (userDataReader["addrZip"].ToString() != "")
                                {
                                    paragraphProjectPIs.Add(" " + userDataReader["addrZip"].ToString());
                                    paragraphProjectPIs.Add("\n");
                                }
                                else
                                    paragraphProjectPIs.Add("\n");
                            }
                        }
                        if (userDataReader["numPhone"].ToString() != "")
                        {
                            paragraphProjectPIs.Add(userDataReader["numPhone"].ToString());
                            paragraphProjectPIs.Add("\n");
                        }
                        if (userDataReader["email"].ToString() != "")
                        {
                            string email = userDataReader["email"].ToString();

                            Anchor anchoremail = new Anchor(email, iTextSharp.text.FontFactory.GetFont("Helvetica", 10, iTextSharp.text.Font.UNDERLINE, iTextSharp.text.Color.BLUE));
                            anchoremail.Reference = "mailto:" + email;
                            paragraphProjectPIs.Add("E-mail: ");
                            paragraphProjectPIs.Add(anchoremail);
                            paragraphProjectPIs.Add("\n");
                        }
                        if (userDataReader["website"].ToString() != "")
                        {
                            string website = userDataReader["website"].ToString();

                            Anchor anchor = new Anchor(website, iTextSharp.text.FontFactory.GetFont("Helvetica", 10, iTextSharp.text.Font.UNDERLINE, iTextSharp.text.Color.BLUE));
                            if (website.StartsWith("http"))
                                anchor.Reference = website;
                            else
                                anchor.Reference = "http://" + website;
                            paragraphProjectPIs.Add("Website: ");
                            paragraphProjectPIs.Add(anchor);
                            paragraphProjectPIs.Add("\n");
                        }
                        paragraphProjectPIs.Add("\n");

                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {

                        paragraphCoords.Add(userDataReader["firstName"].ToString() + " " + userDataReader["lastName"].ToString());
                        paragraphCoords.Add("\n");
                        if (userDataReader["orgPosition"].ToString() != "")
                        {
                            paragraphCoords.Add(userDataReader["orgPosition"].ToString());
                            paragraphCoords.Add("\n");
                        }
                        if (userDataReader["org"].ToString() != "")
                        {
                            paragraphCoords.Add(userDataReader["org"].ToString());
                            paragraphCoords.Add("\n");
                        }
                        if (userDataReader["addrStreet1"].ToString() != "")
                        {
                            paragraphCoords.Add(userDataReader["addrStreet1"].ToString());
                            if (userDataReader["addrStreet2"].ToString() != "")
                            {
                                paragraphCoords.Add(", " + userDataReader["addrStreet2"].ToString());
                                paragraphCoords.Add("\n");
                            }
                            else
                                paragraphCoords.Add("\n");
                        }
                        if (userDataReader["addrCity"].ToString() != "")
                        {
                            paragraphCoords.Add(userDataReader["addrCity"].ToString());
                            if (userDataReader["addrState"].ToString() != "")
                            {
                                paragraphCoords.Add(", " + userDataReader["addrState"].ToString());
                                if (userDataReader["addrZip"].ToString() != "")
                                {
                                    paragraphCoords.Add(" " + userDataReader["addrZip"].ToString());
                                    paragraphCoords.Add("\n");
                                }
                                else
                                    paragraphCoords.Add("\n");
                            }
                        }
                        if (userDataReader["numPhone"].ToString() != "")
                        {
                            paragraphCoords.Add(userDataReader["numPhone"].ToString());
                            paragraphCoords.Add("\n");
                        }
                        if (userDataReader["email"].ToString() != "")
                        {
                            string email = userDataReader["email"].ToString();
                            Anchor anchoremail = new Anchor(email, iTextSharp.text.FontFactory.GetFont("Helvetica", 10, iTextSharp.text.Font.UNDERLINE, iTextSharp.text.Color.BLUE));
                            anchoremail.Reference = "mailto:" + email;
                            paragraphCoords.Add("E-mail: ");
                            paragraphCoords.Add(anchoremail);
                            paragraphCoords.Add("\n");
                        }
                        if (userDataReader["website"].ToString() != "")
                        {
                            string website = userDataReader["website"].ToString();
                            Anchor anchor = new Anchor(website, iTextSharp.text.FontFactory.GetFont("Helvetica", 10, iTextSharp.text.Font.UNDERLINE, iTextSharp.text.Color.BLUE));
                            if (website.StartsWith("http"))
                                anchor.Reference = website;
                            else
                                anchor.Reference = "http://" + website;
                            paragraphCoords.Add("Website: ");
                            paragraphCoords.Add(anchor);
                            paragraphCoords.Add("\n");
                        }
                        paragraphCoords.Add("\n");

                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {


                        section_sub_head = userDataReader["sub_heading"].ToString();

                        if (sectionName != userDataReader["section_name"].ToString())
                        {
                            sectionName = userDataReader["section_name"].ToString();

                            if (userDataReader["sub_text"].ToString() != "")
                            {
                                paragraph.Add("\n");

                                Chunk c = new Chunk(sectionName, FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 14));
                                paragraph.Add(c);
                                paragraph.Add("\n");

                                htmlText = htmlText + "<B>" + sectionName + "</B>" + "<br/>";
                            }
                        }


                        if (section_sub_head.Length != 0)
                        {
                            section_sub_head = section_sub_head + "<br/>";

                            Chunk c1 = new Chunk(section_sub_head, FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 14));
                            paragraph.Add(c1);

                            htmlText = htmlText + "<B>" + section_sub_head + "</B>" + "<br/>";
                        }

                        text = "<font size='2' face='arial unicode ms'>" + userDataReader["sub_text"].ToString() + "</font><br/><br/>";
                        //text = HttpUtility.HtmlDecode(text);
                        text = text.Replace("font-size: medium", "");
                        Chunk c2 = new Chunk(text, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        htmlText = htmlText + text;
                        paragraph.Add(c2);

                    }

                    userDataReader.NextResult();
                    while (userDataReader.Read())
                    {

                        paragraphParticipants.Add(userDataReader["firstName"].ToString() + " " + userDataReader["lastName"].ToString());
                        paragraphParticipants.Add("\n");
                        if (userDataReader["orgPosition"].ToString() != "")
                        {
                            paragraphParticipants.Add(userDataReader["orgPosition"].ToString());
                            paragraphParticipants.Add("\n");
                        }
                        if (userDataReader["org"].ToString() != "")
                        {
                            paragraphParticipants.Add(userDataReader["org"].ToString());
                            paragraphParticipants.Add("\n");
                        }
                        if (userDataReader["addrStreet1"].ToString() != "")
                        {
                            paragraphParticipants.Add(userDataReader["addrStreet1"].ToString());
                            if (userDataReader["addrStreet2"].ToString() != "")
                            {
                                paragraphParticipants.Add(", " + userDataReader["addrStreet2"].ToString());
                                paragraphParticipants.Add("\n");
                            }
                            else
                                paragraphParticipants.Add("\n");
                        }
                        if (userDataReader["addrCity"].ToString() != "")
                        {
                            paragraphParticipants.Add(userDataReader["addrCity"].ToString());
                            if (userDataReader["addrState"].ToString() != "")
                            {
                                paragraphParticipants.Add(", " + userDataReader["addrState"].ToString());
                                if (userDataReader["addrZip"].ToString() != "")
                                {
                                    paragraphParticipants.Add(" " + userDataReader["addrZip"].ToString());
                                    paragraphParticipants.Add("\n");
                                }
                                else
                                    paragraphParticipants.Add("\n");
                            }
                            else
                                paragraphParticipants.Add("\n");
                        }
                        if (userDataReader["numPhone"].ToString() != "")
                        {
                            paragraphParticipants.Add(userDataReader["numPhone"].ToString());
                            paragraphParticipants.Add("\n");
                        }
                        if (userDataReader["email"].ToString() != "")
                        {
                            string email = userDataReader["email"].ToString();
                            Anchor anchoremail = new Anchor(email, iTextSharp.text.FontFactory.GetFont("Helvetica", 10, iTextSharp.text.Font.UNDERLINE, iTextSharp.text.Color.BLUE));
                            anchoremail.Reference = "mailto:" + email;
                            paragraphParticipants.Add("E-mail: ");
                            paragraphParticipants.Add(anchoremail);
                            paragraphParticipants.Add("\n");
                        }
                        if (userDataReader["website"].ToString() != "")
                        {
                            string website = userDataReader["website"].ToString();
                            Anchor anchor = new Anchor(website, iTextSharp.text.FontFactory.GetFont("Helvetica", 10, iTextSharp.text.Font.UNDERLINE, iTextSharp.text.Color.BLUE));
                            if (website.StartsWith("http"))
                                anchor.Reference = website;
                            else
                                anchor.Reference = "http://" + website;
                            paragraphParticipants.Add("Website: ");
                            paragraphParticipants.Add(anchor);
                            paragraphParticipants.Add("\n");
                        }
                        paragraphParticipants.Add("\n\n");

                    }
                    userDataReader.NextResult();

                    //string supportingFiles = "";
                    while (userDataReader.Read())
                    {
                        string attachment = ConfigurationManager.AppSettings["website"].ToString() + "/mySARE/assocfiles/" + userDataReader["file_name"].ToString();
                        Anchor anchor = new Anchor(attachment, iTextSharp.text.FontFactory.GetFont("Helvetica", 10, iTextSharp.text.Font.UNDERLINE, iTextSharp.text.Color.BLUE));
                        anchor.Reference = attachment;
                        paragraphSupportingFiles.Add(userDataReader["file_caption"].ToString() + ": ");
                        paragraphSupportingFiles.Add(anchor);
                        paragraphSupportingFiles.Add("\n");
                        //supportingFiles = "Supporting File(s):";
                    }

                    userDataReader.NextResult();

                    string attachmentTitle = "";
                    while (userDataReader.Read())
                    {
                        if (paragraphAttachments.Count == 0)
                        {
                            if (attachmentTitle == "")
                                attachmentTitle = userDataReader["Title"].ToString();
                            else
                                attachmentTitle = attachmentTitle + "\n" + userDataReader["Title"].ToString();
                        }
                    }
                    if (attachmentTitle != "")
                    {
                        paragraphAttachments.Add(attachmentTitle);
                        paragraphAttachments.Add("\n");
                    }

                }


                document.Add(paragraphProject);

                Paragraph headingAttachmentsExists = new Paragraph("This report has supporting files available online. See the link at the bottom of the page.\n", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));
                if (paragraphAttachments.Count > 1)
                {
                    headingAttachmentsExists.Add("\n");
                    document.Add(headingAttachmentsExists);
                }
                Paragraph headingCoords = new Paragraph("Coordinators:", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));

                document.Add(headingCoords);
                document.Add(paragraphProjectPIs);
                document.Add(paragraphCoords);
                //document.Add(paragraph);
                iTextSharp.text.html.simpleparser.HTMLWorker htmlWorker = new iTextSharp.text.html.simpleparser.HTMLWorker(document);
                //htmlWorker.Parse(new StringReader(htmlText));Below code is used to support special characters.

                // step 4.1: register a unicode font and assign it an allias
                //FontFactory.Register("C:\\Windows\\Fonts\\ARIALUNI.TTF", "arial unicode ms");
                string fontPath = Server.MapPath("~/ARIALUNI.TTF");
                FontFactory.Register(fontPath, "arial unicode ms");

                // step 4.2: create a style sheet and set the encoding to Identity-H
                iTextSharp.text.html.simpleparser.StyleSheet ST = new iTextSharp.text.html.simpleparser.StyleSheet();
                ST.LoadTagStyle("body", "encoding", "Identity-H");
                ST.LoadTagStyle("ul", "indent", "10");
                ST.LoadTagStyle("ol", "indent", "10");
                ST.LoadTagStyle("li", "leading", "14");

                // step 4.3: assign the style sheet to the html parser
                htmlWorker.Style = (ST);

                htmlWorker.StartDocument();

                // step 5: parse the html into the document
                htmlWorker.Parse(new StringReader(htmlText));


                // step 6: close the document and the worker
                htmlWorker.EndDocument();

                Paragraph headingParticipants = new Paragraph("Participants:", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));

                if (paragraphParticipants.Count > 1)
                {
                    document.Add(headingParticipants);
                    document.Add(paragraphParticipants);
                }
                else
                {
                    paragraphParticipants.Add("\n");
                    document.Add(paragraphParticipants);
                }

                Paragraph headingSupportingFilesExists = new Paragraph("Supporting File(s):", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));
                if (paragraphSupportingFiles.Count != 0)
                {
                    headingSupportingFilesExists.Add("\n");
                    document.Add(headingSupportingFilesExists);
                    document.Add(paragraphSupportingFiles);
                }


                Paragraph headingAttachments = new Paragraph("Attachments:", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));
                if (paragraphAttachments.Count > 1)
                {
                    document.Add(headingAttachments);
                    document.Add(paragraphAttachments);
                    projViewParagraph.Add("\n\n");
                }

                string backToProject = ConfigurationManager.AppSettings["website"].ToString() + "/sare_main.aspx?do=viewRept&pn=" + projNum + "&y=" + reportYear.ToString() + "&t=" + reportType.ToString();
                Anchor anchorProjView = new Anchor(backToProject, iTextSharp.text.FontFactory.GetFont("Helvetica", 10, iTextSharp.text.Font.UNDERLINE, iTextSharp.text.Color.BLUE));
                anchorProjView.Reference = backToProject;
                projViewParagraph.Add("View this report online: ");
                projViewParagraph.Add(anchorProjView);

                document.Add(projViewParagraph);

                string disclaimer = "This project and all associated reports and support materials were supported by the Sustainable Agriculture Research and Education (SARE) program, which is funded by the U.S. Department of Agriculture- National Institute of Food and Agriculture (USDA-NIFA). Any opinions, findings, conclusions or recommendations expressed within do not necessarily reflect the view of the SARE program or the U.S. Department of Agriculture. USDA is an equal opportunity provider and employer.";
                Chunk disclaimerChunk = new Chunk(disclaimer, FontFactory.GetFont("Tahoma", 8));
                Paragraph disclaimerParagraph = new Paragraph();
                disclaimerParagraph.Add("\n");
                disclaimerParagraph.Add(disclaimerChunk);
                disclaimerParagraph.Add("\n\n");
                document.Add(disclaimerParagraph);

                Paragraph footer = new Paragraph("Total Number of Pages : " + myPDFWriter.CurrentPageNumber.ToString(), new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 12, iTextSharp.text.Font.BOLD));
                document.Add(footer);


            }
            catch (Exception ee)
            {
                Session["statusMessage1"] = ee.ToString();
            }
            finally
            {
                document.Close();
                userConnection.Dispose();

            }

            string docPath = path + fileName;
            //ShowPdf(docPath);
            ShowPdf(docStream, myPDFWriter);

        }

        private void GenerateStateReportPDF1(string path, string fileName, bool download, string projNum)
        {
            //System.IO.FileStream docStream = new System.IO.FileStream(path + fileName, FileMode.Create);This line is commented becuase it is add up in associaFiles Director           
            Document document = new Document(PageSize.A4.Rotate());
            MemoryStream docStream = new MemoryStream(); // PDF data will be written here
            PdfWriter myPDFWriter = PdfWriter.GetInstance(document, docStream);  // tie a PdfWriter instance to the stream

            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();

            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;

            userConnection = new SqlConnection(userConnString);


            try
            {
                //PdfWriter myPDFWriter = PdfWriter.GetInstance(document, docStream); This line is commented becuase it is add up in associaFiles Director  

                document.Open();

                PdfPTable table = new PdfPTable(4); // new PdfPTable(5); Changed to have only 4 columns (removed activity)

                //actual width of table in points

                table.TotalWidth = 800f;

                table.WidthPercentage = 100;

                //fix the absolute width of the table

                table.LockedWidth = true;



                //relative col widths in proportions - 1/3 and 2/3
                // { 20f,25f, 25f, 25f, 22f }; Changed to have only 4 columns (removed activity)
                float[] widths = new float[] { 20f, 25f, 25f, 25f };

                table.SetWidths(widths);

                table.HorizontalAlignment = 0;


                PdfPCell cell = new PdfPCell(new Phrase(("Training Initiatives"), FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 12)));

                cell.Colspan = 4; //cell.Colspan = 5 ;Changed to have only 4 columns (removed activity)

                PdfPTable nested_act = new PdfPTable(1);
                PdfPTable nested_part = new PdfPTable(1);
                PdfPTable nested_outcomes = new PdfPTable(1);

                PdfPTable nested_act2 = new PdfPTable(1);
                PdfPTable nested_part2 = new PdfPTable(1);
                PdfPTable nested_outcomes2 = new PdfPTable(1);

                PdfPTable nested_act3 = new PdfPTable(1);
                PdfPTable nested_part3 = new PdfPTable(1);
                PdfPTable nested_outcomes3 = new PdfPTable(1);

                PdfPTable nested_act4 = new PdfPTable(1);
                PdfPTable nested_part4 = new PdfPTable(1);
                PdfPTable nested_outcomes4 = new PdfPTable(1);

                PdfPTable nested_act5 = new PdfPTable(1);
                PdfPTable nested_part5 = new PdfPTable(1);
                PdfPTable nested_outcomes5 = new PdfPTable(1);

                PdfPTable nested_act6 = new PdfPTable(1);
                PdfPTable nested_part6 = new PdfPTable(1);
                PdfPTable nested_outcomes6 = new PdfPTable(1);

                cell.HorizontalAlignment = 1; //0=Left, 1=Centre, 2=Right

                userConnection = new SqlConnection(userConnString);
                userSQL = "DaikonGeneratePDFStateReport";
                userCommand = new SqlCommand(userSQL, userConnection);
                userCommand.CommandType = CommandType.StoredProcedure;
                userCommand.Parameters.Add("@proj_num", SqlDbType.VarChar, 50).Value = projNum;

                userConnection.Open();

                iTextSharp.text.ListItem li = new iTextSharp.text.ListItem();

                Paragraph paragraph = new Paragraph();
                Paragraph paragraphProject = new Paragraph();
                Paragraph paragraphCoords = new Paragraph();
                Paragraph paragraphState = new Paragraph();
                Paragraph paragraphAdvAff = new Paragraph();
                Paragraph paragraphInitTitles = new Paragraph();
                Paragraph paragraphSareFace = new Paragraph();
                Paragraph paragraphOutcomeNarrative = new Paragraph();
                Paragraph paragraphInitiative = new Paragraph();
                Paragraph paragraphParticipants = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));

                Paragraph paragraphAttachments = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));
                Paragraph paragraphInfoProducts = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));

                Paragraph projViewParagraph = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));

                // Add the image now
                iTextSharp.text.Image gif = iTextSharp.text.Image.GetInstance(Server.MapPath("~/SARE_CMYK_Small.jpg"));
                gif.ScaleToFit(80f, 80f);
                document.Add(gif);

                Paragraph headingReptType = new Paragraph("Summary Report Information", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));
                headingReptType.SpacingAfter = 12f;
                document.Add(headingReptType);

                string sareamount;

                string htmlTextSareFace = "";
                string htmlTextOutcomeNarrative = "";

                int iTitleCount = 0;
                string Title1 = "";
                string Title2 = "";
                string Title3 = "";
                string Title4 = "";
                string Title5 = "";
                string Title6 = "";

                string partners1 = "";
                string partners2 = "";
                string partners3 = "";
                string partners4 = "";
                string partners5 = "";
                string partners6 = "";

                string WorkshopsDay = "";
                string WorkshopsDayPart = "";
                string WorkshopsDayOutcomes = "";
                //string WorkshopsDayOutputs = "";
                string WorkshopsDay1 = "";
                string WorkshopsDay1Part = "";
                string WorkshopsDay1Outcomes = "";
                //string WorkshopsDay1Outputs = "";
                int WorkshopsTotalCount1 = 0;

                string WorkshopsDay2 = "";
                string WorkshopsDay2Part = "";
                string WorkshopsDay2Outcomes = "";
                //string WorkshopsDay2Outputs = "";
                int WorkshopsTotalCount2 = 0;

                string WorkshopsDay3 = "";
                string WorkshopsDay3Part = "";
                string WorkshopsDay3Outcomes = "";
                //string WorkshopsDay3Outputs = "";
                int WorkshopsTotalCount3 = 0;

                string WorkshopsDay4 = "";
                string WorkshopsDay4Part = "";
                string WorkshopsDay4Outcomes = "";
                //string WorkshopsDay4Outputs = "";
                int WorkshopsTotalCount4 = 0;

                string WorkshopsDay5 = "";
                string WorkshopsDay5Part = "";
                string WorkshopsDay5Outcomes = "";
                //string WorkshopsDay5Outputs = "";
                int WorkshopsTotalCount5 = 0;

                string WorkshopsDay6 = "";
                string WorkshopsDay6Part = "";
                string WorkshopsDay6Outcomes = "";
                //string WorkshopsDay6Outputs = "";
                int WorkshopsTotalCount6 = 0;

                string FieldDay = "";
                string FieldDayPart = "";
                string FieldDayOutcomes = "";
                //string FieldDayOutputs = "";
                string FieldDay1 = "";
                string FieldDay1Part = "";
                string FieldDay1Outcomes = "";
                //string FieldDay1Outputs = "";
                int FieldDaysTotalCount1 = 0;

                string FieldDay2 = "";
                string FieldDay2Part = "";
                string FieldDay2Outcomes = "";
                //string FieldDay2Outputs = "";
                int FieldDaysTotalCount2 = 0;

                string FieldDay3 = "";
                string FieldDay3Part = "";
                string FieldDay3Outcomes = "";
                //string FieldDay3Outputs = "";
                int FieldDaysTotalCount3 = 0;

                string FieldDay4 = "";
                string FieldDay4Part = "";
                string FieldDay4Outcomes = "";
                //string FieldDay4Outputs = "";
                int FieldDaysTotalCount4 = 0;

                string FieldDay5 = "";
                string FieldDay5Part = "";
                string FieldDay5Outcomes = "";
                //string FieldDay5Outputs = "";
                int FieldDaysTotalCount5 = 0;

                string FieldDay6 = "";
                string FieldDay6Part = "";
                string FieldDay6Outcomes = "";
                //string FieldDay6Outputs = "";
                int FieldDaysTotalCount6 = 0;

                string Minigrant = "";
                string MinigrantPart = "";
                string MinigrantOutcomes = "";
                //string MinigrantOutputs = "";
                string Minigrant1 = "";
                string Minigrant1Part = "";
                string Minigrant1Outcomes = "";
                //string Minigrant1Outputs = "";
                int MinigrantsTotalCount1 = 0;

                string Minigrant2 = "";
                string Minigrant2Part = "";
                string Minigrant2Outcomes = "";
                //string Minigrant2Outputs = "";
                int MinigrantsTotalCount2 = 0;

                string Minigrant3 = "";
                string Minigrant3Part = "";
                string Minigrant3Outcomes = "";
                //string Minigrant3Outputs = "";
                int MinigrantsTotalCount3 = 0;

                string Minigrant4 = "";
                string Minigrant4Part = "";
                string Minigrant4Outcomes = "";
                //string Minigrant4Outputs = "";
                int MinigrantsTotalCount4 = 0;

                string Minigrant5 = "";
                string Minigrant5Part = "";
                string Minigrant5Outcomes = "";
                //string Minigrant5Outputs = "";
                int MinigrantsTotalCount5 = 0;

                string Minigrant6 = "";
                string Minigrant6Part = "";
                string Minigrant6Outcomes = "";
                //string Minigrant6Outputs = "";
                int MinigrantsTotalCount6 = 0;

                string Study = "";
                string StudyPart = "";
                string StudyOutcomes = "";
                string StudyOutputs = "";
                string Study1 = "";
                string Study1Part = "";
                string Study1Outcomes = "";
                string Study1Outputs = "";
                int StudyTotalCount1 = 0;

                string Study2 = "";
                string Study2Part = "";
                string Study2Outcomes = "";
                string Study2Outputs = "";
                int StudyTotalCount2 = 0;

                string Study3 = "";
                string Study3Part = "";
                string Study3Outcomes = "";
                string Study3Outputs = "";
                int StudyTotalCount3 = 0;

                string Study4 = "";
                string Study4Part = "";
                string Study4Outcomes = "";
                string Study4Outputs = "";
                int StudyTotalCount4 = 0;

                string Study5 = "";
                string Study5Part = "";
                string Study5Outcomes = "";
                string Study5Outputs = "";
                int StudyTotalCount5 = 0;

                string Study6 = "";
                string Study6Part = "";
                string Study6Outcomes = "";
                string Study6Outputs = "";
                int StudyTotalCount6 = 0;

                string Travel = "";
                string TravelPart = "";
                string TravelOutcomes = "";
                string TravelOutputs = "";
                string Travel1 = "";
                string Travel1Part = "";
                string Travel1Outcomes = "";
                string Travel1Outputs = "";
                int TravelTotalCount1 = 0;

                string Travel2 = "";
                string Travel2Part = "";
                string Travel2Outcomes = "";
                string Travel2Outputs = "";
                int TravelTotalCount2 = 0;

                string Travel3 = "";
                string Travel3Part = "";
                string Travel3Outcomes = "";
                string Travel3Outputs = "";
                int TravelTotalCount3 = 0;

                string Travel4 = "";
                string Travel4Part = "";
                string Travel4Outcomes = "";
                string Travel4Outputs = "";
                int TravelTotalCount4 = 0;

                string Travel5 = "";
                string Travel5Part = "";
                string Travel5Outcomes = "";
                string Travel5Outputs = "";
                int TravelTotalCount5 = 0;

                string Travel6 = "";
                string Travel6Part = "";
                string Travel6Outcomes = "";
                string Travel6Outputs = "";
                int TravelTotalCount6 = 0;

                string Web = "";
                string WebPart = "";
                string WebOutcomes = "";
                string WebOutputs = "";
                string Web1 = "";
                string Web1Part = "";
                string Web1Outcomes = "";
                string Web1Outputs = "";
                int WebTotalCount1 = 0;

                string Web2 = "";
                string Web2Part = "";
                string Web2Outcomes = "";
                string Web2Outputs = "";
                int WebTotalCount2 = 0;

                string Web3 = "";
                string Web3Part = "";
                string Web3Outcomes = "";
                string Web3Outputs = "";
                int WebTotalCount3 = 0;

                string Web4 = "";
                string Web4Part = "";
                string Web4Outcomes = "";
                string Web4Outputs = "";
                int WebTotalCount4 = 0;

                string Web5 = "";
                string Web5Part = "";
                string Web5Outcomes = "";
                string Web5Outputs = "";
                int WebTotalCount5 = 0;

                string Web6 = "";
                string Web6Part = "";
                string Web6Outcomes = "";
                string Web6Outputs = "";
                int WebTotalCount6 = 0;

                string Other = "";
                string OtherPart = "";
                string OtherOutcomes = "";
                string OtherOutputs = "";
                string Other1 = "";
                string Other1Part = "";
                string Other1Outcomes = "";
                string Other1Outputs = "";
                int OtherTotalCount1 = 0;

                string Other2 = "";
                string Other2Part = "";
                string Other2Outcomes = "";
                string Other2Outputs = "";
                int OtherTotalCount2 = 0;

                string Other3 = "";
                string Other3Part = "";
                string Other3Outcomes = "";
                string Other3Outputs = "";
                int OtherTotalCount3 = 0;

                string Other4 = "";
                string Other4Part = "";
                string Other4Outcomes = "";
                string Other4Outputs = "";
                int OtherTotalCount4 = 0;

                string Other5 = "";
                string Other5Part = "";
                string Other5Outcomes = "";
                string Other5Outputs = "";
                int OtherTotalCount5 = 0;

                string Other6 = "";
                string Other6Part = "";
                string Other6Outcomes = "";
                string Other6Outputs = "";
                int OtherTotalCount6 = 0;

                string attachmentTitle = "";
                string infoProductTitle = "";

                using (userDataReader = userCommand.ExecuteReader())
                {

                    while (userDataReader.Read())
                    {
                        sareamount = string.Format("{0:c}", userDataReader["funds_sare"]);
                        Chunk cProjNu = new Chunk("Project Number : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjNu);
                        Chunk cProjNuValue = new Chunk(userDataReader["proj_num"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjNuValue);
                        paragraphProject.Add("\n");

                        Chunk cProjType = new Chunk("Type : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjType);
                        Chunk cProjTypeValue = new Chunk(userDataReader["proj_type_text"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjTypeValue);
                        paragraphProject.Add("\n");

                        Chunk cProjReg = new Chunk("Title : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjReg);
                        Chunk cProjRegValue = new Chunk(userDataReader["proj_title"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjRegValue);
                        paragraphProject.Add("\n");

                        Chunk cProjGrant = new Chunk("SARE Grant : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjGrant);
                        Chunk cProjGrantValue = new Chunk(sareamount, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjGrantValue);
                        paragraphProject.Add("\n\n");
                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {
                        Chunk cStateCoord = new Chunk("State Coordinator : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphCoords.Add(cStateCoord);
                        Chunk cStateCoordValue = new Chunk(userDataReader["firstName"].ToString() + " " + userDataReader["lastName"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphCoords.Add(cStateCoordValue);
                        paragraphCoords.Add("\n");
                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {
                        Chunk cState = new Chunk("State : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphState.Add(cState);
                        Chunk cStateValue = new Chunk(userDataReader["pi_stateProName"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphState.Add(cStateValue);
                        paragraphState.Add("\n");

                        Chunk cAdvAff = new Chunk("Advisory Committee Membership Affiliation : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphAdvAff.Add(cAdvAff);
                        paragraphAdvAff.Add("\n");
                        Chunk cAdvAffValue = new Chunk(userDataReader["advName"].ToString().Trim() + ", " + userDataReader["advAff"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphAdvAff.Add(cAdvAffValue);
                        if (userDataReader["advName1"].ToString().Trim().Length != 0 && userDataReader["advName1"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue1 = new Chunk(userDataReader["advName1"].ToString().Trim() + ", " + userDataReader["advAff1"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue1);
                        }
                        if (userDataReader["advName2"].ToString().Trim().Length != 0 && userDataReader["advName2"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue2 = new Chunk(userDataReader["advName2"].ToString().Trim() + ", " + userDataReader["advAff2"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue2);
                        }
                        if (userDataReader["advName3"].ToString().Trim().Length != 0 && userDataReader["advName3"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue3 = new Chunk(userDataReader["advName3"].ToString().Trim() + ", " + userDataReader["advAff3"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue3);
                        }
                        if (userDataReader["advName4"].ToString().Trim().Length != 0 && userDataReader["advName4"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue4 = new Chunk(userDataReader["advName4"].ToString().Trim() + ", " + userDataReader["advAff4"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue4);
                        }
                        if (userDataReader["advName5"].ToString().Trim().Length != 0 && userDataReader["advName5"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue5 = new Chunk(userDataReader["advName5"].ToString().Trim() + ", " + userDataReader["advAff5"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue5);
                        }
                        if (userDataReader["advName6"].ToString().Trim().Length != 0 && userDataReader["advName6"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue6 = new Chunk(userDataReader["advName6"].ToString().Trim() + ", " + userDataReader["advAff6"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue6);
                        }
                        if (userDataReader["advName7"].ToString().Trim().Length != 0 && userDataReader["advName7"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue7 = new Chunk(userDataReader["advName7"].ToString().Trim() + ", " + userDataReader["advAff7"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue7);
                        }
                        if (userDataReader["advName8"].ToString().Trim().Length != 0 && userDataReader["advName8"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue8 = new Chunk(userDataReader["advName8"].ToString().Trim() + ", " + userDataReader["advAff8"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue8);
                        }
                        if (userDataReader["advName9"].ToString().Trim().Length != 0 && userDataReader["advName9"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue9 = new Chunk(userDataReader["advName9"].ToString().Trim() + ", " + userDataReader["advAff9"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue9);
                        }
                        if (userDataReader["advName10"].ToString().Trim().Length != 0 && userDataReader["advName10"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue10 = new Chunk(userDataReader["advName10"].ToString().Trim() + ", " + userDataReader["advAff10"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue10);
                        }
                        if (userDataReader["advName11"].ToString().Trim().Length != 0 && userDataReader["advName11"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue11 = new Chunk(userDataReader["advName11"].ToString().Trim() + ", " + userDataReader["advAff11"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue11);
                        }
                        if (userDataReader["advName12"].ToString().Trim().Length != 0 && userDataReader["advName12"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue12 = new Chunk(userDataReader["advName12"].ToString().Trim() + ", " + userDataReader["advAff12"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue12);
                        }
                        if (userDataReader["advName13"].ToString().Trim().Length != 0 && userDataReader["advName13"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue13 = new Chunk(userDataReader["advName13"].ToString().Trim() + ", " + userDataReader["advAff13"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue13);
                        }
                        if (userDataReader["advName14"].ToString().Trim().Length != 0 && userDataReader["advName14"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue14 = new Chunk(userDataReader["advName14"].ToString().Trim() + ", " + userDataReader["advAff14"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue14);
                        }
                        if (userDataReader["advName15"].ToString().Trim().Length != 0 && userDataReader["advName15"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("               ");
                            Chunk cAdvAffValue15 = new Chunk(userDataReader["advName15"].ToString().Trim() + ", " + userDataReader["advAff15"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue15);
                        }
                        paragraphAdvAff.Add("\n\n");


                        Chunk cAdvAffDateLoc = new Chunk("Advisory Committee Meetings : (Date & Location)", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphAdvAff.Add(cAdvAffDateLoc);
                        paragraphAdvAff.Add("\n");
                        string advDate = DateTime.Parse(userDataReader["advDate"].ToString().Trim()).ToShortDateString();
                        if (advDate == "1/1/1900")
                            advDate = "";
                        if (advDate != "")
                        {
                            Chunk cAdvAffDateLocValue = new Chunk(advDate + ", " + userDataReader["advType"].ToString() + ", " + userDataReader["advLocation"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue);
                        }

                        string advDate1 = DateTime.Parse(userDataReader["advDate1"].ToString().Trim()).ToShortDateString();
                        if (advDate1 == "1/1/1900")
                            advDate1 = "";
                        if (advDate1 != "")
                        {
                            Chunk cAdvAffDateLocValue1;
                            paragraphAdvAff.Add("               ");
                            if (userDataReader["advLocation1"].ToString().Length != 0 && userDataReader["advLocation1"].ToString().Trim() != "")
                                cAdvAffDateLocValue1 = new Chunk(advDate1 + ", " + userDataReader["advType1"].ToString() + ", " + userDataReader["advLocation1"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            else
                                cAdvAffDateLocValue1 = new Chunk(advDate1 + ", " + userDataReader["advType1"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue1);
                        }

                        string advDate2 = DateTime.Parse(userDataReader["advDate2"].ToString().Trim()).ToShortDateString();
                        if (advDate2 == "1/1/1900")
                            advDate2 = "";
                        if (advDate2 != "")
                        {
                            Chunk cAdvAffDateLocValue2;
                            paragraphAdvAff.Add("               ");
                            if (userDataReader["advLocation2"].ToString().Length != 0 && userDataReader["advLocation2"].ToString().Trim() != "")
                                cAdvAffDateLocValue2 = new Chunk(advDate2 + ", " + userDataReader["advType2"].ToString() + ", " + userDataReader["advLocation2"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            else
                                cAdvAffDateLocValue2 = new Chunk(advDate2 + ", " + userDataReader["advType2"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue2);
                        }

                        string advDate3 = DateTime.Parse(userDataReader["advDate3"].ToString().Trim()).ToShortDateString();
                        if (advDate3 == "1/1/1900")
                            advDate3 = "";                            
                        if (advDate3 != "")
                        {
                            Chunk cAdvAffDateLocValue3;
                            paragraphAdvAff.Add("\n");
                            if (userDataReader["advLocation3"].ToString().Length != 0 && userDataReader["advLocation3"].ToString().Trim() != "")
                                cAdvAffDateLocValue3 = new Chunk(advDate3 + ", " + userDataReader["advType3"].ToString() + ", " + userDataReader["advLocation3"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            else
                                cAdvAffDateLocValue3 = new Chunk(advDate3 + ", " + userDataReader["advType3"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue3);
                        }

                        string advDate4 = DateTime.Parse(userDataReader["advDate4"].ToString().Trim()).ToShortDateString();
                        if (advDate4 == "1/1/1900")
                            advDate4 = "";
                        if (advDate4 != "")
                        {
                            Chunk cAdvAffDateLocValue4;
                            paragraphAdvAff.Add("               ");
                            if (userDataReader["advLocation4"].ToString().Length != 0 && userDataReader["advLocation4"].ToString().Trim() != "")
                                cAdvAffDateLocValue4 = new Chunk(advDate4 + ", " + userDataReader["advType4"].ToString() + ", " + userDataReader["advLocation4"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            else
                                cAdvAffDateLocValue4 = new Chunk(advDate4 + ", " + userDataReader["advType4"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue4);
                        }

                        string advDate5 = DateTime.Parse(userDataReader["advDate5"].ToString().Trim()).ToShortDateString();
                        if (advDate5 == "1/1/1900")
                            advDate5 = "";
                        if (advDate5 != "")
                        {
                            Chunk cAdvAffDateLocValue5;
                            paragraphAdvAff.Add("               ");
                            if (userDataReader["advLocation5"].ToString().Length != 0 && userDataReader["advLocation5"].ToString().Trim() != "")
                                cAdvAffDateLocValue5 = new Chunk(advDate5 + ", " + userDataReader["advType5"].ToString() + ", " + userDataReader["advLocation5"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            else
                                cAdvAffDateLocValue5 = new Chunk(advDate5 + ", " + userDataReader["advType5"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue5);
                        }

                        string advDate6 = DateTime.Parse(userDataReader["advDate6"].ToString().Trim()).ToShortDateString();
                        if (advDate6 == "1/1/1900")
                            advDate6 = "";
                        if (advDate6 != "")
                        {
                            Chunk cAdvAffDateLocValue6;
                            paragraphAdvAff.Add("               ");    
                            if (userDataReader["advLocation6"].ToString().Length != 0 && userDataReader["advLocation6"].ToString().Trim() != "")
                                cAdvAffDateLocValue6 = new Chunk(advDate6 + ", " + userDataReader["advType6"].ToString() + ", " + userDataReader["advLocation6"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            else
                                cAdvAffDateLocValue6 = new Chunk(advDate6 + ", " + userDataReader["advType6"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue6);
                        }
                        paragraphAdvAff.Add("\n");
                        /*
                        Chunk cSareFace = new Chunk("Face of SARE : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphSareFace.Add(cSareFace);
                        paragraphSareFace.Add("\n");
                        Chunk cSareFaceValue = new Chunk(userDataReader["face_of_sare"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphSareFace.Add(cSareFaceValue);
                        paragraphSareFace.Add("\n");
                        */
                        htmlTextSareFace = "<B><font size='2' face='Helvetica'>" + "Face of SARE : " + "</font></B><br/>";
                        htmlTextSareFace += "<font size='2' face='arial unicode ms'>" + userDataReader["face_of_sare"].ToString().Trim() + "</font><br/><br/>";
                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {
                        //Chunk cOutcomeNarrative = new Chunk("Report Summary: ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        //paragraphOutcomeNarrative.Add(cOutcomeNarrative);
                        htmlTextOutcomeNarrative = "<B><font size='2' face='Helvetica'>" + "Report Summary: " + "</font></B><br/>";
                        //paragraphOutcomeNarrative.Add("\n");
                        if (userDataReader["out_summary"].ToString() != "")
                        {
                            /*
                            paragraphOutcomeNarrative.Add("\n");
                            Chunk cOutcomeSummary = new Chunk("Key Results : " + userDataReader["out_summary"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphOutcomeNarrative.Add(cOutcomeSummary);
                            paragraphOutcomeNarrative.Add("\n");
                            */
                            htmlTextOutcomeNarrative += "<font size='2' face='Helvetica'>" + "Key Results : " + userDataReader["out_summary"].ToString().Trim() + "</font><br/>";

                        }
                        if (userDataReader["out_desc"].ToString() != "")
                        {
                            /*
                            paragraphOutcomeNarrative.Add("\n");
                            Chunk cOutcomeDesc = new Chunk("Unanticipated Outcomes : " + userDataReader["out_desc"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphOutcomeNarrative.Add(cOutcomeDesc);
                            paragraphOutcomeNarrative.Add("\n");
                            */
                            htmlTextOutcomeNarrative += "<br/><font size='2' face='Helvetica'>" + "Unanticipated Outcomes : " + userDataReader["out_desc"].ToString().Trim() + "</font><br/>";

                        }
                        if (userDataReader["out_other"].ToString() != "")
                        {
                            /*
                            paragraphOutcomeNarrative.Add("\n");
                            Chunk cOutcomeOther = new Chunk("Other Comments : " + userDataReader["out_other"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphOutcomeNarrative.Add(cOutcomeOther);
                            paragraphOutcomeNarrative.Add("\n");
                            */
                            htmlTextOutcomeNarrative += "<br/><font size='2' face='Helvetica'>" + "Other Comments : " + userDataReader["out_other"].ToString().Trim() + "</font><br/><br/>";
                        }

                    }
                    userDataReader.NextResult();


                    while (userDataReader.Read())
                    {
                        if (userDataReader["Title"].ToString() != "")
                        {
                            if (attachmentTitle == "")
                                attachmentTitle = userDataReader["Title"].ToString();
                            else
                                attachmentTitle = attachmentTitle + "\n" + userDataReader["Title"].ToString();
                        }
                    }
                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {
                        if (userDataReader["Title"].ToString() != "")
                        {
                            if (infoProductTitle == "")
                                infoProductTitle = userDataReader["Title"].ToString();
                            else
                                infoProductTitle = infoProductTitle + "\n" + userDataReader["Title"].ToString();
                        }
                    }
                    userDataReader.NextResult();

                    paragraphInitTitles.Add("\n");
                    Chunk cInit = new Chunk("Initiatives : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                    paragraphInitTitles.Add(cInit);
                    paragraphInitTitles.Add("\n");

                    while (userDataReader.Read())
                    {
                        if (iTitleCount == 0)
                        {
                            Title1 = userDataReader["init_topic"].ToString().Trim();
                            partners1 = "Participated on planning team" + "\n";
                            if (userDataReader["part_ext"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["part_nrcs"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["part_ngo"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["part_state"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["part_farmer"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["part_other"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-Other" + "\n";
                            partners1 = partners1 + "Participated as trainer" + "\n";
                            if (userDataReader["train_ext"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["train_nrcs"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["train_ngo"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["train_state"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["train_farmer"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["train_other"].ToString() != "0")
                                partners1 = partners1 + " " + "X" + "-Other" + "\n";

                            /*
                            partners1 = partners1 + "Developed outreach materials" + "\n";
                            partners1 = partners1 + " " + userDataReader["dev_ext"].ToString() + "-Coop Extension" + "\n";
                            partners1 = partners1 + " " + userDataReader["dev_nrcs"].ToString() + "-NRCS" + "\n";
                            partners1 = partners1 + " " + userDataReader["dev_ngo"].ToString() + "-NGO" + "\n";
                            partners1 = partners1 + " " + userDataReader["dev_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners1 = partners1 + " " + userDataReader["dev_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners1 = partners1 + " " + userDataReader["dev_other"].ToString() + "-Other" + "\n";
                            partners1 = partners1 + "Involved in any other ways" + "\n";
                            partners1 = partners1 + " " + userDataReader["inv_ext"].ToString() + "-Coop Extension" + "\n";
                            partners1 = partners1 + " " + userDataReader["inv_nrcs"].ToString() + "-NRCS" + "\n";
                            partners1 = partners1 + " " + userDataReader["inv_ngo"].ToString() + "-NGO" + "\n";
                            partners1 = partners1 + " " + userDataReader["inv_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners1 = partners1 + " " + userDataReader["inv_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners1 = partners1 + " " + userDataReader["inv_other"].ToString() + "-Other" + "\n";
                            */
                        }
                        if (iTitleCount == 1)
                        {
                            Title2 = userDataReader["init_topic"].ToString().Trim();
                            partners2 = "Participated on planning team" + "\n";
                            if (userDataReader["part_ext"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["part_nrcs"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["part_ngo"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["part_state"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["part_farmer"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["part_other"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-Other" + "\n";
                            partners2 = partners2 + "Participated as trainer" + "\n";
                            if (userDataReader["train_ext"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["train_nrcs"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["train_ngo"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["train_state"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["train_farmer"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["train_other"].ToString() != "0")
                                partners2 = partners2 + " " + "X" + "-Other" + "\n";
                            /*
                            partners2 = "Participated on planning team" + "\n";
                            partners2 = partners2 + " " + userDataReader["part_ext"].ToString() + "-Coop Extension" + "\n";
                            partners2 = partners2 + " " + userDataReader["part_nrcs"].ToString() + "-NRCS" + "\n";
                            partners2 = partners2 + " " + userDataReader["part_ngo"].ToString() + "-NGO" + "\n";
                            partners2 = partners2 + " " + userDataReader["part_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners2 = partners2 + " " + userDataReader["part_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners2 = partners2 + " " + userDataReader["part_other"].ToString() + "-Other" + "\n";
                            partners2 = partners2 + "Actively involved at training sessions" + "\n";
                            partners2 = partners2 + " " + userDataReader["train_ext"].ToString() + "-Coop Extension" + "\n";
                            partners2 = partners2 + " " + userDataReader["train_nrcs"].ToString() + "-NRCS" + "\n";
                            partners2 = partners2 + " " + userDataReader["train_ngo"].ToString() + "-NGO" + "\n";
                            partners2 = partners2 + " " + userDataReader["train_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners2 = partners2 + " " + userDataReader["train_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners2 = partners2 + " " + userDataReader["train_other"].ToString() + "-Other" + "\n";
                            partners2 = partners2 + "Developed outreach materials" + "\n";
                            partners2 = partners2 + " " + userDataReader["dev_ext"].ToString() + "-Coop Extension" + "\n";
                            partners2 = partners2 + " " + userDataReader["dev_nrcs"].ToString() + "-NRCS" + "\n";
                            partners2 = partners2 + " " + userDataReader["dev_ngo"].ToString() + "-NGO" + "\n";
                            partners2 = partners2 + " " + userDataReader["dev_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners2 = partners2 + " " + userDataReader["dev_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners2 = partners2 + " " + userDataReader["dev_other"].ToString() + "-Other" + "\n";
                            partners2 = partners2 + "Involved in any other ways" + "\n";
                            partners2 = partners2 + " " + userDataReader["inv_ext"].ToString() + "-Coop Extension" + "\n";
                            partners2 = partners2 + " " + userDataReader["inv_nrcs"].ToString() + "-NRCS" + "\n";
                            partners2 = partners2 + " " + userDataReader["inv_ngo"].ToString() + "-NGO" + "\n";
                            partners2 = partners2 + " " + userDataReader["inv_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners2 = partners2 + " " + userDataReader["inv_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners2 = partners2 + " " + userDataReader["inv_other"].ToString() + "-Other" + "\n";
                            */
                        }
                        if (iTitleCount == 2)
                        {
                            Title3 = userDataReader["init_topic"].ToString().Trim();
                            partners3 = "Participated on planning team" + "\n";
                            if (userDataReader["part_ext"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["part_nrcs"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["part_ngo"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["part_state"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["part_farmer"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["part_other"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-Other" + "\n";
                            partners3 = partners3 + "Participated as trainer" + "\n";
                            if (userDataReader["train_ext"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["train_nrcs"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["train_ngo"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["train_state"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["train_farmer"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["train_other"].ToString() != "0")
                                partners3 = partners3 + " " + "X" + "-Other" + "\n";
                            /*
                            partners3 = "Participated on planning team" + "\n";
                            partners3 = partners3 + " " + userDataReader["part_ext"].ToString() + "-Coop Extension" + "\n";
                            partners3 = partners3 + " " + userDataReader["part_nrcs"].ToString() + "-NRCS" + "\n";
                            partners3 = partners3 + " " + userDataReader["part_ngo"].ToString() + "-NGO" + "\n";
                            partners3 = partners3 + " " + userDataReader["part_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners3 = partners3 + " " + userDataReader["part_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners3 = partners3 + " " + userDataReader["part_other"].ToString() + "-Other" + "\n";
                            partners3 = partners3 + "Actively involved at training sessions" + "\n";
                            partners3 = partners3 + " " + userDataReader["train_ext"].ToString() + "-Coop Extension" + "\n";
                            partners3 = partners3 + " " + userDataReader["train_nrcs"].ToString() + "-NRCS" + "\n";
                            partners3 = partners3 + " " + userDataReader["train_ngo"].ToString() + "-NGO" + "\n";
                            partners3 = partners3 + " " + userDataReader["train_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners3 = partners3 + " " + userDataReader["train_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners3 = partners3 + " " + userDataReader["train_other"].ToString() + "-Other" + "\n";
                            partners3 = partners3 + "Developed outreach materials" + "\n";
                            partners3 = partners3 + " " + userDataReader["dev_ext"].ToString() + "-Coop Extension" + "\n";
                            partners3 = partners3 + " " + userDataReader["dev_nrcs"].ToString() + "-NRCS" + "\n";
                            partners3 = partners3 + " " + userDataReader["dev_ngo"].ToString() + "-NGO" + "\n";
                            partners3 = partners3 + " " + userDataReader["dev_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners3 = partners3 + " " + userDataReader["dev_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners3 = partners3 + " " + userDataReader["dev_other"].ToString() + "-Other" + "\n";
                            partners3 = partners3 + "Involved in any other ways" + "\n";
                            partners3 = partners3 + " " + userDataReader["inv_ext"].ToString() + "-Coop Extension" + "\n";
                            partners3 = partners3 + " " + userDataReader["inv_nrcs"].ToString() + "-NRCS" + "\n";
                            partners3 = partners3 + " " + userDataReader["inv_ngo"].ToString() + "-NGO" + "\n";
                            partners3 = partners3 + " " + userDataReader["inv_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners3 = partners3 + " " + userDataReader["inv_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners3 = partners3 + " " + userDataReader["inv_other"].ToString() + "-Other" + "\n";
                            */
                        }
                        if (iTitleCount == 3)
                        {
                            Title4 = userDataReader["init_topic"].ToString().Trim();
                            partners4 = "Participated on planning team" + "\n";
                            if (userDataReader["part_ext"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["part_nrcs"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["part_ngo"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["part_state"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["part_farmer"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["part_other"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-Other" + "\n";
                            partners4 = partners4 + "Participated as trainer" + "\n";
                            if (userDataReader["train_ext"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["train_nrcs"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["train_ngo"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["train_state"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["train_farmer"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["train_other"].ToString() != "0")
                                partners4 = partners4 + " " + "X" + "-Other" + "\n";
                            /*
                            partners4 = "Participated on planning team" + "\n";
                            partners4 = partners4 + " " + userDataReader["part_ext"].ToString() + "-Coop Extension" + "\n";
                            partners4 = partners4 + " " + userDataReader["part_nrcs"].ToString() + "-NRCS" + "\n";
                            partners4 = partners4 + " " + userDataReader["part_ngo"].ToString() + "-NGO" + "\n";
                            partners4 = partners4 + " " + userDataReader["part_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners4 = partners4 + " " + userDataReader["part_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners4 = partners4 + " " + userDataReader["part_other"].ToString() + "-Other" + "\n";
                            partners4 = partners4 + "Actively involved at training sessions" + "\n";
                            partners4 = partners4 + " " + userDataReader["train_ext"].ToString() + "-Coop Extension" + "\n";
                            partners4 = partners4 + " " + userDataReader["train_nrcs"].ToString() + "-NRCS" + "\n";
                            partners4 = partners4 + " " + userDataReader["train_ngo"].ToString() + "-NGO" + "\n";
                            partners4 = partners4 + " " + userDataReader["train_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners4 = partners4 + " " + userDataReader["train_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners4 = partners4 + " " + userDataReader["train_other"].ToString() + "-Other" + "\n";
                            partners4 = partners4 + "Developed outreach materials" + "\n";
                            partners4 = partners4 + " " + userDataReader["dev_ext"].ToString() + "-Coop Extension" + "\n";
                            partners4 = partners4 + " " + userDataReader["dev_nrcs"].ToString() + "-NRCS" + "\n";
                            partners4 = partners4 + " " + userDataReader["dev_ngo"].ToString() + "-NGO" + "\n";
                            partners4 = partners4 + " " + userDataReader["dev_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners4 = partners4 + " " + userDataReader["dev_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners4 = partners4 + " " + userDataReader["dev_other"].ToString() + "-Other" + "\n";
                            partners4 = partners4 + "Involved in any other ways" + "\n";
                            partners4 = partners4 + " " + userDataReader["inv_ext"].ToString() + "-Coop Extension" + "\n";
                            partners4 = partners4 + " " + userDataReader["inv_nrcs"].ToString() + "-NRCS" + "\n";
                            partners4 = partners4 + " " + userDataReader["inv_ngo"].ToString() + "-NGO" + "\n";
                            partners4 = partners4 + " " + userDataReader["inv_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners4 = partners4 + " " + userDataReader["inv_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners4 = partners4 + " " + userDataReader["inv_other"].ToString() + "-Other" + "\n";
                            */
                        }
                        if (iTitleCount == 4)
                        {
                            Title5 = userDataReader["init_topic"].ToString().Trim();
                            partners5 = "Participated on planning team" + "\n";
                            if (userDataReader["part_ext"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["part_nrcs"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["part_ngo"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["part_state"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["part_farmer"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["part_other"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-Other" + "\n";
                            partners5 = partners5 + "Participated as trainer" + "\n";
                            if (userDataReader["train_ext"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["train_nrcs"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["train_ngo"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["train_state"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["train_farmer"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["train_other"].ToString() != "0")
                                partners5 = partners5 + " " + "X" + "-Other" + "\n";
                            /*
                            partners5 = "Participated on planning team" + "\n";
                            partners5 = partners5 + " " + userDataReader["part_ext"].ToString() + "-Coop Extension" + "\n";
                            partners5 = partners5 + " " + userDataReader["part_nrcs"].ToString() + "-NRCS" + "\n";
                            partners5 = partners5 + " " + userDataReader["part_ngo"].ToString() + "-NGO" + "\n";
                            partners5 = partners5 + " " + userDataReader["part_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners5 = partners5 + " " + userDataReader["part_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners5 = partners5 + " " + userDataReader["part_other"].ToString() + "-Other" + "\n";
                            partners5 = partners5 + "Actively involved at training sessions" + "\n";
                            partners5 = partners5 + " " + userDataReader["train_ext"].ToString() + "-Coop Extension" + "\n";
                            partners5 = partners5 + " " + userDataReader["train_nrcs"].ToString() + "-NRCS" + "\n";
                            partners5 = partners5 + " " + userDataReader["train_ngo"].ToString() + "-NGO" + "\n";
                            partners5 = partners5 + " " + userDataReader["train_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners5 = partners5 + " " + userDataReader["train_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners5 = partners5 + " " + userDataReader["train_other"].ToString() + "-Other" + "\n";
                            partners5 = partners5 + "Developed outreach materials" + "\n";
                            partners5 = partners5 + " " + userDataReader["dev_ext"].ToString() + "-Coop Extension" + "\n";
                            partners5 = partners5 + " " + userDataReader["dev_nrcs"].ToString() + "-NRCS" + "\n";
                            partners5 = partners5 + " " + userDataReader["dev_ngo"].ToString() + "-NGO" + "\n";
                            partners5 = partners5 + " " + userDataReader["dev_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners5 = partners5 + " " + userDataReader["dev_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners5 = partners5 + " " + userDataReader["dev_other"].ToString() + "-Other" + "\n";
                            partners5 = partners5 + "Involved in any other ways" + "\n";
                            partners5 = partners5 + " " + userDataReader["inv_ext"].ToString() + "-Coop Extension" + "\n";
                            partners5 = partners5 + " " + userDataReader["inv_nrcs"].ToString() + "-NRCS" + "\n";
                            partners5 = partners5 + " " + userDataReader["inv_ngo"].ToString() + "-NGO" + "\n";
                            partners5 = partners5 + " " + userDataReader["inv_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners5 = partners5 + " " + userDataReader["inv_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners5 = partners5 + " " + userDataReader["inv_other"].ToString() + "-Other" + "\n";
                            */
                        }
                        if (iTitleCount == 5)
                        {
                            Title6 = userDataReader["init_topic"].ToString().Trim();
                            partners6 = "Participated on planning team" + "\n";
                            if (userDataReader["part_ext"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["part_nrcs"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["part_ngo"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["part_state"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["part_farmer"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["part_other"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-Other" + "\n";
                            partners6 = partners6 + "Participated as trainer" + "\n";
                            if (userDataReader["train_ext"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-Coop Extension" + "\n";
                            if (userDataReader["train_nrcs"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-NRCS" + "\n";
                            if (userDataReader["train_ngo"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-NGO" + "\n";
                            if (userDataReader["train_state"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-State/Federal/Tribal Agency" + "\n";
                            if (userDataReader["train_farmer"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-Farmer/Rancher" + "\n";
                            if (userDataReader["train_other"].ToString() != "0")
                                partners6 = partners6 + " " + "X" + "-Other" + "\n";
                            /*
                            partners6 = "Participated on planning team" + "\n";
                            partners6 = partners6 + " " + userDataReader["part_ext"].ToString() + "-Coop Extension" + "\n";
                            partners6 = partners6 + " " + userDataReader["part_nrcs"].ToString() + "-NRCS" + "\n";
                            partners6 = partners6 + " " + userDataReader["part_ngo"].ToString() + "-NGO" + "\n";
                            partners6 = partners6 + " " + userDataReader["part_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners6 = partners6 + " " + userDataReader["part_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners6 = partners6 + " " + userDataReader["part_other"].ToString() + "-Other" + "\n";
                            partners6 = partners6 + "Actively involved at training sessions" + "\n";
                            partners6 = partners6 + " " + userDataReader["train_ext"].ToString() + "-Coop Extension" + "\n";
                            partners6 = partners6 + " " + userDataReader["train_nrcs"].ToString() + "-NRCS" + "\n";
                            partners6 = partners6 + " " + userDataReader["train_ngo"].ToString() + "-NGO" + "\n";
                            partners6 = partners6 + " " + userDataReader["train_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners6 = partners6 + " " + userDataReader["train_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners6 = partners6 + " " + userDataReader["train_other"].ToString() + "-Other" + "\n";
                            partners6 = partners6 + "Developed outreach materials" + "\n";
                            partners6 = partners6 + " " + userDataReader["dev_ext"].ToString() + "-Coop Extension" + "\n";
                            partners6 = partners6 + " " + userDataReader["dev_nrcs"].ToString() + "-NRCS" + "\n";
                            partners6 = partners6 + " " + userDataReader["dev_ngo"].ToString() + "-NGO" + "\n";
                            partners6 = partners6 + " " + userDataReader["dev_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners6 = partners6 + " " + userDataReader["dev_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners6 = partners6 + " " + userDataReader["dev_other"].ToString() + "-Other" + "\n";
                            partners6 = partners6 + "Involved in any other ways" + "\n";
                            partners6 = partners6 + " " + userDataReader["inv_ext"].ToString() + "-Coop Extension" + "\n";
                            partners6 = partners6 + " " + userDataReader["inv_nrcs"].ToString() + "-NRCS" + "\n";
                            partners6 = partners6 + " " + userDataReader["inv_ngo"].ToString() + "-NGO" + "\n";
                            partners6 = partners6 + " " + userDataReader["inv_state"].ToString() + "-State/Federal/Tribal Agency" + "\n";
                            partners6 = partners6 + " " + userDataReader["inv_farmer"].ToString() + "-Farmer/Rancher" + "\n";
                            partners6 = partners6 + " " + userDataReader["inv_other"].ToString() + "-Other" + "\n";
                            */
                        }

                        Chunk cInitValue = new Chunk(userDataReader["init_topic"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphInitTitles.Add(cInitValue);
                        paragraphInitTitles.Add("\n");
                        iTitleCount++;
                    }
                    paragraphInitTitles.Add("\n");

                    userDataReader.NextResult();

                    //Workshop Activities
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            WorkshopsDay = userDataReader["Title"].ToString();
                        }

                        // Workshops Day/Tours Activity - 1
                        if (WorkshopsDay != "")
                        {
                            int extTotalCount = 0;
                            int ngoTotalCount = 0;
                            int stTotalCount = 0;
                            int nrcsTotalCount = 0;
                            int farmTotalCount = 0;
                            int proTotalCount = 0;
                            bool shortFlag = false;
                            bool single = false;
                            bool multi = false;
                            bool extend = false;

                            if (userDataReader["ShortExt"].ToString() != "0")
                            {
                                extTotalCount = Int32.Parse(userDataReader["ShortExt"].ToString());
                                shortFlag = true;
                            }
                            if (userDataReader["InterExt"].ToString() != "0")
                            {
                                extTotalCount = Int32.Parse(userDataReader["InterExt"].ToString());
                                single = true;
                            }
                            if (userDataReader["ExtExt"].ToString() != "0")
                            {
                                extTotalCount = extTotalCount + Int32.Parse(userDataReader["ExtExt"].ToString());
                                extend = true;
                            }
                            if (userDataReader["MultiExt"].ToString() != "0")
                            {
                                extTotalCount = extTotalCount + Int32.Parse(userDataReader["MultiExt"].ToString());
                                multi = true;
                            }
                            //if (extTotalCount > 0)
                            WorkshopsDayPart = extTotalCount.ToString() + "-Coop Extension";

                            if (userDataReader["ShortNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = Int32.Parse(userDataReader["ShortNRCS"].ToString());
                                if (shortFlag == false)
                                    shortFlag = true;
                            }
                            if (userDataReader["InterNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = Int32.Parse(userDataReader["InterNRCS"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = nrcsTotalCount + Int32.Parse(userDataReader["ExtNRCS"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = nrcsTotalCount + Int32.Parse(userDataReader["MultiNRCS"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (nrcsTotalCount > 0)
                            WorkshopsDayPart = WorkshopsDayPart + "\n" + nrcsTotalCount.ToString() + "-NRCS";

                            if (userDataReader["ShortNGO"].ToString() != "0")
                            {
                                ngoTotalCount = Int32.Parse(userDataReader["ShortNGO"].ToString());
                                if (shortFlag == false)
                                    shortFlag = true;
                            }
                            if (userDataReader["InterNGO"].ToString() != "0")
                            {
                                ngoTotalCount = Int32.Parse(userDataReader["InterNGO"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtNGO"].ToString() != "0")
                            {
                                ngoTotalCount = ngoTotalCount + Int32.Parse(userDataReader["ExtNGO"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiNGO"].ToString() != "0")
                            {
                                ngoTotalCount = ngoTotalCount + Int32.Parse(userDataReader["MultiNGO"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (ngoTotalCount > 0)
                            WorkshopsDayPart = WorkshopsDayPart + "\n" + ngoTotalCount.ToString() + "-NGO";

                            if (userDataReader["ShortST"].ToString() != "0")
                            {
                                stTotalCount = Int32.Parse(userDataReader["ShortST"].ToString());
                                if (shortFlag == false)
                                    shortFlag = true;
                            }
                            if (userDataReader["InterST"].ToString() != "0")
                            {
                                stTotalCount = Int32.Parse(userDataReader["InterST"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtST"].ToString() != "0")
                            {
                                stTotalCount = stTotalCount + Int32.Parse(userDataReader["ExtST"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiST"].ToString() != "0")
                            {
                                stTotalCount = stTotalCount + Int32.Parse(userDataReader["MultiST"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (stTotalCount > 0)
                            WorkshopsDayPart = WorkshopsDayPart + "\n" + stTotalCount.ToString() + "-State/Federal/Tribal Agency";



                            if (userDataReader["ShortFarm"].ToString() != "0")
                            {
                                farmTotalCount = Int32.Parse(userDataReader["ShortFarm"].ToString());
                                if (shortFlag == false)
                                    shortFlag = true;
                            }
                            if (userDataReader["InterFarm"].ToString() != "0")
                            {
                                farmTotalCount = Int32.Parse(userDataReader["InterFarm"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtFarm"].ToString() != "0")
                            {
                                farmTotalCount = farmTotalCount + Int32.Parse(userDataReader["ExtFarm"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiFarm"].ToString() != "0")
                            {
                                farmTotalCount = farmTotalCount + Int32.Parse(userDataReader["MultiFarm"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (farmTotalCount > 0)
                            WorkshopsDayPart = WorkshopsDayPart + "\n" + farmTotalCount.ToString() + "-Farmer/Rancher";

                            if (userDataReader["ShortPro"].ToString() != "0")
                            {
                                proTotalCount = Int32.Parse(userDataReader["ShortPro"].ToString());
                                if (shortFlag == false)
                                    shortFlag = true;
                            }
                            if (userDataReader["InterPro"].ToString() != "0")
                            {
                                proTotalCount = Int32.Parse(userDataReader["InterPro"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtPro"].ToString() != "0")
                            {
                                proTotalCount = proTotalCount + Int32.Parse(userDataReader["ExtPro"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiPro"].ToString() != "0")
                            {
                                proTotalCount = proTotalCount + Int32.Parse(userDataReader["MultiPro"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (proTotalCount > 0)
                            WorkshopsDayPart = WorkshopsDayPart + "\n" + proTotalCount.ToString() + "-For Profit";

                            if (shortFlag == true)
                                WorkshopsDay = WorkshopsDay + "\n" + "Short (1.5 - 3 hrs)";
                            else if (single == true)
                                WorkshopsDay = WorkshopsDay + "\n" + " Intermediate (3 - 8 hrs)";
                            else if (multi == true)
                                WorkshopsDay = WorkshopsDay + "\n" + " Multiday(>1day)";
                            else if (extend == true)
                                WorkshopsDay = WorkshopsDay + "\n" + " Extended Multiday";

                            int mediaCount = Int32.Parse(userDataReader["ShortMedia"].ToString()) + Int32.Parse(userDataReader["InterMedia"].ToString()) + Int32.Parse(userDataReader["MultiMedia"].ToString()) + Int32.Parse(userDataReader["ExtMedia"].ToString());
                            WorkshopsDayOutcomes = mediaCount.ToString() + "-used in newsletters or other media";

                            int clientTotal = Int32.Parse(userDataReader["ShortClient"].ToString()) + Int32.Parse(userDataReader["InterClient"].ToString()) + Int32.Parse(userDataReader["MultiClient"].ToString()) + Int32.Parse(userDataReader["ExtClient"].ToString());
                            WorkshopsDayOutcomes = WorkshopsDayOutcomes + "\n" + clientTotal.ToString() + "-answered client questions";

                            int develCount = Int32.Parse(userDataReader["ShortDevel"].ToString()) + Int32.Parse(userDataReader["InterDevel"].ToString()) + Int32.Parse(userDataReader["MultiDevel"].ToString()) + Int32.Parse(userDataReader["ExtDevel"].ToString());
                            WorkshopsDayOutcomes = WorkshopsDayOutcomes + "\n" + develCount.ToString() + "-developed  new contacts";

                            int incorpCount = Int32.Parse(userDataReader["ShortIncorp"].ToString()) + Int32.Parse(userDataReader["InterIncorp"].ToString()) + Int32.Parse(userDataReader["MultiIncorp"].ToString()) + Int32.Parse(userDataReader["ExtIncorp"].ToString());
                            WorkshopsDayOutcomes = WorkshopsDayOutcomes + "\n" + incorpCount.ToString() + "-incorporated into programming";

                            int progCount = Int32.Parse(userDataReader["ShortProg"].ToString()) + Int32.Parse(userDataReader["InterProg"].ToString()) + Int32.Parse(userDataReader["MultiProg"].ToString()) + Int32.Parse(userDataReader["ExtProg"].ToString());
                            WorkshopsDayOutcomes = WorkshopsDayOutcomes + "\n" + progCount.ToString() + "-delivered new programming";

                            int consultCount = Int32.Parse(userDataReader["ShortConsult"].ToString()) + Int32.Parse(userDataReader["InterConsult"].ToString()) + Int32.Parse(userDataReader["MultiConsult"].ToString()) + Int32.Parse(userDataReader["ExtConsult"].ToString());
                            WorkshopsDayOutcomes = WorkshopsDayOutcomes + "\n" + consultCount.ToString() + "-individual consultation";

                            int farmersCount = Int32.Parse(userDataReader["ShortFarmers"].ToString()) + Int32.Parse(userDataReader["InterFarmers"].ToString()) + Int32.Parse(userDataReader["MultiFarmers"].ToString()) + Int32.Parse(userDataReader["ExtFarmers"].ToString());
                            WorkshopsDayOutcomes = WorkshopsDayOutcomes + "\n" + farmersCount.ToString() + "-number of farmers reached";

                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            WorkshopsDay1 = WorkshopsDay;
                            WorkshopsDay1Part = WorkshopsDayPart;
                            WorkshopsDay1Outcomes = WorkshopsDayOutcomes;
                            //WorkshopsDay1Outputs = WorkshopsDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            WorkshopsDay2 = WorkshopsDay;
                            WorkshopsDay2Part = WorkshopsDayPart;
                            WorkshopsDay2Outcomes = WorkshopsDayOutcomes;
                            //WorkshopsDay2Outputs = WorkshopsDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "2")
                        {
                            WorkshopsDay3 = WorkshopsDay;
                            WorkshopsDay3Part = WorkshopsDayPart;
                            WorkshopsDay3Outcomes = WorkshopsDayOutcomes;
                            //WorkshopsDay3Outputs = WorkshopsDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "3")
                        {
                            WorkshopsDay4 = WorkshopsDay;
                            WorkshopsDay4Part = WorkshopsDayPart;
                            WorkshopsDay4Outcomes = WorkshopsDayOutcomes;
                            //WorkshopsDay4Outputs = WorkshopsDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "4")
                        {
                            WorkshopsDay5 = WorkshopsDay;
                            WorkshopsDay5Part = WorkshopsDayPart;
                            WorkshopsDay5Outcomes = WorkshopsDayOutcomes;
                            //WorkshopsDay5Outputs = WorkshopsDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "5")
                        {
                            WorkshopsDay6 = WorkshopsDay;
                            WorkshopsDay6Part = WorkshopsDayPart;
                            WorkshopsDay6Outcomes = WorkshopsDayOutcomes;
                            //WorkshopsDay6Outputs = WorkshopsDayOutputs;

                        }

                        //reset Workshops data for next row
                        WorkshopsDay = "";
                        WorkshopsDayPart = "";
                        WorkshopsDayOutcomes = "";
                        //WorkshopsDayOutputs = "";
                    }

                    userDataReader.NextResult();

                    //Field Day/Tours Activities 
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            FieldDay = userDataReader["Title"].ToString();
                        }

                        // Field Day/Tours Activity - 1
                        if (FieldDay != "")
                        {
                            int extTotalCount = 0;
                            int ngoTotalCount = 0;
                            int stTotalCount = 0;
                            int nrcsTotalCount = 0;
                            int farmTotalCount = 0;
                            int proTotalCount = 0;
                            bool single = false;
                            bool multi = false;
                            bool extend = false;

                            if (userDataReader["InterExt"].ToString() != "0")
                            {
                                extTotalCount = Int32.Parse(userDataReader["InterExt"].ToString());
                                single = true;
                            }
                            if (userDataReader["ExtExt"].ToString() != "0")
                            {
                                extTotalCount = extTotalCount + Int32.Parse(userDataReader["ExtExt"].ToString());
                                extend = true;
                            }
                            if (userDataReader["MultiExt"].ToString() != "0")
                            {
                                extTotalCount = extTotalCount + Int32.Parse(userDataReader["MultiExt"].ToString());
                                multi = true;
                            }
                            //if (extTotalCount > 0)
                            FieldDayPart = extTotalCount.ToString() + "-Coop Extension";

                            if (userDataReader["InterNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = Int32.Parse(userDataReader["InterNRCS"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = nrcsTotalCount + Int32.Parse(userDataReader["ExtNRCS"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = nrcsTotalCount + Int32.Parse(userDataReader["MultiNRCS"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (nrcsTotalCount > 0)
                            FieldDayPart = FieldDayPart + "\n" + nrcsTotalCount.ToString() + "-NRCS";

                            if (userDataReader["InterNGO"].ToString() != "0")
                            {
                                ngoTotalCount = Int32.Parse(userDataReader["InterNGO"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtNGO"].ToString() != "0")
                            {
                                ngoTotalCount = ngoTotalCount + Int32.Parse(userDataReader["ExtNGO"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiNGO"].ToString() != "0")
                            {
                                ngoTotalCount = ngoTotalCount + Int32.Parse(userDataReader["MultiNGO"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (ngoTotalCount > 0)
                            FieldDayPart = FieldDayPart + "\n" + ngoTotalCount.ToString() + "-NGO";

                            if (userDataReader["InterST"].ToString() != "0")
                            {
                                stTotalCount = Int32.Parse(userDataReader["InterST"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtST"].ToString() != "0")
                            {
                                stTotalCount = stTotalCount + Int32.Parse(userDataReader["ExtST"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiST"].ToString() != "0")
                            {
                                stTotalCount = stTotalCount + Int32.Parse(userDataReader["MultiST"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (stTotalCount > 0)
                            FieldDayPart = FieldDayPart + "\n" + stTotalCount.ToString() + "-State/Federal/Tribal Agency";


                            if (userDataReader["InterFarm"].ToString() != "0")
                            {
                                farmTotalCount = Int32.Parse(userDataReader["InterFarm"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtFarm"].ToString() != "0")
                            {
                                farmTotalCount = farmTotalCount + Int32.Parse(userDataReader["ExtFarm"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiFarm"].ToString() != "0")
                            {
                                farmTotalCount = farmTotalCount + Int32.Parse(userDataReader["MultiFarm"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (farmTotalCount > 0)
                            FieldDayPart = FieldDayPart + "\n" + farmTotalCount.ToString() + "-Farmer/Rancher";

                            if (userDataReader["InterPro"].ToString() != "0")
                            {
                                proTotalCount = Int32.Parse(userDataReader["InterPro"].ToString());
                                if (single == false)
                                    single = true;
                            }
                            if (userDataReader["ExtPro"].ToString() != "0")
                            {
                                proTotalCount = proTotalCount + Int32.Parse(userDataReader["ExtPro"].ToString());
                                if (extend == false)
                                    extend = true;
                            }
                            if (userDataReader["MultiPro"].ToString() != "0")
                            {
                                proTotalCount = proTotalCount + Int32.Parse(userDataReader["MultiPro"].ToString());
                                if (multi == false)
                                    multi = true;
                            }
                            //if (proTotalCount > 0)
                            FieldDayPart = FieldDayPart + "\n" + proTotalCount.ToString() + "-For Profit";

                            if (single == true)
                                FieldDay = FieldDay + "\n" + " Single Field Day/Tour";
                            else if (multi == true)
                                FieldDay = FieldDay + "\n" + " Multiday Field Day/Tour(>1day)";
                            else if (extend == true)
                                FieldDay = FieldDay + "\n" + " Extended Multiday Field Day/Tour";

                            int mediaCount = Int32.Parse(userDataReader["InterMedia"].ToString()) + Int32.Parse(userDataReader["MultiMedia"].ToString()) + Int32.Parse(userDataReader["ExtMedia"].ToString());
                            FieldDayOutcomes = mediaCount.ToString() + "-used in newsletters or other media";

                            int clientTotal = Int32.Parse(userDataReader["InterClient"].ToString()) + Int32.Parse(userDataReader["MultiClient"].ToString()) + Int32.Parse(userDataReader["ExtClient"].ToString());
                            FieldDayOutcomes = FieldDayOutcomes + "\n" + clientTotal.ToString() + "-answered client questions";

                            int develCount = Int32.Parse(userDataReader["InterDevel"].ToString()) + Int32.Parse(userDataReader["MultiDevel"].ToString()) + Int32.Parse(userDataReader["ExtDevel"].ToString());
                            FieldDayOutcomes = FieldDayOutcomes + "\n" + develCount.ToString() + "-developed  new contacts";


                            int incorpCount = Int32.Parse(userDataReader["InterIncorp"].ToString()) + Int32.Parse(userDataReader["MultiIncorp"].ToString()) + Int32.Parse(userDataReader["ExtIncorp"].ToString());
                            FieldDayOutcomes = FieldDayOutcomes + "\n" + incorpCount.ToString() + "-incorporated into programming";


                            int progCount = Int32.Parse(userDataReader["InterProg"].ToString()) + Int32.Parse(userDataReader["MultiProg"].ToString()) + Int32.Parse(userDataReader["ExtProg"].ToString());
                            FieldDayOutcomes = FieldDayOutcomes + "\n" + progCount.ToString() + "-delivered new programming";

                            int consultCount = Int32.Parse(userDataReader["InterConsult"].ToString()) + Int32.Parse(userDataReader["MultiConsult"].ToString()) + Int32.Parse(userDataReader["ExtConsult"].ToString());
                            FieldDayOutcomes = FieldDayOutcomes + "\n" + consultCount.ToString() + "-individual consultation";

                            int farmersCount = Int32.Parse(userDataReader["InterFarmers"].ToString()) + Int32.Parse(userDataReader["MultiFarmers"].ToString()) + Int32.Parse(userDataReader["ExtFarmers"].ToString());
                            FieldDayOutcomes = FieldDayOutcomes + "\n" + farmersCount.ToString() + "-number of farmers reached";

                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            FieldDay1 = FieldDay;
                            FieldDay1Part = FieldDayPart;
                            FieldDay1Outcomes = FieldDayOutcomes;
                            //FieldDay1Outputs = FieldDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            FieldDay2 = FieldDay;
                            FieldDay2Part = FieldDayPart;
                            FieldDay2Outcomes = FieldDayOutcomes;
                            //FieldDay2Outputs = FieldDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "2")
                        {
                            FieldDay3 = FieldDay;
                            FieldDay3Part = FieldDayPart;
                            FieldDay3Outcomes = FieldDayOutcomes;
                            //FieldDay3Outputs = FieldDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "3")
                        {
                            FieldDay4 = FieldDay;
                            FieldDay4Part = FieldDayPart;
                            FieldDay4Outcomes = FieldDayOutcomes;
                            //FieldDay4Outputs = FieldDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "4")
                        {
                            FieldDay5 = FieldDay;
                            FieldDay5Part = FieldDayPart;
                            FieldDay5Outcomes = FieldDayOutcomes;
                            //FieldDay5Outputs = FieldDayOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "5")
                        {
                            FieldDay6 = FieldDay;
                            FieldDay6Part = FieldDayPart;
                            FieldDay6Outcomes = FieldDayOutcomes;
                            //FieldDay6Outputs = FieldDayOutputs;

                        }

                        //reset field data for next row
                        FieldDay = "";
                        FieldDayPart = "";
                        FieldDayOutcomes = "";
                        //FieldDayOutputs = "";

                    }

                    userDataReader.NextResult();

                    //Mini-Grant Activities
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            Minigrant = "Curricula";//userDataReader["Title"].ToString();
                        }

                        // Workshops Day/Tours Activity - 1
                        if (Minigrant != "")
                        {
                            int extTotalCount = 0;
                            int ngoTotalCount = 0;
                            int stTotalCount = 0;
                            int nrcsTotalCount = 0;
                            int farmTotalCount = 0;
                            int proTotalCount = 0;
                            bool demo = false;
                            bool work = false;
                            bool tour = false;
                            bool cur = false;

                            if (userDataReader["DemoExt"].ToString() != "0")
                            {
                                extTotalCount = Int32.Parse(userDataReader["DemoExt"].ToString());
                                demo = true;
                            }
                            if (userDataReader["WorkExt"].ToString() != "0")
                            {
                                extTotalCount = Int32.Parse(userDataReader["WorkExt"].ToString());
                                work = true;
                            }
                            if (userDataReader["CurExt"].ToString() != "0")
                            {
                                extTotalCount = extTotalCount + Int32.Parse(userDataReader["CurExt"].ToString());
                                cur = true;
                            }
                            if (userDataReader["TourExt"].ToString() != "0")
                            {
                                extTotalCount = extTotalCount + Int32.Parse(userDataReader["TourExt"].ToString());
                                tour = true;
                            }
                            //if (extTotalCount > 0)
                            MinigrantPart = extTotalCount.ToString() + "-Coop Extension";

                            if (userDataReader["DemoNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = Int32.Parse(userDataReader["DemoNRCS"].ToString());
                                if (demo == false)
                                    demo = true;
                            }
                            if (userDataReader["WorkNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = Int32.Parse(userDataReader["WorkNRCS"].ToString());
                                if (work == false)
                                    work = true;
                            }
                            if (userDataReader["CurNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = nrcsTotalCount + Int32.Parse(userDataReader["CurNRCS"].ToString());
                                if (cur == false)
                                    cur = true;
                            }
                            if (userDataReader["TourNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = nrcsTotalCount + Int32.Parse(userDataReader["TourNRCS"].ToString());
                                if (tour == false)
                                    tour = true;
                            }
                            //if (nrcsTotalCount > 0)
                            MinigrantPart = MinigrantPart + "\n" + nrcsTotalCount.ToString() + "-NRCS";

                            if (userDataReader["DemoNGO"].ToString() != "0")
                            {
                                ngoTotalCount = Int32.Parse(userDataReader["DemoNGO"].ToString());
                                if (demo == false)
                                    demo = true;
                            }
                            if (userDataReader["WorkNGO"].ToString() != "0")
                            {
                                ngoTotalCount = Int32.Parse(userDataReader["WorkNGO"].ToString());
                                if (work == false)
                                    work = true;
                            }
                            if (userDataReader["CurNGO"].ToString() != "0")
                            {
                                ngoTotalCount = ngoTotalCount + Int32.Parse(userDataReader["CurNGO"].ToString());
                                if (cur == false)
                                    cur = true;
                            }
                            if (userDataReader["TourNGO"].ToString() != "0")
                            {
                                ngoTotalCount = ngoTotalCount + Int32.Parse(userDataReader["TourNGO"].ToString());
                                if (tour == false)
                                    tour = true;
                            }
                            //if (ngoTotalCount > 0)
                            MinigrantPart = MinigrantPart + "\n" + ngoTotalCount.ToString() + "-NGO";

                            if (userDataReader["DemoST"].ToString() != "0")
                            {
                                stTotalCount = Int32.Parse(userDataReader["DemoST"].ToString());
                                if (demo == false)
                                    demo = true;
                            }
                            if (userDataReader["WorkST"].ToString() != "0")
                            {
                                stTotalCount = Int32.Parse(userDataReader["WorkST"].ToString());
                                if (work == false)
                                    work = true;
                            }
                            if (userDataReader["CurST"].ToString() != "0")
                            {
                                stTotalCount = stTotalCount + Int32.Parse(userDataReader["CurST"].ToString());
                                if (cur == false)
                                    cur = true;
                            }
                            if (userDataReader["TourST"].ToString() != "0")
                            {
                                stTotalCount = stTotalCount + Int32.Parse(userDataReader["TourST"].ToString());
                                if (tour == false)
                                    tour = true;
                            }
                            //if (stTotalCount > 0)
                            MinigrantPart = MinigrantPart + "\n" + stTotalCount.ToString() + "-State/Federal/Tribal Agency";


                            if (userDataReader["DemoFarm"].ToString() != "0")
                            {
                                farmTotalCount = Int32.Parse(userDataReader["DemoFarm"].ToString());
                                if (demo == false)
                                    demo = true;
                            }
                            if (userDataReader["WorkFarm"].ToString() != "0")
                            {
                                farmTotalCount = Int32.Parse(userDataReader["WorkFarm"].ToString());
                                if (work == false)
                                    work = true;
                            }
                            if (userDataReader["CurFarm"].ToString() != "0")
                            {
                                farmTotalCount = farmTotalCount + Int32.Parse(userDataReader["CurFarm"].ToString());
                                if (cur == false)
                                    cur = true;
                            }
                            if (userDataReader["TourFarm"].ToString() != "0")
                            {
                                farmTotalCount = farmTotalCount + Int32.Parse(userDataReader["TourFarm"].ToString());
                                if (tour == false)
                                    tour = true;
                            }
                            //if (farmTotalCount > 0)
                            MinigrantPart = MinigrantPart + "\n" + farmTotalCount.ToString() + "-Farmer/Rancher";

                            if (userDataReader["DemoPro"].ToString() != "0")
                            {
                                proTotalCount = Int32.Parse(userDataReader["DemoPro"].ToString());
                                if (demo == false)
                                    demo = true;
                            }
                            if (userDataReader["WorkPro"].ToString() != "0")
                            {
                                proTotalCount = Int32.Parse(userDataReader["WorkPro"].ToString());
                                if (work == false)
                                    work = true;
                            }
                            if (userDataReader["CurPro"].ToString() != "0")
                            {
                                proTotalCount = proTotalCount + Int32.Parse(userDataReader["CurPro"].ToString());
                                if (cur == false)
                                    cur = true;
                            }
                            if (userDataReader["TourPro"].ToString() != "0")
                            {
                                proTotalCount = proTotalCount + Int32.Parse(userDataReader["TourPro"].ToString());
                                if (tour == false)
                                    tour = true;
                            }
                            //if (proTotalCount > 0)
                            MinigrantPart = MinigrantPart + "\n" + proTotalCount.ToString() + "-For Profit";

                            if (demo == true)
                                Minigrant = Minigrant + "\n" + " Web-based ";//" Demonstration ";
                            else if (work == true)
                                Minigrant = Minigrant + "\n" + " Print-based ";//" Workshop";
                            else if (tour == true)
                                Minigrant = Minigrant + "\n" + " Tour";
                            else if (cur == true)
                                Minigrant = Minigrant + "\n" + " Curriculum Development";

                            int mediaCount = Int32.Parse(userDataReader["DemoMedia"].ToString()) + Int32.Parse(userDataReader["WorkMedia"].ToString()) + Int32.Parse(userDataReader["TourMedia"].ToString()) + Int32.Parse(userDataReader["CurMedia"].ToString());
                            MinigrantOutcomes = mediaCount.ToString() + "-used in newsletters or other media";

                            int clientTotal = Int32.Parse(userDataReader["DemoClient"].ToString()) + Int32.Parse(userDataReader["WorkClient"].ToString()) + Int32.Parse(userDataReader["TourClient"].ToString()) + Int32.Parse(userDataReader["CurClient"].ToString());
                            MinigrantOutcomes = MinigrantOutcomes + "\n" + clientTotal.ToString() + "-answered client questions";

                            int develCount = Int32.Parse(userDataReader["DemoDevel"].ToString()) + Int32.Parse(userDataReader["WorkDevel"].ToString()) + Int32.Parse(userDataReader["TourDevel"].ToString()) + Int32.Parse(userDataReader["CurDevel"].ToString());
                            MinigrantOutcomes = MinigrantOutcomes + "\n" + develCount.ToString() + "-developed  new contacts";

                            int incorpCount = Int32.Parse(userDataReader["DemoIncorp"].ToString()) + Int32.Parse(userDataReader["WorkIncorp"].ToString()) + Int32.Parse(userDataReader["TourIncorp"].ToString()) + Int32.Parse(userDataReader["CurIncorp"].ToString());
                            MinigrantOutcomes = MinigrantOutcomes + "\n" + incorpCount.ToString() + "-incorporated into programming";

                            int progCount = Int32.Parse(userDataReader["DemoProg"].ToString()) + Int32.Parse(userDataReader["WorkProg"].ToString()) + Int32.Parse(userDataReader["TourProg"].ToString()) + Int32.Parse(userDataReader["CurProg"].ToString());
                            MinigrantOutcomes = MinigrantOutcomes + "\n" + progCount.ToString() + "-delivered new programming";

                            int consultCount = Int32.Parse(userDataReader["DemoConsult"].ToString()) + Int32.Parse(userDataReader["WorkConsult"].ToString()) + Int32.Parse(userDataReader["TourConsult"].ToString()) + Int32.Parse(userDataReader["CurConsult"].ToString());
                            MinigrantOutcomes = MinigrantOutcomes + "\n" + consultCount.ToString() + "-individual consultation";

                            int farmersCount = Int32.Parse(userDataReader["DemoFarmers"].ToString()) + Int32.Parse(userDataReader["WorkFarmers"].ToString()) + Int32.Parse(userDataReader["TourFarmers"].ToString()) + Int32.Parse(userDataReader["CurFarmers"].ToString());
                            MinigrantOutcomes = MinigrantOutcomes + "\n" + farmersCount.ToString() + "-number of farmers reached";

                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            Minigrant1 = Minigrant;
                            Minigrant1Part = MinigrantPart;
                            Minigrant1Outcomes = MinigrantOutcomes;
                            //Minigrant1Outputs = MinigrantOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            Minigrant2 = Minigrant;
                            Minigrant2Part = MinigrantPart;
                            Minigrant2Outcomes = MinigrantOutcomes;
                            //Minigrant2Outputs = MinigrantOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "2")
                        {
                            Minigrant3 = Minigrant;
                            Minigrant3Part = MinigrantPart;
                            Minigrant3Outcomes = MinigrantOutcomes;
                            //Minigrant3Outputs = MinigrantOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "3")
                        {
                            Minigrant4 = Minigrant;
                            Minigrant4Part = MinigrantPart;
                            Minigrant4Outcomes = MinigrantOutcomes;
                            //Minigrant4Outputs = MinigrantOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "4")
                        {
                            Minigrant5 = Minigrant;
                            Minigrant5Part = MinigrantPart;
                            Minigrant5Outcomes = MinigrantOutcomes;
                            //Minigrant5Outputs = MinigrantOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "5")
                        {
                            Minigrant6 = Minigrant;
                            Minigrant6Part = MinigrantPart;
                            Minigrant6Outcomes = MinigrantOutcomes;
                            //Minigrant6Outputs = MinigrantOutputs;

                        }

                        //reset Workshops data for next row
                        Minigrant = "";
                        MinigrantPart = "";
                        MinigrantOutcomes = "";
                        //MinigrantOutputs = "";
                    }

                    userDataReader.NextResult();

                    // Study Circle Activities
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            Study = userDataReader["Title"].ToString();
                        }

                        // Study Circle Activity - 1
                        if (Study != "")
                        {
                            int extTotalCount = 0;
                            int ngoTotalCount = 0;
                            int stTotalCount = 0;
                            int nrcsTotalCount = 0;
                            int farmTotalCount = 0;
                            int proTotalCount = 0;
                            bool studyFlag = false;


                            if (userDataReader["StudyExt"].ToString() != "0")
                            {
                                extTotalCount = Int32.Parse(userDataReader["StudyExt"].ToString());
                                studyFlag = true;
                            }
                            if (extTotalCount > 0)
                                StudyPart = extTotalCount.ToString() + "-Coop Extension";

                            if (userDataReader["StudyNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = Int32.Parse(userDataReader["StudyNRCS"].ToString());
                                if (studyFlag == false)
                                    studyFlag = true;
                            }
                            //if (nrcsTotalCount > 0)
                            StudyPart = StudyPart + "\n" + nrcsTotalCount.ToString() + "-NRCS";

                            if (userDataReader["StudyNGO"].ToString() != "0")
                            {
                                ngoTotalCount = Int32.Parse(userDataReader["StudyNGO"].ToString());
                                if (studyFlag == false)
                                    studyFlag = true;
                            }
                            //if (ngoTotalCount > 0)
                            StudyPart = StudyPart + "\n" + ngoTotalCount.ToString() + "-NGO";

                            if (userDataReader["StudyST"].ToString() != "0")
                            {
                                stTotalCount = Int32.Parse(userDataReader["StudyST"].ToString());
                                if (studyFlag == false)
                                    studyFlag = true;
                            }
                            //if (stTotalCount > 0)
                            StudyPart = StudyPart + "\n" + stTotalCount.ToString() + "-State/Federal/Tribal Agency";


                            if (userDataReader["StudyFarm"].ToString() != "0")
                            {
                                farmTotalCount = Int32.Parse(userDataReader["StudyFarm"].ToString());
                                if (studyFlag == false)
                                    studyFlag = true;
                            }
                            //if (farmTotalCount > 0)
                            StudyPart = StudyPart + "\n" + farmTotalCount.ToString() + "-Farmer/Rancher";

                            if (userDataReader["StudyPro"].ToString() != "0")
                            {
                                proTotalCount = Int32.Parse(userDataReader["StudyPro"].ToString());
                                if (studyFlag == false)
                                    studyFlag = true;
                            }
                            //if (proTotalCount > 0)
                            StudyPart = StudyPart + "\n" + proTotalCount.ToString() + "-For Profit";

                            if (studyFlag == true)
                                Study = Study + "\n" + " study focus group";
                            else
                                Study = Study + "\n";

                            int mediaCount = Int32.Parse(userDataReader["StudyMedia"].ToString());
                            StudyOutcomes = mediaCount.ToString() + "-used in newsletters or other media";

                            int clientTotal = Int32.Parse(userDataReader["StudyClient"].ToString());
                            StudyOutcomes = StudyOutcomes + "\n" + clientTotal.ToString() + "-answered client questions";

                            int develCount = Int32.Parse(userDataReader["StudyDevel"].ToString());
                            StudyOutcomes = StudyOutcomes + "\n" + develCount.ToString() + "-developed  new contacts";

                            int incorpCount = Int32.Parse(userDataReader["StudyIncorp"].ToString());
                            StudyOutcomes = StudyOutcomes + "\n" + incorpCount.ToString() + "-incorporated into programming";

                            int progCount = Int32.Parse(userDataReader["StudyProg"].ToString());
                            StudyOutcomes = StudyOutcomes + "\n" + progCount.ToString() + "-delivered new programming";

                            int consultCount = Int32.Parse(userDataReader["StudyConsult"].ToString());
                            StudyOutcomes = StudyOutcomes + "\n" + consultCount.ToString() + "-individual consultation";

                            int farmersCount = Int32.Parse(userDataReader["StudyFarmers"].ToString());
                            StudyOutcomes = StudyOutcomes + "\n" + farmersCount.ToString() + "-number of farmers reached";

                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            Study1 = Study;
                            Study1Part = StudyPart;
                            Study1Outcomes = StudyOutcomes;
                            Study1Outputs = StudyOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            Study2 = Study;
                            Study2Part = StudyPart;
                            Study2Outcomes = StudyOutcomes;
                            Study2Outputs = StudyOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "2")
                        {
                            Study3 = Study;
                            Study3Part = StudyPart;
                            Study3Outcomes = StudyOutcomes;
                            Study3Outputs = StudyOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "3")
                        {
                            Study4 = Study;
                            Study4Part = StudyPart;
                            Study4Outcomes = StudyOutcomes;
                            Study4Outputs = StudyOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "4")
                        {
                            Study5 = Study;
                            Study5Part = StudyPart;
                            Study5Outcomes = StudyOutcomes;
                            Study5Outputs = StudyOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "5")
                        {
                            Study6 = Study;
                            Study6Part = StudyPart;
                            Study6Outcomes = StudyOutcomes;
                            Study6Outputs = StudyOutputs;

                        }

                        //reset study data for next row
                        Study = "";
                        StudyPart = "";
                        StudyOutcomes = "";
                        StudyOutputs = "";
                    }

                    userDataReader.NextResult();

                    //Travel Activities
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            Travel = userDataReader["Title"].ToString();
                        }

                        // Travel Circle Activity - 1
                        if (Travel != "")
                        {
                            int extTotalCount = 0;
                            int ngoTotalCount = 0;
                            int stTotalCount = 0;
                            int nrcsTotalCount = 0;
                            int farmTotalCount = 0;
                            int proTotalCount = 0;
                            bool travelFlag = false;


                            if (userDataReader["TravelExt"].ToString() != "0")
                            {
                                extTotalCount = Int32.Parse(userDataReader["TravelExt"].ToString());
                                travelFlag = true;
                            }
                            //if (extTotalCount > 0)
                            TravelPart = extTotalCount.ToString() + "-Coop Extension";

                            if (userDataReader["TravelNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = Int32.Parse(userDataReader["TravelNRCS"].ToString());
                                if (travelFlag == false)
                                    travelFlag = true;
                            }
                            //if (nrcsTotalCount > 0)
                            TravelPart = TravelPart + "\n" + nrcsTotalCount.ToString() + "-NRCS";


                            if (userDataReader["TravelNGO"].ToString() != "0")
                            {
                                ngoTotalCount = Int32.Parse(userDataReader["TravelNGO"].ToString());
                                if (travelFlag == false)
                                    travelFlag = true;
                            }
                            //if (ngoTotalCount > 0)
                            TravelPart = TravelPart + "\n" + ngoTotalCount.ToString() + "-NGO";

                            if (userDataReader["TravelST"].ToString() != "0")
                            {
                                stTotalCount = Int32.Parse(userDataReader["TravelST"].ToString());
                                if (travelFlag == false)
                                    travelFlag = true;
                            }
                            //if (stTotalCount > 0)
                            TravelPart = TravelPart + "\n" + stTotalCount.ToString() + "-State/Federal/Tribal Agency";



                            if (userDataReader["TravelFarm"].ToString() != "0")
                            {
                                farmTotalCount = Int32.Parse(userDataReader["TravelFarm"].ToString());
                                if (travelFlag == false)
                                    travelFlag = true;
                            }
                            //if (farmTotalCount > 0)
                            TravelPart = TravelPart + "\n" + farmTotalCount.ToString() + "-Farmer/Rancher";

                            if (userDataReader["TravelPro"].ToString() != "0")
                            {
                                proTotalCount = Int32.Parse(userDataReader["TravelPro"].ToString());
                                if (travelFlag == false)
                                    travelFlag = true;
                            }
                            //if (proTotalCount > 0)
                            TravelPart = TravelPart + "\n" + proTotalCount.ToString() + "-For Profit";

                            if (travelFlag == true)
                                Travel = Travel + "\n" + " scholarships";
                            else
                                Travel = Travel + "\n";

                            int mediaCount = Int32.Parse(userDataReader["TravelMedia"].ToString());
                            TravelOutcomes = mediaCount.ToString() + "-used in newsletters or other media";

                            int clientTotal = Int32.Parse(userDataReader["TravelClient"].ToString());
                            TravelOutcomes = TravelOutcomes + "\n" + clientTotal.ToString() + "-answered client questions";

                            int develCount = Int32.Parse(userDataReader["TravelDevel"].ToString());
                            TravelOutcomes = TravelOutcomes + "\n" + develCount.ToString() + "-developed  new contacts";

                            int incorpCount = Int32.Parse(userDataReader["TravelIncorp"].ToString());
                            TravelOutcomes = TravelOutcomes + "\n" + incorpCount.ToString() + "-incorporated into programming";

                            int progCount = Int32.Parse(userDataReader["TravelProg"].ToString());
                            TravelOutcomes = TravelOutcomes + "\n" + progCount.ToString() + "-delivered new programming";

                            int consultCount = Int32.Parse(userDataReader["TravelConsult"].ToString());
                            TravelOutcomes = TravelOutcomes + "\n" + consultCount.ToString() + "-individual consultation";

                            int farmersCount = Int32.Parse(userDataReader["TravelFarmers"].ToString());
                            TravelOutcomes = TravelOutcomes + "\n" + farmersCount.ToString() + "-number of farmers reached";

                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            Travel1 = Travel;
                            Travel1Part = TravelPart;
                            Travel1Outcomes = TravelOutcomes;
                            Travel1Outputs = TravelOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            Travel2 = Travel;
                            Travel2Part = TravelPart;
                            Travel2Outcomes = TravelOutcomes;
                            Travel2Outputs = TravelOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "2")
                        {
                            Travel3 = Travel;
                            Travel3Part = TravelPart;
                            Travel3Outcomes = TravelOutcomes;
                            Travel3Outputs = TravelOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "3")
                        {
                            Travel4 = Travel;
                            Travel4Part = TravelPart;
                            Travel4Outcomes = TravelOutcomes;
                            Travel4Outputs = TravelOutputs;
                        }

                        if (userDataReader["initiative_num"].ToString() == "4")
                        {
                            Travel5 = Travel;
                            Travel5Part = TravelPart;
                            Travel5Outcomes = TravelOutcomes;
                            Travel5Outputs = TravelOutputs;
                        }

                        if (userDataReader["initiative_num"].ToString() == "5")
                        {
                            Travel6 = Travel;
                            Travel6Part = TravelPart;
                            Travel6Outcomes = TravelOutcomes;
                            Travel6Outputs = TravelOutputs;
                        }

                        //reset Workshops data for next row
                        Travel = "";
                        TravelPart = "";
                        TravelOutcomes = "";
                        TravelOutputs = "";
                    }

                    userDataReader.NextResult();

                    //Webinars Activities
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            Web = userDataReader["Title"].ToString();
                        }

                        // Web Circle Activity - 1
                        if (Web != "")
                        {
                            int extTotalCount = 0;
                            int ngoTotalCount = 0;
                            int stTotalCount = 0;
                            int nrcsTotalCount = 0;
                            int farmTotalCount = 0;
                            int proTotalCount = 0;
                            bool webFlag = false;


                            //if (userDataReader["WebExt"].ToString() != "0")
                            //{
                            extTotalCount = Int32.Parse(userDataReader["WebExt"].ToString()) + Int32.Parse(userDataReader["WebSeriesExt"].ToString());
                            //    webFlag = true;
                            //}
                            //if (extTotalCount > 0)
                            WebPart = extTotalCount.ToString() + "-Coop Extension";

                            //if (userDataReader["WebNRCS"].ToString() != "0")
                            //{
                            nrcsTotalCount = Int32.Parse(userDataReader["WebNRCS"].ToString()) + Int32.Parse(userDataReader["WebSeriesNRCS"].ToString());
                            //    if (webFlag == false)
                            //        webFlag = true;
                            // }
                            //if (nrcsTotalCount > 0)
                            WebPart = WebPart + "\n" + nrcsTotalCount.ToString() + "-NRCS";

                            //if (userDataReader["WebNGO"].ToString() != "0")
                            // {
                            ngoTotalCount = Int32.Parse(userDataReader["WebNGO"].ToString()) + Int32.Parse(userDataReader["WebSeriesNGO"].ToString());
                            //    if (webFlag == false)
                            //        webFlag = true;
                            //}
                            //if (ngoTotalCount > 0)
                            WebPart = WebPart + "\n" + ngoTotalCount.ToString() + "-NGO";

                            //if (userDataReader["WebST"].ToString() != "0")
                            //{
                            stTotalCount = Int32.Parse(userDataReader["WebST"].ToString()) + Int32.Parse(userDataReader["WebSeriesST"].ToString());
                            //   if (webFlag == false)
                            //       webFlag = true;
                            //}
                            //if (stTotalCount > 0)
                            WebPart = WebPart + "\n" + stTotalCount.ToString() + "-State/Federal/Tribal Agency";




                            //if (userDataReader["WebFarm"].ToString() != "0")
                            //{
                            farmTotalCount = Int32.Parse(userDataReader["WebFarm"].ToString()) + Int32.Parse(userDataReader["WebSeriesFarm"].ToString());
                            //    if (webFlag == false)
                            //       webFlag = true;
                            //}
                            //if (farmTotalCount > 0)
                            WebPart = WebPart + "\n" + farmTotalCount.ToString() + "-Farmer/Rancher";

                            //if (userDataReader["WebPro"].ToString() != "0")
                            //{
                            proTotalCount = Int32.Parse(userDataReader["WebPro"].ToString()) + Int32.Parse(userDataReader["WebSeriesPro"].ToString());
                            //    if (webFlag == false)
                            //        webFlag = true;
                            //}
                            //if (proTotalCount > 0)
                            WebPart = WebPart + "\n" + proTotalCount.ToString() + "-For Profit";

                            if (webFlag == true)
                                Web = Web + "\n" + " series";
                            else
                                Web = Web + "\n";

                            int mediaCount = Int32.Parse(userDataReader["WebMedia"].ToString()) + Int32.Parse(userDataReader["WebSeriesMedia"].ToString());
                            WebOutcomes = mediaCount.ToString() + "-used in newsletters or other media";

                            int clientTotal = Int32.Parse(userDataReader["WebClient"].ToString()) + Int32.Parse(userDataReader["WebSeriesClient"].ToString());
                            WebOutcomes = WebOutcomes + "\n" + clientTotal.ToString() + "-answered client questions";

                            int develCount = Int32.Parse(userDataReader["WebDevel"].ToString()) + Int32.Parse(userDataReader["WebSeriesDevel"].ToString());
                            WebOutcomes = WebOutcomes + "\n" + develCount.ToString() + "-developed  new contacts";

                            int incorpCount = Int32.Parse(userDataReader["WebIncorp"].ToString()) + Int32.Parse(userDataReader["WebSeriesIncorp"].ToString());
                            WebOutcomes = WebOutcomes + "\n" + incorpCount.ToString() + "-incorporated into programming";

                            int progCount = Int32.Parse(userDataReader["WebProg"].ToString()) + Int32.Parse(userDataReader["WebSeriesProg"].ToString());
                            WebOutcomes = WebOutcomes + "\n" + progCount.ToString() + "-delivered new programming";

                            int consultCount = Int32.Parse(userDataReader["WebConsult"].ToString()) + Int32.Parse(userDataReader["WebSeriesConsult"].ToString());
                            WebOutcomes = WebOutcomes + "\n" + consultCount.ToString() + "-individual consultation";

                            int farmersCount = Int32.Parse(userDataReader["WebFarmers"].ToString()) + Int32.Parse(userDataReader["WebSeriesFarmers"].ToString());
                            WebOutcomes = WebOutcomes + "\n" + farmersCount.ToString() + "-number of farmers reached";

                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            Web1 = Web;
                            Web1Part = WebPart;
                            Web1Outcomes = WebOutcomes;
                            Web1Outputs = WebOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            Web2 = Web;
                            Web2Part = WebPart;
                            Web2Outcomes = WebOutcomes;
                            Web2Outputs = WebOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "2")
                        {
                            Web3 = Web;
                            Web3Part = WebPart;
                            Web3Outcomes = WebOutcomes;
                            Web3Outputs = WebOutputs;
                        }

                        if (userDataReader["initiative_num"].ToString() == "3")
                        {
                            Web4 = Web;
                            Web4Part = WebPart;
                            Web4Outcomes = WebOutcomes;
                            Web4Outputs = WebOutputs;
                        }

                        if (userDataReader["initiative_num"].ToString() == "4")
                        {
                            Web5 = Web;
                            Web5Part = WebPart;
                            Web5Outcomes = WebOutcomes;
                            Web5Outputs = WebOutputs;
                        }

                        if (userDataReader["initiative_num"].ToString() == "5")
                        {
                            Web6 = Web;
                            Web6Part = WebPart;
                            Web6Outcomes = WebOutcomes;
                            Web6Outputs = WebOutputs;
                        }

                        //reset Workshops data for next row
                        Web = "";
                        WebPart = "";
                        WebOutcomes = "";
                        WebOutputs = "";
                    }
                    userDataReader.NextResult();

                    //Other Activities
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            Other = userDataReader["Title"].ToString();
                        }

                        // Other Circle Activity - 1
                        if (Other != "")
                        {
                            int extTotalCount = 0;
                            int ngoTotalCount = 0;
                            int stTotalCount = 0;
                            int nrcsTotalCount = 0;
                            int farmTotalCount = 0;
                            int proTotalCount = 0;
                            bool otherFlag = false;


                            if (userDataReader["OtherExt"].ToString() != "0")
                            {
                                extTotalCount = Int32.Parse(userDataReader["OtherExt"].ToString());
                                otherFlag = true;
                            }
                            //if (extTotalCount > 0)
                            OtherPart = extTotalCount.ToString() + "-Coop Extension";

                            if (userDataReader["OtherNRCS"].ToString() != "0")
                            {
                                nrcsTotalCount = Int32.Parse(userDataReader["OtherNRCS"].ToString());
                                if (otherFlag == false)
                                    otherFlag = true;
                            }
                            //if (nrcsTotalCount > 0)
                            OtherPart = OtherPart + "\n" + nrcsTotalCount.ToString() + "-NRCS";

                            if (userDataReader["OtherNGO"].ToString() != "0")
                            {
                                ngoTotalCount = Int32.Parse(userDataReader["OtherNGO"].ToString());
                                if (otherFlag == false)
                                    otherFlag = true;
                            }
                            //if (ngoTotalCount > 0)
                            OtherPart = OtherPart + "\n" + ngoTotalCount.ToString() + "-NGO";

                            if (userDataReader["OtherST"].ToString() != "0")
                            {
                                stTotalCount = Int32.Parse(userDataReader["OtherST"].ToString());
                                if (otherFlag == false)
                                    otherFlag = true;
                            }
                            //if (stTotalCount > 0)
                            OtherPart = OtherPart + "\n" + stTotalCount.ToString() + "-State/Federal/Tribal Agency";




                            if (userDataReader["OtherFarm"].ToString() != "0")
                            {
                                farmTotalCount = Int32.Parse(userDataReader["OtherFarm"].ToString());
                                if (otherFlag == false)
                                    otherFlag = true;
                            }
                            //if (farmTotalCount > 0)
                            OtherPart = OtherPart + "\n" + farmTotalCount.ToString() + "-Farmer/Rancher";

                            if (userDataReader["OtherPro"].ToString() != "0")
                            {
                                proTotalCount = Int32.Parse(userDataReader["OtherPro"].ToString());
                                if (otherFlag == false)
                                    otherFlag = true;
                            }
                            //if (proTotalCount > 0)
                            OtherPart = OtherPart + "\n" + proTotalCount.ToString() + "-For Profit";

                            if (otherFlag == true)
                                Other = Other + "\n" + " others";
                            else
                                Other = Other + "\n";

                            int mediaCount = Int32.Parse(userDataReader["OtherMedia"].ToString());
                            OtherOutcomes = mediaCount.ToString() + "-used in newsletters or other media";

                            int clientTotal = Int32.Parse(userDataReader["OtherClient"].ToString());
                            OtherOutcomes = OtherOutcomes + "\n" + clientTotal.ToString() + "-answered client questions";

                            int develCount = Int32.Parse(userDataReader["OtherDevel"].ToString());
                            OtherOutcomes = OtherOutcomes + "\n" + develCount.ToString() + "-developed  new contacts";

                            int incorpCount = Int32.Parse(userDataReader["OtherIncorp"].ToString());
                            OtherOutcomes = OtherOutcomes + "\n" + incorpCount.ToString() + "-incorporated into programming";

                            int progCount = Int32.Parse(userDataReader["OtherProg"].ToString());
                            OtherOutcomes = OtherOutcomes + "\n" + progCount.ToString() + "-delivered new programming";

                            int consultCount = Int32.Parse(userDataReader["OtherConsult"].ToString());
                            OtherOutcomes = OtherOutcomes + "\n" + consultCount.ToString() + "-individual consultation";

                            int farmersCount = Int32.Parse(userDataReader["OtherFarmers"].ToString());
                            OtherOutcomes = OtherOutcomes + "\n" + farmersCount.ToString() + "-number of farmers reached";

                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            Other1 = Other;
                            Other1Part = OtherPart;
                            Other1Outcomes = OtherOutcomes;
                            Other1Outputs = OtherOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            Other2 = Other;
                            Other2Part = OtherPart;
                            Other2Outcomes = OtherOutcomes;
                            Other2Outputs = OtherOutputs;

                        }

                        if (userDataReader["initiative_num"].ToString() == "2")
                        {
                            Other3 = Other;
                            Other3Part = OtherPart;
                            Other3Outcomes = OtherOutcomes;
                            Other3Outputs = OtherOutputs;
                        }

                        if (userDataReader["initiative_num"].ToString() == "3")
                        {
                            Other4 = Other;
                            Other4Part = OtherPart;
                            Other4Outcomes = OtherOutcomes;
                            Other4Outputs = OtherOutputs;
                        }

                        if (userDataReader["initiative_num"].ToString() == "4")
                        {
                            Other5 = Other;
                            Other5Part = OtherPart;
                            Other5Outcomes = OtherOutcomes;
                            Other5Outputs = OtherOutputs;
                        }

                        if (userDataReader["initiative_num"].ToString() == "5")
                        {
                            Other6 = Other;
                            Other6Part = OtherPart;
                            Other6Outcomes = OtherOutcomes;
                            Other6Outputs = OtherOutputs;
                        }

                        //reset Workshops data for next row
                        Other = "";
                        OtherPart = "";
                        OtherOutcomes = "";
                        OtherOutputs = "";
                    }
                    userDataReader.NextResult();

                    int WorkshopsPartOtherCount1 = 0;
                    int WorkshopsPartOtherCount2 = 0;
                    int WorkshopsPartOtherCount3 = 0;
                    int WorkshopsPartOtherCount4 = 0;
                    int WorkshopsPartOtherCount5 = 0;
                    int WorkshopsPartOtherCount6 = 0;
                    int WorkshopsOutOtherCount1 = 0;
                    int WorkshopsOutOtherCount2 = 0;
                    int WorkshopsOutOtherCount3 = 0;
                    int WorkshopsOutOtherCount4 = 0;
                    int WorkshopsOutOtherCount5 = 0;
                    int WorkshopsOutOtherCount6 = 0;


                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            if (userDataReader["initiative_num"].ToString() == "0")
                            {
                                //WorkshopsDay1Outputs = WorkshopsDay1Outputs + userDataReader["short_description"].ToString() + "\n" +
                                //                       userDataReader["inter_description"].ToString() + "\n" +
                                //                       userDataReader["multi_description"].ToString() + "\n" +
                                //                       userDataReader["extend_description"].ToString() + "\n";

                                if (userDataReader["short_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount1++;
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount1++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount1++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount1++;

                                if (userDataReader["short_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount1 = WorkshopsPartOtherCount1 + Int32.Parse(userDataReader["short_att_other"].ToString());
                                }
                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount1 = WorkshopsPartOtherCount1 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount1 = WorkshopsPartOtherCount1 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount1 = WorkshopsPartOtherCount1 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }
                                if (userDataReader["short_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount1 = WorkshopsOutOtherCount1 + Int32.Parse(userDataReader["short_out_other"].ToString());
                                }
                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount1 = WorkshopsOutOtherCount1 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount1 = WorkshopsOutOtherCount1 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount1 = WorkshopsOutOtherCount1 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "1")
                            {
                                if (userDataReader["short_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount2++;
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount2++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount2++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount2++;

                                if (userDataReader["short_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount2 = WorkshopsPartOtherCount2 + Int32.Parse(userDataReader["short_att_other"].ToString());
                                }
                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount2 = WorkshopsPartOtherCount2 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount2 = WorkshopsPartOtherCount2 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount2 = WorkshopsPartOtherCount2 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }
                                if (userDataReader["short_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount2 = WorkshopsOutOtherCount2 + Int32.Parse(userDataReader["short_out_other"].ToString());
                                }
                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount2 = WorkshopsOutOtherCount2 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount2 = WorkshopsOutOtherCount2 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount2 = WorkshopsOutOtherCount2 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "2")
                            {
                                if (userDataReader["short_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount3++;
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount3++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount3++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount3++;

                                if (userDataReader["short_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount3 = WorkshopsPartOtherCount3 + Int32.Parse(userDataReader["short_att_other"].ToString());
                                }
                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount3 = WorkshopsPartOtherCount3 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount3 = WorkshopsPartOtherCount3 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount3 = WorkshopsPartOtherCount3 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }
                                if (userDataReader["short_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount3 = WorkshopsOutOtherCount3 + Int32.Parse(userDataReader["short_out_other"].ToString());
                                }
                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount3 = WorkshopsOutOtherCount3 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount3 = WorkshopsOutOtherCount3 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount3 = WorkshopsOutOtherCount3 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "3")
                            {
                                if (userDataReader["short_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount4++;
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount4++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount4++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount4++;

                                if (userDataReader["short_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount4 = WorkshopsPartOtherCount4 + Int32.Parse(userDataReader["short_att_other"].ToString());
                                }
                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount4 = WorkshopsPartOtherCount4 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount4 = WorkshopsPartOtherCount4 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount4 = WorkshopsPartOtherCount4 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }
                                if (userDataReader["short_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount4 = WorkshopsOutOtherCount4 + Int32.Parse(userDataReader["short_out_other"].ToString());
                                }
                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount4 = WorkshopsOutOtherCount4 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount4 = WorkshopsOutOtherCount4 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount4 = WorkshopsOutOtherCount4 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }

                            }
                            if (userDataReader["initiative_num"].ToString() == "4")
                            {
                                if (userDataReader["short_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount5++;
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount5++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount5++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount5++;

                                if (userDataReader["short_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount5 = WorkshopsPartOtherCount5 + Int32.Parse(userDataReader["short_att_other"].ToString());
                                }
                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount5 = WorkshopsPartOtherCount5 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount5 = WorkshopsPartOtherCount5 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount5 = WorkshopsPartOtherCount5 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }
                                if (userDataReader["short_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount5 = WorkshopsOutOtherCount5 + Int32.Parse(userDataReader["short_out_other"].ToString());
                                }
                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount5 = WorkshopsOutOtherCount5 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount5 = WorkshopsOutOtherCount5 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount5 = WorkshopsOutOtherCount5 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "5")
                            {
                                if (userDataReader["short_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount6++;
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount6++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount6++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    WorkshopsTotalCount6++;

                                if (userDataReader["short_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount6 = WorkshopsPartOtherCount6 + Int32.Parse(userDataReader["short_att_other"].ToString());
                                }
                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount6 = WorkshopsPartOtherCount6 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount6 = WorkshopsPartOtherCount6 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    WorkshopsPartOtherCount6 = WorkshopsPartOtherCount6 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }
                                if (userDataReader["short_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount6 = WorkshopsOutOtherCount6 + Int32.Parse(userDataReader["short_out_other"].ToString());
                                }
                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount6 = WorkshopsOutOtherCount6 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount6 = WorkshopsOutOtherCount6 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    WorkshopsOutOtherCount6 = WorkshopsOutOtherCount6 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                        }
                    }
                    if (WorkshopsDay1Part != "")
                        WorkshopsDay1Part = WorkshopsDay1Part + "\n" + WorkshopsPartOtherCount1.ToString() + "-Others" + "\n\n";
                    if (WorkshopsDay2Part != "")
                        WorkshopsDay2Part = WorkshopsDay2Part + "\n" + WorkshopsPartOtherCount2.ToString() + "-Others" + "\n\n";
                    if (WorkshopsDay3Part != "")
                        WorkshopsDay3Part = WorkshopsDay3Part + "\n" + WorkshopsPartOtherCount3.ToString() + "-Others" + "\n\n";
                    if (WorkshopsDay4Part != "")
                        WorkshopsDay4Part = WorkshopsDay4Part + "\n" + WorkshopsPartOtherCount4.ToString() + "-Others" + "\n\n";
                    if (WorkshopsDay5Part != "")
                        WorkshopsDay5Part = WorkshopsDay6Part + "\n" + WorkshopsPartOtherCount5.ToString() + "-Others" + "\n\n";
                    if (WorkshopsDay6Part != "")
                        WorkshopsDay6Part = WorkshopsDay6Part + "\n" + WorkshopsPartOtherCount6.ToString() + "-Others" + "\n\n";

                    if (WorkshopsDay1Outcomes != "")
                        WorkshopsDay1Outcomes = WorkshopsDay1Outcomes + "\n" + WorkshopsOutOtherCount1.ToString() + "-others";
                    if (WorkshopsDay2Outcomes != "")
                        WorkshopsDay2Outcomes = WorkshopsDay2Outcomes + "\n" + WorkshopsOutOtherCount2.ToString() + "-others";
                    if (WorkshopsDay3Outcomes != "")
                        WorkshopsDay3Outcomes = WorkshopsDay3Outcomes + "\n" + WorkshopsOutOtherCount3.ToString() + "-others";
                    if (WorkshopsDay4Outcomes != "")
                        WorkshopsDay4Outcomes = WorkshopsDay4Outcomes + "\n" + WorkshopsOutOtherCount4.ToString() + "-others";
                    if (WorkshopsDay5Outcomes != "")
                        WorkshopsDay5Outcomes = WorkshopsDay5Outcomes + "\n" + WorkshopsOutOtherCount5.ToString() + "-others";
                    if (WorkshopsDay6Outcomes != "")
                        WorkshopsDay6Outcomes = WorkshopsDay6Outcomes + "\n" + WorkshopsOutOtherCount6.ToString() + "-others";

                    userDataReader.NextResult();

                    int FieldDayPartOtherCount1 = 0;
                    int FieldDayPartOtherCount2 = 0;
                    int FieldDayPartOtherCount3 = 0;
                    int FieldDayPartOtherCount4 = 0;
                    int FieldDayPartOtherCount5 = 0;
                    int FieldDayPartOtherCount6 = 0;
                    int FieldDayOutOtherCount1 = 0;
                    int FieldDayOutOtherCount2 = 0;
                    int FieldDayOutOtherCount3 = 0;
                    int FieldDayOutOtherCount4 = 0;
                    int FieldDayOutOtherCount5 = 0;
                    int FieldDayOutOtherCount6 = 0;
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            if (userDataReader["initiative_num"].ToString() == "0")
                            {
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount1++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount1++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount1++;

                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount1 = FieldDayPartOtherCount1 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount1 = FieldDayPartOtherCount1 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount1 = FieldDayPartOtherCount1 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }

                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount1 = FieldDayOutOtherCount1 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount1 = FieldDayOutOtherCount1 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount1 = FieldDayOutOtherCount1 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }

                            }
                            if (userDataReader["initiative_num"].ToString() == "1")
                            {
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount2++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount2++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount2++;

                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount2 = FieldDayPartOtherCount2 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount2 = FieldDayPartOtherCount2 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount2 = FieldDayPartOtherCount2 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }

                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount2 = FieldDayOutOtherCount2 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount2 = FieldDayOutOtherCount2 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount2 = FieldDayOutOtherCount2 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "2")
                            {
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount3++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount3++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount3++;

                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount3 = FieldDayPartOtherCount3 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount3 = FieldDayPartOtherCount3 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount3 = FieldDayPartOtherCount3 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }

                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount3 = FieldDayOutOtherCount3 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount3 = FieldDayOutOtherCount3 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount3 = FieldDayOutOtherCount3 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "3")
                            {
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount4++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount4++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount4++;

                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount4 = FieldDayPartOtherCount4 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount4 = FieldDayPartOtherCount4 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount4 = FieldDayPartOtherCount4 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }

                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount4 = FieldDayOutOtherCount4 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount4 = FieldDayOutOtherCount4 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount4 = FieldDayOutOtherCount4 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "4")
                            {
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount5++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount5++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount5++;

                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount5 = FieldDayPartOtherCount5 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount5 = FieldDayPartOtherCount5 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount5 = FieldDayPartOtherCount5 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }

                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount5 = FieldDayOutOtherCount5 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount5 = FieldDayOutOtherCount5 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount5 = FieldDayOutOtherCount5 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "5")
                            {
                                if (userDataReader["inter_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount6++;
                                if (userDataReader["multi_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount6++;
                                if (userDataReader["extend_title"].ToString().Trim() != "")
                                    FieldDaysTotalCount6++;

                                if (userDataReader["inter_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount6 = FieldDayPartOtherCount6 + Int32.Parse(userDataReader["inter_att_other"].ToString());
                                }
                                if (userDataReader["multi_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount6 = FieldDayPartOtherCount6 + Int32.Parse(userDataReader["multi_att_other"].ToString());
                                }
                                if (userDataReader["extend_att_other"].ToString() != "")
                                {
                                    FieldDayPartOtherCount6 = FieldDayPartOtherCount6 + Int32.Parse(userDataReader["extend_att_other"].ToString());
                                }

                                if (userDataReader["inter_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount6 = FieldDayOutOtherCount6 + Int32.Parse(userDataReader["inter_out_other"].ToString());
                                }
                                if (userDataReader["multi_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount6 = FieldDayOutOtherCount6 + Int32.Parse(userDataReader["multi_out_other"].ToString());
                                }
                                if (userDataReader["extend_out_other"].ToString() != "")
                                {
                                    FieldDayOutOtherCount6 = FieldDayOutOtherCount6 + Int32.Parse(userDataReader["extend_out_other"].ToString());
                                }
                            }
                        }
                    }
                    if (FieldDay1Part != "")
                        FieldDay1Part = FieldDay1Part + "\n" + FieldDayPartOtherCount1.ToString() + "-Others" + "\n\n";
                    if (FieldDay2Part != "")
                        FieldDay2Part = FieldDay2Part + "\n" + FieldDayPartOtherCount2.ToString() + "-Others" + "\n\n";
                    if (FieldDay3Part != "")
                        FieldDay3Part = FieldDay3Part + "\n" + FieldDayPartOtherCount3.ToString() + "-Others" + "\n\n";
                    if (FieldDay4Part != "")
                        FieldDay4Part = FieldDay4Part + "\n" + FieldDayPartOtherCount4.ToString() + "-Others" + "\n\n";
                    if (FieldDay5Part != "")
                        FieldDay5Part = FieldDay5Part + "\n" + FieldDayPartOtherCount5.ToString() + "-Others" + "\n\n";
                    if (FieldDay6Part != "")
                        FieldDay6Part = FieldDay6Part + "\n" + FieldDayPartOtherCount6.ToString() + "-Others" + "\n\n";

                    if (FieldDay1Outcomes != "")
                        FieldDay1Outcomes = FieldDay1Outcomes + "\n" + FieldDayOutOtherCount1.ToString() + "-others";
                    if (FieldDay2Outcomes != "")
                        FieldDay2Outcomes = FieldDay2Outcomes + "\n" + FieldDayOutOtherCount2.ToString() + "-others";
                    if (FieldDay3Outcomes != "")
                        FieldDay3Outcomes = FieldDay3Outcomes + "\n" + FieldDayOutOtherCount3.ToString() + "-others";
                    if (FieldDay4Outcomes != "")
                        FieldDay4Outcomes = FieldDay4Outcomes + "\n" + FieldDayOutOtherCount4.ToString() + "-others";
                    if (FieldDay5Outcomes != "")
                        FieldDay5Outcomes = FieldDay5Outcomes + "\n" + FieldDayOutOtherCount5.ToString() + "-others";
                    if (FieldDay6Outcomes != "")
                        FieldDay6Outcomes = FieldDay6Outcomes + "\n" + FieldDayOutOtherCount6.ToString() + "-others";

                    userDataReader.NextResult();

                    int MinigrantPartOtherCount1 = 0;
                    int MinigrantPartOtherCount2 = 0;
                    int MinigrantPartOtherCount3 = 0;
                    int MinigrantPartOtherCount4 = 0;
                    int MinigrantPartOtherCount5 = 0;
                    int MinigrantPartOtherCount6 = 0;
                    int MinigrantOutOtherCount1 = 0;
                    int MinigrantOutOtherCount2 = 0;
                    int MinigrantOutOtherCount3 = 0;
                    int MinigrantOutOtherCount4 = 0;
                    int MinigrantOutOtherCount5 = 0;
                    int MinigrantOutOtherCount6 = 0;
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            if (userDataReader["initiative_num"].ToString() == "0")
                            {

                                if (userDataReader["demo_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount1++;
                                if (userDataReader["work_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount1++;
                                if (userDataReader["tour_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount1++;
                                if (userDataReader["cur_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount1++;

                                if (userDataReader["demo_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount1 = MinigrantPartOtherCount1 + Int32.Parse(userDataReader["demo_att_other"].ToString());
                                }
                                if (userDataReader["work_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount1 = MinigrantPartOtherCount1 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["tour_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount1 = MinigrantPartOtherCount1 + Int32.Parse(userDataReader["tour_att_other"].ToString());
                                }
                                if (userDataReader["cur_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount1 = MinigrantPartOtherCount1 + Int32.Parse(userDataReader["cur_att_other"].ToString());
                                }

                                if (userDataReader["demo_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount1 = MinigrantOutOtherCount1 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["work_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount1 = MinigrantOutOtherCount1 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["tour_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount1 = MinigrantOutOtherCount1 + Int32.Parse(userDataReader["tour_out_other"].ToString());
                                }
                                if (userDataReader["cur_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount1 = MinigrantOutOtherCount1 + Int32.Parse(userDataReader["cur_out_other"].ToString());
                                }
                            }

                            if (userDataReader["initiative_num"].ToString() == "1")
                            {
                                if (userDataReader["demo_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount2++;
                                if (userDataReader["work_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount2++;
                                if (userDataReader["tour_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount2++;
                                if (userDataReader["cur_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount2++;

                                if (userDataReader["demo_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount2 = MinigrantPartOtherCount2 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["work_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount2 = MinigrantPartOtherCount2 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["tour_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount2 = MinigrantPartOtherCount2 + Int32.Parse(userDataReader["tour_att_other"].ToString());
                                }
                                if (userDataReader["cur_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount2 = MinigrantPartOtherCount2 + Int32.Parse(userDataReader["cur_att_other"].ToString());
                                }

                                if (userDataReader["demo_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount2 = MinigrantOutOtherCount2 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["work_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount2 = MinigrantOutOtherCount2 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["tour_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount2 = MinigrantOutOtherCount2 + Int32.Parse(userDataReader["tour_out_other"].ToString());
                                }
                                if (userDataReader["cur_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount2 = MinigrantOutOtherCount2 + Int32.Parse(userDataReader["cur_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "2")
                            {
                                if (userDataReader["demo_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount3++;
                                if (userDataReader["work_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount3++;
                                if (userDataReader["tour_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount3++;
                                if (userDataReader["cur_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount3++;

                                if (userDataReader["demo_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount3 = MinigrantPartOtherCount3 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["work_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount3 = MinigrantPartOtherCount3 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["tour_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount3 = MinigrantPartOtherCount3 + Int32.Parse(userDataReader["tour_att_other"].ToString());
                                }
                                if (userDataReader["cur_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount3 = MinigrantPartOtherCount3 + Int32.Parse(userDataReader["cur_att_other"].ToString());
                                }

                                if (userDataReader["demo_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount3 = MinigrantOutOtherCount3 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["work_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount3 = MinigrantOutOtherCount3 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["tour_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount3 = MinigrantOutOtherCount3 + Int32.Parse(userDataReader["tour_out_other"].ToString());
                                }
                                if (userDataReader["cur_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount3 = MinigrantOutOtherCount3 + Int32.Parse(userDataReader["cur_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "3")
                            {
                                if (userDataReader["demo_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount4++;
                                if (userDataReader["work_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount4++;
                                if (userDataReader["tour_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount4++;
                                if (userDataReader["cur_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount4++;

                                if (userDataReader["demo_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount4 = MinigrantPartOtherCount4 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["work_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount4 = MinigrantPartOtherCount4 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["tour_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount4 = MinigrantPartOtherCount4 + Int32.Parse(userDataReader["tour_att_other"].ToString());
                                }
                                if (userDataReader["cur_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount4 = MinigrantPartOtherCount4 + Int32.Parse(userDataReader["cur_att_other"].ToString());
                                }

                                if (userDataReader["demo_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount4 = MinigrantOutOtherCount4 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["work_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount4 = MinigrantOutOtherCount4 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["tour_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount4 = MinigrantOutOtherCount4 + Int32.Parse(userDataReader["tour_out_other"].ToString());
                                }
                                if (userDataReader["cur_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount4 = MinigrantOutOtherCount4 + Int32.Parse(userDataReader["cur_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "4")
                            {
                                if (userDataReader["demo_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount5++;
                                if (userDataReader["work_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount5++;
                                if (userDataReader["tour_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount5++;
                                if (userDataReader["cur_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount5++;

                                if (userDataReader["demo_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount5 = MinigrantPartOtherCount5 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["work_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount5 = MinigrantPartOtherCount5 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["tour_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount5 = MinigrantPartOtherCount5 + Int32.Parse(userDataReader["tour_att_other"].ToString());
                                }
                                if (userDataReader["cur_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount5 = MinigrantPartOtherCount5 + Int32.Parse(userDataReader["cur_att_other"].ToString());
                                }

                                if (userDataReader["demo_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount5 = MinigrantOutOtherCount5 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["work_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount5 = MinigrantOutOtherCount5 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["tour_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount5 = MinigrantOutOtherCount5 + Int32.Parse(userDataReader["tour_out_other"].ToString());
                                }
                                if (userDataReader["cur_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount5 = MinigrantOutOtherCount5 + Int32.Parse(userDataReader["cur_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "5")
                            {
                                if (userDataReader["demo_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount6++;
                                if (userDataReader["work_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount6++;
                                if (userDataReader["tour_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount6++;
                                if (userDataReader["cur_title"].ToString().Trim() != "")
                                    MinigrantsTotalCount6++;

                                if (userDataReader["demo_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount6 = MinigrantPartOtherCount6 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["work_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount6 = MinigrantPartOtherCount6 + Int32.Parse(userDataReader["work_att_other"].ToString());
                                }
                                if (userDataReader["tour_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount6 = MinigrantPartOtherCount6 + Int32.Parse(userDataReader["tour_att_other"].ToString());
                                }
                                if (userDataReader["cur_att_other"].ToString() != "")
                                {
                                    MinigrantPartOtherCount6 = MinigrantPartOtherCount6 + Int32.Parse(userDataReader["cur_att_other"].ToString());
                                }

                                if (userDataReader["demo_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount6 = MinigrantOutOtherCount6 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["work_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount6 = MinigrantOutOtherCount6 + Int32.Parse(userDataReader["work_out_other"].ToString());
                                }
                                if (userDataReader["tour_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount6 = MinigrantOutOtherCount6 + Int32.Parse(userDataReader["tour_out_other"].ToString());
                                }
                                if (userDataReader["cur_out_other"].ToString() != "")
                                {
                                    MinigrantOutOtherCount6 = MinigrantOutOtherCount6 + Int32.Parse(userDataReader["cur_out_other"].ToString());
                                }
                            }
                        }
                    }
                    if (Minigrant1Part != "")
                        Minigrant1Part = Minigrant1Part + "\n" + MinigrantPartOtherCount1.ToString() + "-Others" + "\n\n";
                    if (Minigrant2Part != "")
                        Minigrant2Part = Minigrant2Part + "\n" + MinigrantPartOtherCount2.ToString() + "-Others" + "\n\n";
                    if (Minigrant3Part != "")
                        Minigrant3Part = Minigrant3Part + "\n" + MinigrantPartOtherCount3.ToString() + "-Others" + "\n\n";
                    if (Minigrant4Part != "")
                        Minigrant4Part = Minigrant4Part + "\n" + MinigrantPartOtherCount4.ToString() + "-Others" + "\n\n";
                    if (Minigrant5Part != "")
                        Minigrant5Part = Minigrant5Part + "\n" + MinigrantPartOtherCount5.ToString() + "-Others" + "\n\n";
                    if (Minigrant6Part != "")
                        Minigrant6Part = Minigrant6Part + "\n" + MinigrantPartOtherCount6.ToString() + "-Others" + "\n\n";

                    if (Minigrant1Outcomes != "")
                        Minigrant1Outcomes = Minigrant1Outcomes + "\n" + MinigrantOutOtherCount1.ToString() + "-others";
                    if (Minigrant2Outcomes != "")
                        Minigrant2Outcomes = Minigrant2Outcomes + "\n" + MinigrantOutOtherCount2.ToString() + "-others";
                    if (Minigrant3Outcomes != "")
                        Minigrant3Outcomes = Minigrant3Outcomes + "\n" + MinigrantOutOtherCount3.ToString() + "-others";
                    if (Minigrant4Outcomes != "")
                        Minigrant4Outcomes = Minigrant4Outcomes + "\n" + MinigrantOutOtherCount4.ToString() + "-others";
                    if (Minigrant5Outcomes != "")
                        Minigrant5Outcomes = Minigrant5Outcomes + "\n" + MinigrantOutOtherCount5.ToString() + "-others";
                    if (Minigrant6Outcomes != "")
                        Minigrant6Outcomes = Minigrant6Outcomes + "\n" + MinigrantOutOtherCount6.ToString() + "-others";

                    userDataReader.NextResult();

                    int StudyPartOtherCount1 = 0;
                    int StudyPartOtherCount2 = 0;
                    int StudyPartOtherCount3 = 0;
                    int StudyPartOtherCount4 = 0;
                    int StudyPartOtherCount5 = 0;
                    int StudyPartOtherCount6 = 0;
                    int StudyOutOtherCount1 = 0;
                    int StudyOutOtherCount2 = 0;
                    int StudyOutOtherCount3 = 0;
                    int StudyOutOtherCount4 = 0;
                    int StudyOutOtherCount5 = 0;
                    int StudyOutOtherCount6 = 0;
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            if (userDataReader["initiative_num"].ToString() == "0")
                            {
                                if (userDataReader["study_att_other"].ToString() != "")
                                {
                                    StudyPartOtherCount1 = StudyPartOtherCount1 + Int32.Parse(userDataReader["study_att_other"].ToString());
                                }
                                if (userDataReader["study_out_other"].ToString() != "")
                                {
                                    StudyOutOtherCount1 = StudyOutOtherCount1 + Int32.Parse(userDataReader["study_out_other"].ToString());
                                }
                                StudyTotalCount1++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "1")
                            {
                                if (userDataReader["study_att_other"].ToString() != "")
                                {
                                    StudyPartOtherCount2 = StudyPartOtherCount2 + Int32.Parse(userDataReader["study_att_other"].ToString());
                                }
                                if (userDataReader["study_out_other"].ToString() != "")
                                {
                                    StudyOutOtherCount2 = StudyOutOtherCount2 + Int32.Parse(userDataReader["study_out_other"].ToString());
                                }
                                StudyTotalCount2++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "2")
                            {
                                if (userDataReader["study_att_other"].ToString() != "")
                                {
                                    StudyPartOtherCount3 = StudyPartOtherCount3 + Int32.Parse(userDataReader["study_att_other"].ToString());
                                }
                                if (userDataReader["study_out_other"].ToString() != "")
                                {
                                    StudyOutOtherCount3 = StudyOutOtherCount3 + Int32.Parse(userDataReader["study_out_other"].ToString());
                                }
                                StudyTotalCount3++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "3")
                            {
                                if (userDataReader["study_att_other"].ToString() != "")
                                {
                                    StudyPartOtherCount4 = StudyPartOtherCount4 + Int32.Parse(userDataReader["study_att_other"].ToString());
                                }
                                if (userDataReader["study_out_other"].ToString() != "")
                                {
                                    StudyOutOtherCount4 = StudyOutOtherCount4 + Int32.Parse(userDataReader["study_out_other"].ToString());
                                }
                                StudyTotalCount4++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "4")
                            {
                                if (userDataReader["study_att_other"].ToString() != "")
                                {
                                    StudyPartOtherCount5 = StudyPartOtherCount5 + Int32.Parse(userDataReader["study_att_other"].ToString());
                                }
                                if (userDataReader["study_out_other"].ToString() != "")
                                {
                                    StudyOutOtherCount5 = StudyOutOtherCount5 + Int32.Parse(userDataReader["study_out_other"].ToString());
                                }
                                StudyTotalCount5++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "5")
                            {
                                if (userDataReader["study_att_other"].ToString() != "")
                                {
                                    StudyPartOtherCount6 = StudyPartOtherCount6 + Int32.Parse(userDataReader["study_att_other"].ToString());
                                }
                                if (userDataReader["study_out_other"].ToString() != "")
                                {
                                    StudyOutOtherCount6 = StudyOutOtherCount6 + Int32.Parse(userDataReader["study_out_other"].ToString());
                                }
                                StudyTotalCount6++;
                            }
                        }
                    }
                    if (Study1Part != "")
                        Study1Part = Study1Part + "\n" + StudyPartOtherCount1.ToString() + "-Others" + "\n\n";
                    if (Study2Part != "")
                        Study2Part = Study2Part + "\n" + StudyPartOtherCount2.ToString() + "-Others" + "\n\n";
                    if (Study3Part != "")
                        Study3Part = Study3Part + "\n" + StudyPartOtherCount3.ToString() + "-Others" + "\n\n";
                    if (Study4Part != "")
                        Study4Part = Study4Part + "\n" + StudyPartOtherCount4.ToString() + "-Others" + "\n\n";
                    if (Study5Part != "")
                        Study5Part = Study5Part + "\n" + StudyPartOtherCount5.ToString() + "-Others" + "\n\n";
                    if (Study6Part != "")
                        Study6Part = Study6Part + "\n" + StudyPartOtherCount6.ToString() + "-Others" + "\n\n";

                    if (Study1Outcomes != "")
                        Study1Outcomes = Study1Outcomes + "\n" + StudyOutOtherCount1.ToString() + "-others";
                    if (Study2Outcomes != "")
                        Study2Outcomes = Study2Outcomes + "\n" + StudyOutOtherCount2.ToString() + "-others";
                    if (Study3Outcomes != "")
                        Study3Outcomes = Study3Outcomes + "\n" + StudyOutOtherCount3.ToString() + "-others";
                    if (Study4Outcomes != "")
                        Study4Outcomes = Study4Outcomes + "\n" + StudyOutOtherCount4.ToString() + "-others";
                    if (Study5Outcomes != "")
                        Study5Outcomes = Study5Outcomes + "\n" + StudyOutOtherCount5.ToString() + "-others";
                    if (Study6Outcomes != "")
                        Study6Outcomes = Study6Outcomes + "\n" + StudyOutOtherCount6.ToString() + "-others";

                    userDataReader.NextResult();

                    int TravelPartOtherCount1 = 0;
                    int TravelPartOtherCount2 = 0;
                    int TravelPartOtherCount3 = 0;
                    int TravelPartOtherCount4 = 0;
                    int TravelPartOtherCount5 = 0;
                    int TravelPartOtherCount6 = 0;
                    int TravelOutOtherCount1 = 0;
                    int TravelOutOtherCount2 = 0;
                    int TravelOutOtherCount3 = 0;
                    int TravelOutOtherCount4 = 0;
                    int TravelOutOtherCount5 = 0;
                    int TravelOutOtherCount6 = 0;
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            if (userDataReader["initiative_num"].ToString() == "0")
                            {
                                if (userDataReader["travel_other"].ToString() != "")
                                {
                                    TravelPartOtherCount1 = TravelPartOtherCount1 + Int32.Parse(userDataReader["travel_other"].ToString());
                                }
                                if (userDataReader["travel_out_other"].ToString() != "")
                                {
                                    TravelOutOtherCount1 = TravelOutOtherCount1 + Int32.Parse(userDataReader["travel_out_other"].ToString());
                                }
                                TravelTotalCount1++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "1")
                            {
                                if (userDataReader["travel_other"].ToString() != "")
                                {
                                    TravelPartOtherCount2 = TravelPartOtherCount2 + Int32.Parse(userDataReader["travel_other"].ToString());
                                }
                                if (userDataReader["travel_out_other"].ToString() != "")
                                {
                                    TravelOutOtherCount2 = TravelOutOtherCount2 + Int32.Parse(userDataReader["travel_out_other"].ToString());
                                }
                                TravelTotalCount2++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "2")
                            {
                                if (userDataReader["travel_other"].ToString() != "")
                                {
                                    TravelPartOtherCount3 = TravelPartOtherCount3 + Int32.Parse(userDataReader["travel_other"].ToString());
                                }
                                if (userDataReader["travel_out_other"].ToString() != "")
                                {
                                    TravelOutOtherCount3 = TravelOutOtherCount3 + Int32.Parse(userDataReader["travel_out_other"].ToString());
                                }
                                TravelTotalCount3++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "3")
                            {
                                if (userDataReader["travel_other"].ToString() != "")
                                {
                                    TravelPartOtherCount4 = TravelPartOtherCount4 + Int32.Parse(userDataReader["travel_other"].ToString());
                                }
                                if (userDataReader["travel_out_other"].ToString() != "")
                                {
                                    TravelOutOtherCount4 = TravelOutOtherCount4 + Int32.Parse(userDataReader["travel_out_other"].ToString());
                                }
                                TravelTotalCount4++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "4")
                            {
                                if (userDataReader["travel_other"].ToString() != "")
                                {
                                    TravelPartOtherCount5 = TravelPartOtherCount5 + Int32.Parse(userDataReader["travel_other"].ToString());
                                }
                                if (userDataReader["travel_out_other"].ToString() != "")
                                {
                                    TravelOutOtherCount5 = TravelOutOtherCount5 + Int32.Parse(userDataReader["travel_out_other"].ToString());
                                }
                                TravelTotalCount5++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "5")
                            {
                                if (userDataReader["travel_other"].ToString() != "")
                                {
                                    TravelPartOtherCount6 = TravelPartOtherCount6 + Int32.Parse(userDataReader["travel_other"].ToString());
                                }
                                if (userDataReader["travel_out_other"].ToString() != "")
                                {
                                    TravelOutOtherCount6 = TravelOutOtherCount6 + Int32.Parse(userDataReader["travel_out_other"].ToString());
                                }
                                TravelTotalCount6++;
                            }
                        }
                    }
                    if (Travel1Part != "")
                        Travel1Part = Travel1Part + "\n" + TravelPartOtherCount1.ToString() + "-Others" + "\n\n";
                    if (Travel2Part != "")
                        Travel2Part = Travel2Part + "\n" + TravelPartOtherCount2.ToString() + "-Others" + "\n\n";
                    if (Travel3Part != "")
                        Travel3Part = Travel3Part + "\n" + TravelPartOtherCount3.ToString() + "-Others" + "\n\n";
                    if (Travel4Part != "")
                        Travel4Part = Travel4Part + "\n" + TravelPartOtherCount4.ToString() + "-Others" + "\n\n";
                    if (Travel5Part != "")
                        Travel5Part = Travel5Part + "\n" + TravelPartOtherCount5.ToString() + "-Others" + "\n\n";
                    if (Travel6Part != "")
                        Travel6Part = Travel6Part + "\n" + TravelPartOtherCount6.ToString() + "-Others" + "\n\n";

                    if (Travel1Outcomes != "")
                        Travel1Outcomes = Travel1Outcomes + "\n" + TravelOutOtherCount1.ToString() + "-others";
                    if (Travel2Outcomes != "")
                        Travel2Outcomes = Travel2Outcomes + "\n" + TravelOutOtherCount2.ToString() + "-others";
                    if (Travel3Outcomes != "")
                        Travel3Outcomes = Travel3Outcomes + "\n" + TravelOutOtherCount3.ToString() + "-others";
                    if (Travel4Outcomes != "")
                        Travel4Outcomes = Travel4Outcomes + "\n" + TravelOutOtherCount4.ToString() + "-others";
                    if (Travel5Outcomes != "")
                        Travel5Outcomes = Travel5Outcomes + "\n" + TravelOutOtherCount5.ToString() + "-others";
                    if (Travel6Outcomes != "")
                        Travel6Outcomes = Travel6Outcomes + "\n" + TravelOutOtherCount6.ToString() + "-others";

                    userDataReader.NextResult();

                    int WebPartOtherCount1 = 0;
                    int WebPartOtherCount2 = 0;
                    int WebPartOtherCount3 = 0;
                    int WebPartOtherCount4 = 0;
                    int WebPartOtherCount5 = 0;
                    int WebPartOtherCount6 = 0;
                    int WebOutOtherCount1 = 0;
                    int WebOutOtherCount2 = 0;
                    int WebOutOtherCount3 = 0;
                    int WebOutOtherCount4 = 0;
                    int WebOutOtherCount5 = 0;
                    int WebOutOtherCount6 = 0;
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            if (userDataReader["initiative_num"].ToString() == "0")
                            {
                                if (userDataReader["web_title"].ToString().Trim() != "")
                                    WebTotalCount1++;
                                if (userDataReader["webseries_title"].ToString().Trim() != "")
                                    WebTotalCount1++;

                                if (userDataReader["web_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount1 = WebPartOtherCount1 + Int32.Parse(userDataReader["web_att_other"].ToString());
                                }
                                if (userDataReader["webseries_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount1 = WebPartOtherCount1 + Int32.Parse(userDataReader["webseries_att_other"].ToString());
                                }
                                if (userDataReader["web_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount1 = WebOutOtherCount1 + Int32.Parse(userDataReader["web_out_other"].ToString());
                                }
                                if (userDataReader["webseries_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount1 = WebOutOtherCount1 + Int32.Parse(userDataReader["webseries_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "1")
                            {
                                if (userDataReader["web_title"].ToString().Trim() != "")
                                    WebTotalCount2++;
                                if (userDataReader["webseries_title"].ToString().Trim() != "")
                                    WebTotalCount2++;

                                if (userDataReader["web_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount2 = WebPartOtherCount2 + Int32.Parse(userDataReader["web_att_other"].ToString());
                                }
                                if (userDataReader["webseries_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount2 = WebPartOtherCount2 + Int32.Parse(userDataReader["webseries_att_other"].ToString());
                                }
                                if (userDataReader["web_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount2 = WebOutOtherCount2 + Int32.Parse(userDataReader["web_out_other"].ToString());
                                }
                                if (userDataReader["webseries_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount2 = WebOutOtherCount2 + Int32.Parse(userDataReader["webseries_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "2")
                            {
                                if (userDataReader["web_title"].ToString().Trim() != "")
                                    WebTotalCount3++;
                                if (userDataReader["webseries_title"].ToString().Trim() != "")
                                    WebTotalCount3++;

                                if (userDataReader["web_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount3 = WebPartOtherCount3 + Int32.Parse(userDataReader["web_att_other"].ToString());
                                }
                                if (userDataReader["webseries_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount3 = WebPartOtherCount3 + Int32.Parse(userDataReader["webseries_att_other"].ToString());
                                }
                                if (userDataReader["web_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount3 = WebOutOtherCount3 + Int32.Parse(userDataReader["web_out_other"].ToString());
                                }
                                if (userDataReader["webseries_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount3 = WebOutOtherCount3 + Int32.Parse(userDataReader["webseries_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "3")
                            {
                                if (userDataReader["web_title"].ToString().Trim() != "")
                                    WebTotalCount4++;
                                if (userDataReader["webseries_title"].ToString().Trim() != "")
                                    WebTotalCount4++;

                                if (userDataReader["web_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount4 = WebPartOtherCount4 + Int32.Parse(userDataReader["web_att_other"].ToString());
                                }
                                if (userDataReader["webseries_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount4 = WebPartOtherCount4 + Int32.Parse(userDataReader["webseries_att_other"].ToString());
                                }
                                if (userDataReader["web_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount4 = WebOutOtherCount4 + Int32.Parse(userDataReader["web_out_other"].ToString());
                                }
                                if (userDataReader["webseries_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount4 = WebOutOtherCount4 + Int32.Parse(userDataReader["webseries_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "4")
                            {
                                if (userDataReader["web_title"].ToString().Trim() != "")
                                    WebTotalCount5++;
                                if (userDataReader["webseries_title"].ToString().Trim() != "")
                                    WebTotalCount5++;

                                if (userDataReader["web_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount5 = WebPartOtherCount5 + Int32.Parse(userDataReader["web_att_other"].ToString());
                                }
                                if (userDataReader["webseries_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount5 = WebPartOtherCount5 + Int32.Parse(userDataReader["webseries_att_other"].ToString());
                                }
                                if (userDataReader["web_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount5 = WebOutOtherCount5 + Int32.Parse(userDataReader["web_out_other"].ToString());
                                }
                                if (userDataReader["webseries_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount5 = WebOutOtherCount5 + Int32.Parse(userDataReader["webseries_out_other"].ToString());
                                }
                            }
                            if (userDataReader["initiative_num"].ToString() == "5")
                            {
                                if (userDataReader["web_title"].ToString().Trim() != "")
                                    WebTotalCount6++;
                                if (userDataReader["webseries_title"].ToString().Trim() != "")
                                    WebTotalCount6++;

                                if (userDataReader["web_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount6 = WebPartOtherCount6 + Int32.Parse(userDataReader["web_att_other"].ToString());
                                }
                                if (userDataReader["webseries_att_other"].ToString() != "")
                                {
                                    WebPartOtherCount6 = WebPartOtherCount6 + Int32.Parse(userDataReader["webseries_att_other"].ToString());
                                }
                                if (userDataReader["web_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount6 = WebOutOtherCount6 + Int32.Parse(userDataReader["web_out_other"].ToString());
                                }
                                if (userDataReader["webseries_out_other"].ToString() != "")
                                {
                                    WebOutOtherCount6 = WebOutOtherCount6 + Int32.Parse(userDataReader["webseries_out_other"].ToString());
                                }
                            }
                        }
                    }
                    if (Web1Part != "")
                        Web1Part = Web1Part + "\n" + WebPartOtherCount1.ToString() + "-Others" + "\n\n";
                    if (Web2Part != "")
                        Web2Part = Web2Part + "\n" + WebPartOtherCount2.ToString() + "-Others" + "\n\n";
                    if (Web3Part != "")
                        Web3Part = Web3Part + "\n" + WebPartOtherCount3.ToString() + "-Others" + "\n\n";
                    if (Web4Part != "")
                        Web4Part = Web4Part + "\n" + WebPartOtherCount4.ToString() + "-Others" + "\n\n";
                    if (Web5Part != "")
                        Web5Part = Web5Part + "\n" + WebPartOtherCount5.ToString() + "-Others" + "\n\n";
                    if (Web6Part != "")
                        Web6Part = Web6Part + "\n" + WebPartOtherCount6.ToString() + "-Others" + "\n\n";

                    if (Web1Outcomes != "")
                        Web1Outcomes = Web1Outcomes + "\n" + WebOutOtherCount1.ToString() + "-others";
                    if (Web2Outcomes != "")
                        Web2Outcomes = Web2Outcomes + "\n" + WebOutOtherCount2.ToString() + "-others";
                    if (Web3Outcomes != "")
                        Web3Outcomes = Web3Outcomes + "\n" + WebOutOtherCount3.ToString() + "-others";
                    if (Web4Outcomes != "")
                        Web4Outcomes = Web4Outcomes + "\n" + WebOutOtherCount4.ToString() + "-others";
                    if (Web5Outcomes != "")
                        Web5Outcomes = Web5Outcomes + "\n" + WebOutOtherCount5.ToString() + "-others";
                    if (Web6Outcomes != "")
                        Web6Outcomes = Web6Outcomes + "\n" + WebOutOtherCount6.ToString() + "-others";

                    userDataReader.NextResult();

                    int OtherPartOtherCount1 = 0;
                    int OtherPartOtherCount2 = 0;
                    int OtherPartOtherCount3 = 0;
                    int OtherPartOtherCount4 = 0;
                    int OtherPartOtherCount5 = 0;
                    int OtherPartOtherCount6 = 0;
                    int OtherOutOtherCount1 = 0;
                    int OtherOutOtherCount2 = 0;
                    int OtherOutOtherCount3 = 0;
                    int OtherOutOtherCount4 = 0;
                    int OtherOutOtherCount5 = 0;
                    int OtherOutOtherCount6 = 0;
                    while (userDataReader.Read())
                    {
                        if (userDataReader["initiative_num"] != null)
                        {
                            if (userDataReader["initiative_num"].ToString() == "0")
                            {
                                if (userDataReader["other_other"].ToString() != "")
                                {
                                    OtherPartOtherCount1 = OtherPartOtherCount1 + Int32.Parse(userDataReader["other_other"].ToString());
                                }
                                if (userDataReader["other_out_other"].ToString() != "")
                                {
                                    OtherOutOtherCount1 = OtherOutOtherCount1 + Int32.Parse(userDataReader["other_out_other"].ToString());
                                }

                                OtherTotalCount1++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "1")
                            {
                                if (userDataReader["other_other"].ToString() != "")
                                {
                                    OtherPartOtherCount2 = OtherPartOtherCount2 + Int32.Parse(userDataReader["other_other"].ToString());
                                }
                                if (userDataReader["other_out_other"].ToString() != "")
                                {
                                    OtherOutOtherCount2 = OtherOutOtherCount2 + Int32.Parse(userDataReader["other_out_other"].ToString());
                                }
                                OtherTotalCount2++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "2")
                            {
                                if (userDataReader["other_other"].ToString() != "")
                                {
                                    OtherPartOtherCount3 = OtherPartOtherCount3 + Int32.Parse(userDataReader["other_other"].ToString());
                                }
                                if (userDataReader["other_out_other"].ToString() != "")
                                {
                                    OtherOutOtherCount3 = OtherOutOtherCount3 + Int32.Parse(userDataReader["other_out_other"].ToString());
                                }
                                OtherTotalCount3++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "3")
                            {
                                if (userDataReader["other_other"].ToString() != "")
                                {
                                    OtherPartOtherCount4 = OtherPartOtherCount4 + Int32.Parse(userDataReader["other_other"].ToString());
                                }
                                if (userDataReader["other_out_other"].ToString() != "")
                                {
                                    OtherOutOtherCount4 = OtherOutOtherCount4 + Int32.Parse(userDataReader["other_out_other"].ToString());
                                }
                                OtherTotalCount4++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "4")
                            {
                                if (userDataReader["other_other"].ToString() != "")
                                {
                                    OtherPartOtherCount5 = OtherPartOtherCount5 + Int32.Parse(userDataReader["other_other"].ToString());
                                }
                                if (userDataReader["other_out_other"].ToString() != "")
                                {
                                    OtherOutOtherCount5 = OtherOutOtherCount5 + Int32.Parse(userDataReader["other_out_other"].ToString());
                                }
                                OtherTotalCount5++;
                            }
                            if (userDataReader["initiative_num"].ToString() == "5")
                            {
                                if (userDataReader["other_other"].ToString() != "")
                                {
                                    OtherPartOtherCount6 = OtherPartOtherCount6 + Int32.Parse(userDataReader["other_other"].ToString());
                                }
                                if (userDataReader["other_out_other"].ToString() != "")
                                {
                                    OtherOutOtherCount6 = OtherOutOtherCount6 + Int32.Parse(userDataReader["other_out_other"].ToString());
                                }
                                OtherTotalCount6++;
                            }
                        }
                    }
                    if (Other1Part != "")
                        Other1Part = Other1Part + "\n" + OtherPartOtherCount1.ToString() + "-Others" + "\n\n";
                    if (Other2Part != "")
                        Other2Part = Other2Part + "\n" + OtherPartOtherCount2.ToString() + "-Others" + "\n\n";
                    if (Other3Part != "")
                        Other3Part = Other3Part + "\n" + OtherPartOtherCount3.ToString() + "-Others" + "\n\n";
                    if (Other4Part != "")
                        Other4Part = Other4Part + "\n" + OtherPartOtherCount4.ToString() + "-Others" + "\n\n";
                    if (Other5Part != "")
                        Other5Part = Other5Part + "\n" + OtherPartOtherCount5.ToString() + "-Others" + "\n\n";
                    if (Other6Part != "")
                        Other6Part = Other6Part + "\n" + OtherPartOtherCount6.ToString() + "-Others" + "\n\n";

                    if (Other1Outcomes != "")
                        Other1Outcomes = Other1Outcomes + "\n" + OtherOutOtherCount1.ToString() + "-others";
                    if (Other2Outcomes != "")
                        Other2Outcomes = Other2Outcomes + "\n" + OtherOutOtherCount2.ToString() + "-others";
                    if (Other3Outcomes != "")
                        Other3Outcomes = Other3Outcomes + "\n" + OtherOutOtherCount3.ToString() + "-others";
                    if (Other4Outcomes != "")
                        Other4Outcomes = Other4Outcomes + "\n" + OtherOutOtherCount4.ToString() + "-others";
                    if (Other5Outcomes != "")
                        Other5Outcomes = Other5Outcomes + "\n" + OtherOutOtherCount5.ToString() + "-others";
                    if (Other6Outcomes != "")
                        Other6Outcomes = Other6Outcomes + "\n" + OtherOutOtherCount6.ToString() + "-others";

                }
                document.Add(paragraphState);
                document.Add(paragraphCoords);
                document.Add(paragraphProject);
                //paragraphOutcomeNarrative.Add("\n");
                //document.Add(paragraphOutcomeNarrative);
                iTextSharp.text.html.simpleparser.HTMLWorker htmlWorkerNarr = new iTextSharp.text.html.simpleparser.HTMLWorker(document);
                htmlWorkerNarr.Parse(new StringReader(htmlTextOutcomeNarrative + "<br/>"));
                document.Add(paragraphAdvAff);
                document.Add(paragraphInitTitles);
                //paragraphSareFace.Add("\n\n");
                //document.Add(paragraphSareFace);
                iTextSharp.text.html.simpleparser.HTMLWorker htmlWorkerSareFace = new iTextSharp.text.html.simpleparser.HTMLWorker(document);
                //htmlWorkerSareFace.Parse(new StringReader(htmlTextSareFace)); Below code is used to support special characters.

                // step 4.1: register a unicode font and assign it an allias
                //FontFactory.Register("C:\\Windows\\Fonts\\ARIALUNI.TTF", "arial unicode ms");
                string fontPath = Server.MapPath("~/ARIALUNI.TTF");
                FontFactory.Register(fontPath, "arial unicode ms");

                // step 4.2: create a style sheet and set the encoding to Identity-H
                iTextSharp.text.html.simpleparser.StyleSheet ST = new iTextSharp.text.html.simpleparser.StyleSheet();
                ST.LoadTagStyle("body", "encoding", "Identity-H");

                // step 4.3: assign the style sheet to the html parser
                htmlWorkerSareFace.Style = (ST);

                htmlWorkerSareFace.StartDocument();

                // step 5: parse the html into the document
                htmlWorkerSareFace.Parse(new StringReader(htmlTextSareFace));

                // step 6: close the document and the worker
                htmlWorkerSareFace.EndDocument();

                if (attachmentTitle != "")
                {
                    Paragraph headingAttachmentsExists = new Paragraph("Outputs :\n", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 10, iTextSharp.text.Font.BOLD));
                    document.Add(headingAttachmentsExists);
                    paragraphAttachments.Add(attachmentTitle);
                    paragraphAttachments.Add("\n\n");
                    document.Add(paragraphAttachments);
                }
                if (infoProductTitle != "")
                {
                    Paragraph headingInfoProdExists = new Paragraph("Information Products :\n", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 10, iTextSharp.text.Font.BOLD));
                    document.Add(headingInfoProdExists);
                    paragraphInfoProducts.Add(infoProductTitle);
                    paragraphInfoProducts.Add("\n\n");
                    document.Add(paragraphInfoProducts);
                }

                paragraphInitiative.Add("\n\n\n");

                if (Title1.Length != 0)
                {

                    table.AddCell(cell);
                    table.AddCell(new Phrase(("Initiative"), FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                    table.AddCell(new Phrase(("Partners"), FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                    // Changed to have only 4 columns (removed activity)
                    //table.AddCell(new Phrase(("Activities"), FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                    table.AddCell(new Phrase(("Participation"), FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                    //table.AddCell(new Phrase(("Description of Activity and Learning Outcomes"), FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                    table.AddCell(new Phrase(("Outcomes"), FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));

                    table.AddCell(new Phrase(Title1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    table.AddCell(new Phrase(partners1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //Changed to have only 4 columns (removed activity)
                    /*
                    if (WorkshopsDay1 != "")
                        nested_act.AddCell(new Phrase(WorkshopsDay1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (FieldDay1 != "")
                        nested_act.AddCell(new Phrase(FieldDay1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Minigrant1 != "")
                        nested_act.AddCell(new Phrase(Minigrant1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Study1 != "")
                        nested_act.AddCell(new Phrase(Study1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Travel1 != "")
                        nested_act.AddCell(new Phrase(Travel1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Web1 != "")
                        nested_act.AddCell(new Phrase(Web1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Other1 != "")
                        nested_act.AddCell(new Phrase(Other1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    PdfPCell nesthousing_act = new PdfPCell(nested_act);
                    table.AddCell(nesthousing_act);
                    */
                    //table.AddCell(new Phrase(FieldDay1 + "\n" + "------------------------\n" + MiniGrant1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (WorkshopsDay1Part != "")
                    {
                        nested_part.AddCell(new Phrase(WorkshopsTotalCount1.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part.AddCell(new Phrase(WorkshopsDay1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay1Part != "")
                    {
                        nested_part.AddCell(new Phrase(FieldDaysTotalCount1.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part.AddCell(new Phrase(FieldDay1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant1Part != "")
                    {
                        nested_part.AddCell(new Phrase(MinigrantsTotalCount1.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part.AddCell(new Phrase(Minigrant1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study1Part != "")
                    {
                        nested_part.AddCell(new Phrase(StudyTotalCount1.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part.AddCell(new Phrase(Study1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel1Part != "")
                    {
                        nested_part.AddCell(new Phrase(TravelTotalCount1.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part.AddCell(new Phrase(Travel1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web1Part != "")
                    {
                        nested_part.AddCell(new Phrase(WebTotalCount1.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part.AddCell(new Phrase(Web1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other1Part != "")
                    {
                        nested_part.AddCell(new Phrase(OtherTotalCount1.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part.AddCell(new Phrase(Other1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_part = new PdfPCell(nested_part);
                    table.AddCell(nesthousing_part);
                    //table.AddCell(new Phrase(FieldDay1Part + "\n" + "--------\n" + MiniGrant1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //table.AddCell(new Phrase(WorkshopsDay1Outputs + FieldDay1Outputs + Minigrant1Outputs, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (WorkshopsDay1Outcomes != "")
                    {
                        nested_outcomes.AddCell(new Phrase(WorkshopsTotalCount1.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes.AddCell(new Phrase(WorkshopsDay1Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay1Outcomes != "")
                    {
                        nested_outcomes.AddCell(new Phrase(FieldDaysTotalCount1.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes.AddCell(new Phrase(FieldDay1Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant1Outcomes != "")
                    {
                        nested_outcomes.AddCell(new Phrase(MinigrantsTotalCount1.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes.AddCell(new Phrase(Minigrant1Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study1Outcomes != "")
                    {
                        nested_outcomes.AddCell(new Phrase(StudyTotalCount1.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes.AddCell(new Phrase(Study1Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel1Outcomes != "")
                    {
                        nested_outcomes.AddCell(new Phrase(TravelTotalCount1.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes.AddCell(new Phrase(Travel1Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web1Outcomes != "")
                    {
                        nested_outcomes.AddCell(new Phrase(WebTotalCount1.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes.AddCell(new Phrase(Web1Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other1Outcomes != "")
                    {
                        nested_outcomes.AddCell(new Phrase(OtherTotalCount1.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes.AddCell(new Phrase(Other1Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_outcomes = new PdfPCell(nested_outcomes);
                    table.AddCell(nesthousing_outcomes);
                    //table.AddCell(new Phrase(FieldDay1Outcomes + "\n" + "-----------------------\n" + MiniGrant1Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));                     

                }

                if (Title2.Length != 0)
                {
                    table.AddCell(new Phrase(Title2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    table.AddCell(new Phrase(partners2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //Changed to have only 4 columns (removed activity)
                    /*
                    if (WorkshopsDay2 != "")
                        nested_act2.AddCell(new Phrase(WorkshopsDay2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (FieldDay2 != "")
                        nested_act2.AddCell(new Phrase(FieldDay2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Minigrant2 != "")
                        nested_act2.AddCell(new Phrase(Minigrant2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Study2 != "")
                        nested_act2.AddCell(new Phrase(Study2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Travel2 != "")
                        nested_act2.AddCell(new Phrase(Travel2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Web2 != "")
                        nested_act2.AddCell(new Phrase(Web2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Other2 != "")
                        nested_act2.AddCell(new Phrase(Other2, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    PdfPCell nesthousing_act = new PdfPCell(nested_act2);
                    table.AddCell(nesthousing_act);
                    */
                    //table.AddCell(new Phrase(FieldDay1 + "\n" + "------------------------\n" + MiniGrant1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (WorkshopsDay2Part != "")
                    {
                        nested_part2.AddCell(new Phrase(WorkshopsTotalCount2.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part2.AddCell(new Phrase(WorkshopsDay2Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay2Part != "")
                    {
                        nested_part2.AddCell(new Phrase(FieldDaysTotalCount2.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part2.AddCell(new Phrase(FieldDay2Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant2Part != "")
                    {
                        nested_part2.AddCell(new Phrase(MinigrantsTotalCount2.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part2.AddCell(new Phrase(Minigrant2Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study2Part != "")
                    {
                        nested_part2.AddCell(new Phrase(StudyTotalCount2.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part2.AddCell(new Phrase(Study2Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel2Part != "")
                    {
                        nested_part2.AddCell(new Phrase(TravelTotalCount2.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part2.AddCell(new Phrase(Travel2Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web2Part != "")
                    {
                        nested_part2.AddCell(new Phrase(WebTotalCount2.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part2.AddCell(new Phrase(Web2Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other2Part != "")
                    {
                        nested_part2.AddCell(new Phrase(OtherTotalCount2.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part2.AddCell(new Phrase(Other2Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_part = new PdfPCell(nested_part2);
                    table.AddCell(nesthousing_part);
                    //table.AddCell(new Phrase(FieldDay1Part + "\n" + "--------\n" + MiniGrant1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //table.AddCell(new Phrase(WorkshopsDay2Outputs + FieldDay2Outputs + Minigrant2Outputs, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (WorkshopsDay2Outcomes != "")
                    {
                        nested_outcomes2.AddCell(new Phrase(WorkshopsTotalCount2.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes2.AddCell(new Phrase(WorkshopsDay2Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay2Outcomes != "")
                    {
                        nested_outcomes2.AddCell(new Phrase(FieldDaysTotalCount2.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes2.AddCell(new Phrase(FieldDay2Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant2Outcomes != "")
                    {
                        nested_outcomes2.AddCell(new Phrase(MinigrantsTotalCount2.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes2.AddCell(new Phrase(Minigrant2Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study2Outcomes != "")
                    {
                        nested_outcomes2.AddCell(new Phrase(StudyTotalCount2.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes2.AddCell(new Phrase(Study2Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel2Outcomes != "")
                    {
                        nested_outcomes2.AddCell(new Phrase(TravelTotalCount2.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes2.AddCell(new Phrase(Travel2Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web2Outcomes != "")
                    {
                        nested_outcomes2.AddCell(new Phrase(WebTotalCount2.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes2.AddCell(new Phrase(Web2Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other2Outcomes != "")
                    {
                        nested_outcomes2.AddCell(new Phrase(OtherTotalCount2.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes2.AddCell(new Phrase(Other2Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_outcomes = new PdfPCell(nested_outcomes2);
                    table.AddCell(nesthousing_outcomes);

                }

                if (Title3.Length != 0)
                {
                    table.AddCell(new Phrase(Title3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    table.AddCell(new Phrase(partners3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //Changed to have only 4 columns (removed activity)
                    /*
                    if (WorkshopsDay3 != "")
                        nested_act3.AddCell(new Phrase(WorkshopsDay3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (FieldDay3 != "")
                        nested_act3.AddCell(new Phrase(FieldDay3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Minigrant3 != "")
                        nested_act3.AddCell(new Phrase(Minigrant3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Study3 != "")
                        nested_act3.AddCell(new Phrase(Study3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Travel3 != "")
                        nested_act3.AddCell(new Phrase(Travel3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Web3 != "")
                        nested_act3.AddCell(new Phrase(Web3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Other3 != "")
                        nested_act3.AddCell(new Phrase(Other3, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    PdfPCell nesthousing_act = new PdfPCell(nested_act3);
                    table.AddCell(nesthousing_act);
                    */
                    //table.AddCell(new Phrase(FieldDay1 + "\n" + "------------------------\n" + MiniGrant1, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (WorkshopsDay3Part != "")
                    {
                        nested_part3.AddCell(new Phrase(WorkshopsTotalCount3.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part3.AddCell(new Phrase(WorkshopsDay3Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay3Part != "")
                    {
                        nested_part3.AddCell(new Phrase(FieldDaysTotalCount3.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part3.AddCell(new Phrase(FieldDay3Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant3Part != "")
                    {
                        nested_part3.AddCell(new Phrase(MinigrantsTotalCount3.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part3.AddCell(new Phrase(Minigrant3Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study3Part != "")
                    {
                        nested_part3.AddCell(new Phrase(StudyTotalCount3.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part3.AddCell(new Phrase(Study3Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel3Part != "")
                    {
                        nested_part3.AddCell(new Phrase(TravelTotalCount3.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part3.AddCell(new Phrase(Travel3Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web3Part != "")
                    {
                        nested_part3.AddCell(new Phrase(WebTotalCount3.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part3.AddCell(new Phrase(Web3Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other3Part != "")
                    {
                        nested_part3.AddCell(new Phrase(OtherTotalCount3.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part3.AddCell(new Phrase(Other3Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_part = new PdfPCell(nested_part3);
                    table.AddCell(nesthousing_part);
                    //table.AddCell(new Phrase(FieldDay1Part + "\n" + "--------\n" + MiniGrant1Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //table.AddCell(new Phrase(WorkshopsDay3Outputs + FieldDay3Outputs + Minigrant3Outputs, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (WorkshopsDay3Outcomes != "")
                    {
                        nested_outcomes3.AddCell(new Phrase(WorkshopsTotalCount3.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes3.AddCell(new Phrase(WorkshopsDay3Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay3Outcomes != "")
                    {
                        nested_outcomes3.AddCell(new Phrase(FieldDaysTotalCount3.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes3.AddCell(new Phrase(FieldDay3Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant3Outcomes != "")
                    {
                        nested_outcomes3.AddCell(new Phrase(MinigrantsTotalCount3.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes3.AddCell(new Phrase(Minigrant3Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study3Outcomes != "")
                    {
                        nested_outcomes3.AddCell(new Phrase(StudyTotalCount3.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes3.AddCell(new Phrase(Study3Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel3Outcomes != "")
                    {
                        nested_outcomes3.AddCell(new Phrase(TravelTotalCount3.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes3.AddCell(new Phrase(Travel3Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web3Outcomes != "")
                    {
                        nested_outcomes3.AddCell(new Phrase(WebTotalCount3.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes3.AddCell(new Phrase(Web3Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other3Outcomes != "")
                    {
                        nested_outcomes3.AddCell(new Phrase(OtherTotalCount3.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes3.AddCell(new Phrase(Other3Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_outcomes = new PdfPCell(nested_outcomes3);
                    table.AddCell(nesthousing_outcomes);
                }

                if (Title4.Length != 0)
                {
                    table.AddCell(new Phrase(Title4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    table.AddCell(new Phrase(partners4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //Changed to have only 4 columns (removed activity)
                    /*
                    if (WorkshopsDay4 != "")
                        nested_act4.AddCell(new Phrase(WorkshopsDay4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (FieldDay4 != "")
                        nested_act4.AddCell(new Phrase(FieldDay4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Minigrant4 != "")
                        nested_act4.AddCell(new Phrase(Minigrant4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Study4 != "")
                        nested_act4.AddCell(new Phrase(Study4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Travel4 != "")
                        nested_act4.AddCell(new Phrase(Travel4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Web4 != "")
                        nested_act4.AddCell(new Phrase(Web4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Other4 != "")
                        nested_act4.AddCell(new Phrase(Other4, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    PdfPCell nesthousing_act = new PdfPCell(nested_act4);
                    table.AddCell(nesthousing_act);
                    */
                    if (WorkshopsDay4Part != "")
                    {
                        nested_part4.AddCell(new Phrase(WorkshopsTotalCount4.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part4.AddCell(new Phrase(WorkshopsDay4Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay4Part != "")
                    {
                        nested_part4.AddCell(new Phrase(FieldDaysTotalCount4.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part4.AddCell(new Phrase(FieldDay4Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant4Part != "")
                    {
                        nested_part4.AddCell(new Phrase(MinigrantsTotalCount4.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part4.AddCell(new Phrase(Minigrant4Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study4Part != "")
                    {
                        nested_part4.AddCell(new Phrase(StudyTotalCount4.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part4.AddCell(new Phrase(Study4Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel4Part != "")
                    {
                        nested_part4.AddCell(new Phrase(TravelTotalCount4.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part4.AddCell(new Phrase(Travel4Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web4Part != "")
                    {
                        nested_part4.AddCell(new Phrase(WebTotalCount4.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part4.AddCell(new Phrase(Web4Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other4Part != "")
                    {
                        nested_part4.AddCell(new Phrase(OtherTotalCount4.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part4.AddCell(new Phrase(Other4Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_part = new PdfPCell(nested_part4);
                    table.AddCell(nesthousing_part);
                    //table.AddCell(new Phrase(WorkshopsDay4Outputs + FieldDay4Outputs + Minigrant4Outputs, FontFactory.GetFont(BaseFont.HELVETICA, 8)));

                    if (WorkshopsDay4Outcomes != "")
                    {
                        nested_outcomes4.AddCell(new Phrase(WorkshopsTotalCount4.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes4.AddCell(new Phrase(WorkshopsDay4Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay4Outcomes != "")
                    {
                        nested_outcomes4.AddCell(new Phrase(FieldDaysTotalCount4.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes4.AddCell(new Phrase(FieldDay4Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant4Outcomes != "")
                    {
                        nested_outcomes4.AddCell(new Phrase(MinigrantsTotalCount4.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes4.AddCell(new Phrase(Minigrant4Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study4Outcomes != "")
                    {
                        nested_outcomes4.AddCell(new Phrase(StudyTotalCount4.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes4.AddCell(new Phrase(Study4Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel4Outcomes != "")
                    {
                        nested_outcomes4.AddCell(new Phrase(TravelTotalCount4.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes4.AddCell(new Phrase(Travel4Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web4Outcomes != "")
                    {
                        nested_outcomes4.AddCell(new Phrase(WebTotalCount4.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes4.AddCell(new Phrase(Web4Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other4Outcomes != "")
                    {
                        nested_outcomes4.AddCell(new Phrase(OtherTotalCount4.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes4.AddCell(new Phrase(Other4Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_outcomes = new PdfPCell(nested_outcomes4);
                    table.AddCell(nesthousing_outcomes);
                }

                if (Title5.Length != 0)
                {
                    table.AddCell(new Phrase(Title5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    table.AddCell(new Phrase(partners5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //Changed to have only 4 columns (removed activity)
                    /*
                    if (WorkshopsDay5 != "")
                        nested_act5.AddCell(new Phrase(WorkshopsDay5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (FieldDay5 != "")
                        nested_act5.AddCell(new Phrase(FieldDay5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Minigrant5 != "")
                        nested_act5.AddCell(new Phrase(Minigrant5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Study5 != "")
                        nested_act5.AddCell(new Phrase(Study5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Travel5 != "")
                        nested_act5.AddCell(new Phrase(Travel5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Web5 != "")
                        nested_act5.AddCell(new Phrase(Web5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Other5 != "")
                        nested_act5.AddCell(new Phrase(Other5, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    PdfPCell nesthousing_act = new PdfPCell(nested_act5);
                    table.AddCell(nesthousing_act);
                    */
                    if (WorkshopsDay5Part != "")
                    {
                        nested_part5.AddCell(new Phrase(WorkshopsTotalCount5.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part5.AddCell(new Phrase(WorkshopsDay5Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay5Part != "")
                    {
                        nested_part5.AddCell(new Phrase(FieldDaysTotalCount5.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part5.AddCell(new Phrase(FieldDay5Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant5Part != "")
                    {
                        nested_part5.AddCell(new Phrase(MinigrantsTotalCount5.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part5.AddCell(new Phrase(Minigrant5Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study5Part != "")
                    {
                        nested_part5.AddCell(new Phrase(StudyTotalCount5.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part5.AddCell(new Phrase(Study5Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel5Part != "")
                    {
                        nested_part5.AddCell(new Phrase(TravelTotalCount5.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part5.AddCell(new Phrase(Travel5Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web5Part != "")
                    {
                        nested_part5.AddCell(new Phrase(WebTotalCount5.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part5.AddCell(new Phrase(Web5Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other5Part != "")
                    {
                        nested_part5.AddCell(new Phrase(OtherTotalCount5.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part5.AddCell(new Phrase(Other5Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_part = new PdfPCell(nested_part5);
                    table.AddCell(nesthousing_part);
                    //table.AddCell(new Phrase(WorkshopsDay5Outputs + FieldDay5Outputs + Minigrant5Outputs, FontFactory.GetFont(BaseFont.HELVETICA, 8)));

                    if (WorkshopsDay5Outcomes != "")
                    {
                        nested_outcomes5.AddCell(new Phrase(WorkshopsTotalCount5.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes5.AddCell(new Phrase(WorkshopsDay5Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay5Outcomes != "")
                    {
                        nested_outcomes5.AddCell(new Phrase(FieldDaysTotalCount5.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes5.AddCell(new Phrase(FieldDay5Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant5Outcomes != "")
                    {
                        nested_outcomes5.AddCell(new Phrase(MinigrantsTotalCount5.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes5.AddCell(new Phrase(Minigrant5Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study5Outcomes != "")
                    {
                        nested_outcomes5.AddCell(new Phrase(StudyTotalCount5.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes5.AddCell(new Phrase(Study5Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel5Outcomes != "")
                    {
                        nested_outcomes5.AddCell(new Phrase(TravelTotalCount5.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes5.AddCell(new Phrase(Travel5Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web5Outcomes != "")
                    {
                        nested_outcomes5.AddCell(new Phrase(WebTotalCount5.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes5.AddCell(new Phrase(Web5Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other5Outcomes != "")
                    {
                        nested_outcomes5.AddCell(new Phrase(OtherTotalCount5.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes5.AddCell(new Phrase(Other5Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_outcomes = new PdfPCell(nested_outcomes5);
                    table.AddCell(nesthousing_outcomes);
                }

                if (Title6.Length != 0)
                {
                    table.AddCell(new Phrase(Title6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    table.AddCell(new Phrase(partners6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    //Changed to have only 4 columns (removed activity)
                    /*
                    if (WorkshopsDay6 != "")
                        nested_act6.AddCell(new Phrase(WorkshopsDay6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (FieldDay6 != "")
                        nested_act6.AddCell(new Phrase(FieldDay6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Minigrant6 != "")
                        nested_act6.AddCell(new Phrase(Minigrant6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Study6 != "")
                        nested_act6.AddCell(new Phrase(Study6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Travel6 != "")
                        nested_act6.AddCell(new Phrase(Travel6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Web6 != "")
                        nested_act6.AddCell(new Phrase(Web6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    if (Other6 != "")
                        nested_act6.AddCell(new Phrase(Other6, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    PdfPCell nesthousing_act = new PdfPCell(nested_act6);
                    table.AddCell(nesthousing_act);
                    */
                    if (WorkshopsDay6Part != "")
                    {
                        nested_part6.AddCell(new Phrase(WorkshopsTotalCount6.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part6.AddCell(new Phrase(WorkshopsDay6Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay6Part != "")
                    {
                        nested_part6.AddCell(new Phrase(FieldDaysTotalCount6.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part6.AddCell(new Phrase(FieldDay6Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant6Part != "")
                    {
                        nested_part6.AddCell(new Phrase(MinigrantsTotalCount6.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part6.AddCell(new Phrase(Minigrant6Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study6Part != "")
                    {
                        nested_part6.AddCell(new Phrase(StudyTotalCount6.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part6.AddCell(new Phrase(Study6Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel6Part != "")
                    {
                        nested_part6.AddCell(new Phrase(TravelTotalCount6.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part6.AddCell(new Phrase(Travel6Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web6Part != "")
                    {
                        nested_part6.AddCell(new Phrase(WebTotalCount6.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part6.AddCell(new Phrase(Web6Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other6Part != "")
                    {
                        nested_part6.AddCell(new Phrase(OtherTotalCount6.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_part6.AddCell(new Phrase(Other6Part, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_part = new PdfPCell(nested_part6);
                    table.AddCell(nesthousing_part);
                    //table.AddCell(new Phrase(WorkshopsDay6Outputs + FieldDay6Outputs + Minigrant6Outputs, FontFactory.GetFont(BaseFont.HELVETICA, 8)));

                    if (WorkshopsDay6Outcomes != "")
                    {
                        nested_outcomes6.AddCell(new Phrase(WorkshopsTotalCount6.ToString() + " - Workshops", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes6.AddCell(new Phrase(WorkshopsDay6Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (FieldDay6Outcomes != "")
                    {
                        nested_outcomes6.AddCell(new Phrase(FieldDaysTotalCount6.ToString() + " - Field Days/Tour", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes6.AddCell(new Phrase(FieldDay6Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Minigrant6Outcomes != "")
                    {
                        nested_outcomes6.AddCell(new Phrase(MinigrantsTotalCount6.ToString() + " - Curricula", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes6.AddCell(new Phrase(Minigrant6Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Study6Outcomes != "")
                    {
                        nested_outcomes6.AddCell(new Phrase(StudyTotalCount6.ToString() + " - Study Circle/Focus Group", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes6.AddCell(new Phrase(Study6Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Travel6Outcomes != "")
                    {
                        nested_outcomes6.AddCell(new Phrase(TravelTotalCount6.ToString() + " - Travel Scholarships", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes6.AddCell(new Phrase(Travel6Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Web6Outcomes != "")
                    {
                        nested_outcomes6.AddCell(new Phrase(WebTotalCount6.ToString() + " - Webinars", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes6.AddCell(new Phrase(Web6Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    if (Other6Outcomes != "")
                    {
                        nested_outcomes6.AddCell(new Phrase(OtherTotalCount6.ToString() + " - Other Activities", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 8)));
                        nested_outcomes6.AddCell(new Phrase(Other6Outcomes, FontFactory.GetFont(BaseFont.HELVETICA, 8)));
                    }
                    PdfPCell nesthousing_outcomes = new PdfPCell(nested_outcomes6);
                    table.AddCell(nesthousing_outcomes);
                }

                document.Add(table);


            }
            catch (Exception ee)
            {
                Session["statusMessage1"] = ee.ToString();
            }
            finally
            {
                document.Close();

            }

            string docPath = path + fileName;
            //ShowPdf(docPath);
            ShowPdf(docStream, myPDFWriter);

        }


         /// <summary>
        /// generate state report  .pdf
        /// </summary>
        /// <param name="path">path of the document</param>
        /// <param name="fileName">name of the .pdf documen</param>
        /// <param name="download">is this downloadable</param>
        /// <param name="text">text to place in the .pdf</param>
        private void GenerateStateReportPDF(string path, string fileName, bool download, string projNum)
        {
            System.IO.FileStream docStream = new System.IO.FileStream(path + fileName, FileMode.Create); 
            Document document = new Document(PageSize.A4, 60, 60, 10, 10);
                        
            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();

            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;

            userConnection = new SqlConnection(userConnString);

            try
            {
                PdfWriter myPDFWriter = PdfWriter.GetInstance(document, docStream);

                document.Open();


                userConnection = new SqlConnection(userConnString);
                userSQL = "DaikonGeneratePDFStateReport";
                userCommand = new SqlCommand(userSQL, userConnection);
                userCommand.CommandType = CommandType.StoredProcedure;
                userCommand.Parameters.Add("@proj_num", SqlDbType.VarChar, 50).Value = projNum;                

                userConnection.Open();


                iTextSharp.text.ListItem li = new iTextSharp.text.ListItem();

                Paragraph paragraph = new Paragraph();
                Paragraph paragraphProject = new Paragraph();
                Paragraph paragraphCoords = new Paragraph();
                Paragraph paragraphState = new Paragraph();
                Paragraph paragraphAdvAff = new Paragraph();
                Paragraph paragraphInitTitles = new Paragraph();
                Paragraph paragraphSareFace = new Paragraph();
                Paragraph paragraphInitiative = new Paragraph();
                Paragraph paragraphParticipants = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));

                Paragraph paragraphAttachments = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));

                Paragraph projViewParagraph = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));



                string sareamount;
              

                // Add the image now
                iTextSharp.text.Image gif = iTextSharp.text.Image.GetInstance(Server.MapPath("~/SARE_CMYK_Small.jpg"));
                gif.ScaleToFit(80f, 80f);
                document.Add(gif);               

                Paragraph headingReptType = new Paragraph("Summary Report Information", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));
                headingReptType.SpacingAfter = 12f;
                document.Add(headingReptType);

                using (userDataReader = userCommand.ExecuteReader())
                {

                    while (userDataReader.Read())
                    {
                        sareamount = string.Format("{0:c}", userDataReader["funds_sare"]);
                        Chunk cProjNu = new Chunk("Project Number : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjNu);
                        Chunk cProjNuValue = new Chunk(userDataReader["proj_num"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjNuValue);
                        paragraphProject.Add("\n");

                        Chunk cProjType = new Chunk("Type : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjType);
                        Chunk cProjTypeValue = new Chunk(userDataReader["proj_type_text"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjTypeValue);
                        paragraphProject.Add("\n");

                        Chunk cProjReg = new Chunk("Title : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjReg);
                        Chunk cProjRegValue = new Chunk(userDataReader["proj_title"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjRegValue);
                        paragraphProject.Add("\n");

                        Chunk cProjGrant = new Chunk("SARE Grant : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjGrant);
                        Chunk cProjGrantValue = new Chunk(sareamount, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjGrantValue);
                        paragraphProject.Add("\n\n");
                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {
                        Chunk cStateCoord = new Chunk("State Coordinator : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphCoords.Add(cStateCoord);
                        Chunk cStateCoordValue = new Chunk(userDataReader["firstName"].ToString() + " " + userDataReader["lastName"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphCoords.Add(cStateCoordValue);
                        paragraphCoords.Add("\n");
                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {
                        Chunk cState = new Chunk("State : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphState.Add(cState);
                        Chunk cStateValue = new Chunk(userDataReader["pi_stateProName"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphState.Add(cStateValue);
                        paragraphState.Add("\n");

                        Chunk cAdvAff = new Chunk("Advisory Committee Membership Affiliation : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphAdvAff.Add(cAdvAff);
                        paragraphAdvAff.Add("\n");
                        Chunk cAdvAffValue = new Chunk(userDataReader["advName"].ToString().Trim() + ", " + userDataReader["advAff"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphAdvAff.Add(cAdvAffValue);
                        paragraphAdvAff.Add("\n\n");


                        Chunk cAdvAffDateLoc = new Chunk("Advisory Committee Meetings : (Date & Location)", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphAdvAff.Add(cAdvAffDateLoc);
                        paragraphAdvAff.Add("\n");
                        Chunk cAdvAffDateLocValue = new Chunk(userDataReader["advDate"].ToString().Trim() + ", " + userDataReader["advLocation"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphAdvAff.Add(cAdvAffDateLocValue);
                        paragraphAdvAff.Add("\n");

                        
                        Chunk cSareFace = new Chunk("Face of SARE : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphSareFace.Add(cSareFace);
                        paragraphSareFace.Add("\n");
                        Chunk cSareFaceValue = new Chunk(userDataReader["face_of_sare"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphSareFace.Add(cSareFaceValue);
                        paragraphSareFace.Add("\n");
                    }

                    userDataReader.NextResult();

                    paragraphInitTitles.Add("\n");
                    Chunk cInit = new Chunk("Initiatives : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                    paragraphInitTitles.Add(cInit);
                    paragraphInitTitles.Add("\n");

                    while (userDataReader.Read())
                    {

                        Chunk cInitValue = new Chunk(userDataReader["init_topic"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphInitTitles.Add(cInitValue);
                        paragraphInitTitles.Add("\n");
                       
                    }
                    paragraphInitTitles.Add("\n");

                    userDataReader.NextResult();
                  
                    Chunk cInitLable = new Chunk("Initiatives : Field Day/Tours Activity", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                    paragraphInitiative.Add(cInitLable);
                    paragraphInitiative.Add("\n");
                    string initTitle = "";
                    int extTotal = 0;
                    
                    while (userDataReader.Read())
                    {
                        if (initTitle != userDataReader["init_topic"].ToString())
                        {

                            if (extTotal > 0)
                            {
                                Chunk extTotalValue = new Chunk("Extension Total: " + extTotal.ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                                paragraphInitiative.Add(extTotalValue);
                                paragraphInitiative.Add("\n\n");
                                extTotal = 0;
                            }
                            Chunk cInitValue = new Chunk(userDataReader["init_topic"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA_BOLDOBLIQUE, 10));
                            paragraphInitiative.Add(cInitValue);
                            initTitle = userDataReader["init_topic"].ToString().Trim();
                            paragraphInitiative.Add("\n");
                        }
                        else
                        {
                            initTitle = userDataReader["init_topic"].ToString().Trim();
                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            string attendance = "Extension: " + userDataReader["multi_ext"].ToString() + "  NRCS: " + userDataReader["multi_nrcs"].ToString();
                            Chunk cInitValue = new Chunk(attendance, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphInitiative.Add(cInitValue);
                            initTitle = userDataReader["init_topic"].ToString().Trim();
                            paragraphInitiative.Add("\n");

                            if (extTotal == 0)
                            {
                                extTotal = Int32.Parse(userDataReader["multi_ext"].ToString());
                            }
                            else
                            {
                                extTotal = extTotal + Int32.Parse(userDataReader["multi_ext"].ToString());
                            }
                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            string attendance = "Extension: " + userDataReader["multi_ext"].ToString() + "  NRCS: " + userDataReader["multi_nrcs"].ToString();
                            Chunk cInitValue = new Chunk(attendance, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphInitiative.Add(cInitValue);
                            paragraphInitiative.Add("\n");
                            if (extTotal == 0)
                            {
                                extTotal = Int32.Parse(userDataReader["multi_ext"].ToString());
                            }
                            else
                            {
                                extTotal = extTotal + Int32.Parse(userDataReader["multi_ext"].ToString());
                            }
                        }
                                               
                    }
                    if (extTotal > 0)
                    {
                        Chunk extTotalValue = new Chunk("Extension Total: " + extTotal.ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphInitiative.Add(extTotalValue);
                        paragraphInitiative.Add("\n\n");
                        extTotal = 0;
                    }

                    userDataReader.NextResult();

                    Chunk cInitWLable = new Chunk("Initiatives : Workshop Activity", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                    paragraphInitiative.Add(cInitWLable);
                    paragraphInitiative.Add("\n");

                    string initWorkshopTitle = "";
                    int shortTotal = 0;

                    while (userDataReader.Read())
                    {
                        if (initWorkshopTitle != userDataReader["init_topic"].ToString())
                        {

                            if (shortTotal > 0)
                            {
                                Chunk shortTotalValue = new Chunk("Short Total: " + shortTotal.ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                                paragraphInitiative.Add(shortTotalValue);
                                paragraphInitiative.Add("\n\n");
                                shortTotal = 0;
                            }
                            Chunk cInitValue = new Chunk(userDataReader["init_topic"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA_BOLDOBLIQUE, 10));
                            paragraphInitiative.Add(cInitValue);
                            initWorkshopTitle = userDataReader["init_topic"].ToString().Trim();
                            paragraphInitiative.Add("\n");
                        }
                        else
                        {
                            initWorkshopTitle = userDataReader["init_topic"].ToString().Trim();
                        }

                        if (userDataReader["initiative_num"].ToString() == "0")
                        {
                            string attendance = "Short: " + userDataReader["short_ext"].ToString() + "  NRCS: " + userDataReader["short_nrcs"].ToString();
                            Chunk cInitValue = new Chunk(attendance, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphInitiative.Add(cInitValue);
                            initTitle = userDataReader["init_topic"].ToString().Trim();
                            paragraphInitiative.Add("\n");

                            if (shortTotal == 0)
                            {
                                shortTotal = Int32.Parse(userDataReader["short_ext"].ToString());
                            }
                            else
                            {
                                shortTotal = shortTotal + Int32.Parse(userDataReader["short_ext"].ToString());
                            }
                        }

                        if (userDataReader["initiative_num"].ToString() == "1")
                        {
                            string attendance = "Extension: " + userDataReader["short_ext"].ToString() + "  NRCS: " + userDataReader["short_nrcs"].ToString();
                            Chunk cInitValue = new Chunk(attendance, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphInitiative.Add(cInitValue);
                            paragraphInitiative.Add("\n");
                            if (shortTotal == 0)
                            {
                                shortTotal = Int32.Parse(userDataReader["short_ext"].ToString());
                            }
                            else
                            {
                                shortTotal = shortTotal + Int32.Parse(userDataReader["short_ext"].ToString());
                            }
                        }

                    }
                    if (shortTotal > 0)
                    {
                        Chunk extTotalValue = new Chunk("Extension Total: " + shortTotal.ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphInitiative.Add(extTotalValue);
                        paragraphInitiative.Add("\n");
                        shortTotal = 0;
                    }


                    
                    document.Add(paragraphState);
                    document.Add(paragraphCoords);
                    document.Add(paragraphProject);
                    document.Add(paragraphAdvAff);
                    document.Add(paragraphInitTitles);
                    paragraphSareFace.Add("\n\n");
                    document.Add(paragraphSareFace);
                    paragraphInitiative.Add("\n");
                    document.Add(paragraphInitiative);
                    
                }
            }
            catch (Exception ee)
            {
                Session["statusMessage1"] = ee.ToString();
            }
            finally
            {
                document.Close();
                userConnection.Dispose();
                
            }
            
            string docPath = path + fileName;
            ShowPdf(docPath);
                                   
        }

        /*
        public void CreatePDFDocument(string strHtml)
        {

            string strFileName = HttpContext.Current.Server.MapPath("test.pdf");
            // step 1: creation of a document-object
            Document document = new Document();
            // step 2:
            // we create a writer that listens to the document
            Chunk c = new Chunk("Export GridView to PDF Using iTextSharp \n",FontFactory.GetFont("Verdana", 15));
            Paragraph p = new Paragraph();
            p.Alignment = Element.ALIGN_CENTER;
            p.Add(c);
            Chunk chunk1 = new Chunk
            ("By Amit Jain, amit_jain_online@yahoo.com \n",
            FontFactory.GetFont("Verdana", 8));
            Paragraph p1 = new Paragraph();
            p1.Alignment = Element.ALIGN_RIGHT;
            p1.Add(chunk1);

            document.Add(p);
            document.Add(p1);

            System.Xml.XmlTextReader xmlReader = new System.Xml.XmlTextReader(new StringReader(strHtml));
            HtmlParser.Parse(document, xmlReader);

            document.Close();

            ShowPdf(strFileName);


        }
        */

        /// <summary>
        /// generate simplified state report  .pdf
        /// </summary>
        /// <param name="path">path of the document</param>
        /// <param name="fileName">name of the .pdf documen</param>
        /// <param name="download">is this downloadable</param>
        /// <param name="text">text to place in the .pdf</param>
        private void GenerateSimplifiedStateReportPDF(string path, string fileName, bool download, string projNum)
        {
            System.IO.FileStream docStream = new System.IO.FileStream(path + fileName, FileMode.Create);
            Document document = new Document(PageSize.A4, 60, 60, 10, 10);
            string state = "";

            if (projNum.Contains("-") && (projNum.Length == 10 || projNum.Length == 9 || projNum.Length == 8))
            {
                state = projNum.Substring(1, 2);

                if (projNum.Length == 10)
                {
                    state = projNum.Substring(2, 2);                  
                }


                state = state.ToUpper();
             
            }

            string userSQL;
            string userConnString = ConfigurationManager.ConnectionStrings["sareDaikonConnectionString"].ToString();

            SqlConnection userConnection;
            SqlCommand userCommand;
            SqlDataReader userDataReader;

            userConnection = new SqlConnection(userConnString);

            try
            {
                PdfWriter myPDFWriter = PdfWriter.GetInstance(document, docStream);

                document.Open();


                userConnection = new SqlConnection(userConnString);
                userSQL = "DaikonGeneratePDFStateReportObjectives";
                userCommand = new SqlCommand(userSQL, userConnection);
                userCommand.CommandType = CommandType.StoredProcedure;
                userCommand.Parameters.Add("@proj_num", SqlDbType.VarChar, 50).Value = projNum;
                userCommand.Parameters.Add("@state", SqlDbType.VarChar, 4).Value = state;

                userConnection.Open();


                iTextSharp.text.ListItem li = new iTextSharp.text.ListItem();

                Paragraph paragraph = new Paragraph();
                Paragraph paragraphProject = new Paragraph();
                Paragraph paragraphCoords = new Paragraph();
                Paragraph paragraphState = new Paragraph();
                Paragraph paragraphAdvAff = new Paragraph();
                Paragraph paragraphInitTitles = new Paragraph();
                Paragraph paragraphSareFace = new Paragraph();
                Paragraph paragraphInitiative = new Paragraph();
                Paragraph paragraphNarrative = new Paragraph();
                Paragraph paragraphParticipants = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));

                Paragraph paragraphAttachments = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));

                Paragraph projViewParagraph = new Paragraph("", FontFactory.GetFont(BaseFont.HELVETICA, 10));



                string sareamount;
               

                // Add the image now
                iTextSharp.text.Image gif = iTextSharp.text.Image.GetInstance(Server.MapPath("~/SARE_CMYK_Small.jpg"));
                gif.ScaleToFit(80f, 80f);
                document.Add(gif);

                Paragraph headingReptType = new Paragraph("Summary Report Information", new iTextSharp.text.Font(iTextSharp.text.Font.HELVETICA, 14, iTextSharp.text.Font.BOLD));
                headingReptType.SpacingAfter = 12f;
                document.Add(headingReptType);

                using (userDataReader = userCommand.ExecuteReader())
                {

                    while (userDataReader.Read())
                    {
                        Chunk cState = new Chunk("State : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cState);
                        Chunk cStateName = new Chunk(userDataReader["statename"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cStateName);
                        paragraphProject.Add("\n");

                        sareamount = string.Format("{0:c}", userDataReader["funds_sare"]);
                        Chunk cProjNu = new Chunk("Project Number : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjNu);
                        Chunk cProjNuValue = new Chunk(userDataReader["proj_num"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjNuValue);
                        paragraphProject.Add("\n");

                        Chunk cProjType = new Chunk("Type : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjType);
                        Chunk cProjTypeValue = new Chunk(userDataReader["proj_type_text"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjTypeValue);
                        paragraphProject.Add("\n");

                        Chunk cProjReg = new Chunk("Title : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjReg);
                        Chunk cProjRegValue = new Chunk(userDataReader["proj_title"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjRegValue);
                        paragraphProject.Add("\n");

                        Chunk cProjGrant = new Chunk("SARE Grant : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphProject.Add(cProjGrant);
                        Chunk cProjGrantValue = new Chunk(sareamount, FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphProject.Add(cProjGrantValue);
                        paragraphProject.Add("\n\n");
                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {
                        Chunk cStateCoord = new Chunk("State Coordinator : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphCoords.Add(cStateCoord);
                        Chunk cStateCoordValue = new Chunk(userDataReader["firstName"].ToString() + " " + userDataReader["lastName"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphCoords.Add(cStateCoordValue);
                        paragraphCoords.Add("\n");
                    }

                    userDataReader.NextResult();

                    while (userDataReader.Read())
                    {
                        /*
                        Chunk cState = new Chunk("State : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphState.Add(cState);
                        Chunk cStateValue = new Chunk(userDataReader["pi_stateProName"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphState.Add(cStateValue);
                        paragraphState.Add("\n");
                        */

                        Chunk cAdvAff = new Chunk("Advisory Committee Membership Affiliation : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphAdvAff.Add(cAdvAff);
                        paragraphAdvAff.Add("\n");
                        Chunk cAdvAffValue = new Chunk(userDataReader["advName"].ToString().Trim() + ", " + userDataReader["advAff"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphAdvAff.Add(cAdvAffValue);
                        if (userDataReader["advName1"].ToString().Length != 0 && userDataReader["advName1"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue1 = new Chunk(userDataReader["advName1"].ToString().Trim() + ", " + userDataReader["advAff1"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue1);
                        }
                        if (userDataReader["advName2"].ToString().Length != 0 && userDataReader["advName2"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue2 = new Chunk(userDataReader["advName2"].ToString().Trim() + ", " + userDataReader["advAff2"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue2);
                        }
                        if (userDataReader["advName3"].ToString().Length != 0 && userDataReader["advName3"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue3 = new Chunk(userDataReader["advName3"].ToString().Trim() + ", " + userDataReader["advAff3"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue3);
                        }
                        if (userDataReader["advName4"].ToString().Length != 0 && userDataReader["advName4"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue4 = new Chunk(userDataReader["advName4"].ToString().Trim() + ", " + userDataReader["advAff4"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue4);
                        }
                        if (userDataReader["advName5"].ToString().Length != 0 && userDataReader["advName5"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue5 = new Chunk(userDataReader["advName5"].ToString().Trim() + ", " + userDataReader["advAff5"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue5);
                        }
                        if (userDataReader["advName6"].ToString().Length != 0 && userDataReader["advName6"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue6 = new Chunk(userDataReader["advName6"].ToString().Trim() + ", " + userDataReader["advAff6"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue6);
                        }
                        if (userDataReader["advName7"].ToString().Length != 0 && userDataReader["advName7"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue7 = new Chunk(userDataReader["advName7"].ToString().Trim() + ", " + userDataReader["advAff7"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue7);
                        }
                        if (userDataReader["advName8"].ToString().Length != 0 && userDataReader["advName8"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue8 = new Chunk(userDataReader["advName8"].ToString().Trim() + ", " + userDataReader["advAff8"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue8);
                        }
                        if (userDataReader["advName9"].ToString().Length != 0 && userDataReader["advName9"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue9 = new Chunk(userDataReader["advName9"].ToString().Trim() + ", " + userDataReader["advAff9"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue9);
                        }
                        if (userDataReader["advName10"].ToString().Length != 0 && userDataReader["advName10"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue10 = new Chunk(userDataReader["advName10"].ToString().Trim() + ", " + userDataReader["advAff10"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue10);
                        }
                        if (userDataReader["advName11"].ToString().Length != 0 && userDataReader["advName11"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue11 = new Chunk(userDataReader["advName11"].ToString().Trim() + ", " + userDataReader["advAff11"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue11);
                        }
                        if (userDataReader["advName12"].ToString().Length != 0 && userDataReader["advName12"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue12 = new Chunk(userDataReader["advName12"].ToString().Trim() + ", " + userDataReader["advAff12"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue12);
                        }
                        if (userDataReader["advName13"].ToString().Length != 0 && userDataReader["advName13"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue13 = new Chunk(userDataReader["advName13"].ToString().Trim() + ", " + userDataReader["advAff13"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue13);
                        }
                        if (userDataReader["advName14"].ToString().Length != 0 && userDataReader["advName14"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue14 = new Chunk(userDataReader["advName14"].ToString().Trim() + ", " + userDataReader["advAff14"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue14);
                        }
                        if (userDataReader["advName15"].ToString().Length != 0 && userDataReader["advName15"].ToString() != " ")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffValue15 = new Chunk(userDataReader["advName15"].ToString().Trim() + ", " + userDataReader["advAff15"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffValue15);
                        }
                        paragraphAdvAff.Add("\n\n");


                        Chunk cAdvAffDateLoc = new Chunk("Advisory Committee Meetings : (Date & Location)", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphAdvAff.Add(cAdvAffDateLoc);
                        paragraphAdvAff.Add("\n");
                        Chunk cAdvAffDateLocValue = new Chunk(DateTime.Parse(userDataReader["advDate"].ToString().Trim()).ToShortDateString() + ", " + userDataReader["advLocation"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphAdvAff.Add(cAdvAffDateLocValue);
                        if (userDataReader["advDate1"].ToString().Length != 0 && userDataReader["advDate1"].ToString() != "")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffDateLocValue1 = new Chunk(DateTime.Parse(userDataReader["advDate1"].ToString().Trim()).ToShortDateString() + ", " + userDataReader["advLocation1"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue1);
                        }
                        if (userDataReader["advDate2"].ToString().Length != 0 && userDataReader["advDate2"].ToString() != "")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffDateLocValue2 = new Chunk(DateTime.Parse(userDataReader["advDate2"].ToString().Trim()).ToShortDateString() + ", " + userDataReader["advLocation2"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue2);
                        }
                        if (userDataReader["advDate3"].ToString().Length != 0 && userDataReader["advDate3"].ToString() != "")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffDateLocValue3 = new Chunk(DateTime.Parse(userDataReader["advDate3"].ToString().Trim()).ToShortDateString() + ", " + userDataReader["advLocation3"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue3);
                        }
                        if (userDataReader["advDate4"].ToString().Length != 0 && userDataReader["advDate4"].ToString() != "")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffDateLocValue4 = new Chunk(DateTime.Parse(userDataReader["advDate4"].ToString().Trim()).ToShortDateString() + ", " + userDataReader["advLocation4"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue4);
                        }
                        if (userDataReader["advDate5"].ToString().Length != 0 && userDataReader["advDate5"].ToString() != "")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffDateLocValue5 = new Chunk(DateTime.Parse(userDataReader["advDate5"].ToString().Trim()).ToShortDateString() + ", " + userDataReader["advLocation5"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue5);
                        }
                        if (userDataReader["advDate6"].ToString().Length != 0 && userDataReader["advDate6"].ToString() != "")
                        {
                            paragraphAdvAff.Add("\n");
                            Chunk cAdvAffDateLocValue6 = new Chunk(DateTime.Parse(userDataReader["advDate6"].ToString().Trim()).ToShortDateString() + ", " + userDataReader["advLocation6"].ToString(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                            paragraphAdvAff.Add(cAdvAffDateLocValue6);
                        }
                        paragraphAdvAff.Add("\n");


                        Chunk cSareFace = new Chunk("Face of SARE : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphSareFace.Add(cSareFace);
                        paragraphSareFace.Add("\n");
                        Chunk cSareFaceValue = new Chunk(userDataReader["sare_outreach"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphSareFace.Add(cSareFaceValue);
                        paragraphSareFace.Add("\n");
                    }

                    userDataReader.NextResult();

                    paragraphInitTitles.Add("\n");
                    Chunk cInit = new Chunk("Initiatives : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                    paragraphInitTitles.Add(cInit);
                    paragraphInitTitles.Add("\n");

                    while (userDataReader.Read())
                    {

                        Chunk cInitValue = new Chunk(userDataReader["init_topic"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphInitTitles.Add(cInitValue);
                        paragraphInitTitles.Add("\n");

                        Chunk cInitObj = new Chunk("Objectives : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                        paragraphInitTitles.Add(cInitObj);
                        Chunk cInitObjValue = new Chunk(userDataReader["training_obj"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphInitTitles.Add(cInitObjValue);
                        paragraphInitTitles.Add("\n\n");

                    }
                    paragraphInitTitles.Add("\n");

                    userDataReader.NextResult();

                    paragraphNarrative.Add("\n");
                    Chunk cNarrLabel = new Chunk("Outcome Narrative : ", FontFactory.GetFont(BaseFont.HELVETICA_BOLD, 10));
                    paragraphNarrative.Add(cNarrLabel);
                    //paragraphNarrative.Add("\n");

                    while (userDataReader.Read())
                    {

                        Chunk cNarrValue = new Chunk(userDataReader["out_summary"].ToString().Trim(), FontFactory.GetFont(BaseFont.HELVETICA, 10));
                        paragraphNarrative.Add(cNarrValue);
                        paragraphNarrative.Add("\n");
                        

                    }

                    document.Add(paragraphState);
                    document.Add(paragraphCoords);
                    document.Add(paragraphProject);
                    document.Add(paragraphAdvAff);
                    document.Add(paragraphInitTitles);
                    paragraphSareFace.Add("\n\n");
                    document.Add(paragraphSareFace);
                    paragraphInitiative.Add("\n");
                    document.Add(paragraphNarrative);
                    paragraphInitiative.Add("\n");

                }
            }
            catch (Exception ee)
            {
                Session["statusMessage1"] = ee.ToString();
            }
            finally
            {
                document.Close();
                userConnection.Dispose();

            }

            string docPath = path + fileName;
            ShowPdf(docPath);

        }

        public void ShowPdf(string strFileName)
        {
            Response.ClearContent();
            Response.ClearHeaders();
            Response.AddHeader("Content-Disposition", "inline;filename=" + strFileName);
            Response.ContentType = "application/pdf";
            //Response.Write("<SCRIPT language=javascript>var pdf=window.open('" + strFileName + "','PDF');pdf.moveTo(0,0);</SCRIPT>");
            //Response.WriteFile(strFileName);
            Response.TransmitFile(strFileName);            
            Response.End();
            Response.Flush();
            Response.Clear();
        }

        public void ShowPdf(MemoryStream mem, PdfWriter writer)
        {
            Response.ClearContent();
            Response.ClearHeaders();
            Response.ContentType = "application/pdf";
            // write the document data to response stream
            writer.Flush();
            Response.OutputStream.Write(mem.GetBuffer(), 0, mem.GetBuffer().Length);
            Response.OutputStream.Flush();
            Response.OutputStream.Close();
            Response.End();
            Response.End();
            Response.Flush();
            Response.Clear();
        }

		#region Web Form Designer generated code
		override protected void OnInit(EventArgs e)
		{
			//
			// CODEGEN: This call is required by the ASP.NET Web Form Designer.
			//
			InitializeComponent();
			base.OnInit(e);
		}

		/// <summary>
		/// Required method for Designer support - do not modify
		/// the contents of this method with the code editor.
		/// </summary>
		private void InitializeComponent()
		{

		}
		#endregion

	}

}
